# 国際化・ローカライゼーション仕様書（i18n / l10n Specification）

**ドキュメントID:** WUI-I18N-001
**プロジェクト名:** WebUI サンプルシステム
**バージョン:** 1.0.0
**作成日:** 2026-02-25
**最終更新日:** 2026-02-25
**ステータス:** Draft

---

## 1. 対応言語・ロケール

### 1.1 サポート言語

| 言語 | ロケールコード | 対応レベル | 備考 |
|------|------------|---------|------|
| 日本語 | `ja` | フル対応 | デフォルト言語 |
| 英語（米国） | `en-US` | フル対応 | - |
| 英語（英国） | `en-GB` | 部分対応 | 日付形式のみ差異 |

### 1.2 デフォルト設定

- **デフォルト言語:** `ja`（日本語）
- **フォールバック言語:** `en-US`
- **言語検出順:** ユーザー設定 → ブラウザ設定 → デフォルト（`ja`）

---

## 2. 国際化フレームワーク

### 2.1 採用ライブラリ

**react-i18next**（i18next ベース）

```bash
npm install react-i18next i18next i18next-browser-languagedetector
npm install i18next-resources-to-backend
```

### 2.2 初期化設定

```typescript
// i18n/config.ts
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';
import resourcesToBackend from 'i18next-resources-to-backend';

i18n
  .use(LanguageDetector)
  .use(initReactI18next)
  .use(
    resourcesToBackend(
      (language: string, namespace: string) =>
        import(`./locales/${language}/${namespace}.json`)
    )
  )
  .init({
    fallbackLng: 'ja',
    supportedLngs: ['ja', 'en-US', 'en-GB'],
    defaultNS: 'common',
    ns: ['common', 'auth', 'data', 'errors', 'validation'],
    interpolation: {
      escapeValue: false,  // Reactは自動エスケープ
    },
    detection: {
      order: ['localStorage', 'navigator', 'htmlTag'],
      cacheUserLanguage: true,
    },
  });
```

---

## 3. 翻訳リソース構成

### 3.1 ネームスペース構成

```
i18n/locales/
├── ja/
│   ├── common.json      # 共通テキスト
│   ├── auth.json        # 認証関連
│   ├── data.json        # データ管理
│   ├── errors.json      # エラーメッセージ
│   └── validation.json  # バリデーションメッセージ
└── en-US/
    ├── common.json
    ├── auth.json
    ├── data.json
    ├── errors.json
    └── validation.json
```

### 3.2 翻訳ファイル例（common.json）

```json
// ja/common.json
{
  "app": {
    "name": "サンプルシステム",
    "loading": "読み込み中...",
    "saving": "保存中..."
  },
  "actions": {
    "create": "新規作成",
    "edit": "編集",
    "delete": "削除",
    "save": "保存",
    "cancel": "キャンセル",
    "search": "検索",
    "export": "エクスポート",
    "import": "インポート",
    "confirm": "確認",
    "back": "戻る",
    "next": "次へ",
    "previous": "前へ",
    "refresh": "更新",
    "close": "閉じる",
    "submit": "送信"
  },
  "status": {
    "active": "有効",
    "inactive": "無効",
    "pending": "保留"
  },
  "table": {
    "noData": "データがありません",
    "total": "全{{total}}件",
    "showing": "{{start}}-{{end}}件（全{{total}}件中）",
    "rowsPerPage": "表示件数"
  },
  "confirm": {
    "deleteTitle": "削除の確認",
    "deleteMessage": "「{{name}}」を削除しますか？この操作は取り消せません。",
    "bulkDeleteMessage": "選択した{{count}}件を削除しますか？この操作は取り消せません。"
  },
  "theme": {
    "light": "ライト",
    "dark": "ダーク",
    "system": "システム設定に従う"
  },
  "language": {
    "ja": "日本語",
    "en-US": "English (US)"
  }
}
```

```json
// ja/validation.json
{
  "required": "{{field}}は必須です",
  "email": "有効なメールアドレスを入力してください",
  "minLength": "{{field}}は{{min}}文字以上で入力してください",
  "maxLength": "{{field}}は{{max}}文字以内で入力してください",
  "pattern": "{{field}}の形式が正しくありません",
  "min": "{{field}}は{{min}}以上の値を入力してください",
  "max": "{{field}}は{{max}}以下の値を入力してください",
  "passwordMismatch": "パスワードが一致しません",
  "uniqueEmail": "このメールアドレスは既に使用されています"
}
```

### 3.3 複数形対応

```json
// en-US/common.json
{
  "table": {
    "showing_one": "Showing {{count}} item",
    "showing_other": "Showing {{count}} items"
  },
  "confirm": {
    "deleteMessage_one": "Delete {{count}} item? This cannot be undone.",
    "deleteMessage_other": "Delete {{count}} items? This cannot be undone."
  }
}
```

```typescript
// 使用例
t('table.showing', { count: items.length })
```

---

## 4. 日付・時刻の国際化

### 4.1 フォーマット定義

| ロケール | 短い日付 | 長い日付 | 日時 |
|--------|---------|--------|------|
| ja | 2026/02/25 | 2026年2月25日 | 2026/02/25 10:00 |
| en-US | 02/25/2026 | February 25, 2026 | 02/25/2026 10:00 AM |
| en-GB | 25/02/2026 | 25 February 2026 | 25/02/2026 10:00 |

### 4.2 Intl API 使用

```typescript
// lib/utils/date.ts
export const formatDate = (
  date: Date | string,
  format: 'short' | 'long' | 'datetime' | 'relative',
  locale: string = 'ja'
): string => {
  const d = typeof date === 'string' ? new Date(date) : date;

  switch (format) {
    case 'short':
      return new Intl.DateTimeFormat(locale, {
        year: 'numeric', month: '2-digit', day: '2-digit'
      }).format(d);

    case 'long':
      return new Intl.DateTimeFormat(locale, {
        year: 'numeric', month: 'long', day: 'numeric'
      }).format(d);

    case 'datetime':
      return new Intl.DateTimeFormat(locale, {
        year: 'numeric', month: '2-digit', day: '2-digit',
        hour: '2-digit', minute: '2-digit'
      }).format(d);

    case 'relative': {
      const rtf = new Intl.RelativeTimeFormat(locale, { numeric: 'auto' });
      const diff = (d.getTime() - Date.now()) / 1000;
      if (Math.abs(diff) < 60) return rtf.format(Math.round(diff), 'second');
      if (Math.abs(diff) < 3600) return rtf.format(Math.round(diff / 60), 'minute');
      if (Math.abs(diff) < 86400) return rtf.format(Math.round(diff / 3600), 'hour');
      return rtf.format(Math.round(diff / 86400), 'day');
    }
  }
};
```

### 4.3 タイムゾーン対応

- **APIのタイムスタンプ:** UTC（ISO8601形式: `2026-02-25T10:00:00Z`）
- **表示:** ユーザーのタイムゾーン設定に変換して表示
- **入力:** ローカル時刻で入力し、APIへ送信時にUTCに変換

```typescript
// タイムゾーン変換
const displayDate = new Intl.DateTimeFormat(locale, {
  timeZone: userTimezone,  // 例: 'Asia/Tokyo'
  ...options
}).format(new Date(utcString));
```

---

## 5. 数値・通貨の国際化

```typescript
// 数値フォーマット
const formatNumber = (value: number, locale: string) =>
  new Intl.NumberFormat(locale).format(value);
// ja: 1,234,567 / en-US: 1,234,567

// 通貨フォーマット（表示のみ・実際の決済機能なし）
const formatCurrency = (value: number, currency: string, locale: string) =>
  new Intl.NumberFormat(locale, { style: 'currency', currency }).format(value);
// ja/JPY: ¥1,234,567 / en-US/USD: $12,345.67
```

---

## 6. RTL（右から左）言語対応（将来対応）

アラビア語・ヘブライ語等のRTL言語は将来対応とする。現時点での設計考慮事項：

- Tailwind CSS の `dir` 属性対応 Variant を使用する
- `margin-left/right` の代わりに `margin-inline-start/end` を使用する

---

## 7. 翻訳管理

### 7.1 翻訳キーの命名規則

```
{namespace}.{context}.{key}

例:
common.actions.save
auth.login.emailLabel
data.list.emptyMessage
errors.network.timeout
validation.required
```

### 7.2 未翻訳キーの検出

```bash
# i18next-parser で未翻訳・不使用キーを検出
npx i18next-parser src/**/*.{ts,tsx}

# 結果: missing.json（未翻訳）・obsolete.json（不使用）
```

---

## 8. 改訂履歴

| バージョン | 日付 | 変更内容 | 担当者 |
|-----------|------|---------|--------|
| 1.0.0 | 2026-02-25 | 初版作成 | システム管理者 |
