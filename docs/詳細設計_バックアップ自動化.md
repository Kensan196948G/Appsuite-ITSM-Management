# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è‡ªå‹•åŒ–ï¼ˆGitHub Actionsï¼‰è©³ç´°è¨­è¨ˆæ›¸

**ä½œæˆæ—¥**: 2026-02-11
**å¯¾è±¡ãƒ•ã‚§ãƒ¼ã‚º**: Phase 5
**å®Ÿè£…æœŸé–“**: 2æ—¥
**å„ªå…ˆåº¦**: P2ï¼ˆé«˜å„ªå…ˆåº¦ï¼‰

---

## 1. èƒŒæ™¯ã¨ç›®çš„

### 1.1 ç¾çŠ¶ã®èª²é¡Œ

| é …ç›® | ç¾çŠ¶ | èª²é¡Œ |
|------|------|------|
| **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ–¹å¼** | æ‰‹å‹•ã®ã¿ | å–å¾—å¿˜ã‚Œãƒªã‚¹ã‚¯ |
| **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é »åº¦** | ä¸å®šæœŸ | ãƒ‡ãƒ¼ã‚¿æå¤±ãƒªã‚¹ã‚¯ |
| **ä¿å­˜å ´æ‰€** | localStorageã®ã¿ | ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ã§å…¨æ |
| **ã‚ªãƒ•ã‚µã‚¤ãƒˆ** | ãªã— | ç½å®³æ™‚ã®å¾©æ—§ä¸å¯ |
| **è‡ªå‹•åŒ–** | ãªã— | é‹ç”¨è² è·å¤§ |

### 1.2 å¯¾ç­–ç›®æ¨™

| é …ç›® | ç›®æ¨™ |
|------|------|
| **è‡ªå‹•åŒ–** | GitHub Actionsã§æ—¥æ¬¡è‡ªå‹•å®Ÿè¡Œ |
| **é »åº¦** | æ¯æ—¥2:00 AMï¼ˆJSTï¼‰ |
| **ä¿å­˜å ´æ‰€** | GitHub Repositoryï¼ˆartifactsï¼‰ |
| **ä¿æŒæœŸé–“** | 90æ—¥é–“ï¼ˆITSMç›£æŸ»å¯¾å¿œï¼‰ |
| **é€šçŸ¥** | Slack/ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ |

---

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### 2.1 ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ãƒ­ãƒ¼

```
GitHub Actions (Cron: æ¯æ—¥2:00 AM)
  â†“
WebUIèµ·å‹•ï¼ˆNode.js + Playwrightï¼‰
  â†“
localStorageå…¨ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
  â†“
JSONãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆï¼ˆappsuite_backup_YYYYMMDD_HHMMSS.jsonï¼‰
  â†“
GitHub Artifacts ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆ90æ—¥ä¿æŒï¼‰
  â†“
Slack/ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
```

### 2.2 ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¯¾è±¡ãƒ‡ãƒ¼ã‚¿

| ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ | èª¬æ˜ | å„ªå…ˆåº¦ |
|------------|------|--------|
| users | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ | é«˜ |
| apps | ã‚¢ãƒ—ãƒªä¸€è¦§ | é«˜ |
| incidents | ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ | é«˜ |
| changes | å¤‰æ›´è¦æ±‚ | é«˜ |
| logs | ç›£æŸ»ãƒ­ã‚° | ä¸­ |
| settings | ã‚·ã‚¹ãƒ†ãƒ è¨­å®š | é«˜ |

---

## 3. GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè£…

### 3.1 ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«

**ãƒ•ã‚¡ã‚¤ãƒ«**: `.github/workflows/daily-backup.yml`ï¼ˆæ–°è¦ä½œæˆï¼‰

```yaml
name: Daily Backup (AppSuite ITSM)

on:
  # æ¯æ—¥2:00 AMï¼ˆUTC 17:00 = JST 02:00ï¼‰
  schedule:
    - cron: '0 17 * * *'

  # æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼
  workflow_dispatch:
    inputs:
      reason:
        description: 'Backup reason'
        required: false
        default: 'Manual backup'

permissions:
  contents: read

jobs:
  backup:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      # ========================================
      # Step 1: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      # ========================================
      - name: Checkout repository
        uses: actions/checkout@v4

      # ========================================
      # Step 2: Node.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      # ========================================
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      # ========================================
      # Step 3: ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      # ========================================
      - name: Install dependencies
        run: |
          npm ci || npm install
          npx playwright install chromium

      # ========================================
      # Step 4: WebUIã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰
      # ========================================
      - name: Start WebUI Server
        run: |
          cd WebUI-Production
          npx http-server . -p 8888 --silent &
          sleep 5
          echo "WebUI Server started on http://localhost:8888"

      # ========================================
      # Step 5: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
      # ========================================
      - name: Run Backup Script
        id: backup
        run: |
          node scripts/backup-automation.js
        env:
          BACKUP_DIR: ./backups
          TIMESTAMP: ${{ github.run_id }}_${{ github.run_number }}

      # ========================================
      # Step 6: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      # ========================================
      - name: Upload Backup Artifact
        uses: actions/upload-artifact@v4
        with:
          name: appsuite-backup-${{ github.run_id }}
          path: backups/*.json
          retention-days: 90  # 90æ—¥é–“ä¿æŒï¼ˆITSMç›£æŸ»å¯¾å¿œï¼‰

      # ========================================
      # Step 7: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ¤œè¨¼
      # ========================================
      - name: Verify Backup
        run: |
          echo "Verifying backup files..."
          for file in backups/*.json; do
            if [ -f "$file" ]; then
              SIZE=$(stat -f%z "$file" 2>/dev/null || stat -c%s "$file")
              echo "âœ… $file: $((SIZE / 1024)) KB"

              # JSONå¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
              if ! jq empty "$file" 2>/dev/null; then
                echo "âŒ Invalid JSON: $file"
                exit 1
              fi
            fi
          done
          echo "All backup files verified successfully"

      # ========================================
      # Step 8: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚µãƒãƒªãƒ¼ç”Ÿæˆ
      # ========================================
      - name: Generate Backup Summary
        if: always()
        run: |
          echo "## ğŸ“¦ Daily Backup Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Date**: $(date +'%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY
          echo "**Run ID**: ${{ github.run_id }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Backup Files" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| File | Size | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|------|------|--------|" >> $GITHUB_STEP_SUMMARY

          for file in backups/*.json; do
            if [ -f "$file" ]; then
              BASENAME=$(basename "$file")
              SIZE=$(stat -f%z "$file" 2>/dev/null || stat -c%s "$file")
              echo "| $BASENAME | $((SIZE / 1024)) KB | âœ… |" >> $GITHUB_STEP_SUMMARY
            fi
          done

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Retention" >> $GITHUB_STEP_SUMMARY
          echo "Backup files are retained for **90 days**" >> $GITHUB_STEP_SUMMARY

      # ========================================
      # Step 9: Slacké€šçŸ¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
      # ========================================
      - name: Notify Slack
        if: always()
        uses: slackapi/slack-github-action@v1
        with:
          webhook-url: ${{ secrets.SLACK_WEBHOOK_URL }}
          payload: |
            {
              "text": "AppSuite ITSM Daily Backup",
              "blocks": [
                {
                  "type": "header",
                  "text": {
                    "type": "plain_text",
                    "text": "ğŸ“¦ Daily Backup Completed"
                  }
                },
                {
                  "type": "section",
                  "fields": [
                    {
                      "type": "mrkdwn",
                      "text": "*Status:*\n${{ job.status == 'success' && 'âœ… Success' || 'âŒ Failed' }}"
                    },
                    {
                      "type": "mrkdwn",
                      "text": "*Date:*\n$(date +'%Y-%m-%d %H:%M:%S')"
                    },
                    {
                      "type": "mrkdwn",
                      "text": "*Run ID:*\n${{ github.run_id }}"
                    },
                    {
                      "type": "mrkdwn",
                      "text": "*Retention:*\n90 days"
                    }
                  ]
                },
                {
                  "type": "actions",
                  "elements": [
                    {
                      "type": "button",
                      "text": {
                        "type": "plain_text",
                        "text": "View Workflow"
                      },
                      "url": "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
                    }
                  ]
                }
              ]
            }
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

      # ========================================
      # Step 10: ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
      # ========================================
      - name: Send Email Notification
        if: always()
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: AppSuite ITSM Daily Backup - ${{ job.status }}
          to: admin@example.com
          from: GitHub Actions <noreply@github.com>
          body: |
            AppSuite ITSM æ—¥æ¬¡ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

            Status: ${{ job.status }}
            Date: $(date +'%Y-%m-%d %H:%M:%S UTC')
            Run ID: ${{ github.run_id }}

            è©³ç´°: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}
```

---

## 4. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè£…

### 4.1 è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `scripts/backup-automation.js`ï¼ˆæ–°è¦ä½œæˆï¼‰

```javascript
/**
 * AppSuite ITSM ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
 *
 * Playwrightã‚’ä½¿ç”¨ã—ã¦WebUIã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€localStorageã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
 */

const { chromium } = require('playwright');
const fs = require('fs').promises;
const path = require('path');

// è¨­å®š
const CONFIG = {
    webUiUrl: process.env.WEBUI_URL || 'http://localhost:8888',
    backupDir: process.env.BACKUP_DIR || './backups',
    timeout: 30000
};

/**
 * ãƒ¡ã‚¤ãƒ³é–¢æ•°
 */
async function main() {
    console.log('========================================');
    console.log('ğŸ“¦ AppSuite ITSM ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é–‹å§‹');
    console.log('========================================');
    console.log(`WebUI URL: ${CONFIG.webUiUrl}`);
    console.log(`Backup Dir: ${CONFIG.backupDir}`);
    console.log('');

    let browser;

    try {
        // Step 1: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
        await fs.mkdir(CONFIG.backupDir, { recursive: true });
        console.log('âœ… Backup directory created');

        // Step 2: ãƒ–ãƒ©ã‚¦ã‚¶èµ·å‹•
        console.log('ğŸŒ Launching browser...');
        browser = await chromium.launch({
            headless: true,
            args: ['--no-sandbox', '--disable-setuid-sandbox']
        });

        const context = await browser.newContext();
        const page = await context.newPage();

        // Step 3: WebUIã«ã‚¢ã‚¯ã‚»ã‚¹
        console.log(`ğŸŒ Navigating to ${CONFIG.webUiUrl}...`);
        await page.goto(CONFIG.webUiUrl, {
            waitUntil: 'networkidle',
            timeout: CONFIG.timeout
        });
        console.log('âœ… Page loaded');

        // Step 4: localStorageå…¨ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        console.log('ğŸ“¦ Extracting localStorage data...');
        const backupData = await page.evaluate(() => {
            const data = {};

            // å…¨localStorageã‚­ãƒ¼ã‚’å–å¾—
            const keys = [
                'appsuite_users',
                'appsuite_apps',
                'appsuite_incidents',
                'appsuite_changes',
                'appsuite_logs',
                'appsuite_settings'
            ];

            for (const key of keys) {
                const value = localStorage.getItem(key);
                if (value) {
                    try {
                        data[key] = JSON.parse(value);
                    } catch (e) {
                        data[key] = value; // JSONä»¥å¤–ã®å€¤
                    }
                }
            }

            return {
                timestamp: new Date().toISOString(),
                version: '1.0.0',
                collections: data,
                metadata: {
                    userAgent: navigator.userAgent,
                    url: window.location.href,
                    backupSource: 'github-actions'
                }
            };
        });

        console.log('âœ… Data extracted');

        // Step 5: çµ±è¨ˆæƒ…å ±è¡¨ç¤º
        console.log('');
        console.log('ğŸ“Š Backup Statistics:');
        for (const [key, value] of Object.entries(backupData.collections)) {
            const count = Array.isArray(value) ? value.length : 'N/A';
            console.log(`  - ${key}: ${count} records`);
        }
        console.log('');

        // Step 6: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
        const filename = `appsuite_backup_${timestamp}.json`;
        const filepath = path.join(CONFIG.backupDir, filename);

        await fs.writeFile(
            filepath,
            JSON.stringify(backupData, null, 2),
            'utf8'
        );

        const filesize = (await fs.stat(filepath)).size;
        console.log(`âœ… Backup file created: ${filename}`);
        console.log(`   Size: ${(filesize / 1024).toFixed(2)} KB`);

        // Step 7: ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§æ¤œè¨¼
        console.log('ğŸ” Verifying backup integrity...');
        const readData = JSON.parse(await fs.readFile(filepath, 'utf8'));

        if (!readData.timestamp || !readData.collections) {
            throw new Error('Backup file is corrupted');
        }

        console.log('âœ… Backup integrity verified');

        // Step 8: å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®å‰Šé™¤ï¼ˆ30æ—¥ä»¥ä¸ŠçµŒéï¼‰
        console.log('ğŸ—‘ï¸  Cleaning up old backups...');
        const files = await fs.readdir(CONFIG.backupDir);
        const now = Date.now();
        const retentionDays = 30;
        let deletedCount = 0;

        for (const file of files) {
            if (!file.startsWith('appsuite_backup_')) continue;

            const filepath = path.join(CONFIG.backupDir, file);
            const stats = await fs.stat(filepath);
            const age = (now - stats.mtimeMs) / (1000 * 60 * 60 * 24);

            if (age > retentionDays) {
                await fs.unlink(filepath);
                deletedCount++;
                console.log(`  - Deleted: ${file} (${age.toFixed(1)} days old)`);
            }
        }

        if (deletedCount === 0) {
            console.log('  - No old backups to delete');
        } else {
            console.log(`âœ… Deleted ${deletedCount} old backup(s)`);
        }

        // Step 9: å®Œäº†
        console.log('');
        console.log('========================================');
        console.log('âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†');
        console.log('========================================');
        console.log(`Backup file: ${filename}`);
        console.log(`Size: ${(filesize / 1024).toFixed(2)} KB`);
        console.log(`Timestamp: ${backupData.timestamp}`);
        console.log('');

        await browser.close();
        process.exit(0);

    } catch (error) {
        console.error('');
        console.error('========================================');
        console.error('âŒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¤±æ•—');
        console.error('========================================');
        console.error(error);
        console.error('');

        if (browser) {
            await browser.close();
        }

        process.exit(1);
    }
}

// å®Ÿè¡Œ
main();
```

---

## 5. ãƒªã‚¹ãƒˆã‚¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè£…

### 5.1 æ‰‹å‹•ãƒªã‚¹ãƒˆã‚¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `scripts/restore-backup.js`ï¼ˆæ–°è¦ä½œæˆï¼‰

```javascript
/**
 * AppSuite ITSM ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒªã‚¹ãƒˆã‚¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
 */

const fs = require('fs').promises;
const path = require('path');
const readline = require('readline');

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
});

function question(prompt) {
    return new Promise(resolve => {
        rl.question(prompt, resolve);
    });
}

async function main() {
    console.log('========================================');
    console.log('ğŸ“¦ AppSuite ITSM ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒªã‚¹ãƒˆã‚¢');
    console.log('========================================');
    console.log('');

    try {
        // Step 1: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§è¡¨ç¤º
        const backupDir = './backups';
        const files = await fs.readdir(backupDir);
        const backupFiles = files.filter(f => f.startsWith('appsuite_backup_'));

        if (backupFiles.length === 0) {
            console.log('âŒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            process.exit(1);
        }

        console.log('åˆ©ç”¨å¯èƒ½ãªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«:');
        console.log('');

        backupFiles.forEach((file, index) => {
            console.log(`${index + 1}. ${file}`);
        });

        console.log('');

        // Step 2: ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
        const answer = await question('ãƒªã‚¹ãƒˆã‚¢ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„: ');
        const fileIndex = parseInt(answer) - 1;

        if (fileIndex < 0 || fileIndex >= backupFiles.length) {
            console.log('âŒ ç„¡åŠ¹ãªç•ªå·ã§ã™');
            process.exit(1);
        }

        const selectedFile = backupFiles[fileIndex];
        const filepath = path.join(backupDir, selectedFile);

        console.log('');
        console.log(`é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«: ${selectedFile}`);
        console.log('');

        // Step 3: ç¢ºèª
        const confirm = await question('ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªã‚¹ãƒˆã‚¢ã—ã¾ã™ã‹ï¼Ÿ (yes/no): ');
        if (confirm.toLowerCase() !== 'yes') {
            console.log('ãƒªã‚¹ãƒˆã‚¢ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ');
            process.exit(0);
        }

        // Step 4: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«èª­è¾¼
        console.log('');
        console.log('ğŸ“¦ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«èª­è¾¼ä¸­...');
        const backupData = JSON.parse(await fs.readFile(filepath, 'utf8'));

        console.log('âœ… ãƒ•ã‚¡ã‚¤ãƒ«èª­è¾¼å®Œäº†');
        console.log(`ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ—¥æ™‚: ${backupData.timestamp}`);
        console.log('');

        // Step 5: ãƒ‡ãƒ¼ã‚¿çµ±è¨ˆè¡¨ç¤º
        console.log('ğŸ“Š ãƒªã‚¹ãƒˆã‚¢å¯¾è±¡ãƒ‡ãƒ¼ã‚¿:');
        for (const [key, value] of Object.entries(backupData.collections)) {
            const count = Array.isArray(value) ? value.length : 'N/A';
            console.log(`  - ${key}: ${count} records`);
        }
        console.log('');

        // Step 6: ãƒªã‚¹ãƒˆã‚¢ç”¨HTMLãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
        console.log('ğŸ“ ãƒªã‚¹ãƒˆã‚¢ç”¨HTMLãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆä¸­...');

        const restoreHtml = `
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>AppSuite ITSM - ãƒªã‚¹ãƒˆã‚¢</title>
</head>
<body>
    <h1>AppSuite ITSM - ãƒ‡ãƒ¼ã‚¿ãƒªã‚¹ãƒˆã‚¢</h1>
    <p>ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«: ${selectedFile}</p>
    <p>ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ—¥æ™‚: ${backupData.timestamp}</p>
    <button onclick="restore()">ãƒªã‚¹ãƒˆã‚¢å®Ÿè¡Œ</button>
    <div id="status"></div>

    <script>
        const backupData = ${JSON.stringify(backupData.collections, null, 2)};

        function restore() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = '<p>ãƒªã‚¹ãƒˆã‚¢ä¸­...</p>';

            try {
                // localStorageã«ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
                for (const [key, value] of Object.entries(backupData)) {
                    localStorage.setItem(key, JSON.stringify(value));
                }

                statusDiv.innerHTML = '<p style="color: green;">âœ… ãƒªã‚¹ãƒˆã‚¢å®Œäº†</p>';
                alert('ãƒªã‚¹ãƒˆã‚¢ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¾ã™ã€‚');
                window.location.href = '/';

            } catch (error) {
                statusDiv.innerHTML = '<p style="color: red;">âŒ ãƒªã‚¹ãƒˆã‚¢å¤±æ•—: ' + error.message + '</p>';
                console.error(error);
            }
        }
    </script>
</body>
</html>
        `;

        const restoreHtmlPath = './restore.html';
        await fs.writeFile(restoreHtmlPath, restoreHtml, 'utf8');

        console.log('âœ… ãƒªã‚¹ãƒˆã‚¢ç”¨HTMLãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆå®Œäº†: restore.html');
        console.log('');
        console.log('========================================');
        console.log('ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:');
        console.log('========================================');
        console.log('1. Webã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¦ãã ã•ã„:');
        console.log('   npx http-server . -p 8888');
        console.log('');
        console.log('2. ãƒ–ãƒ©ã‚¦ã‚¶ã§ä»¥ä¸‹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„:');
        console.log('   http://localhost:8888/restore.html');
        console.log('');
        console.log('3. ã€Œãƒªã‚¹ãƒˆã‚¢å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„');
        console.log('');

        rl.close();
        process.exit(0);

    } catch (error) {
        console.error('');
        console.error('âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
        console.error('');
        rl.close();
        process.exit(1);
    }
}

main();
```

---

## 6. ãƒ†ã‚¹ãƒˆè¨ˆç”»

### 6.1 ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ†ã‚¹ãƒˆ

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆ
npm run dev:linux  # WebUIã‚µãƒ¼ãƒãƒ¼èµ·å‹•
node scripts/backup-automation.js

# æœŸå¾…çµæœ:
# - backups/appsuite_backup_YYYY-MM-DDTHH-MM-SS.json ãŒç”Ÿæˆã•ã‚Œã‚‹
# - ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒ0ã‚ˆã‚Šå¤§ãã„
# - JSONå¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯æˆåŠŸ
```

### 6.2 ãƒªã‚¹ãƒˆã‚¢ãƒ†ã‚¹ãƒˆ

```bash
# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰ãƒªã‚¹ãƒˆã‚¢
node scripts/restore-backup.js

# æœŸå¾…çµæœ:
# - restore.html ãŒç”Ÿæˆã•ã‚Œã‚‹
# - ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãƒªã‚¹ãƒˆã‚¢å®Ÿè¡Œ
# - ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãå¾©å…ƒã•ã‚Œã‚‹
```

### 6.3 GitHub Actionsãƒ†ã‚¹ãƒˆ

```bash
# æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼ã§ãƒ†ã‚¹ãƒˆ
# GitHub UI: Actions â†’ Daily Backup â†’ Run workflow

# æœŸå¾…çµæœ:
# - ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒæˆåŠŸ
# - Artifacts ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹
# - Slack/ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ãŒå±Šã
```

---

## 7. é‹ç”¨ã‚¬ã‚¤ãƒ‰

### 7.1 ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ç¢ºèªæ–¹æ³•

1. **GitHub UI**:
   - `Actions` â†’ `Daily Backup` â†’ æœ€æ–°ã®å®Ÿè¡Œ
   - `Artifacts` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

2. **ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³**:
   ```bash
   # GitHub CLIã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
   gh run list --workflow=daily-backup.yml
   gh run download <run-id>
   ```

### 7.2 ãƒªã‚¹ãƒˆã‚¢æ‰‹é †

1. **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—**:
   - GitHub Actionsã® Artifacts ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
   - `backups/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®

2. **ãƒªã‚¹ãƒˆã‚¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ**:
   ```bash
   node scripts/restore-backup.js
   ```

3. **ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒªã‚¹ãƒˆã‚¢**:
   - http://localhost:8888/restore.html ã«ã‚¢ã‚¯ã‚»ã‚¹
   - ã€Œãƒªã‚¹ãƒˆã‚¢å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

### 7.3 ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

| å•é¡Œ | åŸå›  | è§£æ±ºç­– |
|------|------|--------|
| ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¤±æ•— | WebUIã‚µãƒ¼ãƒãƒ¼èµ·å‹•å¤±æ•— | ãƒãƒ¼ãƒˆ8888ãŒç©ºã„ã¦ã„ã‚‹ã‹ç¢ºèª |
| Artifactsæœªã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ | ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ¨©é™ä¸è¶³ | `permissions: contents: read` ç¢ºèª |
| Slacké€šçŸ¥å±Šã‹ãªã„ | Webhook URLæœªè¨­å®š | `SLACK_WEBHOOK_URL` Secretè¨­å®š |

---

## 8. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### 8.1 æ©Ÿå¯†æƒ…å ±ã®å–ã‚Šæ‰±ã„

| ãƒ‡ãƒ¼ã‚¿ | æ©Ÿå¯†åº¦ | å¯¾ç­– |
|--------|--------|------|
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | é«˜ | ãƒãƒƒã‚·ãƒ¥åŒ–æ¸ˆã¿ï¼ˆå¹³æ–‡ãªã—ï¼‰ |
| APIã‚­ãƒ¼ | é«˜ | æš—å·åŒ–æ¸ˆã¿ï¼ˆPhase 5å®Ÿè£…å¾Œï¼‰ |
| å€‹äººæƒ…å ± | ä¸­ | ç›£æŸ»ãƒ­ã‚°ã«è¨˜éŒ² |

### 8.2 ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

- **GitHub Artifacts**: ãƒªãƒã‚¸ãƒˆãƒªç®¡ç†è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- **Slacké€šçŸ¥**: é™å®šãƒãƒ£ãƒ³ãƒãƒ«ã«æŠ•ç¨¿
- **ãƒ¡ãƒ¼ãƒ«é€šçŸ¥**: ç®¡ç†è€…ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã¿

---

## 9. ã‚³ã‚¹ãƒˆè©¦ç®—

### 9.1 GitHub Actions ä½¿ç”¨é‡

| é …ç›® | å€¤ |
|------|-----|
| å®Ÿè¡Œé »åº¦ | æ¯æ—¥1å› |
| å®Ÿè¡Œæ™‚é–“ | ç´„5åˆ†/å› |
| æœˆé–“ä½¿ç”¨æ™‚é–“ | 150åˆ†ï¼ˆ5åˆ† Ã— 30æ—¥ï¼‰ |
| ç„¡æ–™æ  | 2,000åˆ†/æœˆï¼ˆFreeãƒ—ãƒ©ãƒ³ï¼‰ |
| **ã‚³ã‚¹ãƒˆ** | **ç„¡æ–™** |

### 9.2 Artifacts ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

| é …ç›® | å€¤ |
|------|-----|
| ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º | ç´„500KB/æ—¥ |
| ä¿æŒæœŸé–“ | 90æ—¥ |
| æœˆé–“ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | ç´„45MBï¼ˆ500KB Ã— 90æ—¥ï¼‰ |
| ç„¡æ–™æ  | 500MBï¼ˆFreeãƒ—ãƒ©ãƒ³ï¼‰ |
| **ã‚³ã‚¹ãƒˆ** | **ç„¡æ–™** |

---

## 10. å°†æ¥å±•æœ›

### 10.1 Phase 6ä»¥é™ã®æ”¹å–„æ¡ˆ

- **AWS S3/Google Cloud Storageé€£æº**: ã‚ˆã‚Šé•·æœŸçš„ãªä¿å­˜
- **å¢—åˆ†ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸åŠ¹ç‡å‘ä¸Š
- **æš—å·åŒ–ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: GPGã«ã‚ˆã‚‹æš—å·åŒ–
- **è‡ªå‹•ãƒªã‚¹ãƒˆã‚¢**: ç½å®³å¾©æ—§è‡ªå‹•åŒ–

---

## 11. å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] `.github/workflows/daily-backup.yml` ä½œæˆ
- [ ] `scripts/backup-automation.js` ä½œæˆ
- [ ] `scripts/restore-backup.js` ä½œæˆ
- [ ] `package.json` ã« Playwright è¿½åŠ 
- [ ] GitHub Secrets è¨­å®šï¼ˆSLACK_WEBHOOK_URL, EMAIL_PASSWORDï¼‰
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆå®Ÿæ–½
- [ ] GitHub Actions ãƒ†ã‚¹ãƒˆå®Ÿæ–½
- [ ] é‹ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«æ›´æ–°

---

**ä½œæˆè€…**: Lead Agent
**é‹ç”¨è²¬ä»»è€…**: Ops Agentï¼ˆæ‰¿èªå¾…ã¡ï¼‰
**å®Ÿè£…äºˆå®š**: Phase 5ï¼ˆ2026-02-19ï¼‰
