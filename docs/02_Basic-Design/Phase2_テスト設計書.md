# Phase 2: テスト設計書

**文書番号**: TEST-APPSUITE-001
**バージョン**: 1.0
**作成日**: 2026年1月21日
**Phase**: Phase 2 - 詳細設計
**ステータス**: ✅ レビュー待ち

---

## 📋 目次

1. [テスト戦略](#1-テスト戦略)
2. [テストレベル](#2-テストレベル)
3. [テストケース設計](#3-テストケース設計)
4. [テスト環境](#4-テスト環境)
5. [テストスケジュール](#5-テストスケジュール)

---

## 1. テスト戦略

### 1.1 テスト方針

| 方針 | 説明 |
|------|------|
| **段階的テスト** | 単体→結合→システム→UATの順に実施 |
| **自動化** | 可能な限り自動テストを導入 |
| **網羅性** | 全機能要件をカバー |
| **回帰テスト** | 変更時は既存機能もテスト |

### 1.2 テスト目標

| 目標 | 基準 |
|------|------|
| **機能カバレッジ** | 必須機能100%、推奨機能80% |
| **コードカバレッジ** | 70%以上 |
| **バグ検出率** | テストフェーズで90%以上 |
| **クリティカルバグ** | リリース時ゼロ |

---

## 2. テストレベル

### 2.1 単体テスト（Unit Test）

**対象**: 個別のモジュール・関数

**実施者**: 開発者

**ツール**: 手動テスト（将来的にJest導入検討）

#### テストケース例

```javascript
// UserModule.create() のテスト
describe('UserModule.create', () => {
  test('新規ユーザーを正しく作成できる', () => {
    const userData = {
      username: 'テストユーザー',
      email: 'test@example.com',
      password: 'Test1234!',
      department: 'テスト部',
      role: 'user'
    };

    const user = UserModule.create(userData);

    expect(user.id).toMatch(/^U\d{4}$/);
    expect(user.username).toBe('テストユーザー');
    expect(user.passwordHash).toBeDefined();
    expect(user.createdAt).toBeDefined();
  });

  test('メールアドレス重複時はエラー', () => {
    const userData = {
      username: 'ユーザー2',
      email: 'test@example.com',  // 既存のメール
      password: 'Test1234!',
      department: 'テスト部',
      role: 'user'
    };

    expect(() => UserModule.create(userData))
      .toThrow('メールアドレスが既に登録されています');
  });
});
```

#### 単体テスト一覧

| モジュール | テストケース数 | 優先度 |
|-----------|--------------|--------|
| UserModule | 15 | 高 |
| AppModule | 12 | 高 |
| IncidentModule | 18 | 高 |
| ChangeModule | 15 | 高 |
| LogModule | 8 | 中 |
| SettingsModule | 6 | 中 |
| **合計** | **74** | - |

---

### 2.2 結合テスト（Integration Test）

**対象**: モジュール間の連携

**実施者**: 開発チーム

**期間**: Week 18前半

#### テストシナリオ例

| TC-ID | テストシナリオ | 期待結果 |
|-------|--------------|---------|
| IT-001 | ユーザー作成→ログ記録確認 | 監査ログに作成操作が記録される |
| IT-002 | インシデント作成→アプリ紐付け確認 | インシデントが正しいアプリに紐付く |
| IT-003 | 変更承認→ステータス更新確認 | ステータスが「承認済み」に変更される |
| IT-004 | ユーザー削除→関連データ確認 | ユーザーに紐付くデータも削除される |

**合計**: 25テストシナリオ

---

### 2.3 システムテスト（System Test）

**対象**: システム全体の動作

**実施者**: テストチーム

**期間**: Week 19

#### 機能テスト

| カテゴリ | テストケース数 |
|---------|--------------|
| ログイン・認証 | 8 |
| ダッシュボード | 6 |
| ユーザー管理 | 15 |
| アプリ管理 | 12 |
| インシデント管理 | 20 |
| 変更管理 | 18 |
| 監査ログ | 10 |
| システム設定 | 8 |
| **合計** | **97** |

#### 非機能テスト

| テスト種別 | テストケース数 | 目標 |
|-----------|--------------|------|
| パフォーマンステスト | 12 | 初期表示3秒以内 |
| セキュリティテスト | 15 | OWASP Top 10対策確認 |
| ユーザビリティテスト | 8 | タスク完了率90% |
| ブラウザ互換性テスト | 4 | Chrome, Firefox, Edge, Safari |
| レスポンシブテスト | 3 | Desktop, Tablet, Mobile |

**合計**: 42テストケース

---

### 2.4 UAT（ユーザー受入テスト）

**対象**: 実際の業務シナリオ

**実施者**: エンドユーザー（IT管理者、サービスデスク）

**期間**: Week 20

#### 業務シナリオテスト

| シナリオID | 業務シナリオ | 所要時間 |
|-----------|------------|---------|
| UAT-001 | 新規ユーザーの登録から権限付与まで | 5分 |
| UAT-002 | インシデント受付から解決・クローズまで | 10分 |
| UAT-003 | 変更要求の申請から承認・実施まで | 15分 |
| UAT-004 | 月次レポート作成（監査ログエクスポート） | 5分 |
| UAT-005 | DeskNet's Neo APIからのデータ同期 | 5分 |

**合計**: 5シナリオ

---

## 3. テストケース設計

### 3.1 テストケース例（インシデント新規登録）

| 項目 | 内容 |
|------|------|
| **TC-ID** | TC-INC-001 |
| **テストケース名** | インシデント新規登録（正常系） |
| **テストレベル** | システムテスト |
| **優先度** | 高 |

#### 前提条件
- ユーザーがログイン済み
- サービスデスク権限を保持
- アプリが1件以上登録済み

#### テスト手順

| # | 操作 | 期待結果 |
|---|------|---------|
| 1 | インシデント管理画面を開く | インシデント一覧が表示される |
| 2 | 「新規登録」ボタンをクリック | 新規登録モーダルが表示される |
| 3 | タイトルに「テストインシデント」を入力 | 入力値が表示される |
| 4 | 説明を入力 | 入力値が表示される |
| 5 | 関連アプリを選択 | アプリが選択される |
| 6 | 優先度「P2」を選択 | P2が選択される |
| 7 | 「登録」ボタンをクリック | - |
| 8 | - | 成功メッセージが表示される |
| 9 | - | インシデントIDが採番される（INC-形式） |
| 10 | - | インシデント一覧に追加される |
| 11 | - | 監査ログに操作が記録される |

#### テストデータ

```javascript
{
  title: 'テストインシデント',
  description: 'これはテスト用のインシデントです',
  appId: 'A0001',
  priority: 'P2',
  category: 'software'
}
```

#### 判定基準
- すべての期待結果が満たされる
- エラーが発生しない
- データが正しく保存される

---

### 3.2 異常系テストケース例

| TC-ID | テストケース名 | テスト内容 | 期待結果 |
|-------|--------------|-----------|---------|
| TC-INC-E01 | タイトル未入力 | タイトルを空欄で登録 | エラーメッセージ表示、登録不可 |
| TC-INC-E02 | タイトル超過 | 101文字のタイトル入力 | エラーメッセージ表示、登録不可 |
| TC-INC-E03 | アプリ未選択 | 関連アプリを選択せず登録 | エラーメッセージ表示、登録不可 |
| TC-INC-E04 | XSS攻撃 | `<script>alert('XSS')</script>`を入力 | エスケープされて表示、実行されない |

---

## 4. テスト環境

### 4.1 テスト環境構成

| 環境 | URL | 用途 |
|------|-----|------|
| **開発環境** | http://192.168.0.185:3100 | 開発者による動作確認 |
| **テスト環境** | http://192.168.0.185:3100 | 結合・システムテスト |
| **UAT環境** | https://192.168.0.185:8443 | ユーザー受入テスト |

### 4.2 テストデータ

| データ種別 | 件数 | 説明 |
|-----------|------|------|
| テストユーザー | 50 | 様々な権限・ステータス |
| テストアプリ | 20 | 各カテゴリ網羅 |
| テストインシデント | 100 | 全優先度・ステータス |
| テスト変更要求 | 30 | 全タイプ・リスクレベル |

---

## 5. テストスケジュール

### 5.1 Phase 4: テストフェーズ（3週間）

| Week | テスト種別 | 責任者 | 完了基準 |
|------|-----------|--------|---------|
| **Week 18** | 単体テスト<br>結合テスト | 開発チーム | 全テストケースPASS |
| **Week 19** | システムテスト<br>非機能テスト | テストチーム | クリティカルバグゼロ |
| **Week 20** | UAT | エンドユーザー | 受入承認取得 |

### 5.2 バグ管理

#### バグ優先度

| 優先度 | 説明 | 対応期限 |
|--------|------|---------|
| **P1-Critical** | システムが動作しない | 即日 |
| **P2-High** | 主要機能が動作しない | 3日以内 |
| **P3-Medium** | 一部機能に不具合 | 1週間以内 |
| **P4-Low** | 軽微な問題 | リリース前 |

#### バグトラッキング

- **ツール**: GitHub Issues
- **ラベル**: bug, enhancement, documentation
- **担当割り当て**: バグ発見から24時間以内

---

## 📊 テスト統計

### テストケース総数

| テストレベル | テストケース数 | 実施週 |
|------------|--------------|--------|
| 単体テスト | 74 | Week 18 |
| 結合テスト | 25 | Week 18 |
| システムテスト（機能） | 97 | Week 19 |
| システムテスト（非機能） | 42 | Week 19 |
| UAT | 5 | Week 20 |
| **合計** | **243** | - |

---

## ✅ レビューチェックリスト

- [ ] テスト戦略が明確
- [ ] 全テストレベルが定義されている
- [ ] テストケースが網羅的
- [ ] テスト環境が整備されている
- [ ] スケジュールが現実的
- [ ] QAリーダーレビュー完了

---

**承認**:
- テスト設計者: _________________ 日付: _______
- QAリーダー: _________________ 日付: _______
- 技術リーダー: _________________ 日付: _______

**次のステップ**: Phase 2完了レポート作成
