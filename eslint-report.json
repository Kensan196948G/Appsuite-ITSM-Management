[{"filePath":"/home/runner/work/Appsuite-ITSM-Management/Appsuite-ITSM-Management/WebUI-Production/js/api.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'initApiSync' is defined but never used.","line":323,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":323,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'toggleApiKey' is defined but never used.","line":364,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":364,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AppSuite 管理運用システム - API連携モジュール\n */\n\nconst ApiConfig = {\n    baseUrl: '',\n    apiKey: '',\n    authMethod: 'bearer',\n    timeout: 30000,\n\n    save() {\n        this.baseUrl = document.getElementById('apiUrl').value;\n        this.apiKey = document.getElementById('apiKey').value;\n        this.authMethod = document.getElementById('authMethod').value;\n        this.timeout = parseInt(document.getElementById('timeout').value) * 1000;\n\n        localStorage.setItem('appsuite_api_config', JSON.stringify({\n            baseUrl: this.baseUrl,\n            apiKey: this.apiKey,\n            authMethod: this.authMethod,\n            timeout: this.timeout\n        }));\n\n        showToast('API設定を保存しました', 'success');\n    },\n\n    load() {\n        const savedSettings = localStorage.getItem('appsuiteSettings');\n        if (savedSettings) {\n            const settings = JSON.parse(savedSettings);\n            const api = settings.api || {};\n            this.baseUrl = api.url || '';\n            this.apiKey = api.key || '';\n            this.authMethod = api.authMethod || 'bearer';\n            this.timeout = (api.timeout || 30) * 1000;\n            return;\n        }\n\n        const saved = localStorage.getItem('appsuite_api_config');\n        if (saved) {\n            const config = JSON.parse(saved);\n            this.baseUrl = config.baseUrl || '';\n            this.apiKey = config.apiKey || '';\n            this.authMethod = config.authMethod || 'bearer';\n            this.timeout = config.timeout || 30000;\n        }\n    },\n\n    async test() {\n        if (!this.baseUrl) {\n            showToast('API URLを入力してください', 'error');\n            return;\n        }\n\n        try {\n            showToast('接続テスト中...', 'info');\n            // 実際のAPI接続テスト（デモではシミュレート）\n            await new Promise(resolve => setTimeout(resolve, 1000));\n\n            updateConnectionStatus(true);\n            document.getElementById('apiStatus').textContent = '接続中';\n            document.getElementById('apiStatus').style.color = '#22c55e';\n            document.getElementById('lastSync').textContent = new Date().toLocaleString('ja-JP');\n            document.getElementById('apiVersion').textContent = 'V7.5';\n\n            showToast('接続成功！', 'success');\n        } catch (error) {\n            updateConnectionStatus(false);\n            document.getElementById('apiStatus').textContent = '接続エラー';\n            document.getElementById('apiStatus').style.color = '#ef4444';\n            showToast('接続失敗: ' + error.message, 'error');\n        }\n    }\n};\n\n// API通信クラス\nconst Api = {\n    async get(endpoint, params = {}) {\n        return this.request('GET', endpoint, params);\n    },\n\n    async post(endpoint, data = {}) {\n        return this.request('POST', endpoint, data);\n    },\n\n    async put(endpoint, data = {}) {\n        return this.request('PUT', endpoint, data);\n    },\n\n    async delete(endpoint) {\n        return this.request('DELETE', endpoint);\n    },\n\n    async request(method, endpoint, data = {}) {\n        const url = new URL(endpoint, ApiConfig.baseUrl);\n\n        const options = {\n            method: method,\n            headers: this.getHeaders(),\n        };\n\n        if (method === 'GET' && Object.keys(data).length > 0) {\n            Object.keys(data).forEach(key => url.searchParams.append(key, data[key]));\n        } else if (method !== 'GET') {\n            options.body = JSON.stringify(data);\n        }\n\n        const controller = new AbortController();\n        const timeoutId = setTimeout(() => controller.abort(), ApiConfig.timeout);\n        options.signal = controller.signal;\n\n        try {\n            const response = await fetch(url, options);\n            clearTimeout(timeoutId);\n\n            if (!response.ok) {\n                throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n            }\n\n            return await response.json();\n        } catch (error) {\n            if (error.name === 'AbortError') {\n                throw new Error('リクエストがタイムアウトしました');\n            }\n            throw error;\n        }\n    },\n\n    getHeaders() {\n        const headers = {\n            'Content-Type': 'application/json',\n            'Accept': 'application/json'\n        };\n\n        switch (ApiConfig.authMethod) {\n        case 'bearer':\n            headers['Authorization'] = `Bearer ${ApiConfig.apiKey}`;\n            break;\n        case 'basic':\n            headers['Authorization'] = `Basic ${btoa(ApiConfig.apiKey)}`;\n            break;\n        case 'apikey':\n            headers['X-API-Key'] = ApiConfig.apiKey;\n            break;\n        }\n\n        return headers;\n    }\n};\n\n// デモ用データストア\nconst DataStore = {\n    users: [\n        { id: 'U0000', username: 'admin', email: 'admin@example.com', department: '情報システム部', role: '管理者', status: 'active', lastLogin: '2026-01-23 22:00' },\n        { id: 'U0001', username: '山田太郎', email: 'yamada@example.com', department: '情報システム部', role: '管理者', status: 'active', lastLogin: '2026-01-19 09:30' },\n        { id: 'U0002', username: '鈴木花子', email: 'suzuki@example.com', department: '営業部', role: 'ユーザー', status: 'active', lastLogin: '2026-01-19 08:45' },\n        { id: 'U0003', username: '佐藤一郎', email: 'sato@example.com', department: '総務部', role: 'ユーザー', status: 'active', lastLogin: '2026-01-18 17:20' },\n        { id: 'U0004', username: '田中美咲', email: 'tanaka@example.com', department: '開発部', role: '管理者', status: 'active', lastLogin: '2026-01-19 10:15' },\n        { id: 'U0005', username: '高橋健二', email: 'takahashi@example.com', department: '情報システム部', role: 'ユーザー', status: 'inactive', lastLogin: '2026-01-10 14:00' },\n        { id: 'U0006', username: '伊藤真由', email: 'ito@example.com', department: '経理部', role: 'ユーザー', status: 'active', lastLogin: '2026-01-19 09:00' },\n        { id: 'U0007', username: '渡辺大輔', email: 'watanabe@example.com', department: '営業部', role: 'ユーザー', status: 'active', lastLogin: '2026-01-18 16:30' }\n    ],\n\n    apps: [\n        { id: 'APP001', name: '勤怠管理', category: '業務管理', creator: '山田太郎', records: 1250, status: 'active', updated: '2026-01-19' },\n        { id: 'APP002', name: '経費精算申請', category: '申請・承認', creator: '田中美咲', records: 856, status: 'active', updated: '2026-01-18' },\n        { id: 'APP003', name: '顧客管理', category: 'データ管理', creator: '鈴木花子', records: 3420, status: 'active', updated: '2026-01-19' },\n        { id: 'APP004', name: '備品貸出管理', category: '業務管理', creator: '佐藤一郎', records: 234, status: 'active', updated: '2026-01-17' },\n        { id: 'APP005', name: '休暇申請', category: '申請・承認', creator: '山田太郎', records: 567, status: 'active', updated: '2026-01-16' },\n        { id: 'APP006', name: '会議室予約', category: '業務管理', creator: '田中美咲', records: 1890, status: 'maintenance', updated: '2026-01-15' },\n        { id: 'APP007', name: '在庫管理', category: 'データ管理', creator: '高橋健二', records: 4521, status: 'active', updated: '2026-01-19' }\n    ],\n\n    incidents: [\n        { id: 'INC001', title: '勤怠管理アプリでデータが保存されない', appId: 'APP001', appName: '勤怠管理', priority: 'high', status: 'in_progress', reporter: '鈴木花子', assignee: '山田太郎', created: '2026-01-19', description: '出勤打刻後、データが保存されずエラーが発生する' },\n        { id: 'INC002', title: '経費精算の承認ボタンが反応しない', appId: 'APP002', appName: '経費精算申請', priority: 'medium', status: 'open', reporter: '佐藤一郎', assignee: '-', created: '2026-01-19', description: '承認ボタンをクリックしても何も起こらない' },\n        { id: 'INC003', title: '顧客検索が遅い', appId: 'APP003', appName: '顧客管理', priority: 'low', status: 'resolved', reporter: '渡辺大輔', assignee: '田中美咲', created: '2026-01-18', description: '検索に10秒以上かかることがある' },\n        { id: 'INC004', title: '会議室予約の表示エラー', appId: 'APP006', appName: '会議室予約', priority: 'medium', status: 'closed', reporter: '伊藤真由', assignee: '高橋健二', created: '2026-01-17', description: '予約一覧が正しく表示されない問題' }\n    ],\n\n    changes: [\n        { id: 'CHG001', title: '勤怠管理に残業申請機能を追加', appId: 'APP001', appName: '勤怠管理', type: 'feature', status: 'approved', requester: '佐藤一郎', scheduled: '2026-02-01', description: '残業時間の事前申請・承認機能を追加したい' },\n        { id: 'CHG002', title: '経費精算の領収書アップロード機能改善', appId: 'APP002', appName: '経費精算申請', type: 'improvement', status: 'in_progress', requester: '鈴木花子', scheduled: '2026-01-25', description: '複数ファイルの一括アップロードに対応' },\n        { id: 'CHG003', title: '顧客管理の検索条件追加', appId: 'APP003', appName: '顧客管理', type: 'modification', status: 'pending', requester: '渡辺大輔', scheduled: '2026-02-10', description: '取引先担当者での検索を可能にしたい' },\n        { id: 'CHG004', title: '在庫管理のバーコード読取不具合修正', appId: 'APP007', appName: '在庫管理', type: 'bugfix', status: 'completed', requester: '高橋健二', scheduled: '2026-01-15', description: '一部バーコードが読み取れない問題を修正' },\n        { id: 'CHG005', title: '休暇申請に半休機能追加', appId: 'APP005', appName: '休暇申請', type: 'feature', status: 'draft', requester: '伊藤真由', scheduled: '-', description: '午前休・午後休の選択を可能にしたい' }\n    ],\n\n    logs: [\n        { timestamp: '2026-01-19 10:30:15', user: '山田太郎', action: 'login', target: 'システム', targetType: 'system', detail: 'ログイン成功', ip: '192.168.1.100' },\n        { timestamp: '2026-01-19 10:25:00', user: '田中美咲', action: 'update', target: '経費精算申請', targetType: 'app', detail: 'アプリ設定を更新', ip: '192.168.1.105' },\n        { timestamp: '2026-01-19 10:20:30', user: '鈴木花子', action: 'create', target: '顧客管理', targetType: 'app', detail: '新規レコード追加（顧客ID: C1234）', ip: '192.168.1.110' },\n        { timestamp: '2026-01-19 10:15:00', user: '佐藤一郎', action: 'export', target: '備品貸出管理', targetType: 'app', detail: 'CSVエクスポート実行', ip: '192.168.1.115' },\n        { timestamp: '2026-01-19 09:45:00', user: '山田太郎', action: 'create', target: 'ユーザー', targetType: 'user', detail: '新規ユーザー追加: 伊藤真由', ip: '192.168.1.100' },\n        { timestamp: '2026-01-19 09:30:00', user: '田中美咲', action: 'login', target: 'システム', targetType: 'system', detail: 'ログイン成功', ip: '192.168.1.105' },\n        { timestamp: '2026-01-18 17:30:00', user: '高橋健二', action: 'logout', target: 'システム', targetType: 'system', detail: 'ログアウト', ip: '192.168.1.120' },\n        { timestamp: '2026-01-18 17:00:00', user: '渡辺大輔', action: 'update', target: '顧客管理', targetType: 'app', detail: 'レコード更新（顧客ID: C0891）', ip: '192.168.1.125' },\n        { timestamp: '2026-01-18 16:30:00', user: '伊藤真由', action: 'delete', target: '経費精算申請', targetType: 'app', detail: 'レコード削除（申請ID: E0234）', ip: '192.168.1.130' }\n    ],\n\n    getStats() {\n        return {\n            totalUsers: this.users.length,\n            activeUsers: this.users.filter(u => u.status === 'active').length,\n            totalApps: this.apps.length,\n            activeApps: this.apps.filter(a => a.status === 'active').length,\n            openIncidents: this.incidents.filter(i => i.status !== 'closed').length,\n            pendingChanges: this.changes.filter(c => c.status === 'pending').length\n        };\n    }\n};\n\nconst ApiSync = {\n    isReadOnly: false,\n    timerId: null,\n\n    loadSettings() {\n        const savedSettings = localStorage.getItem('appsuiteSettings');\n        const settings = savedSettings ? JSON.parse(savedSettings) : {};\n        return settings.api || {};\n    },\n\n    applySettings() {\n        const apiSettings = this.loadSettings();\n        ApiConfig.baseUrl = apiSettings.url || '';\n        ApiConfig.apiKey = apiSettings.key || '';\n        ApiConfig.authMethod = apiSettings.authMethod || 'bearer';\n        ApiConfig.timeout = (apiSettings.timeout || 30) * 1000;\n\n        this.isReadOnly = Boolean(apiSettings.url);\n        this.applyReadOnlyState();\n\n        this.stopAutoSync();\n        const interval = parseInt(apiSettings.syncInterval || 0);\n        if (apiSettings.url && interval > 0) {\n            this.startAutoSync(interval);\n        }\n    },\n\n    applyReadOnlyState() {\n        const addUserButton = document.getElementById('addUserButton');\n        const addAppButton = document.getElementById('addAppButton');\n        if (addUserButton) {addUserButton.disabled = this.isReadOnly;}\n        if (addAppButton) {addAppButton.disabled = this.isReadOnly;}\n\n        if (window.UserModule) {UserModule.refresh();}\n        if (window.AppModule) {AppModule.refresh();}\n    },\n\n    startAutoSync(intervalMinutes) {\n        this.timerId = setInterval(async () => {\n            await this.syncAll();\n        }, intervalMinutes * 60 * 1000);\n    },\n\n    stopAutoSync() {\n        if (this.timerId) {\n            clearInterval(this.timerId);\n            this.timerId = null;\n        }\n    },\n\n    async syncAll() {\n        if (!ApiConfig.baseUrl) {\n            showToast('API URLが未設定です', 'error');\n            return;\n        }\n\n        try {\n            await this.syncUsers();\n            await this.syncApps();\n            updateConnectionStatus(true);\n            document.getElementById('apiStatus').textContent = '接続中';\n            document.getElementById('apiStatus').style.color = '#22c55e';\n            document.getElementById('lastSync').textContent = new Date().toLocaleString('ja-JP');\n            if (window.updateDashboard) {updateDashboard();}\n            showToast('同期が完了しました', 'success');\n        } catch (error) {\n            updateConnectionStatus(false);\n            showToast('同期に失敗しました: ' + error.message, 'error');\n        }\n    },\n\n    async syncUsers() {\n        const response = await Api.get('', { cmd: 'getuser' });\n        if (response.status !== 'success' || !Array.isArray(response.users)) {\n            throw new Error('ユーザー同期に失敗しました');\n        }\n\n        DataStore.users = response.users.map(user => ({\n            id: user.userid,\n            username: user.name,\n            email: user.email,\n            department: user.dept || '',\n            role: 'ユーザー',\n            status: 'active',\n            lastLogin: '-'\n        }));\n        if (window.UserModule) {UserModule.refresh();}\n    },\n\n    async syncApps() {\n        const response = await Api.get('', { cmd: 'getapps' });\n        if (response.status !== 'success' || !Array.isArray(response.apps)) {\n            throw new Error('アプリ同期に失敗しました');\n        }\n\n        const today = new Date().toISOString().split('T')[0];\n        DataStore.apps = response.apps.map(app => ({\n            id: app.appid,\n            name: app.name,\n            category: 'その他',\n            creator: '',\n            records: app.recordcount || 0,\n            status: 'active',\n            updated: today,\n            description: ''\n        }));\n        if (window.AppModule) {AppModule.refresh();}\n    }\n};\n\nfunction initApiSync() {\n    ApiSync.applySettings();\n}\n\n// ユーティリティ\nfunction updateConnectionStatus(connected) {\n    const status = document.getElementById('connectionStatus');\n    if (connected) {\n        status.innerHTML = '<i class=\"fas fa-circle\"></i> 接続中';\n        status.classList.add('connected');\n    } else {\n        status.innerHTML = '<i class=\"fas fa-circle\"></i> 未接続';\n        status.classList.remove('connected');\n    }\n}\n\nfunction showToast(message, type = 'info') {\n    const container = document.getElementById('toastContainer');\n    const toast = document.createElement('div');\n    toast.className = `toast ${type}`;\n\n    const icons = {\n        success: 'fa-check-circle',\n        error: 'fa-exclamation-circle',\n        warning: 'fa-exclamation-triangle',\n        info: 'fa-info-circle'\n    };\n\n    toast.innerHTML = `\n        <i class=\"fas ${icons[type]}\"></i>\n        <span>${message}</span>\n    `;\n\n    container.appendChild(toast);\n\n    setTimeout(() => {\n        toast.style.animation = 'toastIn 0.3s ease reverse';\n        setTimeout(() => toast.remove(), 300);\n    }, 3000);\n}\n\nfunction toggleApiKey() {\n    const input = document.getElementById('apiKey');\n    input.type = input.type === 'password' ? 'text' : 'password';\n}\n","usedDeprecatedRules":[{"ruleId":"semi","replacedBy":[]},{"ruleId":"quotes","replacedBy":[]},{"ruleId":"indent","replacedBy":[]},{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/runner/work/Appsuite-ITSM-Management/Appsuite-ITSM-Management/WebUI-Production/js/app.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'loadApiConfig' is defined but never used.","line":111,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":111,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'openModal' is defined but never used.","line":168,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":168,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AppSuite 管理運用システム - メインアプリケーション\n */\n\n// 初期化\ndocument.addEventListener('DOMContentLoaded', () => {\n    initNavigation();\n    initSidebar();\n    initFilters();\n    initSettings();\n    initApiSync();\n    initDashboard();\n    refreshAllModules();\n});\n\n// ナビゲーション初期化\nfunction initNavigation() {\n    const navItems = document.querySelectorAll('.nav-item');\n    navItems.forEach(item => {\n        item.addEventListener('click', () => {\n            const section = item.dataset.section;\n            showSection(section);\n\n            navItems.forEach(nav => nav.classList.remove('active'));\n            item.classList.add('active');\n\n            if (window.innerWidth <= 1024) {\n                document.getElementById('sidebar').classList.remove('active');\n            }\n        });\n    });\n}\n\n// セクション表示切替\nfunction showSection(sectionName) {\n    const sections = document.querySelectorAll('.section');\n    sections.forEach(sec => sec.classList.add('hidden'));\n\n    const target = document.getElementById('section-' + sectionName);\n    if (target) {\n        target.classList.remove('hidden');\n    }\n\n    switch(sectionName) {\n    case 'dashboard':\n        updateDashboard();\n        break;\n    case 'users':\n        UserModule.refresh();\n        break;\n    case 'apps':\n        AppModule.refresh();\n        break;\n    case 'incidents':\n        IncidentModule.refresh();\n        break;\n    case 'changes':\n        ChangeModule.refresh();\n        break;\n    case 'logs':\n        LogModule.refresh();\n        break;\n    case 'settings':\n        SettingsModule.loadToForm();\n        break;\n    }\n}\n\n// サイドバー初期化\nfunction initSidebar() {\n    const menuToggle = document.getElementById('menuToggle');\n    const sidebar = document.getElementById('sidebar');\n\n    menuToggle.addEventListener('click', () => {\n        sidebar.classList.toggle('active');\n    });\n\n    document.addEventListener('click', (e) => {\n        if (window.innerWidth <= 1024) {\n            if (!sidebar.contains(e.target) && !menuToggle.contains(e.target)) {\n                sidebar.classList.remove('active');\n            }\n        }\n    });\n}\n\n// フィルター初期化\nfunction initFilters() {\n    // ユーザー検索・フィルター\n    document.getElementById('userSearch').addEventListener('input', () => UserModule.filter());\n    document.getElementById('userStatusFilter').addEventListener('change', () => UserModule.filter());\n    document.getElementById('userRoleFilter').addEventListener('change', () => UserModule.filter());\n\n    // アプリ検索・フィルター\n    document.getElementById('appSearch').addEventListener('input', () => AppModule.filter());\n    document.getElementById('appCategoryFilter').addEventListener('change', () => AppModule.filter());\n    document.getElementById('appStatusFilter').addEventListener('change', () => AppModule.filter());\n\n    // インシデント検索・フィルター\n    document.getElementById('incidentSearch').addEventListener('input', () => IncidentModule.filter());\n    document.getElementById('incidentPriorityFilter').addEventListener('change', () => IncidentModule.filter());\n    document.getElementById('incidentStatusFilter').addEventListener('change', () => IncidentModule.filter());\n\n    // 変更要求検索・フィルター\n    document.getElementById('changeSearch').addEventListener('input', () => ChangeModule.filter());\n    document.getElementById('changeTypeFilter').addEventListener('change', () => ChangeModule.filter());\n    document.getElementById('changeStatusFilter').addEventListener('change', () => ChangeModule.filter());\n}\n\n// API設定読み込み（互換性のため残す）\nfunction loadApiConfig() {\n    // 設定モジュールで管理するため、この関数は互換性のために残す\n}\n\n// 設定初期化\nfunction initSettings() {\n    SettingsModule.initTabs();\n    SettingsModule.loadToForm();\n}\n\n// ダッシュボード初期化\nfunction initDashboard() {\n    updateDashboard();\n}\n\n// ダッシュボード更新\nfunction updateDashboard() {\n    const stats = DataStore.getStats();\n    document.getElementById('totalUsers').textContent = stats.totalUsers;\n    document.getElementById('activeUsers').textContent = stats.activeUsers;\n    document.getElementById('totalApps').textContent = stats.totalApps;\n    document.getElementById('activeApps').textContent = stats.activeApps;\n    document.getElementById('openIncidents').textContent = stats.openIncidents;\n    document.getElementById('pendingChanges').textContent = stats.pendingChanges;\n\n    // 最近のログ\n    LogModule.renderRecent();\n\n    // アプリサマリー\n    renderAppSummary();\n}\n\n// アプリサマリー表示\nfunction renderAppSummary() {\n    const container = document.getElementById('appSummary');\n    const apps = [...DataStore.apps]\n        .sort((a, b) => new Date(b.updated) - new Date(a.updated))\n        .slice(0, 5);\n    container.innerHTML = apps.map(app => `\n        <div class=\"app-summary-item\">\n            <span class=\"app-name\">${app.name}</span>\n            <span class=\"app-records\">${app.records.toLocaleString()}件</span>\n            <span class=\"badge ${AppModule.getStatusBadge(app.status)}\">${AppModule.getStatusText(app.status)}</span>\n        </div>\n    `).join('');\n}\n\n// 全モジュール初期化\nfunction refreshAllModules() {\n    UserModule.refresh();\n    AppModule.refresh();\n    IncidentModule.refresh();\n    ChangeModule.refresh();\n    LogModule.refresh();\n}\n\n// モーダル関連\nfunction openModal(title, bodyContent, buttons = []) {\n    document.getElementById('modalTitle').textContent = title;\n    document.getElementById('modalBody').innerHTML = bodyContent;\n\n    const footer = document.getElementById('modalFooter');\n    footer.innerHTML = buttons.map(btn =>\n        `<button class=\"btn ${btn.class}\" onclick=\"${btn.onclick}\">${btn.text}</button>`\n    ).join('');\n\n    document.getElementById('modalOverlay').classList.add('active');\n}\n\nfunction closeModal() {\n    document.getElementById('modalOverlay').classList.remove('active');\n}\n\n// ESCキーでモーダルを閉じる\ndocument.addEventListener('keydown', (e) => {\n    if (e.key === 'Escape') {\n        closeModal();\n    }\n});\n\n// モーダルオーバーレイクリックで閉じる\ndocument.getElementById('modalOverlay').addEventListener('click', (e) => {\n    if (e.target === document.getElementById('modalOverlay')) {\n        closeModal();\n    }\n});\n\n// 初期ログイン記録\nLogModule.addLog('login', 'システム', 'system', 'ログイン成功');\n","usedDeprecatedRules":[{"ruleId":"semi","replacedBy":[]},{"ruleId":"quotes","replacedBy":[]},{"ruleId":"indent","replacedBy":[]},{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/runner/work/Appsuite-ITSM-Management/Appsuite-ITSM-Management/WebUI-Production/js/modules.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'UserModule' is assigned a value but never used.","line":10,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'AppModule' is assigned a value but never used.","line":203,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":203,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'IncidentModule' is assigned a value but never used.","line":537,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":537,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'SettingsModule' is assigned a value but never used.","line":789,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":789,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'ChangeModule' is assigned a value but never used.","line":1242,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":1242,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AppSuite 管理運用システム - 機能モジュール\n */\n\nfunction isValidEmail(value) {\n    return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(value);\n}\n\n// ユーザー管理モジュール\nconst UserModule = {\n    refresh() {\n        this.render(DataStore.users);\n    },\n\n    render(users) {\n        const readOnly = window.ApiSync?.isReadOnly;\n        const tbody = document.getElementById('usersTableBody');\n        tbody.innerHTML = users.map(user => `\n            <tr>\n                <td>${escapeHtml(user.id)}</td>\n                <td>${escapeHtml(user.username)}</td>\n                <td>${escapeHtml(user.email)}</td>\n                <td>${escapeHtml(user.department)}</td>\n                <td><span class=\"badge ${user.role === '管理者' ? 'badge-primary' : 'badge-info'}\">${escapeHtml(user.role)}</span></td>\n                <td><span class=\"badge ${user.status === 'active' ? 'badge-success' : 'badge-secondary'}\">${user.status === 'active' ? '有効' : '無効'}</span></td>\n                <td>${escapeHtml(user.lastLogin)}</td>\n                <td>\n                    <button class=\"action-btn edit\" onclick=\"UserModule.edit('${escapeHtml(user.id)}')\" title=\"${readOnly ? '参照専用のため編集不可' : '編集'}\" ${readOnly ? 'disabled' : ''}><i class=\"fas fa-edit\"></i></button>\n                    <button class=\"action-btn delete\" onclick=\"UserModule.delete('${escapeHtml(user.id)}')\" title=\"${readOnly ? '参照専用のため削除不可' : '削除'}\" ${readOnly ? 'disabled' : ''}><i class=\"fas fa-trash\"></i></button>\n                </td>\n            </tr>\n        `).join('');\n    },\n\n    showAddModal() {\n        openModal('ユーザー追加', `\n            <div class=\"form-group\">\n                <label>ユーザー名</label>\n                <input type=\"text\" id=\"newUserName\" required>\n            </div>\n            <div class=\"form-group\">\n                <label>メールアドレス</label>\n                <input type=\"email\" id=\"newUserEmail\" required>\n            </div>\n            <div class=\"form-group\">\n                <label>部署</label>\n                <select id=\"newUserDept\">\n                    <option>情報システム部</option>\n                    <option>営業部</option>\n                    <option>総務部</option>\n                    <option>開発部</option>\n                    <option>経理部</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>権限</label>\n                <select id=\"newUserRole\">\n                    <option value=\"ユーザー\">ユーザー</option>\n                    <option value=\"管理者\">管理者</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>ステータス</label>\n                <select id=\"newUserStatus\">\n                    <option value=\"active\">有効</option>\n                    <option value=\"inactive\">無効</option>\n                </select>\n            </div>\n        `, [\n            { text: 'キャンセル', class: 'btn-secondary', onclick: 'closeModal()' },\n            { text: '追加', class: 'btn-primary', onclick: 'UserModule.add()' }\n        ]);\n    },\n\n    add() {\n        const username = document.getElementById('newUserName').value.trim();\n        const email = document.getElementById('newUserEmail').value.trim();\n        if (!username || username.length > 50) {\n            showToast('ユーザー名は1-50文字で入力してください', 'error');\n            return;\n        }\n        if (!isValidEmail(email)) {\n            showToast('メールアドレス形式が正しくありません', 'error');\n            return;\n        }\n        const newUser = {\n            id: 'U' + String(DataStore.users.length + 1).padStart(4, '0'),\n            username: username,\n            email: email,\n            department: document.getElementById('newUserDept').value,\n            role: document.getElementById('newUserRole').value,\n            status: document.getElementById('newUserStatus').value,\n            lastLogin: '-'\n        };\n        DataStore.users.push(newUser);\n        this.refresh();\n        closeModal();\n        showToast('ユーザーを追加しました', 'success');\n        LogModule.addLog('create', 'ユーザー', 'user', '新規ユーザー追加: ' + newUser.username);\n        updateDashboard();\n    },\n\n    edit(id) {\n        const user = DataStore.users.find(u => u.id === id);\n        openModal('ユーザー編集', `\n            <div class=\"form-group\">\n                <label>ユーザー名</label>\n                <input type=\"text\" id=\"editUserName\" value=\"${escapeHtml(user.username)}\">\n            </div>\n            <div class=\"form-group\">\n                <label>メールアドレス</label>\n                <input type=\"email\" id=\"editUserEmail\" value=\"${escapeHtml(user.email)}\">\n            </div>\n            <div class=\"form-group\">\n                <label>部署</label>\n                <select id=\"editUserDept\">\n                    ${['情報システム部', '営業部', '総務部', '開発部', '経理部'].map(d =>\n        `<option ${d === user.department ? 'selected' : ''}>${d}</option>`\n    ).join('')}\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>権限</label>\n                <select id=\"editUserRole\">\n                    <option ${user.role === 'ユーザー' ? 'selected' : ''}>ユーザー</option>\n                    <option ${user.role === '管理者' ? 'selected' : ''}>管理者</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>ステータス</label>\n                <select id=\"editUserStatus\">\n                    <option value=\"active\" ${user.status === 'active' ? 'selected' : ''}>有効</option>\n                    <option value=\"inactive\" ${user.status === 'inactive' ? 'selected' : ''}>無効</option>\n                </select>\n            </div>\n        `, [\n            { text: 'キャンセル', class: 'btn-secondary', onclick: 'closeModal()' },\n            { text: '保存', class: 'btn-primary', onclick: `UserModule.save('${id}')` }\n        ]);\n    },\n\n    save(id) {\n        const user = DataStore.users.find(u => u.id === id);\n        const username = document.getElementById('editUserName').value.trim();\n        const email = document.getElementById('editUserEmail').value.trim();\n        if (!username || username.length > 50) {\n            showToast('ユーザー名は1-50文字で入力してください', 'error');\n            return;\n        }\n        if (!isValidEmail(email)) {\n            showToast('メールアドレス形式が正しくありません', 'error');\n            return;\n        }\n        user.username = username;\n        user.email = email;\n        user.department = document.getElementById('editUserDept').value;\n        user.role = document.getElementById('editUserRole').value;\n        user.status = document.getElementById('editUserStatus').value;\n        this.refresh();\n        closeModal();\n        showToast('ユーザー情報を更新しました', 'success');\n        LogModule.addLog('update', 'ユーザー', 'user', 'ユーザー更新: ' + user.username);\n        updateDashboard();\n    },\n\n    delete(id) {\n        const user = DataStore.users.find(u => u.id === id);\n        if (confirm(`ユーザー「${user.username}」を削除しますか？`)) {\n            const idx = DataStore.users.findIndex(u => u.id === id);\n            DataStore.users.splice(idx, 1);\n            this.refresh();\n            showToast('ユーザーを削除しました', 'success');\n            LogModule.addLog('delete', 'ユーザー', 'user', 'ユーザー削除: ' + user.username);\n            updateDashboard();\n        }\n    },\n\n    filter() {\n        const search = document.getElementById('userSearch').value.toLowerCase();\n        const status = document.getElementById('userStatusFilter').value;\n        const role = document.getElementById('userRoleFilter').value;\n\n        let filtered = DataStore.users;\n\n        if (search) {\n            filtered = filtered.filter(u =>\n                u.username.toLowerCase().includes(search) ||\n                u.email.toLowerCase().includes(search)\n            );\n        }\n        if (status) {\n            filtered = filtered.filter(u => u.status === status);\n        }\n        if (role) {\n            filtered = filtered.filter(u => u.role === role);\n        }\n\n        this.render(filtered);\n    }\n};\n\n// アプリ管理モジュール\nconst AppModule = {\n    refresh() {\n        this.render(DataStore.apps);\n    },\n\n    render(apps) {\n        const readOnly = window.ApiSync?.isReadOnly;\n        const tbody = document.getElementById('appsTableBody');\n        tbody.innerHTML = apps.map(app => `\n            <tr>\n                <td>${escapeHtml(app.id)}</td>\n                <td>${escapeHtml(app.name)}</td>\n                <td>${escapeHtml(app.category)}</td>\n                <td>${escapeHtml(app.creator)}</td>\n                <td>${app.records.toLocaleString()}</td>\n                <td><span class=\"badge ${this.getStatusBadge(app.status)}\">${this.getStatusText(app.status)}</span></td>\n                <td>${escapeHtml(app.updated)}</td>\n                <td>\n                    <button class=\"action-btn view\" onclick=\"AppModule.view('${escapeHtml(app.id)}')\" title=\"詳細\"><i class=\"fas fa-eye\"></i></button>\n                    <button class=\"action-btn edit\" onclick=\"AppModule.edit('${escapeHtml(app.id)}')\" title=\"${readOnly ? '参照専用のため編集不可' : '編集'}\" ${readOnly ? 'disabled' : ''}><i class=\"fas fa-edit\"></i></button>\n                    <button class=\"action-btn delete\" onclick=\"AppModule.delete('${escapeHtml(app.id)}')\" title=\"${readOnly ? '参照専用のため削除不可' : '削除'}\" ${readOnly ? 'disabled' : ''}><i class=\"fas fa-trash\"></i></button>\n                </td>\n            </tr>\n        `).join('');\n    },\n\n    getStatusBadge(status) {\n        const badges = { active: 'badge-success', maintenance: 'badge-warning', inactive: 'badge-secondary' };\n        return badges[status] || 'badge-secondary';\n    },\n\n    getStatusText(status) {\n        const texts = { active: '稼働中', maintenance: 'メンテナンス', inactive: '停止中' };\n        return texts[status] || status;\n    },\n\n    showAddModal() {\n        openModal('新規アプリ登録', `\n            <div class=\"form-group\">\n                <label>アプリ名</label>\n                <input type=\"text\" id=\"newAppName\" required>\n            </div>\n            <div class=\"form-group\">\n                <label>カテゴリ</label>\n                <select id=\"newAppCategory\">\n                    <option>業務管理</option>\n                    <option>申請・承認</option>\n                    <option>データ管理</option>\n                    <option>その他</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>作成者</label>\n                <input type=\"text\" id=\"newAppCreator\" value=\"${document.getElementById('currentUser').textContent}\">\n            </div>\n            <div class=\"form-group\">\n                <label>ステータス</label>\n                <select id=\"newAppStatus\">\n                    <option value=\"active\">稼働中</option>\n                    <option value=\"maintenance\">メンテナンス</option>\n                    <option value=\"inactive\">停止中</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>説明</label>\n                <textarea id=\"newAppDesc\" rows=\"3\" style=\"width:100%;padding:10px;border:1px solid #e2e8f0;border-radius:8px;\"></textarea>\n            </div>\n        `, [\n            { text: 'キャンセル', class: 'btn-secondary', onclick: 'closeModal()' },\n            { text: '登録', class: 'btn-primary', onclick: 'AppModule.add()' }\n        ]);\n    },\n\n    add() {\n        const name = document.getElementById('newAppName').value.trim();\n        const creator = document.getElementById('newAppCreator').value.trim();\n        if (!name || name.length > 100) {\n            showToast('アプリ名は1-100文字で入力してください', 'error');\n            return;\n        }\n        if (!creator || creator.length > 50) {\n            showToast('作成者は1-50文字で入力してください', 'error');\n            return;\n        }\n        const newApp = {\n            id: 'APP' + String(DataStore.apps.length + 1).padStart(3, '0'),\n            name: name,\n            category: document.getElementById('newAppCategory').value,\n            creator: creator,\n            records: 0,\n            status: document.getElementById('newAppStatus').value,\n            updated: new Date().toISOString().split('T')[0],\n            description: document.getElementById('newAppDesc').value.trim()\n        };\n        DataStore.apps.push(newApp);\n        this.refresh();\n        closeModal();\n        showToast('アプリを登録しました', 'success');\n        LogModule.addLog('create', newApp.name, 'app', '新規アプリ作成');\n        updateDashboard();\n    },\n\n    view(id) {\n        const app = DataStore.apps.find(a => a.id === id);\n        openModal('アプリ詳細: ' + escapeHtml(app.name), `\n            <div style=\"line-height: 2;\">\n                <p><strong>アプリID:</strong> ${escapeHtml(app.id)}</p>\n                <p><strong>アプリ名:</strong> ${escapeHtml(app.name)}</p>\n                <p><strong>カテゴリ:</strong> ${escapeHtml(app.category)}</p>\n                <p><strong>作成者:</strong> ${escapeHtml(app.creator)}</p>\n                <p><strong>レコード数:</strong> ${app.records.toLocaleString()}件</p>\n                <p><strong>ステータス:</strong> ${this.getStatusText(app.status)}</p>\n                <p><strong>最終更新:</strong> ${escapeHtml(app.updated)}</p>\n                <p><strong>説明:</strong></p>\n                <p style=\"background:#f8fafc;padding:10px;border-radius:8px;\">${escapeHtml(app.description) || '（なし）'}</p>\n            </div>\n        `, [\n            { text: '閉じる', class: 'btn-secondary', onclick: 'closeModal()' }\n        ]);\n    },\n\n    edit(id) {\n        const app = DataStore.apps.find(a => a.id === id);\n        openModal('アプリ編集: ' + escapeHtml(app.name), `\n            <div class=\"form-group\">\n                <label>アプリ名</label>\n                <input type=\"text\" id=\"editAppName\" value=\"${escapeHtml(app.name)}\">\n            </div>\n            <div class=\"form-group\">\n                <label>カテゴリ</label>\n                <select id=\"editAppCategory\">\n                    ${['業務管理', '申請・承認', 'データ管理', 'その他'].map(c =>\n        `<option ${c === app.category ? 'selected' : ''}>${c}</option>`\n    ).join('')}\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>作成者</label>\n                <input type=\"text\" id=\"editAppCreator\" value=\"${escapeHtml(app.creator)}\">\n            </div>\n            <div class=\"form-group\">\n                <label>ステータス</label>\n                <select id=\"editAppStatus\">\n                    <option value=\"active\" ${app.status === 'active' ? 'selected' : ''}>稼働中</option>\n                    <option value=\"maintenance\" ${app.status === 'maintenance' ? 'selected' : ''}>メンテナンス</option>\n                    <option value=\"inactive\" ${app.status === 'inactive' ? 'selected' : ''}>停止中</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>説明</label>\n                <textarea id=\"editAppDesc\" rows=\"3\" style=\"width:100%;padding:10px;border:1px solid #e2e8f0;border-radius:8px;\">${escapeHtml(app.description) || ''}</textarea>\n            </div>\n        `, [\n            { text: 'キャンセル', class: 'btn-secondary', onclick: 'closeModal()' },\n            { text: '保存', class: 'btn-primary', onclick: `AppModule.save('${escapeHtml(id)}')` }\n        ]);\n    },\n\n    save(id) {\n        const app = DataStore.apps.find(a => a.id === id);\n        const name = document.getElementById('editAppName').value.trim();\n        const creator = document.getElementById('editAppCreator').value.trim();\n        if (!name || name.length > 100) {\n            showToast('アプリ名は1-100文字で入力してください', 'error');\n            return;\n        }\n        if (!creator || creator.length > 50) {\n            showToast('作成者は1-50文字で入力してください', 'error');\n            return;\n        }\n        app.name = name;\n        app.category = document.getElementById('editAppCategory').value;\n        app.creator = creator;\n        app.status = document.getElementById('editAppStatus').value;\n        app.updated = new Date().toISOString().split('T')[0];\n        app.description = document.getElementById('editAppDesc').value.trim();\n        this.refresh();\n        closeModal();\n        showToast('アプリ情報を更新しました', 'success');\n        LogModule.addLog('update', app.name, 'app', 'アプリ設定を更新');\n        updateDashboard();\n    },\n\n    delete(id) {\n        const app = DataStore.apps.find(a => a.id === id);\n        if (confirm(`アプリ「${app.name}」を削除しますか？\\n※ ${app.records}件のレコードも削除されます。`)) {\n            const idx = DataStore.apps.findIndex(a => a.id === id);\n            DataStore.apps.splice(idx, 1);\n            this.refresh();\n            showToast('アプリを削除しました', 'success');\n            LogModule.addLog('delete', app.name, 'app', 'アプリ削除');\n            updateDashboard();\n        }\n    },\n\n    filter() {\n        const search = document.getElementById('appSearch').value.toLowerCase();\n        const category = document.getElementById('appCategoryFilter').value;\n        const status = document.getElementById('appStatusFilter').value;\n\n        let filtered = DataStore.apps;\n\n        if (search) {\n            filtered = filtered.filter(a =>\n                a.name.toLowerCase().includes(search)\n            );\n        }\n        if (category) {\n            filtered = filtered.filter(a => a.category === category);\n        }\n        if (status) {\n            filtered = filtered.filter(a => a.status === status);\n        }\n\n        this.render(filtered);\n    }\n};\n\n// 監査ログモジュール\nconst LogModule = {\n    refresh() {\n        this.render(DataStore.logs);\n    },\n\n    render(logs) {\n        const tbody = document.getElementById('logsTableBody');\n        tbody.innerHTML = logs.map(log => `\n            <tr>\n                <td>${escapeHtml(log.timestamp)}</td>\n                <td>${escapeHtml(log.user)}</td>\n                <td><span class=\"badge ${this.getActionBadge(log.action)}\">${this.getActionText(log.action)}</span></td>\n                <td>${escapeHtml(log.target)}</td>\n                <td>${escapeHtml(log.detail)}</td>\n                <td>${escapeHtml(log.ip)}</td>\n            </tr>\n        `).join('');\n    },\n\n    getActionBadge(action) {\n        const badges = {\n            login: 'badge-success',\n            logout: 'badge-secondary',\n            create: 'badge-info',\n            update: 'badge-warning',\n            delete: 'badge-danger',\n            export: 'badge-info'\n        };\n        return badges[action] || 'badge-secondary';\n    },\n\n    getActionText(action) {\n        const texts = {\n            login: 'ログイン',\n            logout: 'ログアウト',\n            create: '作成',\n            update: '更新',\n            delete: '削除',\n            export: 'エクスポート'\n        };\n        return texts[action] || action;\n    },\n\n    addLog(action, target, targetType, detail) {\n        const now = new Date();\n        const timestamp = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;\n        DataStore.logs.unshift({\n            timestamp: timestamp,\n            user: document.getElementById('currentUser').textContent,\n            action: action,\n            target: target,\n            targetType: targetType,\n            detail: detail,\n            ip: '192.168.1.100'\n        });\n    },\n\n    search() {\n        const from = document.getElementById('logDateFrom').value;\n        const to = document.getElementById('logDateTo').value;\n        const actionType = document.getElementById('logTypeFilter').value;\n        const targetType = document.getElementById('logTargetFilter').value;\n\n        let filtered = DataStore.logs;\n\n        if (actionType) {\n            filtered = filtered.filter(l => l.action === actionType);\n        }\n        if (targetType) {\n            filtered = filtered.filter(l => l.targetType === targetType);\n        }\n        if (from) {\n            filtered = filtered.filter(l => l.timestamp >= from);\n        }\n        if (to) {\n            filtered = filtered.filter(l => l.timestamp <= to + ' 23:59:59');\n        }\n\n        this.render(filtered);\n        showToast(`${filtered.length}件のログが見つかりました`, 'success');\n    },\n\n    export() {\n        const now = new Date();\n        const timestamp = `${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}_${String(now.getHours()).padStart(2,'0')}${String(now.getMinutes()).padStart(2,'0')}${String(now.getSeconds()).padStart(2,'0')}`;\n        const csv = '\\uFEFF日時,ユーザー,操作タイプ,対象,詳細,IPアドレス\\n' +\n            DataStore.logs.map(l =>\n                `\"${l.timestamp}\",\"${l.user}\",\"${this.getActionText(l.action)}\",\"${l.target}\",\"${l.detail}\",\"${l.ip}\"`\n            ).join('\\n');\n\n        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = 'audit_log_' + timestamp + '.csv';\n        a.click();\n        showToast('ログをエクスポートしました', 'success');\n        this.addLog('export', '監査ログ', 'system', 'CSVエクスポート実行');\n    },\n\n    renderRecent() {\n        const recentLogs = DataStore.logs.slice(0, 10);\n        const container = document.getElementById('recentLogs');\n        container.innerHTML = recentLogs.map(log => `\n            <div class=\"log-item\">\n                <span class=\"log-time\">${escapeHtml(log.timestamp)}</span>\n                <span class=\"log-user\">${escapeHtml(log.user)}</span>が\n                <span class=\"badge ${this.getActionBadge(log.action)}\" style=\"font-size:0.7rem;\">${this.getActionText(log.action)}</span>\n                ${escapeHtml(log.target)}\n            </div>\n        `).join('');\n    }\n};\n\n// インシデント管理モジュール\nconst IncidentModule = {\n    refresh() {\n        this.render(DataStore.incidents);\n    },\n\n    render(incidents) {\n        const tbody = document.getElementById('incidentsTableBody');\n        tbody.innerHTML = incidents.map(inc => `\n            <tr>\n                <td>${escapeHtml(inc.id)}</td>\n                <td>${escapeHtml(inc.title)}</td>\n                <td>${escapeHtml(inc.appName)}</td>\n                <td><span class=\"badge ${this.getPriorityBadge(inc.priority)}\">${this.getPriorityText(inc.priority)}</span></td>\n                <td><span class=\"badge ${this.getStatusBadge(inc.status)}\">${this.getStatusText(inc.status)}</span></td>\n                <td>${escapeHtml(inc.reporter)}</td>\n                <td>${escapeHtml(inc.assignee)}</td>\n                <td>${escapeHtml(inc.created)}</td>\n                <td>\n                    <button class=\"action-btn view\" onclick=\"IncidentModule.view('${escapeHtml(inc.id)}')\" title=\"詳細\"><i class=\"fas fa-eye\"></i></button>\n                    <button class=\"action-btn edit\" onclick=\"IncidentModule.edit('${escapeHtml(inc.id)}')\" title=\"編集\"><i class=\"fas fa-edit\"></i></button>\n                    <button class=\"action-btn delete\" onclick=\"IncidentModule.delete('${escapeHtml(inc.id)}')\" title=\"削除\"><i class=\"fas fa-trash\"></i></button>\n                </td>\n            </tr>\n        `).join('');\n    },\n\n    getPriorityBadge(priority) {\n        const badges = { high: 'badge-danger', medium: 'badge-warning', low: 'badge-info' };\n        return badges[priority] || 'badge-secondary';\n    },\n\n    getPriorityText(priority) {\n        const texts = { high: '高', medium: '中', low: '低' };\n        return texts[priority] || priority;\n    },\n\n    getStatusBadge(status) {\n        const badges = { open: 'badge-danger', in_progress: 'badge-warning', resolved: 'badge-info', closed: 'badge-success' };\n        return badges[status] || 'badge-secondary';\n    },\n\n    getStatusText(status) {\n        const texts = { open: 'オープン', in_progress: '対応中', resolved: '解決済', closed: 'クローズ' };\n        return texts[status] || status;\n    },\n\n    showAddModal() {\n        const appOptions = DataStore.apps.map(a => `<option value=\"${escapeHtml(a.id)}\" data-name=\"${escapeHtml(a.name)}\">${escapeHtml(a.name)}</option>`).join('');\n        const userOptions = DataStore.users.filter(u => u.status === 'active').map(u => `<option value=\"${escapeHtml(u.username)}\">${escapeHtml(u.username)}</option>`).join('');\n\n        openModal('インシデント登録', `\n            <div class=\"form-group\">\n                <label>タイトル</label>\n                <input type=\"text\" id=\"newIncTitle\" required>\n            </div>\n            <div class=\"form-group\">\n                <label>対象アプリ</label>\n                <select id=\"newIncApp\">\n                    ${appOptions}\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>優先度</label>\n                <select id=\"newIncPriority\">\n                    <option value=\"low\">低</option>\n                    <option value=\"medium\" selected>中</option>\n                    <option value=\"high\">高</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>担当者</label>\n                <select id=\"newIncAssignee\">\n                    <option value=\"-\">未割当</option>\n                    ${userOptions}\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>説明</label>\n                <textarea id=\"newIncDesc\" rows=\"3\" style=\"width:100%;padding:10px;border:1px solid #e2e8f0;border-radius:8px;\"></textarea>\n            </div>\n        `, [\n            { text: 'キャンセル', class: 'btn-secondary', onclick: 'closeModal()' },\n            { text: '登録', class: 'btn-primary', onclick: 'IncidentModule.add()' }\n        ]);\n    },\n\n    add() {\n        const appSelect = document.getElementById('newIncApp');\n        const selectedOption = appSelect.options[appSelect.selectedIndex];\n        const newInc = {\n            id: 'INC' + String(DataStore.incidents.length + 1).padStart(3, '0'),\n            title: document.getElementById('newIncTitle').value,\n            appId: appSelect.value,\n            appName: selectedOption.dataset.name,\n            priority: document.getElementById('newIncPriority').value,\n            status: 'open',\n            reporter: document.getElementById('currentUser').textContent,\n            assignee: document.getElementById('newIncAssignee').value,\n            created: new Date().toISOString().split('T')[0],\n            description: document.getElementById('newIncDesc').value\n        };\n        DataStore.incidents.push(newInc);\n        this.refresh();\n        closeModal();\n        showToast('インシデントを登録しました', 'success');\n        LogModule.addLog('create', 'インシデント', 'incident', '新規インシデント登録: ' + newInc.title);\n        updateDashboard();\n    },\n\n    view(id) {\n        const inc = DataStore.incidents.find(i => i.id === id);\n        openModal('インシデント詳細: ' + escapeHtml(inc.id), `\n            <div style=\"line-height: 2;\">\n                <p><strong>インシデントID:</strong> ${escapeHtml(inc.id)}</p>\n                <p><strong>タイトル:</strong> ${escapeHtml(inc.title)}</p>\n                <p><strong>対象アプリ:</strong> ${escapeHtml(inc.appName)}</p>\n                <p><strong>優先度:</strong> <span class=\"badge ${this.getPriorityBadge(inc.priority)}\">${this.getPriorityText(inc.priority)}</span></p>\n                <p><strong>ステータス:</strong> <span class=\"badge ${this.getStatusBadge(inc.status)}\">${this.getStatusText(inc.status)}</span></p>\n                <p><strong>報告者:</strong> ${escapeHtml(inc.reporter)}</p>\n                <p><strong>担当者:</strong> ${escapeHtml(inc.assignee)}</p>\n                <p><strong>登録日:</strong> ${escapeHtml(inc.created)}</p>\n                <p><strong>説明:</strong></p>\n                <p style=\"background:#f8fafc;padding:10px;border-radius:8px;\">${escapeHtml(inc.description) || '（なし）'}</p>\n            </div>\n        `, [\n            { text: '閉じる', class: 'btn-secondary', onclick: 'closeModal()' }\n        ]);\n    },\n\n    edit(id) {\n        const inc = DataStore.incidents.find(i => i.id === id);\n        const appOptions = DataStore.apps.map(a => `<option value=\"${escapeHtml(a.id)}\" data-name=\"${escapeHtml(a.name)}\" ${a.id === inc.appId ? 'selected' : ''}>${escapeHtml(a.name)}</option>`).join('');\n        const userOptions = DataStore.users.filter(u => u.status === 'active').map(u => `<option value=\"${escapeHtml(u.username)}\" ${u.username === inc.assignee ? 'selected' : ''}>${escapeHtml(u.username)}</option>`).join('');\n\n        openModal('インシデント編集: ' + escapeHtml(inc.id), `\n            <div class=\"form-group\">\n                <label>タイトル</label>\n                <input type=\"text\" id=\"editIncTitle\" value=\"${escapeHtml(inc.title)}\">\n            </div>\n            <div class=\"form-group\">\n                <label>対象アプリ</label>\n                <select id=\"editIncApp\">\n                    ${appOptions}\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>優先度</label>\n                <select id=\"editIncPriority\">\n                    <option value=\"low\" ${inc.priority === 'low' ? 'selected' : ''}>低</option>\n                    <option value=\"medium\" ${inc.priority === 'medium' ? 'selected' : ''}>中</option>\n                    <option value=\"high\" ${inc.priority === 'high' ? 'selected' : ''}>高</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>ステータス</label>\n                <select id=\"editIncStatus\">\n                    <option value=\"open\" ${inc.status === 'open' ? 'selected' : ''}>オープン</option>\n                    <option value=\"in_progress\" ${inc.status === 'in_progress' ? 'selected' : ''}>対応中</option>\n                    <option value=\"resolved\" ${inc.status === 'resolved' ? 'selected' : ''}>解決済</option>\n                    <option value=\"closed\" ${inc.status === 'closed' ? 'selected' : ''}>クローズ</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>担当者</label>\n                <select id=\"editIncAssignee\">\n                    <option value=\"-\" ${inc.assignee === '-' ? 'selected' : ''}>未割当</option>\n                    ${userOptions}\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>説明</label>\n                <textarea id=\"editIncDesc\" rows=\"3\" style=\"width:100%;padding:10px;border:1px solid #e2e8f0;border-radius:8px;\">${escapeHtml(inc.description) || ''}</textarea>\n            </div>\n        `, [\n            { text: 'キャンセル', class: 'btn-secondary', onclick: 'closeModal()' },\n            { text: '保存', class: 'btn-primary', onclick: `IncidentModule.save('${escapeHtml(id)}')` }\n        ]);\n    },\n\n    save(id) {\n        const inc = DataStore.incidents.find(i => i.id === id);\n        const appSelect = document.getElementById('editIncApp');\n        const selectedOption = appSelect.options[appSelect.selectedIndex];\n        const nextStatus = document.getElementById('editIncStatus').value;\n        if (!this.isValidStatusTransition(inc.status, nextStatus)) {\n            showToast('ステータス遷移ルールに違反しています', 'error');\n            return;\n        }\n        inc.title = document.getElementById('editIncTitle').value;\n        inc.appId = appSelect.value;\n        inc.appName = selectedOption.dataset.name;\n        inc.priority = document.getElementById('editIncPriority').value;\n        inc.status = nextStatus;\n        inc.assignee = document.getElementById('editIncAssignee').value;\n        inc.description = document.getElementById('editIncDesc').value;\n        this.refresh();\n        closeModal();\n        showToast('インシデントを更新しました', 'success');\n        LogModule.addLog('update', 'インシデント', 'incident', 'インシデント更新: ' + inc.title);\n        updateDashboard();\n    },\n\n    delete(id) {\n        const inc = DataStore.incidents.find(i => i.id === id);\n        if (confirm(`インシデント「${inc.title}」を削除しますか？`)) {\n            const idx = DataStore.incidents.findIndex(i => i.id === id);\n            DataStore.incidents.splice(idx, 1);\n            this.refresh();\n            showToast('インシデントを削除しました', 'success');\n            LogModule.addLog('delete', 'インシデント', 'incident', 'インシデント削除: ' + inc.title);\n            updateDashboard();\n        }\n    },\n\n    filter() {\n        const search = document.getElementById('incidentSearch').value.toLowerCase();\n        const priority = document.getElementById('incidentPriorityFilter').value;\n        const status = document.getElementById('incidentStatusFilter').value;\n\n        let filtered = DataStore.incidents;\n\n        if (search) {\n            filtered = filtered.filter(i =>\n                i.title.toLowerCase().includes(search) ||\n                (i.description || '').toLowerCase().includes(search)\n            );\n        }\n        if (priority) {\n            filtered = filtered.filter(i => i.priority === priority);\n        }\n        if (status) {\n            filtered = filtered.filter(i => i.status === status);\n        }\n\n        this.render(filtered);\n    },\n\n    isValidStatusTransition(currentStatus, nextStatus) {\n        if (currentStatus === nextStatus) {\n            return true;\n        }\n        const transitions = {\n            open: ['in_progress', 'closed'],\n            in_progress: ['resolved', 'open'],\n            resolved: ['closed', 'in_progress'],\n            closed: ['in_progress']\n        };\n        return (transitions[currentStatus] || []).includes(nextStatus);\n    }\n};\n\n// システム設定モジュール\nconst SettingsModule = {\n    // 設定データのデフォルト値\n    defaults: {\n        api: {\n            url: '',\n            key: '',\n            authMethod: 'bearer',\n            timeout: 30,\n            syncInterval: 30\n        },\n        general: {\n            systemName: 'AppSuite 管理運用システム',\n            orgName: '',\n            adminEmail: '',\n            theme: 'light',\n            language: 'ja',\n            dateFormat: 'yyyy-MM-dd',\n            pageSize: 25\n        },\n        notification: {\n            incidentNew: true,\n            incidentHigh: true,\n            changeApproval: true,\n            changeComplete: false,\n            smtpHost: '',\n            smtpPort: 587,\n            smtpUser: '',\n            smtpPass: '',\n            smtpSsl: true\n        },\n        security: {\n            pwMinLength: 8,\n            pwRequireUpper: true,\n            pwRequireNumber: true,\n            pwRequireSpecial: false,\n            pwExpireDays: 90,\n            sessionTimeout: 30,\n            maxSessions: 3,\n            enableTwoFactor: false,\n            maxLoginAttempts: 5,\n            lockoutDuration: 15\n        },\n        workflow: {\n            incidentAutoAssign: false,\n            incidentDefaultAssignee: '',\n            incidentEscalation: 24,\n            changeRequireApproval: true,\n            changeApprover: 'manager',\n            changeLeadTime: 3,\n            allowSkipStatus: false,\n            requireComment: true\n        },\n        backup: {\n            autoBackup: true,\n            backupInterval: 'daily',\n            backupRetention: 7\n        }\n    },\n\n    // 設定読み込み\n    load() {\n        const saved = localStorage.getItem('appsuiteSettings');\n        return saved ? JSON.parse(saved) : this.defaults;\n    },\n\n    // 設定保存\n    save(settings) {\n        localStorage.setItem('appsuiteSettings', JSON.stringify(settings));\n    },\n\n    // タブ切り替え初期化\n    initTabs() {\n        document.querySelectorAll('.settings-tab').forEach(tab => {\n            tab.addEventListener('click', () => {\n                // タブのアクティブ状態を切り替え\n                document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('active'));\n                tab.classList.add('active');\n\n                // パネルの表示を切り替え\n                const tabName = tab.dataset.tab;\n                document.querySelectorAll('.settings-panel').forEach(p => p.classList.remove('active'));\n                document.getElementById('panel-' + tabName).classList.add('active');\n            });\n        });\n    },\n\n    // フォームに設定を反映\n    loadToForm() {\n        const settings = this.load();\n\n        // API設定\n        document.getElementById('apiUrl').value = settings.api?.url || '';\n        document.getElementById('apiKey').value = settings.api?.key || '';\n        document.getElementById('authMethod').value = settings.api?.authMethod || 'bearer';\n        document.getElementById('timeout').value = settings.api?.timeout || 30;\n        document.getElementById('syncInterval').value = settings.api?.syncInterval || 30;\n\n        // 基本設定\n        document.getElementById('systemName').value = settings.general?.systemName || 'AppSuite 管理運用システム';\n        document.getElementById('orgName').value = settings.general?.orgName || '';\n        document.getElementById('adminEmail').value = settings.general?.adminEmail || '';\n        document.getElementById('themeSelect').value = settings.general?.theme || 'light';\n        document.getElementById('langSelect').value = settings.general?.language || 'ja';\n        document.getElementById('dateFormat').value = settings.general?.dateFormat || 'yyyy-MM-dd';\n        document.getElementById('pageSize').value = settings.general?.pageSize || 25;\n\n        // 通知設定\n        document.getElementById('notifyIncidentNew').checked = settings.notification?.incidentNew !== false;\n        document.getElementById('notifyIncidentHigh').checked = settings.notification?.incidentHigh !== false;\n        document.getElementById('notifyChangeApproval').checked = settings.notification?.changeApproval !== false;\n        document.getElementById('notifyChangeComplete').checked = settings.notification?.changeComplete === true;\n        document.getElementById('smtpHost').value = settings.notification?.smtpHost || '';\n        document.getElementById('smtpPort').value = settings.notification?.smtpPort || 587;\n        document.getElementById('smtpUser').value = settings.notification?.smtpUser || '';\n        document.getElementById('smtpPass').value = settings.notification?.smtpPass || '';\n        document.getElementById('smtpSsl').checked = settings.notification?.smtpSsl !== false;\n\n        // セキュリティ設定\n        document.getElementById('pwMinLength').value = settings.security?.pwMinLength || 8;\n        document.getElementById('pwRequireUpper').checked = settings.security?.pwRequireUpper !== false;\n        document.getElementById('pwRequireNumber').checked = settings.security?.pwRequireNumber !== false;\n        document.getElementById('pwRequireSpecial').checked = settings.security?.pwRequireSpecial === true;\n        document.getElementById('pwExpireDays').value = settings.security?.pwExpireDays || 90;\n        document.getElementById('sessionTimeout').value = settings.security?.sessionTimeout || 30;\n        document.getElementById('maxSessions').value = settings.security?.maxSessions || 3;\n        document.getElementById('enableTwoFactor').checked = settings.security?.enableTwoFactor === true;\n        document.getElementById('maxLoginAttempts').value = settings.security?.maxLoginAttempts || 5;\n        document.getElementById('lockoutDuration').value = settings.security?.lockoutDuration || 15;\n\n        // ワークフロー設定\n        document.getElementById('incidentAutoAssign').checked = settings.workflow?.incidentAutoAssign === true;\n        document.getElementById('incidentDefaultAssignee').value = settings.workflow?.incidentDefaultAssignee || '';\n        document.getElementById('incidentEscalation').value = settings.workflow?.incidentEscalation || 24;\n        document.getElementById('changeRequireApproval').checked = settings.workflow?.changeRequireApproval !== false;\n        document.getElementById('changeApprover').value = settings.workflow?.changeApprover || 'manager';\n        document.getElementById('changeLeadTime').value = settings.workflow?.changeLeadTime || 3;\n        document.getElementById('allowSkipStatus').checked = settings.workflow?.allowSkipStatus === true;\n        document.getElementById('requireComment').checked = settings.workflow?.requireComment !== false;\n\n        // バックアップ設定\n        document.getElementById('autoBackup').checked = settings.backup?.autoBackup !== false;\n        document.getElementById('backupInterval').value = settings.backup?.backupInterval || 'daily';\n        document.getElementById('backupRetention').value = settings.backup?.backupRetention || 7;\n\n        // バックアップ状態を更新\n        this.updateBackupStatus();\n    },\n\n    // API設定保存\n    saveApi() {\n        const settings = this.load();\n        settings.api = {\n            url: document.getElementById('apiUrl').value,\n            key: document.getElementById('apiKey').value,\n            authMethod: document.getElementById('authMethod').value,\n            timeout: parseInt(document.getElementById('timeout').value),\n            syncInterval: parseInt(document.getElementById('syncInterval').value)\n        };\n        this.save(settings);\n        showToast('API設定を保存しました', 'success');\n        LogModule.addLog('update', 'システム設定', 'system', 'API設定を更新');\n        if (window.ApiSync) {ApiSync.applySettings();}\n    },\n\n    // API接続テスト\n    testApi() {\n        const url = document.getElementById('apiUrl').value;\n        if (!url) {\n            showToast('APIのURLを入力してください', 'error');\n            return;\n        }\n\n        showToast('接続テスト中...', 'info');\n        // シミュレーション（実際の実装ではfetchを使用）\n        setTimeout(() => {\n            document.getElementById('apiStatus').textContent = '接続成功';\n            document.getElementById('apiStatus').className = 'status-value badge badge-success';\n            document.getElementById('lastSync').textContent = new Date().toLocaleString('ja-JP');\n            document.getElementById('apiVersion').textContent = 'V7.5';\n            showToast('API接続に成功しました', 'success');\n        }, 1500);\n    },\n\n    syncNow() {\n        if (window.ApiSync) {\n            ApiSync.syncAll();\n        }\n    },\n\n    // 基本設定保存\n    saveGeneral() {\n        const settings = this.load();\n        settings.general = {\n            systemName: document.getElementById('systemName').value,\n            orgName: document.getElementById('orgName').value,\n            adminEmail: document.getElementById('adminEmail').value,\n            theme: document.getElementById('themeSelect').value,\n            language: document.getElementById('langSelect').value,\n            dateFormat: document.getElementById('dateFormat').value,\n            pageSize: parseInt(document.getElementById('pageSize').value)\n        };\n        this.save(settings);\n\n        // システム名を反映\n        document.querySelector('.sidebar-header h1').innerHTML = '<i class=\"fas fa-cogs\"></i> ' + settings.general.systemName.substring(0, 15);\n\n        showToast('基本設定を保存しました', 'success');\n        LogModule.addLog('update', 'システム設定', 'system', '基本設定を更新');\n    },\n\n    // 基本設定リセット\n    resetGeneral() {\n        if (confirm('基本設定を初期値にリセットしますか？')) {\n            const settings = this.load();\n            settings.general = this.defaults.general;\n            this.save(settings);\n            this.loadToForm();\n            showToast('基本設定をリセットしました', 'success');\n        }\n    },\n\n    // 通知設定保存\n    saveNotification() {\n        const settings = this.load();\n        settings.notification = {\n            incidentNew: document.getElementById('notifyIncidentNew').checked,\n            incidentHigh: document.getElementById('notifyIncidentHigh').checked,\n            changeApproval: document.getElementById('notifyChangeApproval').checked,\n            changeComplete: document.getElementById('notifyChangeComplete').checked,\n            smtpHost: document.getElementById('smtpHost').value,\n            smtpPort: parseInt(document.getElementById('smtpPort').value),\n            smtpUser: document.getElementById('smtpUser').value,\n            smtpPass: document.getElementById('smtpPass').value,\n            smtpSsl: document.getElementById('smtpSsl').checked\n        };\n        this.save(settings);\n        showToast('通知設定を保存しました', 'success');\n        LogModule.addLog('update', 'システム設定', 'system', '通知設定を更新');\n    },\n\n    // テストメール送信\n    testEmail() {\n        const host = document.getElementById('smtpHost').value;\n        if (!host) {\n            showToast('SMTPホストを入力してください', 'error');\n            return;\n        }\n        showToast('テストメールを送信中...', 'info');\n        setTimeout(() => {\n            showToast('テストメールを送信しました', 'success');\n        }, 1500);\n    },\n\n    // セキュリティ設定保存\n    saveSecurity() {\n        const settings = this.load();\n        settings.security = {\n            pwMinLength: parseInt(document.getElementById('pwMinLength').value),\n            pwRequireUpper: document.getElementById('pwRequireUpper').checked,\n            pwRequireNumber: document.getElementById('pwRequireNumber').checked,\n            pwRequireSpecial: document.getElementById('pwRequireSpecial').checked,\n            pwExpireDays: parseInt(document.getElementById('pwExpireDays').value),\n            sessionTimeout: parseInt(document.getElementById('sessionTimeout').value),\n            maxSessions: parseInt(document.getElementById('maxSessions').value),\n            enableTwoFactor: document.getElementById('enableTwoFactor').checked,\n            maxLoginAttempts: parseInt(document.getElementById('maxLoginAttempts').value),\n            lockoutDuration: parseInt(document.getElementById('lockoutDuration').value)\n        };\n        this.save(settings);\n        showToast('セキュリティ設定を保存しました', 'success');\n        LogModule.addLog('update', 'システム設定', 'system', 'セキュリティ設定を更新');\n    },\n\n    // ワークフロー設定保存\n    saveWorkflow() {\n        const settings = this.load();\n        settings.workflow = {\n            incidentAutoAssign: document.getElementById('incidentAutoAssign').checked,\n            incidentDefaultAssignee: document.getElementById('incidentDefaultAssignee').value,\n            incidentEscalation: parseInt(document.getElementById('incidentEscalation').value),\n            changeRequireApproval: document.getElementById('changeRequireApproval').checked,\n            changeApprover: document.getElementById('changeApprover').value,\n            changeLeadTime: parseInt(document.getElementById('changeLeadTime').value),\n            allowSkipStatus: document.getElementById('allowSkipStatus').checked,\n            requireComment: document.getElementById('requireComment').checked\n        };\n        this.save(settings);\n        showToast('ワークフロー設定を保存しました', 'success');\n        LogModule.addLog('update', 'システム設定', 'system', 'ワークフロー設定を更新');\n    },\n\n    // バックアップ作成\n    createBackup() {\n        const data = {\n            version: '1.0.0',\n            timestamp: new Date().toISOString(),\n            settings: this.load(),\n            users: DataStore.users,\n            apps: DataStore.apps,\n            incidents: DataStore.incidents,\n            changes: DataStore.changes,\n            logs: DataStore.logs\n        };\n\n        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = 'appsuite_backup_' + new Date().toISOString().split('T')[0] + '.json';\n        a.click();\n\n        // バックアップ履歴を保存\n        const backups = JSON.parse(localStorage.getItem('backupHistory') || '[]');\n        backups.unshift({\n            date: new Date().toISOString(),\n            size: blob.size\n        });\n        localStorage.setItem('backupHistory', JSON.stringify(backups.slice(0, 10)));\n\n        this.updateBackupStatus();\n        showToast('バックアップを作成しました', 'success');\n        LogModule.addLog('export', 'バックアップ', 'system', 'データバックアップを作成');\n    },\n\n    // バックアップ状態更新\n    updateBackupStatus() {\n        const backups = JSON.parse(localStorage.getItem('backupHistory') || '[]');\n        document.getElementById('lastBackup').textContent = backups.length > 0\n            ? new Date(backups[0].date).toLocaleString('ja-JP')\n            : '-';\n        document.getElementById('backupCount').textContent = backups.length;\n\n        // データサイズを計算\n        const dataSize = new Blob([JSON.stringify({\n            settings: this.load(),\n            users: DataStore.users,\n            apps: DataStore.apps,\n            incidents: DataStore.incidents,\n            changes: DataStore.changes,\n            logs: DataStore.logs\n        })]).size;\n        document.getElementById('dataSize').textContent = this.formatBytes(dataSize);\n\n        // バックアップリスト表示\n        const listEl = document.getElementById('backupList');\n        if (backups.length > 0) {\n            listEl.innerHTML = backups.slice(0, 5).map(b => `\n                <div class=\"backup-item\">\n                    <span>${new Date(b.date).toLocaleString('ja-JP')}</span>\n                    <span>${this.formatBytes(b.size)}</span>\n                </div>\n            `).join('');\n        } else {\n            listEl.innerHTML = '<p class=\"text-muted\">バックアップはありません</p>';\n        }\n    },\n\n    // バイト数フォーマット\n    formatBytes(bytes) {\n        if (bytes === 0) {return '0 Bytes';}\n        const k = 1024;\n        const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n        const i = Math.floor(Math.log(bytes) / Math.log(k));\n        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n    },\n\n    // リストア実行\n    restoreBackup() {\n        const fileInput = document.getElementById('restoreFile');\n        const file = fileInput.files[0];\n\n        if (!file) {\n            showToast('バックアップファイルを選択してください', 'error');\n            return;\n        }\n\n        if (!confirm('現在のデータは上書きされます。リストアを実行しますか？')) {\n            return;\n        }\n\n        const reader = new FileReader();\n        reader.onload = (e) => {\n            try {\n                const data = JSON.parse(e.target.result);\n\n                // データの復元\n                if (data.settings) {this.save(data.settings);}\n                if (data.users) {DataStore.users = data.users;}\n                if (data.apps) {DataStore.apps = data.apps;}\n                if (data.incidents) {DataStore.incidents = data.incidents;}\n                if (data.changes) {DataStore.changes = data.changes;}\n                if (data.logs) {DataStore.logs = data.logs;}\n\n                this.loadToForm();\n                refreshAllModules();\n                updateDashboard();\n\n                showToast('データをリストアしました', 'success');\n                LogModule.addLog('update', 'バックアップ', 'system', 'データリストアを実行');\n            } catch (error) {\n                showToast('バックアップファイルの読み込みに失敗しました', 'error');\n            }\n        };\n        reader.readAsText(file);\n    },\n\n    // データエクスポート\n    exportData() {\n        const data = {\n            exportDate: new Date().toISOString(),\n            users: DataStore.users,\n            apps: DataStore.apps,\n            incidents: DataStore.incidents,\n            changes: DataStore.changes\n        };\n\n        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = 'appsuite_data_' + new Date().toISOString().split('T')[0] + '.json';\n        a.click();\n\n        showToast('データをエクスポートしました', 'success');\n        LogModule.addLog('export', 'データ', 'system', 'データエクスポートを実行');\n    },\n\n    // データ初期化\n    clearData() {\n        if (!confirm('全てのデータを初期化しますか？この操作は取り消せません。')) {\n            return;\n        }\n        if (!confirm('本当に初期化してよろしいですか？')) {\n            return;\n        }\n\n        localStorage.removeItem('appsuiteSettings');\n        localStorage.removeItem('backupHistory');\n        DataStore.users = [];\n        DataStore.apps = [];\n        DataStore.incidents = [];\n        DataStore.changes = [];\n        DataStore.logs = [];\n\n        this.loadToForm();\n        refreshAllModules();\n        updateDashboard();\n\n        showToast('データを初期化しました', 'warning');\n    }\n};\n\n// 変更管理モジュール\nconst ChangeModule = {\n    refresh() {\n        this.render(DataStore.changes);\n    },\n\n    render(changes) {\n        const tbody = document.getElementById('changesTableBody');\n        tbody.innerHTML = changes.map(chg => `\n            <tr>\n                <td>${escapeHtml(chg.id)}</td>\n                <td>${escapeHtml(chg.title)}</td>\n                <td>${escapeHtml(chg.appName)}</td>\n                <td><span class=\"badge ${this.getTypeBadge(chg.type)}\">${this.getTypeText(chg.type)}</span></td>\n                <td><span class=\"badge ${this.getStatusBadge(chg.status)}\">${this.getStatusText(chg.status)}</span></td>\n                <td>${escapeHtml(chg.requester)}</td>\n                <td>${escapeHtml(chg.scheduled)}</td>\n                <td>\n                    <button class=\"action-btn view\" onclick=\"ChangeModule.view('${escapeHtml(chg.id)}')\" title=\"詳細\"><i class=\"fas fa-eye\"></i></button>\n                    <button class=\"action-btn edit\" onclick=\"ChangeModule.edit('${escapeHtml(chg.id)}')\" title=\"編集\"><i class=\"fas fa-edit\"></i></button>\n                    <button class=\"action-btn delete\" onclick=\"ChangeModule.delete('${escapeHtml(chg.id)}')\" title=\"削除\"><i class=\"fas fa-trash\"></i></button>\n                </td>\n            </tr>\n        `).join('');\n    },\n\n    getTypeBadge(type) {\n        const badges = { feature: 'badge-success', improvement: 'badge-info', modification: 'badge-warning', bugfix: 'badge-danger' };\n        return badges[type] || 'badge-secondary';\n    },\n\n    getTypeText(type) {\n        const texts = { feature: '新機能', improvement: '改善', modification: '変更', bugfix: 'バグ修正' };\n        return texts[type] || type;\n    },\n\n    getStatusBadge(status) {\n        const badges = { draft: 'badge-secondary', pending: 'badge-warning', approved: 'badge-info', in_progress: 'badge-primary', completed: 'badge-success', rejected: 'badge-danger' };\n        return badges[status] || 'badge-secondary';\n    },\n\n    getStatusText(status) {\n        const texts = { draft: '下書き', pending: '申請中', approved: '承認済', in_progress: '実施中', completed: '完了', rejected: '却下' };\n        return texts[status] || status;\n    },\n\n    showAddModal() {\n        const appOptions = DataStore.apps.map(a => `<option value=\"${escapeHtml(a.id)}\" data-name=\"${escapeHtml(a.name)}\">${escapeHtml(a.name)}</option>`).join('');\n\n        openModal('変更要求登録', `\n            <div class=\"form-group\">\n                <label>タイトル</label>\n                <input type=\"text\" id=\"newChgTitle\" required>\n            </div>\n            <div class=\"form-group\">\n                <label>対象アプリ</label>\n                <select id=\"newChgApp\">\n                    ${appOptions}\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>変更種別</label>\n                <select id=\"newChgType\">\n                    <option value=\"feature\">新機能</option>\n                    <option value=\"improvement\">改善</option>\n                    <option value=\"modification\">変更</option>\n                    <option value=\"bugfix\">バグ修正</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>実施予定日</label>\n                <input type=\"date\" id=\"newChgScheduled\">\n            </div>\n            <div class=\"form-group\">\n                <label>説明</label>\n                <textarea id=\"newChgDesc\" rows=\"3\" style=\"width:100%;padding:10px;border:1px solid #e2e8f0;border-radius:8px;\"></textarea>\n            </div>\n        `, [\n            { text: 'キャンセル', class: 'btn-secondary', onclick: 'closeModal()' },\n            { text: '登録', class: 'btn-primary', onclick: 'ChangeModule.add()' }\n        ]);\n    },\n\n    add() {\n        const appSelect = document.getElementById('newChgApp');\n        const selectedOption = appSelect.options[appSelect.selectedIndex];\n        const newChg = {\n            id: 'CHG' + String(DataStore.changes.length + 1).padStart(3, '0'),\n            title: document.getElementById('newChgTitle').value,\n            appId: appSelect.value,\n            appName: selectedOption.dataset.name,\n            type: document.getElementById('newChgType').value,\n            status: 'draft',\n            requester: document.getElementById('currentUser').textContent,\n            scheduled: document.getElementById('newChgScheduled').value || '-',\n            description: document.getElementById('newChgDesc').value\n        };\n        DataStore.changes.push(newChg);\n        this.refresh();\n        closeModal();\n        showToast('変更要求を登録しました', 'success');\n        LogModule.addLog('create', '変更要求', 'change', '新規変更要求登録: ' + newChg.title);\n        updateDashboard();\n    },\n\n    view(id) {\n        const chg = DataStore.changes.find(c => c.id === id);\n        openModal('変更要求詳細: ' + escapeHtml(chg.id), `\n            <div style=\"line-height: 2;\">\n                <p><strong>変更ID:</strong> ${escapeHtml(chg.id)}</p>\n                <p><strong>タイトル:</strong> ${escapeHtml(chg.title)}</p>\n                <p><strong>対象アプリ:</strong> ${escapeHtml(chg.appName)}</p>\n                <p><strong>変更種別:</strong> <span class=\"badge ${this.getTypeBadge(chg.type)}\">${this.getTypeText(chg.type)}</span></p>\n                <p><strong>ステータス:</strong> <span class=\"badge ${this.getStatusBadge(chg.status)}\">${this.getStatusText(chg.status)}</span></p>\n                <p><strong>依頼者:</strong> ${escapeHtml(chg.requester)}</p>\n                <p><strong>実施予定日:</strong> ${escapeHtml(chg.scheduled)}</p>\n                <p><strong>説明:</strong></p>\n                <p style=\"background:#f8fafc;padding:10px;border-radius:8px;\">${escapeHtml(chg.description) || '（なし）'}</p>\n            </div>\n        `, [\n            { text: '閉じる', class: 'btn-secondary', onclick: 'closeModal()' }\n        ]);\n    },\n\n    edit(id) {\n        const chg = DataStore.changes.find(c => c.id === id);\n        const appOptions = DataStore.apps.map(a => `<option value=\"${escapeHtml(a.id)}\" data-name=\"${escapeHtml(a.name)}\" ${a.id === chg.appId ? 'selected' : ''}>${escapeHtml(a.name)}</option>`).join('');\n\n        openModal('変更要求編集: ' + escapeHtml(chg.id), `\n            <div class=\"form-group\">\n                <label>タイトル</label>\n                <input type=\"text\" id=\"editChgTitle\" value=\"${escapeHtml(chg.title)}\">\n            </div>\n            <div class=\"form-group\">\n                <label>対象アプリ</label>\n                <select id=\"editChgApp\">\n                    ${appOptions}\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>変更種別</label>\n                <select id=\"editChgType\">\n                    <option value=\"feature\" ${chg.type === 'feature' ? 'selected' : ''}>新機能</option>\n                    <option value=\"improvement\" ${chg.type === 'improvement' ? 'selected' : ''}>改善</option>\n                    <option value=\"modification\" ${chg.type === 'modification' ? 'selected' : ''}>変更</option>\n                    <option value=\"bugfix\" ${chg.type === 'bugfix' ? 'selected' : ''}>バグ修正</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>ステータス</label>\n                <select id=\"editChgStatus\">\n                    <option value=\"draft\" ${chg.status === 'draft' ? 'selected' : ''}>下書き</option>\n                    <option value=\"pending\" ${chg.status === 'pending' ? 'selected' : ''}>申請中</option>\n                    <option value=\"approved\" ${chg.status === 'approved' ? 'selected' : ''}>承認済</option>\n                    <option value=\"in_progress\" ${chg.status === 'in_progress' ? 'selected' : ''}>実施中</option>\n                    <option value=\"completed\" ${chg.status === 'completed' ? 'selected' : ''}>完了</option>\n                    <option value=\"rejected\" ${chg.status === 'rejected' ? 'selected' : ''}>却下</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>実施予定日</label>\n                <input type=\"date\" id=\"editChgScheduled\" value=\"${chg.scheduled !== '-' ? escapeHtml(chg.scheduled) : ''}\">\n            </div>\n            <div class=\"form-group\">\n                <label>説明</label>\n                <textarea id=\"editChgDesc\" rows=\"3\" style=\"width:100%;padding:10px;border:1px solid #e2e8f0;border-radius:8px;\">${escapeHtml(chg.description) || ''}</textarea>\n            </div>\n        `, [\n            { text: 'キャンセル', class: 'btn-secondary', onclick: 'closeModal()' },\n            { text: '保存', class: 'btn-primary', onclick: `ChangeModule.save('${escapeHtml(id)}')` }\n        ]);\n    },\n\n    save(id) {\n        const chg = DataStore.changes.find(c => c.id === id);\n        const appSelect = document.getElementById('editChgApp');\n        const selectedOption = appSelect.options[appSelect.selectedIndex];\n        chg.title = document.getElementById('editChgTitle').value;\n        chg.appId = appSelect.value;\n        chg.appName = selectedOption.dataset.name;\n        chg.type = document.getElementById('editChgType').value;\n        chg.status = document.getElementById('editChgStatus').value;\n        chg.scheduled = document.getElementById('editChgScheduled').value || '-';\n        chg.description = document.getElementById('editChgDesc').value;\n        this.refresh();\n        closeModal();\n        showToast('変更要求を更新しました', 'success');\n        LogModule.addLog('update', '変更要求', 'change', '変更要求更新: ' + chg.title);\n        updateDashboard();\n    },\n\n    delete(id) {\n        const chg = DataStore.changes.find(c => c.id === id);\n        if (confirm(`変更要求「${chg.title}」を削除しますか？`)) {\n            const idx = DataStore.changes.findIndex(c => c.id === id);\n            DataStore.changes.splice(idx, 1);\n            this.refresh();\n            showToast('変更要求を削除しました', 'success');\n            LogModule.addLog('delete', '変更要求', 'change', '変更要求削除: ' + chg.title);\n            updateDashboard();\n        }\n    },\n\n    filter() {\n        const search = document.getElementById('changeSearch').value.toLowerCase();\n        const type = document.getElementById('changeTypeFilter').value;\n        const status = document.getElementById('changeStatusFilter').value;\n\n        let filtered = DataStore.changes;\n\n        if (search) {\n            filtered = filtered.filter(c =>\n                c.title.toLowerCase().includes(search) ||\n                (c.description || '').toLowerCase().includes(search)\n            );\n        }\n        if (type) {\n            filtered = filtered.filter(c => c.type === type);\n        }\n        if (status) {\n            filtered = filtered.filter(c => c.status === status);\n        }\n\n        this.render(filtered);\n    }\n};\n","usedDeprecatedRules":[{"ruleId":"semi","replacedBy":[]},{"ruleId":"quotes","replacedBy":[]},{"ruleId":"indent","replacedBy":[]},{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/runner/work/Appsuite-ITSM-Management/Appsuite-ITSM-Management/WebUI-Production/js/security.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'FormValidator' is assigned a value but never used.","line":269,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":269,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'CsrfProtection' is assigned a value but never used.","line":365,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":365,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'RateLimiter' is assigned a value but never used.","line":417,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":417,"endColumn":18},{"ruleId":"no-unused-vars","severity":1,"message":"'escapeHtml' is defined but never used.","line":485,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":485,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'sanitizeInput' is defined but never used.","line":489,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":489,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AppSuite 管理運用システム - セキュリティユーティリティ\n * Phase 3 Sprint 1: セキュリティ強化\n */\n\nconst Security = {\n    /**\n     * HTMLエスケープ（XSS対策）\n     * @param {string} str - エスケープする文字列\n     * @returns {string} - エスケープされた文字列\n     */\n    escapeHtml(str) {\n        if (str === null || str === undefined) {return '';}\n        if (typeof str !== 'string') {str = String(str);}\n\n        const escapeMap = {\n            '&': '&amp;',\n            '<': '&lt;',\n            '>': '&gt;',\n            '\"': '&quot;',\n            '\\'': '&#039;',\n            '/': '&#x2F;',\n            '`': '&#x60;',\n            '=': '&#x3D;'\n        };\n\n        return str.replace(/[&<>\"'`=/]/g, char => escapeMap[char]);\n    },\n\n    /**\n     * HTMLアンエスケープ\n     * @param {string} str - アンエスケープする文字列\n     * @returns {string} - アンエスケープされた文字列\n     */\n    unescapeHtml(str) {\n        if (!str) {return '';}\n\n        const unescapeMap = {\n            '&amp;': '&',\n            '&lt;': '<',\n            '&gt;': '>',\n            '&quot;': '\"',\n            '&#039;': '\\'',\n            '&#x2F;': '/',\n            '&#x60;': '`',\n            '&#x3D;': '='\n        };\n\n        return str.replace(/&amp;|&lt;|&gt;|&quot;|&#039;|&#x2F;|&#x60;|&#x3D;/g,\n            match => unescapeMap[match]);\n    },\n\n    /**\n     * 安全なHTML生成（テンプレートリテラル用タグ関数）\n     * @param {Array} strings - テンプレート文字列配列\n     * @param {...any} values - 挿入値\n     * @returns {string} - エスケープされたHTML\n     */\n    html(strings, ...values) {\n        return strings.reduce((result, str, i) => {\n            const value = values[i - 1];\n            const escaped = this.escapeHtml(value);\n            return result + escaped + str;\n        });\n    },\n\n    /**\n     * URLエンコード\n     * @param {string} str - エンコードする文字列\n     * @returns {string} - エンコードされた文字列\n     */\n    encodeUrl(str) {\n        return encodeURIComponent(str);\n    },\n\n    /**\n     * SQLインジェクション対策（クライアント側参考実装）\n     * @param {string} str - サニタイズする文字列\n     * @returns {string} - サニタイズされた文字列\n     */\n    sanitizeSql(str) {\n        if (!str) {return '';}\n        // シングルクォートをエスケープ\n        return str.replace(/'/g, '\\'\\'');\n    }\n};\n\n/**\n * 入力バリデーションモジュール\n */\nconst Validator = {\n    /**\n     * 必須チェック\n     * @param {any} value - チェックする値\n     * @returns {boolean} - 値がある場合true\n     */\n    required(value) {\n        if (value === null || value === undefined) {return false;}\n        if (typeof value === 'string') {return value.trim().length > 0;}\n        if (Array.isArray(value)) {return value.length > 0;}\n        return true;\n    },\n\n    /**\n     * 最小長チェック\n     * @param {string} value - チェックする値\n     * @param {number} min - 最小長\n     * @returns {boolean} - 条件を満たす場合true\n     */\n    minLength(value, min) {\n        if (!value) {return false;}\n        return String(value).length >= min;\n    },\n\n    /**\n     * 最大長チェック\n     * @param {string} value - チェックする値\n     * @param {number} max - 最大長\n     * @returns {boolean} - 条件を満たす場合true\n     */\n    maxLength(value, max) {\n        if (!value) {return true;}\n        return String(value).length <= max;\n    },\n\n    /**\n     * メールアドレス形式チェック\n     * @param {string} email - チェックするメールアドレス\n     * @returns {boolean} - 有効な形式の場合true\n     */\n    email(email) {\n        if (!email) {return false;}\n        const pattern = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n        return pattern.test(email);\n    },\n\n    /**\n     * 電話番号形式チェック（日本）\n     * @param {string} phone - チェックする電話番号\n     * @returns {boolean} - 有効な形式の場合true\n     */\n    phone(phone) {\n        if (!phone) {return false;}\n        // ハイフンあり・なし両対応\n        const pattern = /^0\\d{1,4}-?\\d{1,4}-?\\d{4}$/;\n        return pattern.test(phone.replace(/\\s/g, ''));\n    },\n\n    /**\n     * 数値チェック\n     * @param {any} value - チェックする値\n     * @returns {boolean} - 数値の場合true\n     */\n    numeric(value) {\n        return !isNaN(parseFloat(value)) && isFinite(value);\n    },\n\n    /**\n     * 整数チェック\n     * @param {any} value - チェックする値\n     * @returns {boolean} - 整数の場合true\n     */\n    integer(value) {\n        return Number.isInteger(Number(value));\n    },\n\n    /**\n     * 範囲チェック\n     * @param {number} value - チェックする値\n     * @param {number} min - 最小値\n     * @param {number} max - 最大値\n     * @returns {boolean} - 範囲内の場合true\n     */\n    range(value, min, max) {\n        const num = Number(value);\n        return !isNaN(num) && num >= min && num <= max;\n    },\n\n    /**\n     * 正規表現チェック\n     * @param {string} value - チェックする値\n     * @param {RegExp} pattern - 正規表現パターン\n     * @returns {boolean} - パターンにマッチする場合true\n     */\n    pattern(value, pattern) {\n        if (!value) {return false;}\n        return pattern.test(value);\n    },\n\n    /**\n     * 日付形式チェック（YYYY-MM-DD）\n     * @param {string} date - チェックする日付文字列\n     * @returns {boolean} - 有効な日付の場合true\n     */\n    date(date) {\n        if (!date) {return false;}\n        const pattern = /^\\d{4}-\\d{2}-\\d{2}$/;\n        if (!pattern.test(date)) {return false;}\n\n        const d = new Date(date);\n        return d instanceof Date && !isNaN(d);\n    },\n\n    /**\n     * 日時形式チェック（YYYY-MM-DD HH:mm）\n     * @param {string} datetime - チェックする日時文字列\n     * @returns {boolean} - 有効な日時の場合true\n     */\n    datetime(datetime) {\n        if (!datetime) {return false;}\n        const pattern = /^\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}$/;\n        if (!pattern.test(datetime)) {return false;}\n\n        const d = new Date(datetime.replace(' ', 'T'));\n        return d instanceof Date && !isNaN(d);\n    },\n\n    /**\n     * URL形式チェック\n     * @param {string} url - チェックするURL\n     * @returns {boolean} - 有効なURLの場合true\n     */\n    url(url) {\n        if (!url) {return false;}\n        try {\n            new URL(url);\n            return true;\n        } catch {\n            return false;\n        }\n    },\n\n    /**\n     * 英数字のみチェック\n     * @param {string} value - チェックする値\n     * @returns {boolean} - 英数字のみの場合true\n     */\n    alphanumeric(value) {\n        if (!value) {return false;}\n        return /^[a-zA-Z0-9]+$/.test(value);\n    },\n\n    /**\n     * 日本語を含むかチェック\n     * @param {string} value - チェックする値\n     * @returns {boolean} - 日本語を含む場合true\n     */\n    containsJapanese(value) {\n        if (!value) {return false;}\n        return /[\\u3040-\\u309F\\u30A0-\\u30FF\\u4E00-\\u9FAF]/.test(value);\n    },\n\n    /**\n     * 禁止文字チェック\n     * @param {string} value - チェックする値\n     * @param {string} chars - 禁止文字（文字列）\n     * @returns {boolean} - 禁止文字を含まない場合true\n     */\n    noForbiddenChars(value, chars = '<>\"\\'/\\\\') {\n        if (!value) {return true;}\n        const pattern = new RegExp(`[${chars.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&')}]`);\n        return !pattern.test(value);\n    }\n};\n\n/**\n * フォームバリデーションヘルパー\n */\nconst FormValidator = {\n    /**\n     * フォームバリデーション実行\n     * @param {HTMLFormElement} form - フォーム要素\n     * @param {Object} rules - バリデーションルール\n     * @returns {Object} - バリデーション結果\n     */\n    validate(form, rules) {\n        const errors = {};\n        let isValid = true;\n\n        for (const [fieldName, fieldRules] of Object.entries(rules)) {\n            const input = form.querySelector(`[name=\"${fieldName}\"]`);\n            if (!input) {continue;}\n\n            const value = input.value;\n            const fieldErrors = [];\n\n            for (const rule of fieldRules) {\n                const { type, message, params } = rule;\n\n                let valid = true;\n                switch (type) {\n                case 'required':\n                    valid = Validator.required(value);\n                    break;\n                case 'minLength':\n                    valid = Validator.minLength(value, params.min);\n                    break;\n                case 'maxLength':\n                    valid = Validator.maxLength(value, params.max);\n                    break;\n                case 'email':\n                    valid = !value || Validator.email(value);\n                    break;\n                case 'pattern':\n                    valid = !value || Validator.pattern(value, params.pattern);\n                    break;\n                case 'range':\n                    valid = !value || Validator.range(value, params.min, params.max);\n                    break;\n                case 'custom':\n                    valid = params.fn(value, form);\n                    break;\n                }\n\n                if (!valid) {\n                    fieldErrors.push(message);\n                    isValid = false;\n                }\n            }\n\n            if (fieldErrors.length > 0) {\n                errors[fieldName] = fieldErrors;\n            }\n        }\n\n        return { isValid, errors };\n    },\n\n    /**\n     * エラー表示\n     * @param {HTMLFormElement} form - フォーム要素\n     * @param {Object} errors - エラーオブジェクト\n     */\n    showErrors(form, errors) {\n        // 既存のエラー表示をクリア\n        form.querySelectorAll('.field-error').forEach(el => el.remove());\n        form.querySelectorAll('.input-error').forEach(el => el.classList.remove('input-error'));\n\n        for (const [fieldName, messages] of Object.entries(errors)) {\n            const input = form.querySelector(`[name=\"${fieldName}\"]`);\n            if (!input) {continue;}\n\n            input.classList.add('input-error');\n\n            const errorDiv = document.createElement('div');\n            errorDiv.className = 'field-error';\n            errorDiv.textContent = messages[0]; // 最初のエラーのみ表示\n            input.parentNode.insertBefore(errorDiv, input.nextSibling);\n        }\n    },\n\n    /**\n     * エラークリア\n     * @param {HTMLFormElement} form - フォーム要素\n     */\n    clearErrors(form) {\n        form.querySelectorAll('.field-error').forEach(el => el.remove());\n        form.querySelectorAll('.input-error').forEach(el => el.classList.remove('input-error'));\n    }\n};\n\n/**\n * CSRFトークン管理（将来のサーバー連携用）\n */\nconst CsrfProtection = {\n    tokenKey: 'csrf_token',\n\n    /**\n     * トークン生成\n     * @returns {string} - CSRFトークン\n     */\n    generateToken() {\n        const array = new Uint8Array(32);\n        crypto.getRandomValues(array);\n        const token = Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');\n        sessionStorage.setItem(this.tokenKey, token);\n        return token;\n    },\n\n    /**\n     * トークン取得\n     * @returns {string|null} - 保存されているトークン\n     */\n    getToken() {\n        return sessionStorage.getItem(this.tokenKey);\n    },\n\n    /**\n     * トークン検証\n     * @param {string} token - 検証するトークン\n     * @returns {boolean} - 有効な場合true\n     */\n    verifyToken(token) {\n        const storedToken = this.getToken();\n        return storedToken && storedToken === token;\n    },\n\n    /**\n     * フォームにトークンを追加\n     * @param {HTMLFormElement} form - フォーム要素\n     */\n    addToForm(form) {\n        let input = form.querySelector('input[name=\"csrf_token\"]');\n        if (!input) {\n            input = document.createElement('input');\n            input.type = 'hidden';\n            input.name = 'csrf_token';\n            form.appendChild(input);\n        }\n        input.value = this.getToken() || this.generateToken();\n    }\n};\n\n/**\n * レート制限（ブルートフォース対策）\n */\nconst RateLimiter = {\n    limits: new Map(),\n\n    /**\n     * レート制限チェック\n     * @param {string} key - 識別キー\n     * @param {number} maxRequests - 最大リクエスト数\n     * @param {number} windowMs - 時間窓（ミリ秒）\n     * @returns {Object} - 制限情報\n     */\n    check(key, maxRequests = 10, windowMs = 60000) {\n        const now = Date.now();\n        let record = this.limits.get(key);\n\n        if (!record) {\n            record = { requests: [], blocked: false, blockUntil: 0 };\n            this.limits.set(key, record);\n        }\n\n        // ブロック中かチェック\n        if (record.blocked && now < record.blockUntil) {\n            return {\n                allowed: false,\n                remaining: 0,\n                resetAt: record.blockUntil\n            };\n        }\n\n        // ブロック解除\n        if (record.blocked && now >= record.blockUntil) {\n            record.blocked = false;\n            record.requests = [];\n        }\n\n        // 古いリクエストを削除\n        record.requests = record.requests.filter(time => now - time < windowMs);\n\n        // リクエスト追加\n        record.requests.push(now);\n\n        // 制限超過チェック\n        if (record.requests.length > maxRequests) {\n            record.blocked = true;\n            record.blockUntil = now + windowMs;\n            return {\n                allowed: false,\n                remaining: 0,\n                resetAt: record.blockUntil\n            };\n        }\n\n        return {\n            allowed: true,\n            remaining: maxRequests - record.requests.length,\n            resetAt: now + windowMs\n        };\n    },\n\n    /**\n     * リセット\n     * @param {string} key - 識別キー\n     */\n    reset(key) {\n        this.limits.delete(key);\n    }\n};\n\n// グローバル関数としてエクスポート（既存コードとの互換性）\nfunction escapeHtml(str) {\n    return Security.escapeHtml(str);\n}\n\nfunction sanitizeInput(str) {\n    return Security.escapeHtml(str);\n}\n","usedDeprecatedRules":[{"ruleId":"semi","replacedBy":[]},{"ruleId":"quotes","replacedBy":[]},{"ruleId":"indent","replacedBy":[]},{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/runner/work/Appsuite-ITSM-Management/Appsuite-ITSM-Management/WebUI-Sample/js/api.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'initApiSync' is defined but never used.","line":494,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":494,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'toggleApiKey' is defined but never used.","line":535,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":535,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AppSuite 管理運用システム - API連携モジュール\n */\n\nconst ApiConfig = {\n    baseUrl: '',\n    apiKey: '',\n    authMethod: 'bearer',\n    timeout: 30000,\n\n    save() {\n        this.baseUrl = document.getElementById('apiUrl').value;\n        this.apiKey = document.getElementById('apiKey').value;\n        this.authMethod = document.getElementById('authMethod').value;\n        this.timeout = parseInt(document.getElementById('timeout').value) * 1000;\n\n        localStorage.setItem('appsuite_api_config', JSON.stringify({\n            baseUrl: this.baseUrl,\n            apiKey: this.apiKey,\n            authMethod: this.authMethod,\n            timeout: this.timeout\n        }));\n\n        showToast('API設定を保存しました', 'success');\n    },\n\n    load() {\n        const savedSettings = localStorage.getItem('appsuiteSettings');\n        if (savedSettings) {\n            const settings = JSON.parse(savedSettings);\n            const api = settings.api || {};\n            this.baseUrl = api.url || '';\n            this.apiKey = api.key || '';\n            this.authMethod = api.authMethod || 'bearer';\n            this.timeout = (api.timeout || 30) * 1000;\n            return;\n        }\n\n        const saved = localStorage.getItem('appsuite_api_config');\n        if (saved) {\n            const config = JSON.parse(saved);\n            this.baseUrl = config.baseUrl || '';\n            this.apiKey = config.apiKey || '';\n            this.authMethod = config.authMethod || 'bearer';\n            this.timeout = config.timeout || 30000;\n        }\n    },\n\n    async test() {\n        if (!this.baseUrl) {\n            showToast('API URLを入力してください', 'error');\n            return;\n        }\n\n        try {\n            showToast('接続テスト中...', 'info');\n            // 実際のAPI接続テスト（デモではシミュレート）\n            await new Promise(resolve => setTimeout(resolve, 1000));\n\n            updateConnectionStatus(true);\n            document.getElementById('apiStatus').textContent = '接続中';\n            document.getElementById('apiStatus').style.color = '#22c55e';\n            document.getElementById('lastSync').textContent = new Date().toLocaleString('ja-JP');\n            document.getElementById('apiVersion').textContent = 'V7.5';\n\n            showToast('接続成功！', 'success');\n        } catch (error) {\n            updateConnectionStatus(false);\n            document.getElementById('apiStatus').textContent = '接続エラー';\n            document.getElementById('apiStatus').style.color = '#ef4444';\n            showToast('接続失敗: ' + error.message, 'error');\n        }\n    }\n};\n\n// API通信クラス\nconst Api = {\n    async get(endpoint, params = {}) {\n        return this.request('GET', endpoint, params);\n    },\n\n    async post(endpoint, data = {}) {\n        return this.request('POST', endpoint, data);\n    },\n\n    async put(endpoint, data = {}) {\n        return this.request('PUT', endpoint, data);\n    },\n\n    async delete(endpoint) {\n        return this.request('DELETE', endpoint);\n    },\n\n    async request(method, endpoint, data = {}) {\n        const url = new URL(endpoint, ApiConfig.baseUrl);\n\n        const options = {\n            method: method,\n            headers: this.getHeaders(),\n        };\n\n        if (method === 'GET' && Object.keys(data).length > 0) {\n            Object.keys(data).forEach(key => url.searchParams.append(key, data[key]));\n        } else if (method !== 'GET') {\n            options.body = JSON.stringify(data);\n        }\n\n        const controller = new AbortController();\n        const timeoutId = setTimeout(() => controller.abort(), ApiConfig.timeout);\n        options.signal = controller.signal;\n\n        try {\n            const response = await fetch(url, options);\n            clearTimeout(timeoutId);\n\n            if (!response.ok) {\n                throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n            }\n\n            return await response.json();\n        } catch (error) {\n            if (error.name === 'AbortError') {\n                throw new Error('リクエストがタイムアウトしました');\n            }\n            throw error;\n        }\n    },\n\n    getHeaders() {\n        const headers = {\n            'Content-Type': 'application/json',\n            'Accept': 'application/json'\n        };\n\n        switch (ApiConfig.authMethod) {\n        case 'bearer':\n            headers['Authorization'] = `Bearer ${ApiConfig.apiKey}`;\n            break;\n        case 'basic':\n            headers['Authorization'] = `Basic ${btoa(ApiConfig.apiKey)}`;\n            break;\n        case 'apikey':\n            headers['X-API-Key'] = ApiConfig.apiKey;\n            break;\n        }\n\n        return headers;\n    }\n};\n\n// データストア（永続化対応）\nconst DataStore = {\n    // ストレージキー\n    STORAGE_KEYS: {\n        users: 'appsuite_users',\n        apps: 'appsuite_apps',\n        incidents: 'appsuite_incidents',\n        changes: 'appsuite_changes',\n        logs: 'appsuite_logs'\n    },\n\n    // デフォルトデータ\n    _defaults: {\n        users: [\n            { id: 'U0000', username: 'admin', email: 'admin@example.com', department: '情報システム部', role: '管理者', status: 'active', lastLogin: '2026-01-23 22:00', passwordHash: 'admin' },\n            { id: 'U0001', username: '山田太郎', email: 'yamada@example.com', department: '情報システム部', role: '管理者', status: 'active', lastLogin: '2026-01-19 09:30', passwordHash: 'demo' },\n            { id: 'U0002', username: '鈴木花子', email: 'suzuki@example.com', department: '営業部', role: 'ユーザー', status: 'active', lastLogin: '2026-01-19 08:45', passwordHash: 'demo' },\n            { id: 'U0003', username: '佐藤一郎', email: 'sato@example.com', department: '総務部', role: 'ユーザー', status: 'active', lastLogin: '2026-01-18 17:20', passwordHash: 'demo' },\n            { id: 'U0004', username: '田中美咲', email: 'tanaka@example.com', department: '開発部', role: '管理者', status: 'active', lastLogin: '2026-01-19 10:15', passwordHash: 'demo' },\n            { id: 'U0005', username: '高橋健二', email: 'takahashi@example.com', department: '情報システム部', role: 'ユーザー', status: 'inactive', lastLogin: '2026-01-10 14:00', passwordHash: 'demo' },\n            { id: 'U0006', username: '伊藤真由', email: 'ito@example.com', department: '経理部', role: 'ユーザー', status: 'active', lastLogin: '2026-01-19 09:00', passwordHash: 'demo' },\n            { id: 'U0007', username: '渡辺大輔', email: 'watanabe@example.com', department: '営業部', role: 'ユーザー', status: 'active', lastLogin: '2026-01-18 16:30', passwordHash: 'demo' }\n        ],\n        apps: [\n            { id: 'APP001', name: '勤怠管理', category: '業務管理', creator: '山田太郎', records: 1250, status: 'active', updated: '2026-01-19' },\n            { id: 'APP002', name: '経費精算申請', category: '申請・承認', creator: '田中美咲', records: 856, status: 'active', updated: '2026-01-18' },\n            { id: 'APP003', name: '顧客管理', category: 'データ管理', creator: '鈴木花子', records: 3420, status: 'active', updated: '2026-01-19' },\n            { id: 'APP004', name: '備品貸出管理', category: '業務管理', creator: '佐藤一郎', records: 234, status: 'active', updated: '2026-01-17' },\n            { id: 'APP005', name: '休暇申請', category: '申請・承認', creator: '山田太郎', records: 567, status: 'active', updated: '2026-01-16' },\n            { id: 'APP006', name: '会議室予約', category: '業務管理', creator: '田中美咲', records: 1890, status: 'maintenance', updated: '2026-01-15' },\n            { id: 'APP007', name: '在庫管理', category: 'データ管理', creator: '高橋健二', records: 4521, status: 'active', updated: '2026-01-19' }\n        ],\n        incidents: [\n            { id: 'INC001', title: '勤怠管理アプリでデータが保存されない', appId: 'APP001', appName: '勤怠管理', priority: 'high', status: 'in_progress', reporter: '鈴木花子', assignee: '山田太郎', created: '2026-01-19', description: '出勤打刻後、データが保存されずエラーが発生する' },\n            { id: 'INC002', title: '経費精算の承認ボタンが反応しない', appId: 'APP002', appName: '経費精算申請', priority: 'medium', status: 'open', reporter: '佐藤一郎', assignee: '-', created: '2026-01-19', description: '承認ボタンをクリックしても何も起こらない' },\n            { id: 'INC003', title: '顧客検索が遅い', appId: 'APP003', appName: '顧客管理', priority: 'low', status: 'resolved', reporter: '渡辺大輔', assignee: '田中美咲', created: '2026-01-18', description: '検索に10秒以上かかることがある' },\n            { id: 'INC004', title: '会議室予約の表示エラー', appId: 'APP006', appName: '会議室予約', priority: 'medium', status: 'closed', reporter: '伊藤真由', assignee: '高橋健二', created: '2026-01-17', description: '予約一覧が正しく表示されない問題' }\n        ],\n        changes: [\n            { id: 'CHG001', title: '勤怠管理に残業申請機能を追加', appId: 'APP001', appName: '勤怠管理', type: 'feature', status: 'approved', requester: '佐藤一郎', scheduled: '2026-02-01', description: '残業時間の事前申請・承認機能を追加したい' },\n            { id: 'CHG002', title: '経費精算の領収書アップロード機能改善', appId: 'APP002', appName: '経費精算申請', type: 'improvement', status: 'in_progress', requester: '鈴木花子', scheduled: '2026-01-25', description: '複数ファイルの一括アップロードに対応' },\n            { id: 'CHG003', title: '顧客管理の検索条件追加', appId: 'APP003', appName: '顧客管理', type: 'modification', status: 'pending', requester: '渡辺大輔', scheduled: '2026-02-10', description: '取引先担当者での検索を可能にしたい' },\n            { id: 'CHG004', title: '在庫管理のバーコード読取不具合修正', appId: 'APP007', appName: '在庫管理', type: 'bugfix', status: 'completed', requester: '高橋健二', scheduled: '2026-01-15', description: '一部バーコードが読み取れない問題を修正' },\n            { id: 'CHG005', title: '休暇申請に半休機能追加', appId: 'APP005', appName: '休暇申請', type: 'feature', status: 'draft', requester: '伊藤真由', scheduled: '-', description: '午前休・午後休の選択を可能にしたい' }\n        ],\n        logs: [\n            { timestamp: '2026-01-19 10:30:15', user: '山田太郎', action: 'login', target: 'システム', targetType: 'system', detail: 'ログイン成功', ip: '192.168.1.100' },\n            { timestamp: '2026-01-19 10:25:00', user: '田中美咲', action: 'update', target: '経費精算申請', targetType: 'app', detail: 'アプリ設定を更新', ip: '192.168.1.105' },\n            { timestamp: '2026-01-19 10:20:30', user: '鈴木花子', action: 'create', target: '顧客管理', targetType: 'app', detail: '新規レコード追加（顧客ID: C1234）', ip: '192.168.1.110' },\n            { timestamp: '2026-01-19 10:15:00', user: '佐藤一郎', action: 'export', target: '備品貸出管理', targetType: 'app', detail: 'CSVエクスポート実行', ip: '192.168.1.115' },\n            { timestamp: '2026-01-19 09:45:00', user: '山田太郎', action: 'create', target: 'ユーザー', targetType: 'user', detail: '新規ユーザー追加: 伊藤真由', ip: '192.168.1.100' },\n            { timestamp: '2026-01-19 09:30:00', user: '田中美咲', action: 'login', target: 'システム', targetType: 'system', detail: 'ログイン成功', ip: '192.168.1.105' },\n            { timestamp: '2026-01-18 17:30:00', user: '高橋健二', action: 'logout', target: 'システム', targetType: 'system', detail: 'ログアウト', ip: '192.168.1.120' },\n            { timestamp: '2026-01-18 17:00:00', user: '渡辺大輔', action: 'update', target: '顧客管理', targetType: 'app', detail: 'レコード更新（顧客ID: C0891）', ip: '192.168.1.125' },\n            { timestamp: '2026-01-18 16:30:00', user: '伊藤真由', action: 'delete', target: '経費精算申請', targetType: 'app', detail: 'レコード削除（申請ID: E0234）', ip: '192.168.1.130' }\n        ]\n    },\n\n    // データ配列（メモリ上）\n    users: [],\n    apps: [],\n    incidents: [],\n    changes: [],\n    logs: [],\n\n    /**\n     * 初期化：localStorageからデータを読み込む\n     */\n    init() {\n        const collections = ['users', 'apps', 'incidents', 'changes', 'logs'];\n        collections.forEach(collection => {\n            const saved = localStorage.getItem(this.STORAGE_KEYS[collection]);\n            if (saved) {\n                try {\n                    this[collection] = JSON.parse(saved);\n                } catch (e) {\n                    console.error(`Failed to load ${collection}:`, e);\n                    this[collection] = [...this._defaults[collection]];\n                }\n            } else {\n                this[collection] = [...this._defaults[collection]];\n            }\n        });\n    },\n\n    /**\n     * データをlocalStorageに保存\n     * @param {string} collection - コレクション名\n     */\n    save(collection) {\n        if (this.STORAGE_KEYS[collection]) {\n            try {\n                localStorage.setItem(this.STORAGE_KEYS[collection], JSON.stringify(this[collection]));\n            } catch (e) {\n                console.error(`Failed to save ${collection}:`, e);\n                showToast('データの保存に失敗しました', 'error');\n            }\n        }\n    },\n\n    /**\n     * 全データを保存\n     */\n    saveAll() {\n        Object.keys(this.STORAGE_KEYS).forEach(collection => this.save(collection));\n    },\n\n    /**\n     * IDでアイテムを検索\n     * @param {string} collection - コレクション名\n     * @param {string} id - ID\n     * @returns {Object|null} - アイテムまたはnull\n     */\n    findById(collection, id) {\n        return this[collection]?.find(item => item.id === id) || null;\n    },\n\n    /**\n     * 条件でアイテムを検索\n     * @param {string} collection - コレクション名\n     * @param {Function} predicate - 検索条件\n     * @returns {Array} - 検索結果\n     */\n    findWhere(collection, predicate) {\n        return this[collection]?.filter(predicate) || [];\n    },\n\n    /**\n     * アイテムを作成\n     * @param {string} collection - コレクション名\n     * @param {Object} item - 新規アイテム\n     * @returns {Object} - 作成されたアイテム\n     */\n    create(collection, item) {\n        this[collection].push(item);\n        this.save(collection);\n        return item;\n    },\n\n    /**\n     * アイテムを更新\n     * @param {string} collection - コレクション名\n     * @param {string} id - ID\n     * @param {Object} updates - 更新内容\n     * @returns {Object|null} - 更新されたアイテムまたはnull\n     */\n    update(collection, id, updates) {\n        const index = this[collection]?.findIndex(item => item.id === id);\n        if (index === -1 || index === undefined) {return null;}\n\n        this[collection][index] = { ...this[collection][index], ...updates };\n        this.save(collection);\n        return this[collection][index];\n    },\n\n    /**\n     * アイテムを削除\n     * @param {string} collection - コレクション名\n     * @param {string} id - ID\n     * @returns {boolean} - 削除成功の場合true\n     */\n    delete(collection, id) {\n        const index = this[collection]?.findIndex(item => item.id === id);\n        if (index === -1 || index === undefined) {return false;}\n\n        this[collection].splice(index, 1);\n        this.save(collection);\n        return true;\n    },\n\n    /**\n     * データをリセット（デフォルトに戻す）\n     * @param {string} collection - コレクション名（省略時は全て）\n     */\n    reset(collection) {\n        if (collection) {\n            this[collection] = [...this._defaults[collection]];\n            this.save(collection);\n        } else {\n            Object.keys(this.STORAGE_KEYS).forEach(c => {\n                this[c] = [...this._defaults[c]];\n                localStorage.removeItem(this.STORAGE_KEYS[c]);\n            });\n        }\n    },\n\n    /**\n     * 統計情報を取得\n     * @returns {Object} - 統計情報\n     */\n    getStats() {\n        return {\n            totalUsers: this.users.length,\n            activeUsers: this.users.filter(u => u.status === 'active').length,\n            totalApps: this.apps.length,\n            activeApps: this.apps.filter(a => a.status === 'active').length,\n            openIncidents: this.incidents.filter(i => i.status !== 'closed').length,\n            pendingChanges: this.changes.filter(c => c.status === 'pending').length\n        };\n    },\n\n    /**\n     * 全データをエクスポート\n     * @returns {Object} - 全データ\n     */\n    exportAll() {\n        return {\n            users: this.users,\n            apps: this.apps,\n            incidents: this.incidents,\n            changes: this.changes,\n            logs: this.logs,\n            exportedAt: new Date().toISOString()\n        };\n    },\n\n    /**\n     * データをインポート\n     * @param {Object} data - インポートデータ\n     */\n    importAll(data) {\n        if (data.users) {this.users = data.users;}\n        if (data.apps) {this.apps = data.apps;}\n        if (data.incidents) {this.incidents = data.incidents;}\n        if (data.changes) {this.changes = data.changes;}\n        if (data.logs) {this.logs = data.logs;}\n        this.saveAll();\n    }\n};\n\n// DataStore初期化\nDataStore.init();\n\nconst ApiSync = {\n    isReadOnly: false,\n    timerId: null,\n\n    loadSettings() {\n        const savedSettings = localStorage.getItem('appsuiteSettings');\n        const settings = savedSettings ? JSON.parse(savedSettings) : {};\n        return settings.api || {};\n    },\n\n    applySettings() {\n        const apiSettings = this.loadSettings();\n        ApiConfig.baseUrl = apiSettings.url || '';\n        ApiConfig.apiKey = apiSettings.key || '';\n        ApiConfig.authMethod = apiSettings.authMethod || 'bearer';\n        ApiConfig.timeout = (apiSettings.timeout || 30) * 1000;\n\n        this.isReadOnly = Boolean(apiSettings.url);\n        this.applyReadOnlyState();\n\n        this.stopAutoSync();\n        const interval = parseInt(apiSettings.syncInterval || 0);\n        if (apiSettings.url && interval > 0) {\n            this.startAutoSync(interval);\n        }\n    },\n\n    applyReadOnlyState() {\n        const addUserButton = document.getElementById('addUserButton');\n        const addAppButton = document.getElementById('addAppButton');\n        if (addUserButton) {addUserButton.disabled = this.isReadOnly;}\n        if (addAppButton) {addAppButton.disabled = this.isReadOnly;}\n\n        if (window.UserModule) {UserModule.refresh();}\n        if (window.AppModule) {AppModule.refresh();}\n    },\n\n    startAutoSync(intervalMinutes) {\n        this.timerId = setInterval(async () => {\n            await this.syncAll();\n        }, intervalMinutes * 60 * 1000);\n    },\n\n    stopAutoSync() {\n        if (this.timerId) {\n            clearInterval(this.timerId);\n            this.timerId = null;\n        }\n    },\n\n    async syncAll() {\n        if (!ApiConfig.baseUrl) {\n            showToast('API URLが未設定です', 'error');\n            return;\n        }\n\n        try {\n            await this.syncUsers();\n            await this.syncApps();\n            updateConnectionStatus(true);\n            document.getElementById('apiStatus').textContent = '接続中';\n            document.getElementById('apiStatus').style.color = '#22c55e';\n            document.getElementById('lastSync').textContent = new Date().toLocaleString('ja-JP');\n            if (window.updateDashboard) {updateDashboard();}\n            showToast('同期が完了しました', 'success');\n        } catch (error) {\n            updateConnectionStatus(false);\n            showToast('同期に失敗しました: ' + error.message, 'error');\n        }\n    },\n\n    async syncUsers() {\n        const response = await Api.get('', { cmd: 'getuser' });\n        if (response.status !== 'success' || !Array.isArray(response.users)) {\n            throw new Error('ユーザー同期に失敗しました');\n        }\n\n        DataStore.users = response.users.map(user => ({\n            id: user.userid,\n            username: user.name,\n            email: user.email,\n            department: user.dept || '',\n            role: 'ユーザー',\n            status: 'active',\n            lastLogin: '-'\n        }));\n        if (window.UserModule) {UserModule.refresh();}\n    },\n\n    async syncApps() {\n        const response = await Api.get('', { cmd: 'getapps' });\n        if (response.status !== 'success' || !Array.isArray(response.apps)) {\n            throw new Error('アプリ同期に失敗しました');\n        }\n\n        const today = new Date().toISOString().split('T')[0];\n        DataStore.apps = response.apps.map(app => ({\n            id: app.appid,\n            name: app.name,\n            category: 'その他',\n            creator: '',\n            records: app.recordcount || 0,\n            status: 'active',\n            updated: today,\n            description: ''\n        }));\n        if (window.AppModule) {AppModule.refresh();}\n    }\n};\n\nfunction initApiSync() {\n    ApiSync.applySettings();\n}\n\n// ユーティリティ\nfunction updateConnectionStatus(connected) {\n    const status = document.getElementById('connectionStatus');\n    if (connected) {\n        status.innerHTML = '<i class=\"fas fa-circle\"></i> 接続中';\n        status.classList.add('connected');\n    } else {\n        status.innerHTML = '<i class=\"fas fa-circle\"></i> 未接続';\n        status.classList.remove('connected');\n    }\n}\n\nfunction showToast(message, type = 'info') {\n    const container = document.getElementById('toastContainer');\n    const toast = document.createElement('div');\n    toast.className = `toast ${type}`;\n\n    const icons = {\n        success: 'fa-check-circle',\n        error: 'fa-exclamation-circle',\n        warning: 'fa-exclamation-triangle',\n        info: 'fa-info-circle'\n    };\n\n    toast.innerHTML = `\n        <i class=\"fas ${icons[type]}\"></i>\n        <span>${message}</span>\n    `;\n\n    container.appendChild(toast);\n\n    setTimeout(() => {\n        toast.style.animation = 'toastIn 0.3s ease reverse';\n        setTimeout(() => toast.remove(), 300);\n    }, 3000);\n}\n\nfunction toggleApiKey() {\n    const input = document.getElementById('apiKey');\n    input.type = input.type === 'password' ? 'text' : 'password';\n}\n","usedDeprecatedRules":[{"ruleId":"semi","replacedBy":[]},{"ruleId":"quotes","replacedBy":[]},{"ruleId":"indent","replacedBy":[]},{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/runner/work/Appsuite-ITSM-Management/Appsuite-ITSM-Management/WebUI-Sample/js/app.js","messages":[{"ruleId":"no-undef","severity":1,"message":"'WorkflowEngine' is not defined.","line":38,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":38,"endColumn":23},{"ruleId":"no-undef","severity":1,"message":"'NotificationManager' is not defined.","line":43,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":43,"endColumn":28},{"ruleId":"no-undef","severity":1,"message":"'BackupManager' is not defined.","line":48,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":48,"endColumn":22},{"ruleId":"no-undef","severity":1,"message":"'PerformanceOptimizer' is not defined.","line":53,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":53,"endColumn":29},{"ruleId":"no-undef","severity":1,"message":"'WorkflowEngine' is not defined.","line":63,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":63,"endColumn":23},{"ruleId":"no-undef","severity":1,"message":"'NotificationManager' is not defined.","line":66,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":66,"endColumn":28},{"ruleId":"no-undef","severity":1,"message":"'BackupManager' is not defined.","line":69,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":69,"endColumn":22},{"ruleId":"no-undef","severity":1,"message":"'LazyLoader' is not defined.","line":72,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":72,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'loadApiConfig' is defined but never used.","line":171,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":171,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'openModal' is defined but never used.","line":256,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":256,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'startApplicationAfterLogin' is defined but never used.","line":287,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":287,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AppSuite 管理運用システム - メインアプリケーション\n * Phase 3 Sprint 1: 認証システム統合\n */\n\n// 初期化\ndocument.addEventListener('DOMContentLoaded', () => {\n    // 認証モジュール初期化\n    AuthModule.init();\n\n    // 認証チェック\n    if (AuthModule.isAuthenticated()) {\n        // 認証済み：アプリケーション初期化\n        initApplication();\n        AuthModule.hideLoginScreen();\n        const user = AuthModule.getCurrentUser();\n        if (user) {\n            AuthModule.updateUIForUser(user);\n        }\n    } else {\n        // 未認証：ログイン画面表示\n        AuthModule.showLoginScreen();\n    }\n});\n\n// アプリケーション初期化\nfunction initApplication() {\n    initNavigation();\n    initSidebar();\n    initFilters();\n    initSettings();\n    initApiSync();\n    initDashboard();\n    refreshAllModules();\n\n    // ワークフローエンジン初期化\n    if (typeof WorkflowEngine !== 'undefined') {\n        WorkflowEngine.init();\n    }\n\n    // 通知システム初期化\n    if (typeof NotificationManager !== 'undefined') {\n        NotificationManager.init();\n    }\n\n    // バックアップマネージャー初期化\n    if (typeof BackupManager !== 'undefined') {\n        BackupManager.init();\n    }\n\n    // パフォーマンス最適化初期化\n    if (typeof PerformanceOptimizer !== 'undefined') {\n        PerformanceOptimizer.init();\n    }\n\n    // ページ離脱時のクリーンアップ\n    window.addEventListener('beforeunload', cleanupApplication);\n}\n\n// アプリケーションクリーンアップ\nfunction cleanupApplication() {\n    if (typeof WorkflowEngine !== 'undefined') {\n        WorkflowEngine.cleanup();\n    }\n    if (typeof NotificationManager !== 'undefined') {\n        NotificationManager.cleanup();\n    }\n    if (typeof BackupManager !== 'undefined') {\n        BackupManager.cleanup();\n    }\n    if (typeof LazyLoader !== 'undefined') {\n        LazyLoader.disconnect();\n    }\n}\n\n// ナビゲーション初期化\nfunction initNavigation() {\n    const navItems = document.querySelectorAll('.nav-item');\n    navItems.forEach(item => {\n        item.addEventListener('click', () => {\n            const section = item.dataset.section;\n            showSection(section);\n\n            navItems.forEach(nav => nav.classList.remove('active'));\n            item.classList.add('active');\n\n            if (window.innerWidth <= 1024) {\n                document.getElementById('sidebar').classList.remove('active');\n            }\n        });\n    });\n}\n\n// セクション表示切替\nfunction showSection(sectionName) {\n    const sections = document.querySelectorAll('.section');\n    sections.forEach(sec => sec.classList.add('hidden'));\n\n    const target = document.getElementById('section-' + sectionName);\n    if (target) {\n        target.classList.remove('hidden');\n    }\n\n    switch(sectionName) {\n    case 'dashboard':\n        updateDashboard();\n        break;\n    case 'users':\n        UserModule.refresh();\n        break;\n    case 'apps':\n        AppModule.refresh();\n        break;\n    case 'incidents':\n        IncidentModule.refresh();\n        break;\n    case 'changes':\n        ChangeModule.refresh();\n        break;\n    case 'logs':\n        LogModule.refresh();\n        break;\n    case 'settings':\n        SettingsModule.loadToForm();\n        break;\n    }\n}\n\n// サイドバー初期化\nfunction initSidebar() {\n    const menuToggle = document.getElementById('menuToggle');\n    const sidebar = document.getElementById('sidebar');\n\n    menuToggle.addEventListener('click', () => {\n        sidebar.classList.toggle('active');\n    });\n\n    document.addEventListener('click', (e) => {\n        if (window.innerWidth <= 1024) {\n            if (!sidebar.contains(e.target) && !menuToggle.contains(e.target)) {\n                sidebar.classList.remove('active');\n            }\n        }\n    });\n}\n\n// フィルター初期化\nfunction initFilters() {\n    // ユーザー検索・フィルター\n    document.getElementById('userSearch').addEventListener('input', () => UserModule.filter());\n    document.getElementById('userStatusFilter').addEventListener('change', () => UserModule.filter());\n    document.getElementById('userRoleFilter').addEventListener('change', () => UserModule.filter());\n\n    // アプリ検索・フィルター\n    document.getElementById('appSearch').addEventListener('input', () => AppModule.filter());\n    document.getElementById('appCategoryFilter').addEventListener('change', () => AppModule.filter());\n    document.getElementById('appStatusFilter').addEventListener('change', () => AppModule.filter());\n\n    // インシデント検索・フィルター\n    document.getElementById('incidentSearch').addEventListener('input', () => IncidentModule.filter());\n    document.getElementById('incidentPriorityFilter').addEventListener('change', () => IncidentModule.filter());\n    document.getElementById('incidentStatusFilter').addEventListener('change', () => IncidentModule.filter());\n\n    // 変更要求検索・フィルター\n    document.getElementById('changeSearch').addEventListener('input', () => ChangeModule.filter());\n    document.getElementById('changeTypeFilter').addEventListener('change', () => ChangeModule.filter());\n    document.getElementById('changeStatusFilter').addEventListener('change', () => ChangeModule.filter());\n}\n\n// API設定読み込み（互換性のため残す）\nfunction loadApiConfig() {\n    // 設定モジュールで管理するため、この関数は互換性のために残す\n}\n\n// 設定初期化\nfunction initSettings() {\n    SettingsModule.initTabs();\n    SettingsModule.loadToForm();\n}\n\n// ダッシュボード初期化\nfunction initDashboard() {\n    updateDashboard();\n\n    // DashboardManager初期化（Chart.js読み込み後）\n    if (typeof DashboardManager !== 'undefined') {\n        DashboardManager.init();\n\n        // KPIウィジェット初期化\n        if (typeof KPIWidget !== 'undefined') {\n            KPIWidget.render();\n        }\n\n        // クイックアクション初期化\n        if (typeof QuickActions !== 'undefined') {\n            QuickActions.render();\n        }\n\n        // システムステータス初期化\n        if (typeof SystemStatus !== 'undefined') {\n            SystemStatus.render();\n        }\n    }\n}\n\n// ダッシュボード更新\nfunction updateDashboard() {\n    const stats = DataStore.getStats();\n    document.getElementById('totalUsers').textContent = stats.totalUsers;\n    document.getElementById('activeUsers').textContent = stats.activeUsers;\n    document.getElementById('totalApps').textContent = stats.totalApps;\n    document.getElementById('activeApps').textContent = stats.activeApps;\n    document.getElementById('openIncidents').textContent = stats.openIncidents;\n    document.getElementById('pendingChanges').textContent = stats.pendingChanges;\n\n    // 最近のログ\n    LogModule.renderRecent();\n\n    // アプリサマリー\n    renderAppSummary();\n\n    // ウィジェット更新\n    if (typeof KPIWidget !== 'undefined') {\n        KPIWidget.render();\n    }\n    if (typeof SystemStatus !== 'undefined') {\n        SystemStatus.render();\n    }\n}\n\n// アプリサマリー表示\nfunction renderAppSummary() {\n    const container = document.getElementById('appSummary');\n    const apps = [...DataStore.apps]\n        .sort((a, b) => new Date(b.updated) - new Date(a.updated))\n        .slice(0, 5);\n    container.innerHTML = apps.map(app => `\n        <div class=\"app-summary-item\">\n            <span class=\"app-name\">${escapeHtml(app.name)}</span>\n            <span class=\"app-records\">${app.records.toLocaleString()}件</span>\n            <span class=\"badge ${AppModule.getStatusBadge(app.status)}\">${AppModule.getStatusText(app.status)}</span>\n        </div>\n    `).join('');\n}\n\n// 全モジュール初期化\nfunction refreshAllModules() {\n    UserModule.refresh();\n    AppModule.refresh();\n    IncidentModule.refresh();\n    ChangeModule.refresh();\n    LogModule.refresh();\n}\n\n// モーダル関連\nfunction openModal(title, bodyContent, buttons = []) {\n    document.getElementById('modalTitle').textContent = title;\n    document.getElementById('modalBody').innerHTML = bodyContent;\n\n    const footer = document.getElementById('modalFooter');\n    footer.innerHTML = buttons.map(btn =>\n        `<button class=\"btn ${btn.class}\" onclick=\"${btn.onclick}\">${btn.text}</button>`\n    ).join('');\n\n    document.getElementById('modalOverlay').classList.add('active');\n}\n\nfunction closeModal() {\n    document.getElementById('modalOverlay').classList.remove('active');\n}\n\n// ESCキーでモーダルを閉じる\ndocument.addEventListener('keydown', (e) => {\n    if (e.key === 'Escape') {\n        closeModal();\n    }\n});\n\n// モーダルオーバーレイクリックで閉じる\ndocument.getElementById('modalOverlay').addEventListener('click', (e) => {\n    if (e.target === document.getElementById('modalOverlay')) {\n        closeModal();\n    }\n});\n\n// 認証後のアプリケーション起動（AuthModuleから呼び出される）\nfunction startApplicationAfterLogin() {\n    initApplication();\n}\n","usedDeprecatedRules":[{"ruleId":"semi","replacedBy":[]},{"ruleId":"quotes","replacedBy":[]},{"ruleId":"indent","replacedBy":[]},{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/runner/work/Appsuite-ITSM-Management/Appsuite-ITSM-Management/WebUI-Sample/js/auth.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'passwordHash' is assigned a value but never used.","line":357,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":357,"endColumn":29},{"ruleId":"no-unused-vars","severity":1,"message":"'PasswordValidator' is assigned a value but never used.","line":493,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":493,"endColumn":24},{"ruleId":"no-unused-vars","severity":1,"message":"'handleLogin' is defined but never used.","line":600,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":600,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'handleLogout' is defined but never used.","line":604,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":604,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AppSuite 管理運用システム - 認証モジュール\n * Phase 3 Sprint 1: 認証システム実装\n */\n\nconst AuthModule = {\n    // セッション設定\n    SESSION_KEY: 'appsuite_session',\n    SESSION_TIMEOUT: 30 * 60 * 1000, // 30分（ミリ秒）\n    MAX_LOGIN_ATTEMPTS: 5,\n    LOCKOUT_DURATION: 15 * 60 * 1000, // 15分（ミリ秒）\n\n    // 現在のセッション\n    currentSession: null,\n\n    /**\n     * 初期化\n     */\n    init() {\n        this.loadSession();\n        this.setupSessionTimeout();\n        this.setupActivityListener();\n    },\n\n    /**\n     * ログイン処理\n     * @param {string} username - ユーザー名\n     * @param {string} password - パスワード\n     * @returns {Object} - ログイン結果\n     */\n    async login(username, password) {\n        // 入力バリデーション\n        if (!username || !password) {\n            return { success: false, error: 'ユーザー名とパスワードを入力してください' };\n        }\n\n        // ロックアウトチェック\n        const lockoutInfo = this.checkLockout(username);\n        if (lockoutInfo.locked) {\n            const remainingMinutes = Math.ceil(lockoutInfo.remainingTime / 60000);\n            return {\n                success: false,\n                error: `アカウントがロックされています。${remainingMinutes}分後に再試行してください`\n            };\n        }\n\n        // ユーザー検索\n        const user = DataStore.users.find(u =>\n            u.username === username || u.email === username\n        );\n\n        if (!user) {\n            this.recordFailedAttempt(username);\n            return { success: false, error: 'ユーザー名またはパスワードが正しくありません' };\n        }\n\n        // ステータスチェック\n        if (user.status !== 'active') {\n            return { success: false, error: 'このアカウントは無効化されています' };\n        }\n\n        // パスワード検証（デモ環境では簡易チェック）\n        const isValidPassword = await this.verifyPassword(password, user.passwordHash || 'demo');\n        if (!isValidPassword) {\n            this.recordFailedAttempt(username);\n            const attempts = this.getFailedAttempts(username);\n            const remaining = this.MAX_LOGIN_ATTEMPTS - attempts;\n            return {\n                success: false,\n                error: `ユーザー名またはパスワードが正しくありません（残り${remaining}回）`\n            };\n        }\n\n        // ログイン成功\n        this.clearFailedAttempts(username);\n        const session = this.createSession(user);\n        this.saveSession(session);\n\n        // ログ記録\n        LogModule.addLog('login', 'システム', 'system', `ログイン成功: ${user.username}`);\n\n        // 最終ログイン更新\n        user.lastLogin = new Date().toLocaleString('ja-JP');\n\n        return { success: true, user: this.sanitizeUser(user), session };\n    },\n\n    /**\n     * ログアウト処理\n     */\n    logout() {\n        const user = this.getCurrentUser();\n        if (user) {\n            LogModule.addLog('logout', 'システム', 'system', `ログアウト: ${user.username}`);\n        }\n\n        this.clearSession();\n        this.showLoginScreen();\n    },\n\n    /**\n     * セッション作成\n     * @param {Object} user - ユーザーオブジェクト\n     * @returns {Object} - セッションオブジェクト\n     */\n    createSession(user) {\n        const now = Date.now();\n        return {\n            id: this.generateSessionId(),\n            userId: user.id,\n            username: user.username,\n            role: user.role,\n            department: user.department,\n            createdAt: now,\n            expiresAt: now + this.SESSION_TIMEOUT,\n            lastActivity: now\n        };\n    },\n\n    /**\n     * セッションID生成\n     * @returns {string} - ユニークなセッションID\n     */\n    generateSessionId() {\n        const array = new Uint8Array(32);\n        crypto.getRandomValues(array);\n        return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');\n    },\n\n    /**\n     * セッション保存\n     * @param {Object} session - セッションオブジェクト\n     */\n    saveSession(session) {\n        this.currentSession = session;\n        sessionStorage.setItem(this.SESSION_KEY, JSON.stringify(session));\n    },\n\n    /**\n     * セッション読み込み\n     */\n    loadSession() {\n        const saved = sessionStorage.getItem(this.SESSION_KEY);\n        if (saved) {\n            const session = JSON.parse(saved);\n            if (this.isSessionValid(session)) {\n                this.currentSession = session;\n                return true;\n            }\n            this.clearSession();\n        }\n        return false;\n    },\n\n    /**\n     * セッション有効性チェック\n     * @param {Object} session - セッションオブジェクト\n     * @returns {boolean} - 有効な場合true\n     */\n    isSessionValid(session) {\n        if (!session) {return false;}\n        const now = Date.now();\n        return session.expiresAt > now;\n    },\n\n    /**\n     * セッションクリア\n     */\n    clearSession() {\n        this.currentSession = null;\n        sessionStorage.removeItem(this.SESSION_KEY);\n    },\n\n    /**\n     * セッション更新（アクティビティ延長）\n     */\n    refreshSession() {\n        if (this.currentSession) {\n            const now = Date.now();\n            this.currentSession.lastActivity = now;\n            this.currentSession.expiresAt = now + this.SESSION_TIMEOUT;\n            this.saveSession(this.currentSession);\n        }\n    },\n\n    /**\n     * 認証済みかチェック\n     * @returns {boolean} - 認証済みの場合true\n     */\n    isAuthenticated() {\n        return this.currentSession !== null && this.isSessionValid(this.currentSession);\n    },\n\n    /**\n     * 現在のユーザー取得\n     * @returns {Object|null} - ユーザーオブジェクトまたはnull\n     */\n    getCurrentUser() {\n        if (!this.isAuthenticated()) {return null;}\n        const user = DataStore.users.find(u => u.id === this.currentSession.userId);\n        return user ? this.sanitizeUser(user) : null;\n    },\n\n    /**\n     * 権限チェック\n     * @param {string} permission - 必要な権限\n     * @returns {boolean} - 権限がある場合true\n     */\n    hasPermission(permission) {\n        if (!this.isAuthenticated()) {return false;}\n\n        const permissions = {\n            // 管理者のみ\n            'admin': ['管理者'],\n            'user.create': ['管理者'],\n            'user.delete': ['管理者'],\n            'settings.edit': ['管理者'],\n            'log.export': ['管理者'],\n\n            // 管理者とユーザー\n            'user.view': ['管理者', 'ユーザー'],\n            'app.view': ['管理者', 'ユーザー'],\n            'incident.view': ['管理者', 'ユーザー'],\n            'incident.create': ['管理者', 'ユーザー'],\n            'change.view': ['管理者', 'ユーザー'],\n            'change.create': ['管理者', 'ユーザー']\n        };\n\n        const allowedRoles = permissions[permission];\n        if (!allowedRoles) {return true;} // 未定義の権限は許可\n\n        return allowedRoles.includes(this.currentSession.role);\n    },\n\n    /**\n     * 権限チェック（UIガード用）\n     * @param {string} permission - 必要な権限\n     * @param {Function} callback - 権限がある場合に実行する関数\n     */\n    requirePermission(permission, callback) {\n        if (this.hasPermission(permission)) {\n            callback();\n        } else {\n            showToast('この操作を行う権限がありません', 'error');\n        }\n    },\n\n    /**\n     * パスワード検証（SHA-256ベースの簡易実装）\n     * @param {string} password - 入力パスワード\n     * @param {string} hash - 保存されているハッシュ\n     * @returns {Promise<boolean>} - 一致する場合true\n     */\n    async verifyPassword(password, hash) {\n        // 管理者アカウント：admin / admin123\n        if (hash === 'admin') {\n            return password === 'admin123';\n        }\n\n        // デモ環境：パスワードが'demo'または'password123'なら許可\n        if (hash === 'demo') {\n            return password === 'demo' || password === 'password123';\n        }\n\n        // 本番環境：SHA-256ハッシュ比較\n        const inputHash = await this.hashPassword(password);\n        return inputHash === hash;\n    },\n\n    /**\n     * パスワードハッシュ化（SHA-256）\n     * @param {string} password - パスワード\n     * @returns {Promise<string>} - ハッシュ値\n     */\n    async hashPassword(password) {\n        const encoder = new TextEncoder();\n        const data = encoder.encode(password + 'appsuite_salt_2026');\n        const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n        const hashArray = Array.from(new Uint8Array(hashBuffer));\n        return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n    },\n\n    /**\n     * ログイン失敗記録\n     * @param {string} username - ユーザー名\n     */\n    recordFailedAttempt(username) {\n        const key = `login_attempts_${username}`;\n        const data = JSON.parse(localStorage.getItem(key) || '{\"attempts\":0,\"firstAttempt\":0}');\n\n        const now = Date.now();\n        if (now - data.firstAttempt > this.LOCKOUT_DURATION) {\n            // ロックアウト期間経過後はリセット\n            data.attempts = 1;\n            data.firstAttempt = now;\n        } else {\n            data.attempts++;\n        }\n        data.lastAttempt = now;\n\n        localStorage.setItem(key, JSON.stringify(data));\n\n        // ロックアウト時にログ記録\n        if (data.attempts >= this.MAX_LOGIN_ATTEMPTS) {\n            LogModule.addLog('security', 'システム', 'system',\n                `アカウントロック: ${username} (${this.MAX_LOGIN_ATTEMPTS}回の失敗)`);\n        }\n    },\n\n    /**\n     * 失敗回数取得\n     * @param {string} username - ユーザー名\n     * @returns {number} - 失敗回数\n     */\n    getFailedAttempts(username) {\n        const key = `login_attempts_${username}`;\n        const data = JSON.parse(localStorage.getItem(key) || '{\"attempts\":0}');\n        return data.attempts;\n    },\n\n    /**\n     * ロックアウトチェック\n     * @param {string} username - ユーザー名\n     * @returns {Object} - ロックアウト情報\n     */\n    checkLockout(username) {\n        const key = `login_attempts_${username}`;\n        const data = JSON.parse(localStorage.getItem(key) || '{\"attempts\":0,\"lastAttempt\":0}');\n\n        const now = Date.now();\n        const timeSinceLastAttempt = now - data.lastAttempt;\n\n        if (data.attempts >= this.MAX_LOGIN_ATTEMPTS && timeSinceLastAttempt < this.LOCKOUT_DURATION) {\n            return {\n                locked: true,\n                remainingTime: this.LOCKOUT_DURATION - timeSinceLastAttempt\n            };\n        }\n\n        return { locked: false };\n    },\n\n    /**\n     * 失敗記録クリア\n     * @param {string} username - ユーザー名\n     */\n    clearFailedAttempts(username) {\n        localStorage.removeItem(`login_attempts_${username}`);\n    },\n\n    /**\n     * ユーザー情報のサニタイズ（機密情報除去）\n     * @param {Object} user - ユーザーオブジェクト\n     * @returns {Object} - サニタイズされたユーザー\n     */\n    sanitizeUser(user) {\n        const { passwordHash, ...safeUser } = user;\n        return safeUser;\n    },\n\n    /**\n     * セッションタイムアウト設定\n     */\n    setupSessionTimeout() {\n        setInterval(() => {\n            if (this.currentSession && !this.isSessionValid(this.currentSession)) {\n                showToast('セッションがタイムアウトしました', 'warning');\n                this.logout();\n            }\n        }, 60000); // 1分ごとにチェック\n    },\n\n    /**\n     * アクティビティリスナー設定\n     */\n    setupActivityListener() {\n        const events = ['mousedown', 'keydown', 'scroll', 'touchstart'];\n        const handler = () => {\n            if (this.isAuthenticated()) {\n                this.refreshSession();\n            }\n        };\n\n        events.forEach(event => {\n            document.addEventListener(event, handler, { passive: true });\n        });\n    },\n\n    /**\n     * ログイン画面表示\n     */\n    showLoginScreen() {\n        const loginModal = document.getElementById('loginModal');\n        if (loginModal) {\n            loginModal.classList.add('active');\n        }\n        document.getElementById('loginUsername').value = '';\n        document.getElementById('loginPassword').value = '';\n        document.getElementById('loginError').textContent = '';\n    },\n\n    /**\n     * ログイン画面非表示\n     */\n    hideLoginScreen() {\n        const loginModal = document.getElementById('loginModal');\n        if (loginModal) {\n            loginModal.classList.remove('active');\n        }\n    },\n\n    /**\n     * ログインフォーム送信処理\n     */\n    async handleLoginSubmit(event) {\n        event.preventDefault();\n\n        const username = document.getElementById('loginUsername').value.trim();\n        const password = document.getElementById('loginPassword').value;\n        const errorElement = document.getElementById('loginError');\n        const submitButton = event.target.querySelector('button[type=\"submit\"]');\n\n        // ボタン無効化\n        submitButton.disabled = true;\n        submitButton.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> ログイン中...';\n\n        try {\n            const result = await this.login(username, password);\n\n            if (result.success) {\n                this.hideLoginScreen();\n                this.updateUIForUser(result.user);\n                showToast(`ようこそ、${result.user.username}さん`, 'success');\n\n                // アプリケーション初期化\n                if (typeof startApplicationAfterLogin === 'function') {\n                    startApplicationAfterLogin();\n                } else if (typeof updateDashboard === 'function') {\n                    updateDashboard();\n                }\n            } else {\n                errorElement.textContent = result.error;\n                document.getElementById('loginPassword').value = '';\n            }\n        } catch (error) {\n            errorElement.textContent = 'ログイン処理中にエラーが発生しました';\n            console.error('Login error:', error);\n        } finally {\n            submitButton.disabled = false;\n            submitButton.innerHTML = '<i class=\"fas fa-sign-in-alt\"></i> ログイン';\n        }\n    },\n\n    /**\n     * ユーザー情報でUI更新\n     * @param {Object} user - ユーザーオブジェクト\n     */\n    updateUIForUser(user) {\n        const currentUserElement = document.getElementById('currentUser');\n        if (currentUserElement) {\n            currentUserElement.textContent = user.username;\n        }\n\n        // 権限に基づくUI制御\n        this.applyPermissionBasedUI();\n    },\n\n    /**\n     * 権限ベースのUI制御\n     */\n    applyPermissionBasedUI() {\n        // 管理者専用機能の表示/非表示\n        const adminOnlyElements = document.querySelectorAll('[data-permission=\"admin\"]');\n        adminOnlyElements.forEach(el => {\n            el.style.display = this.hasPermission('admin') ? '' : 'none';\n        });\n\n        // ユーザー作成ボタン\n        const addUserButton = document.getElementById('addUserButton');\n        if (addUserButton) {\n            addUserButton.style.display = this.hasPermission('user.create') ? '' : 'none';\n        }\n\n        // 設定エクスポートボタン\n        const exportButtons = document.querySelectorAll('[data-permission=\"log.export\"]');\n        exportButtons.forEach(el => {\n            el.style.display = this.hasPermission('log.export') ? '' : 'none';\n        });\n    }\n};\n\n// パスワード強度チェッカー\nconst PasswordValidator = {\n    /**\n     * パスワード強度チェック\n     * @param {string} password - パスワード\n     * @returns {Object} - チェック結果\n     */\n    check(password) {\n        const result = {\n            valid: true,\n            score: 0,\n            errors: [],\n            strength: 'weak'\n        };\n\n        // 最小長チェック（8文字以上）\n        if (password.length < 8) {\n            result.valid = false;\n            result.errors.push('パスワードは8文字以上必要です');\n        } else {\n            result.score += 1;\n        }\n\n        // 大文字チェック\n        if (!/[A-Z]/.test(password)) {\n            result.errors.push('大文字を含めてください');\n        } else {\n            result.score += 1;\n        }\n\n        // 小文字チェック\n        if (!/[a-z]/.test(password)) {\n            result.errors.push('小文字を含めてください');\n        } else {\n            result.score += 1;\n        }\n\n        // 数字チェック\n        if (!/[0-9]/.test(password)) {\n            result.errors.push('数字を含めてください');\n        } else {\n            result.score += 1;\n        }\n\n        // 特殊文字チェック\n        if (!/[!@#$%^&*()_+\\-=[\\]{};':\"\\\\|,.<>/?]/.test(password)) {\n            result.errors.push('特殊文字を含めてください');\n        } else {\n            result.score += 1;\n        }\n\n        // 12文字以上でボーナス\n        if (password.length >= 12) {\n            result.score += 1;\n        }\n\n        // 強度判定\n        if (result.score >= 5) {\n            result.strength = 'strong';\n        } else if (result.score >= 3) {\n            result.strength = 'medium';\n        } else {\n            result.strength = 'weak';\n        }\n\n        return result;\n    },\n\n    /**\n     * 強度バー更新\n     * @param {string} password - パスワード\n     * @param {HTMLElement} barElement - プログレスバー要素\n     * @param {HTMLElement} textElement - テキスト要素\n     */\n    updateStrengthUI(password, barElement, textElement) {\n        const result = this.check(password);\n\n        const colors = {\n            weak: '#ef4444',\n            medium: '#f59e0b',\n            strong: '#22c55e'\n        };\n\n        const labels = {\n            weak: '弱い',\n            medium: '普通',\n            strong: '強い'\n        };\n\n        const widths = {\n            weak: '33%',\n            medium: '66%',\n            strong: '100%'\n        };\n\n        if (barElement) {\n            barElement.style.width = widths[result.strength];\n            barElement.style.backgroundColor = colors[result.strength];\n        }\n\n        if (textElement) {\n            textElement.textContent = labels[result.strength];\n            textElement.style.color = colors[result.strength];\n        }\n    }\n};\n\n// グローバル関数（HTML onclick用）\nfunction handleLogin(event) {\n    AuthModule.handleLoginSubmit(event);\n}\n\nfunction handleLogout() {\n    AuthModule.logout();\n}\n","usedDeprecatedRules":[{"ruleId":"semi","replacedBy":[]},{"ruleId":"quotes","replacedBy":[]},{"ruleId":"indent","replacedBy":[]},{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/runner/work/Appsuite-ITSM-Management/Appsuite-ITSM-Management/WebUI-Sample/js/backup.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"semi","replacedBy":[]},{"ruleId":"quotes","replacedBy":[]},{"ruleId":"indent","replacedBy":[]},{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/runner/work/Appsuite-ITSM-Management/Appsuite-ITSM-Management/WebUI-Sample/js/components.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Pagination' is assigned a value but never used.","line":9,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'Loading' is assigned a value but never used.","line":343,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":343,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'Tabs' is assigned a value but never used.","line":391,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":391,"endColumn":11},{"ruleId":"no-unused-vars","severity":1,"message":"'TableSort' is assigned a value but never used.","line":488,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":488,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'SearchHighlight' is assigned a value but never used.","line":527,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":527,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AppSuite 管理運用システム - 共通コンポーネント\n * Phase 3 Sprint 1: 共通コンポーネント実装\n */\n\n/**\n * ページネーションコンポーネント\n */\nconst Pagination = {\n    /**\n     * ページネーションを生成\n     * @param {Object} options - オプション\n     * @param {number} options.currentPage - 現在のページ\n     * @param {number} options.totalItems - 総アイテム数\n     * @param {number} options.itemsPerPage - 1ページあたりのアイテム数\n     * @param {Function} options.onPageChange - ページ変更時のコールバック\n     * @returns {string} - HTML文字列\n     */\n    render(options) {\n        const { currentPage, totalItems, itemsPerPage, containerId } = options;\n        const totalPages = Math.ceil(totalItems / itemsPerPage);\n\n        if (totalPages <= 1) {\n            return '';\n        }\n\n        const startItem = (currentPage - 1) * itemsPerPage + 1;\n        const endItem = Math.min(currentPage * itemsPerPage, totalItems);\n\n        let html = `\n            <div class=\"pagination-container\">\n                <div class=\"pagination-info\">\n                    ${totalItems}件中 ${startItem}-${endItem}件を表示\n                </div>\n                <div class=\"pagination-controls\">\n        `;\n\n        // 前へボタン\n        html += `\n            <button class=\"pagination-btn ${currentPage === 1 ? 'disabled' : ''}\"\n                    onclick=\"Pagination.goToPage('${containerId}', ${currentPage - 1})\"\n                    ${currentPage === 1 ? 'disabled' : ''}>\n                <i class=\"fas fa-chevron-left\"></i>\n            </button>\n        `;\n\n        // ページ番号\n        const maxVisiblePages = 5;\n        let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));\n        const endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);\n\n        if (endPage - startPage < maxVisiblePages - 1) {\n            startPage = Math.max(1, endPage - maxVisiblePages + 1);\n        }\n\n        if (startPage > 1) {\n            html += `<button class=\"pagination-btn\" onclick=\"Pagination.goToPage('${containerId}', 1)\">1</button>`;\n            if (startPage > 2) {\n                html += `<span class=\"pagination-ellipsis\">...</span>`;\n            }\n        }\n\n        for (let i = startPage; i <= endPage; i++) {\n            html += `\n                <button class=\"pagination-btn ${i === currentPage ? 'active' : ''}\"\n                        onclick=\"Pagination.goToPage('${containerId}', ${i})\">\n                    ${i}\n                </button>\n            `;\n        }\n\n        if (endPage < totalPages) {\n            if (endPage < totalPages - 1) {\n                html += `<span class=\"pagination-ellipsis\">...</span>`;\n            }\n            html += `<button class=\"pagination-btn\" onclick=\"Pagination.goToPage('${containerId}', ${totalPages})\">${totalPages}</button>`;\n        }\n\n        // 次へボタン\n        html += `\n            <button class=\"pagination-btn ${currentPage === totalPages ? 'disabled' : ''}\"\n                    onclick=\"Pagination.goToPage('${containerId}', ${currentPage + 1})\"\n                    ${currentPage === totalPages ? 'disabled' : ''}>\n                <i class=\"fas fa-chevron-right\"></i>\n            </button>\n        `;\n\n        html += `\n                </div>\n            </div>\n        `;\n\n        return html;\n    },\n\n    // ページ変更ハンドラー（各モジュールで上書き可能）\n    handlers: {},\n\n    /**\n     * ハンドラーを登録\n     * @param {string} containerId - コンテナID\n     * @param {Function} handler - ページ変更ハンドラー\n     */\n    registerHandler(containerId, handler) {\n        this.handlers[containerId] = handler;\n    },\n\n    /**\n     * 指定ページに移動\n     * @param {string} containerId - コンテナID\n     * @param {number} page - ページ番号\n     */\n    goToPage(containerId, page) {\n        const handler = this.handlers[containerId];\n        if (handler) {\n            handler(page);\n        }\n    }\n};\n\n/**\n * モーダルコンポーネント\n */\nconst Modal = {\n    /**\n     * モーダルを開く\n     * @param {Object} options - オプション\n     * @param {string} options.title - タイトル\n     * @param {string} options.content - HTML内容\n     * @param {Array} options.buttons - ボタン配列\n     * @param {string} options.size - サイズ（'small', 'medium', 'large'）\n     * @param {Function} options.onClose - 閉じた時のコールバック\n     */\n    open(options) {\n        const { title, content, buttons = [], size = 'medium', onClose } = options;\n\n        document.getElementById('modalTitle').textContent = title;\n        document.getElementById('modalBody').innerHTML = content;\n\n        const footer = document.getElementById('modalFooter');\n        footer.innerHTML = buttons.map(btn => {\n            const onclick = typeof btn.onclick === 'function'\n                ? `(${btn.onclick.toString()})()`\n                : btn.onclick;\n            return `<button class=\"btn ${btn.class || ''}\" onclick=\"${onclick}\">${escapeHtml(btn.text)}</button>`;\n        }).join('');\n\n        const modal = document.getElementById('modal');\n        modal.className = `modal modal-${size}`;\n\n        document.getElementById('modalOverlay').classList.add('active');\n\n        this.onCloseCallback = onClose;\n    },\n\n    /**\n     * モーダルを閉じる\n     */\n    close() {\n        document.getElementById('modalOverlay').classList.remove('active');\n\n        if (this.onCloseCallback) {\n            this.onCloseCallback();\n            this.onCloseCallback = null;\n        }\n    },\n\n    /**\n     * 確認ダイアログを表示\n     * @param {string} message - メッセージ\n     * @param {Function} onConfirm - 確認時のコールバック\n     * @param {Function} onCancel - キャンセル時のコールバック\n     */\n    confirm(message, onConfirm, onCancel) {\n        this.open({\n            title: '確認',\n            content: `<p>${escapeHtml(message)}</p>`,\n            size: 'small',\n            buttons: [\n                {\n                    text: 'キャンセル',\n                    class: 'btn-secondary',\n                    onclick: () => {\n                        Modal.close();\n                        if (onCancel) {onCancel();}\n                    }\n                },\n                {\n                    text: '確認',\n                    class: 'btn-primary',\n                    onclick: () => {\n                        Modal.close();\n                        if (onConfirm) {onConfirm();}\n                    }\n                }\n            ]\n        });\n    },\n\n    /**\n     * アラートダイアログを表示\n     * @param {string} message - メッセージ\n     * @param {string} type - タイプ（'info', 'success', 'warning', 'error'）\n     */\n    alert(message, type = 'info') {\n        const icons = {\n            info: 'fa-info-circle',\n            success: 'fa-check-circle',\n            warning: 'fa-exclamation-triangle',\n            error: 'fa-times-circle'\n        };\n\n        const colors = {\n            info: 'var(--info-color)',\n            success: 'var(--success-color)',\n            warning: 'var(--warning-color)',\n            error: 'var(--danger-color)'\n        };\n\n        this.open({\n            title: type === 'error' ? 'エラー' : type === 'warning' ? '警告' : 'お知らせ',\n            content: `\n                <div style=\"text-align: center; padding: 20px;\">\n                    <i class=\"fas ${icons[type]}\" style=\"font-size: 48px; color: ${colors[type]}; margin-bottom: 16px;\"></i>\n                    <p style=\"margin: 0;\">${escapeHtml(message)}</p>\n                </div>\n            `,\n            size: 'small',\n            buttons: [\n                {\n                    text: 'OK',\n                    class: 'btn-primary',\n                    onclick: 'Modal.close()'\n                }\n            ]\n        });\n    }\n};\n\n/**\n * トーストコンポーネント（強化版）\n */\nconst Toast = {\n    container: null,\n    queue: [],\n    maxVisible: 5,\n\n    /**\n     * 初期化\n     */\n    init() {\n        this.container = document.getElementById('toastContainer');\n        if (!this.container) {\n            this.container = document.createElement('div');\n            this.container.id = 'toastContainer';\n            this.container.className = 'toast-container';\n            document.body.appendChild(this.container);\n        }\n    },\n\n    /**\n     * トーストを表示\n     * @param {string} message - メッセージ\n     * @param {string} type - タイプ（'success', 'error', 'warning', 'info'）\n     * @param {number} duration - 表示時間（ミリ秒）\n     */\n    show(message, type = 'info', duration = 3000) {\n        if (!this.container) {this.init();}\n\n        const toast = document.createElement('div');\n        toast.className = `toast toast-${type}`;\n\n        const icons = {\n            success: 'fa-check-circle',\n            error: 'fa-exclamation-circle',\n            warning: 'fa-exclamation-triangle',\n            info: 'fa-info-circle'\n        };\n\n        toast.innerHTML = `\n            <i class=\"fas ${icons[type]}\"></i>\n            <span class=\"toast-message\">${escapeHtml(message)}</span>\n            <button class=\"toast-close\" onclick=\"Toast.dismiss(this.parentElement)\">\n                <i class=\"fas fa-times\"></i>\n            </button>\n        `;\n\n        this.container.appendChild(toast);\n\n        // アニメーション開始\n        requestAnimationFrame(() => {\n            toast.classList.add('show');\n        });\n\n        // 自動削除\n        if (duration > 0) {\n            setTimeout(() => {\n                this.dismiss(toast);\n            }, duration);\n        }\n\n        // 最大数を超えたら古いものを削除\n        const toasts = this.container.querySelectorAll('.toast');\n        if (toasts.length > this.maxVisible) {\n            this.dismiss(toasts[0]);\n        }\n    },\n\n    /**\n     * トーストを削除\n     * @param {HTMLElement} toast - トースト要素\n     */\n    dismiss(toast) {\n        if (!toast || !toast.parentElement) {return;}\n\n        toast.classList.add('hide');\n        setTimeout(() => {\n            if (toast.parentElement) {\n                toast.remove();\n            }\n        }, 300);\n    },\n\n    /**\n     * 全トーストをクリア\n     */\n    clear() {\n        if (!this.container) {return;}\n        const toasts = this.container.querySelectorAll('.toast');\n        toasts.forEach(toast => this.dismiss(toast));\n    },\n\n    // ショートカットメソッド\n    success(message, duration) { this.show(message, 'success', duration); },\n    error(message, duration) { this.show(message, 'error', duration); },\n    warning(message, duration) { this.show(message, 'warning', duration); },\n    info(message, duration) { this.show(message, 'info', duration); }\n};\n\n/**\n * ローディングコンポーネント\n */\nconst Loading = {\n    overlay: null,\n\n    /**\n     * ローディング表示\n     * @param {string} message - メッセージ\n     */\n    show(message = '読み込み中...') {\n        if (!this.overlay) {\n            this.overlay = document.createElement('div');\n            this.overlay.className = 'loading-overlay';\n            this.overlay.innerHTML = `\n                <div class=\"loading-content\">\n                    <div class=\"loading-spinner\"></div>\n                    <p class=\"loading-message\">${escapeHtml(message)}</p>\n                </div>\n            `;\n            document.body.appendChild(this.overlay);\n        } else {\n            this.overlay.querySelector('.loading-message').textContent = message;\n        }\n\n        this.overlay.classList.add('active');\n    },\n\n    /**\n     * ローディング非表示\n     */\n    hide() {\n        if (this.overlay) {\n            this.overlay.classList.remove('active');\n        }\n    },\n\n    /**\n     * メッセージ更新\n     * @param {string} message - 新しいメッセージ\n     */\n    updateMessage(message) {\n        if (this.overlay) {\n            this.overlay.querySelector('.loading-message').textContent = message;\n        }\n    }\n};\n\n/**\n * タブコンポーネント\n */\nconst Tabs = {\n    /**\n     * タブを初期化\n     * @param {string} containerId - タブコンテナのID\n     * @param {Function} onChange - タブ変更時のコールバック\n     */\n    init(containerId, onChange) {\n        const container = document.getElementById(containerId);\n        if (!container) {return;}\n\n        const tabs = container.querySelectorAll('.tab-button');\n        const panels = container.querySelectorAll('.tab-panel');\n\n        tabs.forEach(tab => {\n            tab.addEventListener('click', () => {\n                const targetId = tab.dataset.tab;\n\n                // タブ切り替え\n                tabs.forEach(t => t.classList.remove('active'));\n                tab.classList.add('active');\n\n                // パネル切り替え\n                panels.forEach(p => {\n                    p.classList.toggle('active', p.id === targetId);\n                });\n\n                if (onChange) {\n                    onChange(targetId);\n                }\n            });\n        });\n    }\n};\n\n/**\n * ドロップダウンコンポーネント\n */\nconst Dropdown = {\n    activeDropdown: null,\n\n    /**\n     * 初期化\n     */\n    init() {\n        document.addEventListener('click', (e) => {\n            if (this.activeDropdown && !this.activeDropdown.contains(e.target)) {\n                this.close();\n            }\n        });\n    },\n\n    /**\n     * ドロップダウンを開く\n     * @param {HTMLElement} trigger - トリガー要素\n     * @param {HTMLElement} dropdown - ドロップダウン要素\n     */\n    open(trigger, dropdown) {\n        if (this.activeDropdown) {\n            this.close();\n        }\n\n        dropdown.classList.add('active');\n        this.activeDropdown = dropdown;\n\n        // 位置調整\n        const rect = trigger.getBoundingClientRect();\n        dropdown.style.top = `${rect.bottom + 8}px`;\n        dropdown.style.left = `${rect.left}px`;\n    },\n\n    /**\n     * ドロップダウンを閉じる\n     */\n    close() {\n        if (this.activeDropdown) {\n            this.activeDropdown.classList.remove('active');\n            this.activeDropdown = null;\n        }\n    },\n\n    /**\n     * トグル\n     * @param {HTMLElement} trigger - トリガー要素\n     * @param {HTMLElement} dropdown - ドロップダウン要素\n     */\n    toggle(trigger, dropdown) {\n        if (dropdown.classList.contains('active')) {\n            this.close();\n        } else {\n            this.open(trigger, dropdown);\n        }\n    }\n};\n\n/**\n * テーブルソートコンポーネント\n */\nconst TableSort = {\n    /**\n     * テーブルをソート可能にする\n     * @param {string} tableId - テーブルID\n     * @param {Function} onSort - ソート時のコールバック\n     */\n    init(tableId, onSort) {\n        const table = document.getElementById(tableId);\n        if (!table) {return;}\n\n        const headers = table.querySelectorAll('th[data-sortable]');\n        headers.forEach(header => {\n            header.style.cursor = 'pointer';\n            header.addEventListener('click', () => {\n                const column = header.dataset.column;\n                const currentDir = header.dataset.sortDir || 'none';\n                const newDir = currentDir === 'asc' ? 'desc' : 'asc';\n\n                // 他のヘッダーのソート状態をリセット\n                headers.forEach(h => {\n                    h.dataset.sortDir = 'none';\n                    h.classList.remove('sort-asc', 'sort-desc');\n                });\n\n                // 現在のヘッダーのソート状態を設定\n                header.dataset.sortDir = newDir;\n                header.classList.add(`sort-${newDir}`);\n\n                if (onSort) {\n                    onSort(column, newDir);\n                }\n            });\n        });\n    }\n};\n\n/**\n * 検索ハイライトコンポーネント\n */\nconst SearchHighlight = {\n    /**\n     * テキスト内の検索文字列をハイライト\n     * @param {string} text - 対象テキスト\n     * @param {string} search - 検索文字列\n     * @returns {string} - ハイライトされたHTML\n     */\n    highlight(text, search) {\n        if (!search || !text) {return escapeHtml(text);}\n\n        const escapedSearch = search.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n        const regex = new RegExp(`(${escapedSearch})`, 'gi');\n        const escaped = escapeHtml(text);\n\n        return escaped.replace(regex, '<mark class=\"search-highlight\">$1</mark>');\n    }\n};\n\n// 初期化\ndocument.addEventListener('DOMContentLoaded', () => {\n    Toast.init();\n    Dropdown.init();\n});\n","usedDeprecatedRules":[{"ruleId":"semi","replacedBy":[]},{"ruleId":"quotes","replacedBy":[]},{"ruleId":"indent","replacedBy":[]},{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/runner/work/Appsuite-ITSM-Management/Appsuite-ITSM-Management/WebUI-Sample/js/dashboard.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'DashboardManager' is assigned a value but never used.","line":10,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'KPIWidget' is assigned a value but never used.","line":690,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":690,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'QuickActions' is assigned a value but never used.","line":785,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":785,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'SystemStatus' is assigned a value but never used.","line":955,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":955,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AppSuite 管理運用システム - ダッシュボードモジュール\n * Phase 3 Sprint 2: ダッシュボード強化・リアルタイム更新・グラフ/チャート\n */\n\n/**\n * ダッシュボードマネージャー\n * グラフ、リアルタイム更新、ウィジェット管理を統括\n */\nconst DashboardManager = {\n    // 更新間隔（ミリ秒）\n    UPDATE_INTERVAL: 30000, // 30秒\n\n    // 更新タイマーID\n    updateTimer: null,\n\n    // Chart.jsインスタンス\n    charts: {\n        incidentTrend: null,\n        appStatus: null,\n        incidentPriority: null,\n        changeType: null,\n        weeklyActivity: null\n    },\n\n    // ウィジェット設定\n    widgets: [],\n\n    /**\n     * 初期化\n     */\n    init() {\n        this.loadWidgetSettings();\n        this.initCharts();\n        this.startAutoUpdate();\n        this.initWidgetControls();\n\n        // ページ離脱時にタイマー停止\n        window.addEventListener('beforeunload', () => this.stopAutoUpdate());\n    },\n\n    /**\n     * グラフ初期化\n     */\n    initCharts() {\n        // Chart.jsが読み込まれているか確認\n        if (typeof Chart === 'undefined') {\n            console.warn('Chart.js is not loaded. Charts will not be displayed.');\n            return;\n        }\n\n        // グローバル設定\n        Chart.defaults.font.family = '\\'Noto Sans JP\\', \\'Hiragino Sans\\', sans-serif';\n        Chart.defaults.responsive = true;\n        Chart.defaults.maintainAspectRatio = false;\n\n        // 各チャートを初期化\n        this.initIncidentTrendChart();\n        this.initAppStatusChart();\n        this.initIncidentPriorityChart();\n        this.initChangeTypeChart();\n        this.initWeeklyActivityChart();\n    },\n\n    /**\n     * インシデントトレンドチャート（折れ線グラフ）\n     */\n    initIncidentTrendChart() {\n        const ctx = document.getElementById('incidentTrendChart');\n        if (!ctx) {return;}\n\n        const data = this.getIncidentTrendData();\n\n        this.charts.incidentTrend = new Chart(ctx, {\n            type: 'line',\n            data: {\n                labels: data.labels,\n                datasets: [\n                    {\n                        label: '新規',\n                        data: data.newIncidents,\n                        borderColor: '#f59e0b',\n                        backgroundColor: 'rgba(245, 158, 11, 0.1)',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: '解決済み',\n                        data: data.resolvedIncidents,\n                        borderColor: '#10b981',\n                        backgroundColor: 'rgba(16, 185, 129, 0.1)',\n                        fill: true,\n                        tension: 0.4\n                    }\n                ]\n            },\n            options: {\n                plugins: {\n                    legend: {\n                        position: 'bottom'\n                    },\n                    title: {\n                        display: true,\n                        text: 'インシデント推移（過去7日間）'\n                    }\n                },\n                scales: {\n                    y: {\n                        beginAtZero: true,\n                        ticks: {\n                            stepSize: 1\n                        }\n                    }\n                }\n            }\n        });\n    },\n\n    /**\n     * アプリステータス分布チャート（ドーナツ）\n     */\n    initAppStatusChart() {\n        const ctx = document.getElementById('appStatusChart');\n        if (!ctx) {return;}\n\n        const data = this.getAppStatusData();\n\n        this.charts.appStatus = new Chart(ctx, {\n            type: 'doughnut',\n            data: {\n                labels: ['稼働中', 'メンテナンス', '停止中'],\n                datasets: [{\n                    data: [data.active, data.maintenance, data.inactive],\n                    backgroundColor: ['#10b981', '#f59e0b', '#6b7280'],\n                    borderWidth: 0\n                }]\n            },\n            options: {\n                plugins: {\n                    legend: {\n                        position: 'bottom'\n                    },\n                    title: {\n                        display: true,\n                        text: 'アプリ稼働状況'\n                    }\n                },\n                cutout: '60%'\n            }\n        });\n    },\n\n    /**\n     * インシデント優先度分布チャート（円グラフ）\n     */\n    initIncidentPriorityChart() {\n        const ctx = document.getElementById('incidentPriorityChart');\n        if (!ctx) {return;}\n\n        const data = this.getIncidentPriorityData();\n\n        this.charts.incidentPriority = new Chart(ctx, {\n            type: 'pie',\n            data: {\n                labels: ['高', '中', '低'],\n                datasets: [{\n                    data: [data.high, data.medium, data.low],\n                    backgroundColor: ['#ef4444', '#f59e0b', '#3b82f6'],\n                    borderWidth: 0\n                }]\n            },\n            options: {\n                plugins: {\n                    legend: {\n                        position: 'bottom'\n                    },\n                    title: {\n                        display: true,\n                        text: 'インシデント優先度'\n                    }\n                }\n            }\n        });\n    },\n\n    /**\n     * 変更タイプ分布チャート（棒グラフ）\n     */\n    initChangeTypeChart() {\n        const ctx = document.getElementById('changeTypeChart');\n        if (!ctx) {return;}\n\n        const data = this.getChangeTypeData();\n\n        this.charts.changeType = new Chart(ctx, {\n            type: 'bar',\n            data: {\n                labels: ['機能追加', '機能変更', 'バグ修正', '改善'],\n                datasets: [{\n                    label: '件数',\n                    data: [data.feature, data.modification, data.bugfix, data.improvement],\n                    backgroundColor: ['#8b5cf6', '#3b82f6', '#ef4444', '#10b981'],\n                    borderRadius: 4\n                }]\n            },\n            options: {\n                plugins: {\n                    legend: {\n                        display: false\n                    },\n                    title: {\n                        display: true,\n                        text: '変更要求タイプ別'\n                    }\n                },\n                scales: {\n                    y: {\n                        beginAtZero: true,\n                        ticks: {\n                            stepSize: 1\n                        }\n                    }\n                }\n            }\n        });\n    },\n\n    /**\n     * 週間アクティビティチャート（複合グラフ）\n     */\n    initWeeklyActivityChart() {\n        const ctx = document.getElementById('weeklyActivityChart');\n        if (!ctx) {return;}\n\n        const data = this.getWeeklyActivityData();\n\n        this.charts.weeklyActivity = new Chart(ctx, {\n            type: 'bar',\n            data: {\n                labels: data.labels,\n                datasets: [\n                    {\n                        label: 'ログイン',\n                        data: data.logins,\n                        backgroundColor: 'rgba(59, 130, 246, 0.7)',\n                        borderRadius: 4\n                    },\n                    {\n                        label: '操作',\n                        data: data.actions,\n                        backgroundColor: 'rgba(16, 185, 129, 0.7)',\n                        borderRadius: 4\n                    }\n                ]\n            },\n            options: {\n                plugins: {\n                    legend: {\n                        position: 'bottom'\n                    },\n                    title: {\n                        display: true,\n                        text: '週間アクティビティ'\n                    }\n                },\n                scales: {\n                    y: {\n                        beginAtZero: true\n                    }\n                }\n            }\n        });\n    },\n\n    /**\n     * インシデントトレンドデータ取得\n     */\n    getIncidentTrendData() {\n        const incidents = DataStore.incidents || [];\n        const labels = [];\n        const newIncidents = [];\n        const resolvedIncidents = [];\n\n        // 過去7日間のデータを生成\n        for (let i = 6; i >= 0; i--) {\n            const date = new Date();\n            date.setDate(date.getDate() - i);\n            const dateStr = DateUtils.format(date, 'MM/dd');\n            labels.push(dateStr);\n\n            const dayStart = new Date(date);\n            dayStart.setHours(0, 0, 0, 0);\n            const dayEnd = new Date(date);\n            dayEnd.setHours(23, 59, 59, 999);\n\n            // その日に作成されたインシデント\n            const created = incidents.filter(inc => {\n                const createdDate = new Date(inc.created);\n                return createdDate >= dayStart && createdDate <= dayEnd;\n            }).length;\n            newIncidents.push(created);\n\n            // その日に解決されたインシデント\n            const resolved = incidents.filter(inc => {\n                if (!inc.resolvedAt) {return false;}\n                const resolvedDate = new Date(inc.resolvedAt);\n                return resolvedDate >= dayStart && resolvedDate <= dayEnd;\n            }).length;\n            resolvedIncidents.push(resolved);\n        }\n\n        return { labels, newIncidents, resolvedIncidents };\n    },\n\n    /**\n     * アプリステータスデータ取得\n     */\n    getAppStatusData() {\n        const apps = DataStore.apps || [];\n        return {\n            active: apps.filter(a => a.status === 'active').length,\n            maintenance: apps.filter(a => a.status === 'maintenance').length,\n            inactive: apps.filter(a => a.status === 'inactive').length\n        };\n    },\n\n    /**\n     * インシデント優先度データ取得\n     */\n    getIncidentPriorityData() {\n        const incidents = DataStore.incidents || [];\n        const openIncidents = incidents.filter(i => i.status !== 'closed');\n        return {\n            high: openIncidents.filter(i => i.priority === 'high').length,\n            medium: openIncidents.filter(i => i.priority === 'medium').length,\n            low: openIncidents.filter(i => i.priority === 'low').length\n        };\n    },\n\n    /**\n     * 変更タイプデータ取得\n     */\n    getChangeTypeData() {\n        const changes = DataStore.changes || [];\n        return {\n            feature: changes.filter(c => c.type === 'feature').length,\n            modification: changes.filter(c => c.type === 'modification').length,\n            bugfix: changes.filter(c => c.type === 'bugfix').length,\n            improvement: changes.filter(c => c.type === 'improvement').length\n        };\n    },\n\n    /**\n     * 週間アクティビティデータ取得\n     */\n    getWeeklyActivityData() {\n        const logs = DataStore.logs || [];\n        const labels = [];\n        const logins = [];\n        const actions = [];\n\n        const dayNames = ['日', '月', '火', '水', '木', '金', '土'];\n\n        for (let i = 6; i >= 0; i--) {\n            const date = new Date();\n            date.setDate(date.getDate() - i);\n            labels.push(dayNames[date.getDay()]);\n\n            const dayStart = new Date(date);\n            dayStart.setHours(0, 0, 0, 0);\n            const dayEnd = new Date(date);\n            dayEnd.setHours(23, 59, 59, 999);\n\n            const dayLogs = logs.filter(log => {\n                const logDate = new Date(log.timestamp);\n                return logDate >= dayStart && logDate <= dayEnd;\n            });\n\n            logins.push(dayLogs.filter(l => l.action === 'login').length);\n            actions.push(dayLogs.filter(l => l.action !== 'login' && l.action !== 'logout').length);\n        }\n\n        return { labels, logins, actions };\n    },\n\n    /**\n     * 全チャートを更新\n     */\n    updateCharts() {\n        if (!this.charts.incidentTrend) {return;}\n\n        // インシデントトレンド更新\n        const trendData = this.getIncidentTrendData();\n        this.charts.incidentTrend.data.labels = trendData.labels;\n        this.charts.incidentTrend.data.datasets[0].data = trendData.newIncidents;\n        this.charts.incidentTrend.data.datasets[1].data = trendData.resolvedIncidents;\n        this.charts.incidentTrend.update('none');\n\n        // アプリステータス更新\n        const appData = this.getAppStatusData();\n        this.charts.appStatus.data.datasets[0].data = [appData.active, appData.maintenance, appData.inactive];\n        this.charts.appStatus.update('none');\n\n        // インシデント優先度更新\n        const priorityData = this.getIncidentPriorityData();\n        this.charts.incidentPriority.data.datasets[0].data = [priorityData.high, priorityData.medium, priorityData.low];\n        this.charts.incidentPriority.update('none');\n\n        // 変更タイプ更新\n        const changeData = this.getChangeTypeData();\n        this.charts.changeType.data.datasets[0].data = [changeData.feature, changeData.modification, changeData.bugfix, changeData.improvement];\n        this.charts.changeType.update('none');\n\n        // 週間アクティビティ更新\n        const activityData = this.getWeeklyActivityData();\n        this.charts.weeklyActivity.data.labels = activityData.labels;\n        this.charts.weeklyActivity.data.datasets[0].data = activityData.logins;\n        this.charts.weeklyActivity.data.datasets[1].data = activityData.actions;\n        this.charts.weeklyActivity.update('none');\n    },\n\n    /**\n     * 自動更新開始\n     */\n    startAutoUpdate() {\n        if (this.updateTimer) {return;}\n\n        this.updateTimer = setInterval(() => {\n            this.refresh();\n        }, this.UPDATE_INTERVAL);\n\n        // 更新インジケーター表示\n        this.updateLastRefreshTime();\n    },\n\n    /**\n     * 自動更新停止\n     */\n    stopAutoUpdate() {\n        if (this.updateTimer) {\n            clearInterval(this.updateTimer);\n            this.updateTimer = null;\n        }\n    },\n\n    /**\n     * 手動更新\n     */\n    refresh() {\n        // 統計カード更新\n        this.updateStatCards();\n\n        // チャート更新\n        this.updateCharts();\n\n        // 最近のログ更新\n        if (typeof LogModule !== 'undefined') {\n            LogModule.renderRecent();\n        }\n\n        // アプリサマリー更新\n        if (typeof renderAppSummary === 'function') {\n            renderAppSummary();\n        }\n\n        // 最終更新時刻更新\n        this.updateLastRefreshTime();\n\n        // 更新アニメーション\n        this.showRefreshAnimation();\n    },\n\n    /**\n     * 統計カード更新\n     */\n    updateStatCards() {\n        const stats = DataStore.getStats();\n\n        // アニメーション付きで数値更新\n        this.animateNumber('totalUsers', stats.totalUsers);\n        this.animateNumber('activeUsers', stats.activeUsers);\n        this.animateNumber('totalApps', stats.totalApps);\n        this.animateNumber('activeApps', stats.activeApps);\n        this.animateNumber('openIncidents', stats.openIncidents);\n        this.animateNumber('pendingChanges', stats.pendingChanges);\n    },\n\n    /**\n     * 数値のアニメーション更新\n     */\n    animateNumber(elementId, targetValue) {\n        const element = document.getElementById(elementId);\n        if (!element) {return;}\n\n        const currentValue = parseInt(element.textContent) || 0;\n        const diff = targetValue - currentValue;\n\n        if (diff === 0) {return;}\n\n        const duration = 500;\n        const startTime = performance.now();\n\n        const animate = (currentTime) => {\n            const elapsed = currentTime - startTime;\n            const progress = Math.min(elapsed / duration, 1);\n\n            // イージング関数（easeOutQuad）\n            const eased = 1 - (1 - progress) * (1 - progress);\n\n            const value = Math.round(currentValue + diff * eased);\n            element.textContent = value;\n\n            if (progress < 1) {\n                requestAnimationFrame(animate);\n            }\n        };\n\n        requestAnimationFrame(animate);\n    },\n\n    /**\n     * 最終更新時刻を更新\n     */\n    updateLastRefreshTime() {\n        const element = document.getElementById('lastRefreshTime');\n        if (element) {\n            element.textContent = DateUtils.format(new Date(), 'HH:mm:ss');\n        }\n    },\n\n    /**\n     * 更新アニメーション表示\n     */\n    showRefreshAnimation() {\n        const btn = document.getElementById('refreshDashboard');\n        if (btn) {\n            btn.classList.add('refreshing');\n            setTimeout(() => btn.classList.remove('refreshing'), 1000);\n        }\n    },\n\n    /**\n     * ウィジェット設定読み込み\n     */\n    loadWidgetSettings() {\n        const saved = localStorage.getItem('appsuite_dashboard_widgets');\n        if (saved) {\n            try {\n                this.widgets = JSON.parse(saved);\n            } catch (e) {\n                this.widgets = this.getDefaultWidgets();\n            }\n        } else {\n            this.widgets = this.getDefaultWidgets();\n        }\n    },\n\n    /**\n     * デフォルトウィジェット設定\n     */\n    getDefaultWidgets() {\n        return [\n            { id: 'stats', name: '統計カード', visible: true, order: 1 },\n            { id: 'incidentTrend', name: 'インシデント推移', visible: true, order: 2 },\n            { id: 'appStatus', name: 'アプリ稼働状況', visible: true, order: 3 },\n            { id: 'incidentPriority', name: 'インシデント優先度', visible: true, order: 4 },\n            { id: 'changeType', name: '変更要求タイプ', visible: true, order: 5 },\n            { id: 'weeklyActivity', name: '週間アクティビティ', visible: true, order: 6 },\n            { id: 'recentLogs', name: '最近の操作ログ', visible: true, order: 7 },\n            { id: 'appSummary', name: 'アプリ一覧', visible: true, order: 8 }\n        ];\n    },\n\n    /**\n     * ウィジェット設定保存\n     */\n    saveWidgetSettings() {\n        localStorage.setItem('appsuite_dashboard_widgets', JSON.stringify(this.widgets));\n    },\n\n    /**\n     * ウィジェット表示/非表示切替\n     */\n    toggleWidget(widgetId) {\n        const widget = this.widgets.find(w => w.id === widgetId);\n        if (widget) {\n            widget.visible = !widget.visible;\n            this.saveWidgetSettings();\n            this.applyWidgetVisibility();\n        }\n    },\n\n    /**\n     * ウィジェット表示状態を適用\n     */\n    applyWidgetVisibility() {\n        this.widgets.forEach(widget => {\n            const element = document.getElementById(`widget-${widget.id}`);\n            if (element) {\n                element.style.display = widget.visible ? '' : 'none';\n            }\n        });\n    },\n\n    /**\n     * ウィジェットコントロール初期化\n     */\n    initWidgetControls() {\n        const container = document.getElementById('widgetControlList');\n        if (!container) {return;}\n\n        container.innerHTML = this.widgets.map(widget => `\n            <label class=\"widget-control-item\">\n                <input type=\"checkbox\"\n                       ${widget.visible ? 'checked' : ''}\n                       onchange=\"DashboardManager.toggleWidget('${widget.id}')\">\n                <span>${escapeHtml(widget.name)}</span>\n            </label>\n        `).join('');\n    },\n\n    /**\n     * ウィジェット設定モーダルを開く\n     */\n    openWidgetSettings() {\n        Modal.open({\n            title: 'ダッシュボード設定',\n            content: `\n                <div class=\"widget-settings\">\n                    <p>表示するウィジェットを選択してください：</p>\n                    <div class=\"widget-control-list\" id=\"widgetControlList\"></div>\n                    <div class=\"widget-settings-actions\">\n                        <button class=\"btn btn-secondary btn-sm\" onclick=\"DashboardManager.resetWidgets()\">\n                            <i class=\"fas fa-undo\"></i> デフォルトに戻す\n                        </button>\n                    </div>\n                </div>\n            `,\n            size: 'small',\n            buttons: [\n                {\n                    text: '閉じる',\n                    class: 'btn-primary',\n                    onclick: 'Modal.close()'\n                }\n            ]\n        });\n\n        this.initWidgetControls();\n    },\n\n    /**\n     * ウィジェット設定をリセット\n     */\n    resetWidgets() {\n        this.widgets = this.getDefaultWidgets();\n        this.saveWidgetSettings();\n        this.applyWidgetVisibility();\n        this.initWidgetControls();\n        Toast.success('ウィジェット設定をリセットしました');\n    },\n\n    /**\n     * 更新間隔設定\n     */\n    setUpdateInterval(interval) {\n        this.UPDATE_INTERVAL = interval;\n        this.stopAutoUpdate();\n        if (interval > 0) {\n            this.startAutoUpdate();\n        }\n    },\n\n    /**\n     * クリーンアップ（チャートの破棄）\n     */\n    destroy() {\n        this.stopAutoUpdate();\n        Object.values(this.charts).forEach(chart => {\n            if (chart) {chart.destroy();}\n        });\n        this.charts = {};\n    }\n};\n\n/**\n * KPIウィジェット\n * 重要業績評価指標の表示\n */\nconst KPIWidget = {\n    /**\n     * KPIデータを計算\n     */\n    calculate() {\n        const incidents = DataStore.incidents || [];\n        const changes = DataStore.changes || [];\n\n        // 平均解決時間（時間）\n        const resolvedIncidents = incidents.filter(i => i.resolvedAt && i.created);\n        let avgResolutionTime = 0;\n        if (resolvedIncidents.length > 0) {\n            const totalTime = resolvedIncidents.reduce((sum, inc) => {\n                return sum + (new Date(inc.resolvedAt) - new Date(inc.created));\n            }, 0);\n            avgResolutionTime = Math.round(totalTime / resolvedIncidents.length / (1000 * 60 * 60) * 10) / 10;\n        }\n\n        // SLA達成率（24時間以内に解決した割合）\n        const slaTarget = 24 * 60 * 60 * 1000; // 24時間\n        const withinSla = resolvedIncidents.filter(inc => {\n            const resolutionTime = new Date(inc.resolvedAt) - new Date(inc.created);\n            return resolutionTime <= slaTarget;\n        }).length;\n        const slaRate = resolvedIncidents.length > 0\n            ? Math.round(withinSla / resolvedIncidents.length * 100)\n            : 100;\n\n        // 変更成功率\n        const completedChanges = changes.filter(c => c.status === 'completed');\n        const failedChanges = changes.filter(c => c.status === 'rejected');\n        const changeSuccessRate = (completedChanges.length + failedChanges.length) > 0\n            ? Math.round(completedChanges.length / (completedChanges.length + failedChanges.length) * 100)\n            : 100;\n\n        // 今月のインシデント数\n        const now = new Date();\n        const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\n        const monthlyIncidents = incidents.filter(i => new Date(i.created) >= monthStart).length;\n\n        return {\n            avgResolutionTime,\n            slaRate,\n            changeSuccessRate,\n            monthlyIncidents\n        };\n    },\n\n    /**\n     * KPIウィジェットをレンダリング\n     */\n    render() {\n        const container = document.getElementById('kpiWidget');\n        if (!container) {return;}\n\n        const kpi = this.calculate();\n\n        container.innerHTML = `\n            <div class=\"kpi-grid\">\n                <div class=\"kpi-item\">\n                    <div class=\"kpi-value\">${kpi.avgResolutionTime}<small>時間</small></div>\n                    <div class=\"kpi-label\">平均解決時間</div>\n                    <div class=\"kpi-trend ${kpi.avgResolutionTime <= 8 ? 'good' : 'warning'}\">\n                        <i class=\"fas fa-${kpi.avgResolutionTime <= 8 ? 'arrow-down' : 'arrow-up'}\"></i>\n                    </div>\n                </div>\n                <div class=\"kpi-item\">\n                    <div class=\"kpi-value\">${kpi.slaRate}<small>%</small></div>\n                    <div class=\"kpi-label\">SLA達成率</div>\n                    <div class=\"kpi-trend ${kpi.slaRate >= 90 ? 'good' : 'warning'}\">\n                        <i class=\"fas fa-${kpi.slaRate >= 90 ? 'check' : 'exclamation'}\"></i>\n                    </div>\n                </div>\n                <div class=\"kpi-item\">\n                    <div class=\"kpi-value\">${kpi.changeSuccessRate}<small>%</small></div>\n                    <div class=\"kpi-label\">変更成功率</div>\n                    <div class=\"kpi-trend ${kpi.changeSuccessRate >= 95 ? 'good' : 'warning'}\">\n                        <i class=\"fas fa-${kpi.changeSuccessRate >= 95 ? 'check' : 'exclamation'}\"></i>\n                    </div>\n                </div>\n                <div class=\"kpi-item\">\n                    <div class=\"kpi-value\">${kpi.monthlyIncidents}</div>\n                    <div class=\"kpi-label\">今月のインシデント</div>\n                    <div class=\"kpi-trend neutral\">\n                        <i class=\"fas fa-chart-line\"></i>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n};\n\n/**\n * クイックアクションウィジェット\n */\nconst QuickActions = {\n    /**\n     * レンダリング\n     */\n    render() {\n        const container = document.getElementById('quickActions');\n        if (!container) {return;}\n\n        container.innerHTML = `\n            <div class=\"quick-actions-grid\">\n                <button class=\"quick-action-btn\" onclick=\"QuickActions.newIncident()\">\n                    <i class=\"fas fa-exclamation-triangle\"></i>\n                    <span>新規インシデント</span>\n                </button>\n                <button class=\"quick-action-btn\" onclick=\"QuickActions.newChange()\">\n                    <i class=\"fas fa-code-branch\"></i>\n                    <span>新規変更要求</span>\n                </button>\n                <button class=\"quick-action-btn\" onclick=\"QuickActions.viewMyTasks()\">\n                    <i class=\"fas fa-tasks\"></i>\n                    <span>担当タスク</span>\n                </button>\n                <button class=\"quick-action-btn\" onclick=\"QuickActions.viewReports()\">\n                    <i class=\"fas fa-chart-bar\"></i>\n                    <span>レポート</span>\n                </button>\n            </div>\n        `;\n    },\n\n    /**\n     * 新規インシデント作成\n     */\n    newIncident() {\n        // インシデントセクションに移動して新規モーダルを開く\n        showSection('incidents');\n        document.querySelector('[data-section=\"incidents\"]').classList.add('active');\n        setTimeout(() => IncidentModule.showAddModal(), 100);\n    },\n\n    /**\n     * 新規変更要求作成\n     */\n    newChange() {\n        showSection('changes');\n        document.querySelector('[data-section=\"changes\"]').classList.add('active');\n        setTimeout(() => ChangeModule.showAddModal(), 100);\n    },\n\n    /**\n     * 担当タスク表示\n     */\n    viewMyTasks() {\n        const currentUser = AuthModule.getCurrentUser();\n        if (!currentUser) {return;}\n\n        const myIncidents = (DataStore.incidents || []).filter(\n            i => i.assignee === currentUser.username && i.status !== 'closed'\n        );\n        const myChanges = (DataStore.changes || []).filter(\n            c => c.assignee === currentUser.username && c.status !== 'completed'\n        );\n\n        let content = '<div class=\"my-tasks\">';\n\n        if (myIncidents.length === 0 && myChanges.length === 0) {\n            content += '<p class=\"text-muted\">担当タスクはありません</p>';\n        } else {\n            if (myIncidents.length > 0) {\n                content += '<h4><i class=\"fas fa-exclamation-triangle\"></i> インシデント</h4>';\n                content += '<ul class=\"task-list\">';\n                myIncidents.forEach(inc => {\n                    content += `\n                        <li class=\"task-item priority-${inc.priority}\">\n                            <span class=\"task-id\">${escapeHtml(inc.id)}</span>\n                            <span class=\"task-title\">${escapeHtml(inc.title)}</span>\n                            <span class=\"badge badge-${inc.priority}\">${inc.priority}</span>\n                        </li>\n                    `;\n                });\n                content += '</ul>';\n            }\n\n            if (myChanges.length > 0) {\n                content += '<h4><i class=\"fas fa-code-branch\"></i> 変更要求</h4>';\n                content += '<ul class=\"task-list\">';\n                myChanges.forEach(chg => {\n                    content += `\n                        <li class=\"task-item\">\n                            <span class=\"task-id\">${escapeHtml(chg.id)}</span>\n                            <span class=\"task-title\">${escapeHtml(chg.title)}</span>\n                            <span class=\"badge\">${escapeHtml(chg.status)}</span>\n                        </li>\n                    `;\n                });\n                content += '</ul>';\n            }\n        }\n\n        content += '</div>';\n\n        Modal.open({\n            title: '担当タスク一覧',\n            content: content,\n            size: 'medium',\n            buttons: [\n                {\n                    text: '閉じる',\n                    class: 'btn-primary',\n                    onclick: 'Modal.close()'\n                }\n            ]\n        });\n    },\n\n    /**\n     * レポート表示\n     */\n    viewReports() {\n        Modal.open({\n            title: 'レポート',\n            content: `\n                <div class=\"reports-menu\">\n                    <button class=\"btn btn-block\" onclick=\"QuickActions.generateIncidentReport()\">\n                        <i class=\"fas fa-file-pdf\"></i> インシデントレポート\n                    </button>\n                    <button class=\"btn btn-block\" onclick=\"QuickActions.generateChangeReport()\">\n                        <i class=\"fas fa-file-pdf\"></i> 変更管理レポート\n                    </button>\n                    <button class=\"btn btn-block\" onclick=\"QuickActions.generateActivityReport()\">\n                        <i class=\"fas fa-file-pdf\"></i> アクティビティレポート\n                    </button>\n                </div>\n            `,\n            size: 'small',\n            buttons: [\n                {\n                    text: '閉じる',\n                    class: 'btn-secondary',\n                    onclick: 'Modal.close()'\n                }\n            ]\n        });\n    },\n\n    /**\n     * インシデントレポート生成\n     */\n    generateIncidentReport() {\n        Toast.info('レポート生成機能は今後のアップデートで実装予定です');\n    },\n\n    /**\n     * 変更管理レポート生成\n     */\n    generateChangeReport() {\n        Toast.info('レポート生成機能は今後のアップデートで実装予定です');\n    },\n\n    /**\n     * アクティビティレポート生成\n     */\n    generateActivityReport() {\n        Toast.info('レポート生成機能は今後のアップデートで実装予定です');\n    }\n};\n\n/**\n * システムステータスウィジェット\n */\nconst SystemStatus = {\n    /**\n     * レンダリング\n     */\n    render() {\n        const container = document.getElementById('systemStatus');\n        if (!container) {return;}\n\n        const status = this.getStatus();\n\n        container.innerHTML = `\n            <div class=\"system-status-grid\">\n                <div class=\"status-indicator ${status.api}\">\n                    <i class=\"fas fa-plug\"></i>\n                    <span>API接続</span>\n                </div>\n                <div class=\"status-indicator ${status.storage}\">\n                    <i class=\"fas fa-database\"></i>\n                    <span>ストレージ</span>\n                </div>\n                <div class=\"status-indicator ${status.sync}\">\n                    <i class=\"fas fa-sync\"></i>\n                    <span>同期</span>\n                </div>\n            </div>\n            <div class=\"storage-usage\">\n                <div class=\"storage-label\">\n                    <span>ストレージ使用量</span>\n                    <span>${status.storageUsed} / ${status.storageMax}</span>\n                </div>\n                <div class=\"storage-bar\">\n                    <div class=\"storage-fill\" style=\"width: ${status.storagePercent}%\"></div>\n                </div>\n            </div>\n        `;\n    },\n\n    /**\n     * ステータス取得\n     */\n    getStatus() {\n        // localStorage使用量を計算\n        let totalSize = 0;\n        for (const key in localStorage) {\n            if (Object.prototype.hasOwnProperty.call(localStorage, key) && key.startsWith('appsuite_')) {\n                totalSize += (localStorage.getItem(key) || '').length * 2; // UTF-16\n            }\n        }\n\n        const maxSize = 5 * 1024 * 1024; // 5MB（一般的なlocalStorage上限）\n        const usedKB = Math.round(totalSize / 1024);\n        const maxKB = Math.round(maxSize / 1024);\n        const percent = Math.round(totalSize / maxSize * 100);\n\n        return {\n            api: 'offline', // 実際の接続状態に応じて変更\n            storage: percent < 80 ? 'online' : 'warning',\n            sync: 'offline',\n            storageUsed: `${usedKB}KB`,\n            storageMax: `${maxKB}KB`,\n            storagePercent: percent\n        };\n    }\n};\n\n// 初期化はapp.jsから呼び出される\n","usedDeprecatedRules":[{"ruleId":"semi","replacedBy":[]},{"ruleId":"quotes","replacedBy":[]},{"ruleId":"indent","replacedBy":[]},{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/runner/work/Appsuite-ITSM-Management/Appsuite-ITSM-Management/WebUI-Sample/js/modules.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'UserModule' is assigned a value but never used.","line":10,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'AppModule' is assigned a value but never used.","line":203,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":203,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'IncidentModule' is assigned a value but never used.","line":649,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":649,"endColumn":21},{"ruleId":"no-undef","severity":1,"message":"'NotificationManager' is not defined.","line":759,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":759,"endColumn":32},{"ruleId":"no-undef","severity":1,"message":"'NotificationManager' is not defined.","line":761,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":761,"endColumn":36},{"ruleId":"no-undef","severity":1,"message":"'WorkflowEngine' is not defined.","line":845,"column":28,"nodeType":"Identifier","messageId":"undef","endLine":845,"endColumn":42},{"ruleId":"no-undef","severity":1,"message":"'NotificationManager' is not defined.","line":879,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":879,"endColumn":36},{"ruleId":"no-undef","severity":1,"message":"'NotificationManager' is not defined.","line":883,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":883,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'SettingsModule' is assigned a value but never used.","line":938,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":938,"endColumn":21},{"ruleId":"no-undef","severity":1,"message":"'BackupManager' is not defined.","line":1079,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":1079,"endColumn":26},{"ruleId":"no-undef","severity":1,"message":"'BackupManager' is not defined.","line":1301,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":1301,"endColumn":40},{"ruleId":"no-unused-vars","severity":1,"message":"'ChangeModule' is assigned a value but never used.","line":1406,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":1406,"endColumn":19},{"ruleId":"no-undef","severity":1,"message":"'WorkflowEngine' is not defined.","line":1586,"column":28,"nodeType":"Identifier","messageId":"undef","endLine":1586,"endColumn":42},{"ruleId":"no-undef","severity":1,"message":"'NotificationManager' is not defined.","line":1616,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":1616,"endColumn":36},{"ruleId":"no-undef","severity":1,"message":"'NotificationManager' is not defined.","line":1620,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":1620,"endColumn":36},{"ruleId":"no-undef","severity":1,"message":"'NotificationManager' is not defined.","line":1623,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":1623,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AppSuite 管理運用システム - 機能モジュール\n */\n\nfunction isValidEmail(value) {\n    return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(value);\n}\n\n// ユーザー管理モジュール\nconst UserModule = {\n    refresh() {\n        this.render(DataStore.users);\n    },\n\n    render(users) {\n        const readOnly = window.ApiSync?.isReadOnly;\n        const tbody = document.getElementById('usersTableBody');\n        tbody.innerHTML = users.map(user => `\n            <tr>\n                <td>${escapeHtml(user.id)}</td>\n                <td>${escapeHtml(user.username)}</td>\n                <td>${escapeHtml(user.email)}</td>\n                <td>${escapeHtml(user.department)}</td>\n                <td><span class=\"badge ${user.role === '管理者' ? 'badge-primary' : 'badge-info'}\">${escapeHtml(user.role)}</span></td>\n                <td><span class=\"badge ${user.status === 'active' ? 'badge-success' : 'badge-secondary'}\">${user.status === 'active' ? '有効' : '無効'}</span></td>\n                <td>${escapeHtml(user.lastLogin)}</td>\n                <td>\n                    <button class=\"action-btn edit\" onclick=\"UserModule.edit('${escapeHtml(user.id)}')\" title=\"${readOnly ? '参照専用のため編集不可' : '編集'}\" ${readOnly ? 'disabled' : ''}><i class=\"fas fa-edit\"></i></button>\n                    <button class=\"action-btn delete\" onclick=\"UserModule.delete('${escapeHtml(user.id)}')\" title=\"${readOnly ? '参照専用のため削除不可' : '削除'}\" ${readOnly ? 'disabled' : ''}><i class=\"fas fa-trash\"></i></button>\n                </td>\n            </tr>\n        `).join('');\n    },\n\n    showAddModal() {\n        openModal('ユーザー追加', `\n            <div class=\"form-group\">\n                <label>ユーザー名</label>\n                <input type=\"text\" id=\"newUserName\" required>\n            </div>\n            <div class=\"form-group\">\n                <label>メールアドレス</label>\n                <input type=\"email\" id=\"newUserEmail\" required>\n            </div>\n            <div class=\"form-group\">\n                <label>部署</label>\n                <select id=\"newUserDept\">\n                    <option>情報システム部</option>\n                    <option>営業部</option>\n                    <option>総務部</option>\n                    <option>開発部</option>\n                    <option>経理部</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>権限</label>\n                <select id=\"newUserRole\">\n                    <option value=\"ユーザー\">ユーザー</option>\n                    <option value=\"管理者\">管理者</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>ステータス</label>\n                <select id=\"newUserStatus\">\n                    <option value=\"active\">有効</option>\n                    <option value=\"inactive\">無効</option>\n                </select>\n            </div>\n        `, [\n            { text: 'キャンセル', class: 'btn-secondary', onclick: 'closeModal()' },\n            { text: '追加', class: 'btn-primary', onclick: 'UserModule.add()' }\n        ]);\n    },\n\n    add() {\n        const username = document.getElementById('newUserName').value.trim();\n        const email = document.getElementById('newUserEmail').value.trim();\n        if (!username || username.length > 50) {\n            showToast('ユーザー名は1-50文字で入力してください', 'error');\n            return;\n        }\n        if (!isValidEmail(email)) {\n            showToast('メールアドレス形式が正しくありません', 'error');\n            return;\n        }\n        const newUser = {\n            id: 'U' + String(DataStore.users.length + 1).padStart(4, '0'),\n            username: username,\n            email: email,\n            department: document.getElementById('newUserDept').value,\n            role: document.getElementById('newUserRole').value,\n            status: document.getElementById('newUserStatus').value,\n            lastLogin: '-'\n        };\n        DataStore.users.push(newUser);\n        this.refresh();\n        closeModal();\n        showToast('ユーザーを追加しました', 'success');\n        LogModule.addLog('create', 'ユーザー', 'user', '新規ユーザー追加: ' + newUser.username);\n        updateDashboard();\n    },\n\n    edit(id) {\n        const user = DataStore.users.find(u => u.id === id);\n        openModal('ユーザー編集', `\n            <div class=\"form-group\">\n                <label>ユーザー名</label>\n                <input type=\"text\" id=\"editUserName\" value=\"${user.username}\">\n            </div>\n            <div class=\"form-group\">\n                <label>メールアドレス</label>\n                <input type=\"email\" id=\"editUserEmail\" value=\"${user.email}\">\n            </div>\n            <div class=\"form-group\">\n                <label>部署</label>\n                <select id=\"editUserDept\">\n                    ${['情報システム部', '営業部', '総務部', '開発部', '経理部'].map(d =>\n        `<option ${d === user.department ? 'selected' : ''}>${d}</option>`\n    ).join('')}\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>権限</label>\n                <select id=\"editUserRole\">\n                    <option ${user.role === 'ユーザー' ? 'selected' : ''}>ユーザー</option>\n                    <option ${user.role === '管理者' ? 'selected' : ''}>管理者</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>ステータス</label>\n                <select id=\"editUserStatus\">\n                    <option value=\"active\" ${user.status === 'active' ? 'selected' : ''}>有効</option>\n                    <option value=\"inactive\" ${user.status === 'inactive' ? 'selected' : ''}>無効</option>\n                </select>\n            </div>\n        `, [\n            { text: 'キャンセル', class: 'btn-secondary', onclick: 'closeModal()' },\n            { text: '保存', class: 'btn-primary', onclick: `UserModule.save('${id}')` }\n        ]);\n    },\n\n    save(id) {\n        const user = DataStore.users.find(u => u.id === id);\n        const username = document.getElementById('editUserName').value.trim();\n        const email = document.getElementById('editUserEmail').value.trim();\n        if (!username || username.length > 50) {\n            showToast('ユーザー名は1-50文字で入力してください', 'error');\n            return;\n        }\n        if (!isValidEmail(email)) {\n            showToast('メールアドレス形式が正しくありません', 'error');\n            return;\n        }\n        user.username = username;\n        user.email = email;\n        user.department = document.getElementById('editUserDept').value;\n        user.role = document.getElementById('editUserRole').value;\n        user.status = document.getElementById('editUserStatus').value;\n        this.refresh();\n        closeModal();\n        showToast('ユーザー情報を更新しました', 'success');\n        LogModule.addLog('update', 'ユーザー', 'user', 'ユーザー更新: ' + user.username);\n        updateDashboard();\n    },\n\n    delete(id) {\n        const user = DataStore.users.find(u => u.id === id);\n        if (confirm(`ユーザー「${user.username}」を削除しますか？`)) {\n            const idx = DataStore.users.findIndex(u => u.id === id);\n            DataStore.users.splice(idx, 1);\n            this.refresh();\n            showToast('ユーザーを削除しました', 'success');\n            LogModule.addLog('delete', 'ユーザー', 'user', 'ユーザー削除: ' + user.username);\n            updateDashboard();\n        }\n    },\n\n    filter() {\n        const search = document.getElementById('userSearch').value.toLowerCase();\n        const status = document.getElementById('userStatusFilter').value;\n        const role = document.getElementById('userRoleFilter').value;\n\n        let filtered = DataStore.users;\n\n        if (search) {\n            filtered = filtered.filter(u =>\n                u.username.toLowerCase().includes(search) ||\n                u.email.toLowerCase().includes(search)\n            );\n        }\n        if (status) {\n            filtered = filtered.filter(u => u.status === status);\n        }\n        if (role) {\n            filtered = filtered.filter(u => u.role === role);\n        }\n\n        this.render(filtered);\n    }\n};\n\n// アプリ管理モジュール\nconst AppModule = {\n    refresh() {\n        this.render(DataStore.apps);\n    },\n\n    render(apps) {\n        const readOnly = window.ApiSync?.isReadOnly;\n        const tbody = document.getElementById('appsTableBody');\n        tbody.innerHTML = apps.map(app => `\n            <tr>\n                <td>${escapeHtml(app.id)}</td>\n                <td>${escapeHtml(app.name)}</td>\n                <td>${escapeHtml(app.category)}</td>\n                <td>${escapeHtml(app.creator)}</td>\n                <td>${app.records.toLocaleString()}</td>\n                <td><span class=\"badge ${this.getStatusBadge(app.status)}\">${this.getStatusText(app.status)}</span></td>\n                <td>${escapeHtml(app.updated)}</td>\n                <td>\n                    <button class=\"action-btn view\" onclick=\"AppModule.view('${escapeHtml(app.id)}')\" title=\"詳細\"><i class=\"fas fa-eye\"></i></button>\n                    <button class=\"action-btn edit\" onclick=\"AppModule.edit('${escapeHtml(app.id)}')\" title=\"${readOnly ? '参照専用のため編集不可' : '編集'}\" ${readOnly ? 'disabled' : ''}><i class=\"fas fa-edit\"></i></button>\n                    <button class=\"action-btn delete\" onclick=\"AppModule.delete('${escapeHtml(app.id)}')\" title=\"${readOnly ? '参照専用のため削除不可' : '削除'}\" ${readOnly ? 'disabled' : ''}><i class=\"fas fa-trash\"></i></button>\n                </td>\n            </tr>\n        `).join('');\n    },\n\n    getStatusBadge(status) {\n        const badges = { active: 'badge-success', maintenance: 'badge-warning', inactive: 'badge-secondary' };\n        return badges[status] || 'badge-secondary';\n    },\n\n    getStatusText(status) {\n        const texts = { active: '稼働中', maintenance: 'メンテナンス', inactive: '停止中' };\n        return texts[status] || status;\n    },\n\n    showAddModal() {\n        openModal('新規アプリ登録', `\n            <div class=\"form-group\">\n                <label>アプリ名</label>\n                <input type=\"text\" id=\"newAppName\" required>\n            </div>\n            <div class=\"form-group\">\n                <label>カテゴリ</label>\n                <select id=\"newAppCategory\">\n                    <option>業務管理</option>\n                    <option>申請・承認</option>\n                    <option>データ管理</option>\n                    <option>その他</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>作成者</label>\n                <input type=\"text\" id=\"newAppCreator\" value=\"${document.getElementById('currentUser').textContent}\">\n            </div>\n            <div class=\"form-group\">\n                <label>ステータス</label>\n                <select id=\"newAppStatus\">\n                    <option value=\"active\">稼働中</option>\n                    <option value=\"maintenance\">メンテナンス</option>\n                    <option value=\"inactive\">停止中</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>説明</label>\n                <textarea id=\"newAppDesc\" rows=\"3\" style=\"width:100%;padding:10px;border:1px solid #e2e8f0;border-radius:8px;\"></textarea>\n            </div>\n        `, [\n            { text: 'キャンセル', class: 'btn-secondary', onclick: 'closeModal()' },\n            { text: '登録', class: 'btn-primary', onclick: 'AppModule.add()' }\n        ]);\n    },\n\n    add() {\n        const name = document.getElementById('newAppName').value.trim();\n        const creator = document.getElementById('newAppCreator').value.trim();\n        if (!name || name.length > 100) {\n            showToast('アプリ名は1-100文字で入力してください', 'error');\n            return;\n        }\n        if (!creator || creator.length > 50) {\n            showToast('作成者は1-50文字で入力してください', 'error');\n            return;\n        }\n        const newApp = {\n            id: 'APP' + String(DataStore.apps.length + 1).padStart(3, '0'),\n            name: name,\n            category: document.getElementById('newAppCategory').value,\n            creator: creator,\n            records: 0,\n            status: document.getElementById('newAppStatus').value,\n            updated: new Date().toISOString().split('T')[0],\n            description: document.getElementById('newAppDesc').value.trim()\n        };\n        DataStore.apps.push(newApp);\n        this.refresh();\n        closeModal();\n        showToast('アプリを登録しました', 'success');\n        LogModule.addLog('create', newApp.name, 'app', '新規アプリ作成');\n        updateDashboard();\n    },\n\n    view(id) {\n        const app = DataStore.apps.find(a => a.id === id);\n        openModal('アプリ詳細: ' + app.name, `\n            <div style=\"line-height: 2;\">\n                <p><strong>アプリID:</strong> ${app.id}</p>\n                <p><strong>アプリ名:</strong> ${app.name}</p>\n                <p><strong>カテゴリ:</strong> ${app.category}</p>\n                <p><strong>作成者:</strong> ${app.creator}</p>\n                <p><strong>レコード数:</strong> ${app.records.toLocaleString()}件</p>\n                <p><strong>ステータス:</strong> ${this.getStatusText(app.status)}</p>\n                <p><strong>最終更新:</strong> ${app.updated}</p>\n                <p><strong>説明:</strong></p>\n                <p style=\"background:#f8fafc;padding:10px;border-radius:8px;\">${app.description || '（なし）'}</p>\n            </div>\n        `, [\n            { text: '閉じる', class: 'btn-secondary', onclick: 'closeModal()' }\n        ]);\n    },\n\n    edit(id) {\n        const app = DataStore.apps.find(a => a.id === id);\n        openModal('アプリ編集: ' + app.name, `\n            <div class=\"form-group\">\n                <label>アプリ名</label>\n                <input type=\"text\" id=\"editAppName\" value=\"${app.name}\">\n            </div>\n            <div class=\"form-group\">\n                <label>カテゴリ</label>\n                <select id=\"editAppCategory\">\n                    ${['業務管理', '申請・承認', 'データ管理', 'その他'].map(c =>\n        `<option ${c === app.category ? 'selected' : ''}>${c}</option>`\n    ).join('')}\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>作成者</label>\n                <input type=\"text\" id=\"editAppCreator\" value=\"${app.creator}\">\n            </div>\n            <div class=\"form-group\">\n                <label>ステータス</label>\n                <select id=\"editAppStatus\">\n                    <option value=\"active\" ${app.status === 'active' ? 'selected' : ''}>稼働中</option>\n                    <option value=\"maintenance\" ${app.status === 'maintenance' ? 'selected' : ''}>メンテナンス</option>\n                    <option value=\"inactive\" ${app.status === 'inactive' ? 'selected' : ''}>停止中</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>説明</label>\n                <textarea id=\"editAppDesc\" rows=\"3\" style=\"width:100%;padding:10px;border:1px solid #e2e8f0;border-radius:8px;\">${app.description || ''}</textarea>\n            </div>\n        `, [\n            { text: 'キャンセル', class: 'btn-secondary', onclick: 'closeModal()' },\n            { text: '保存', class: 'btn-primary', onclick: `AppModule.save('${id}')` }\n        ]);\n    },\n\n    save(id) {\n        const app = DataStore.apps.find(a => a.id === id);\n        const name = document.getElementById('editAppName').value.trim();\n        const creator = document.getElementById('editAppCreator').value.trim();\n        if (!name || name.length > 100) {\n            showToast('アプリ名は1-100文字で入力してください', 'error');\n            return;\n        }\n        if (!creator || creator.length > 50) {\n            showToast('作成者は1-50文字で入力してください', 'error');\n            return;\n        }\n        app.name = name;\n        app.category = document.getElementById('editAppCategory').value;\n        app.creator = creator;\n        app.status = document.getElementById('editAppStatus').value;\n        app.updated = new Date().toISOString().split('T')[0];\n        app.description = document.getElementById('editAppDesc').value.trim();\n        this.refresh();\n        closeModal();\n        showToast('アプリ情報を更新しました', 'success');\n        LogModule.addLog('update', app.name, 'app', 'アプリ設定を更新');\n        updateDashboard();\n    },\n\n    delete(id) {\n        const app = DataStore.apps.find(a => a.id === id);\n        if (confirm(`アプリ「${app.name}」を削除しますか？\\n※ ${app.records}件のレコードも削除されます。`)) {\n            const idx = DataStore.apps.findIndex(a => a.id === id);\n            DataStore.apps.splice(idx, 1);\n            this.refresh();\n            showToast('アプリを削除しました', 'success');\n            LogModule.addLog('delete', app.name, 'app', 'アプリ削除');\n            updateDashboard();\n        }\n    },\n\n    filter() {\n        const search = document.getElementById('appSearch').value.toLowerCase();\n        const category = document.getElementById('appCategoryFilter').value;\n        const status = document.getElementById('appStatusFilter').value;\n\n        let filtered = DataStore.apps;\n\n        if (search) {\n            filtered = filtered.filter(a =>\n                a.name.toLowerCase().includes(search)\n            );\n        }\n        if (category) {\n            filtered = filtered.filter(a => a.category === category);\n        }\n        if (status) {\n            filtered = filtered.filter(a => a.status === status);\n        }\n\n        this.render(filtered);\n    }\n};\n\n// 監査ログモジュール\nconst LogModule = {\n    refresh() {\n        this.render(DataStore.logs);\n    },\n\n    render(logs) {\n        const tbody = document.getElementById('logsTableBody');\n        tbody.innerHTML = logs.map(log => `\n            <tr>\n                <td>${escapeHtml(log.timestamp)}</td>\n                <td>${escapeHtml(log.user)}</td>\n                <td><span class=\"badge ${this.getActionBadge(log.action)}\">${this.getActionText(log.action)}</span></td>\n                <td>${escapeHtml(log.target)}</td>\n                <td>${escapeHtml(log.detail)}</td>\n                <td>${escapeHtml(log.ip)}</td>\n            </tr>\n        `).join('');\n    },\n\n    getActionBadge(action) {\n        const badges = {\n            login: 'badge-success',\n            logout: 'badge-secondary',\n            create: 'badge-info',\n            update: 'badge-warning',\n            delete: 'badge-danger',\n            export: 'badge-info',\n            escalation: 'badge-danger'\n        };\n        return badges[action] || 'badge-secondary';\n    },\n\n    getActionText(action) {\n        const texts = {\n            login: 'ログイン',\n            logout: 'ログアウト',\n            create: '作成',\n            update: '更新',\n            delete: '削除',\n            export: 'エクスポート',\n            escalation: 'エスカレート'\n        };\n        return texts[action] || action;\n    },\n\n    addLog(action, target, targetType, detail) {\n        const now = new Date();\n        const timestamp = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;\n        DataStore.logs.unshift({\n            timestamp: timestamp,\n            user: document.getElementById('currentUser').textContent,\n            action: action,\n            target: target,\n            targetType: targetType,\n            detail: detail,\n            ip: '192.168.1.100'\n        });\n    },\n\n    search() {\n        const from = document.getElementById('logDateFrom').value;\n        const to = document.getElementById('logDateTo').value;\n        const actionType = document.getElementById('logTypeFilter').value;\n        const targetType = document.getElementById('logTargetFilter').value;\n\n        let filtered = DataStore.logs;\n\n        if (actionType) {\n            filtered = filtered.filter(l => l.action === actionType);\n        }\n        if (targetType) {\n            filtered = filtered.filter(l => l.targetType === targetType);\n        }\n        if (from) {\n            filtered = filtered.filter(l => l.timestamp >= from);\n        }\n        if (to) {\n            filtered = filtered.filter(l => l.timestamp <= to + ' 23:59:59');\n        }\n\n        this.render(filtered);\n        showToast(`${filtered.length}件のログが見つかりました`, 'success');\n    },\n\n    export() {\n        const now = new Date();\n        const timestamp = `${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}_${String(now.getHours()).padStart(2,'0')}${String(now.getMinutes()).padStart(2,'0')}${String(now.getSeconds()).padStart(2,'0')}`;\n        const csv = '\\uFEFF日時,ユーザー,操作タイプ,対象,詳細,IPアドレス\\n' +\n            DataStore.logs.map(l =>\n                `\"${l.timestamp}\",\"${l.user}\",\"${this.getActionText(l.action)}\",\"${l.target}\",\"${l.detail}\",\"${l.ip}\"`\n            ).join('\\n');\n\n        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = 'audit_log_' + timestamp + '.csv';\n        a.click();\n        showToast('ログをエクスポートしました', 'success');\n        this.addLog('export', '監査ログ', 'system', 'CSVエクスポート実行');\n    },\n\n    /**\n     * JSON形式でエクスポート\n     */\n    exportJSON() {\n        const now = new Date();\n        const timestamp = `${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}_${String(now.getHours()).padStart(2,'0')}${String(now.getMinutes()).padStart(2,'0')}${String(now.getSeconds()).padStart(2,'0')}`;\n\n        const data = {\n            exportedAt: now.toISOString(),\n            version: '1.0.0',\n            totalCount: DataStore.logs.length,\n            logs: DataStore.logs.map(log => ({\n                timestamp: log.timestamp,\n                user: log.user,\n                action: log.action,\n                actionLabel: this.getActionText(log.action),\n                target: log.target,\n                targetType: log.targetType,\n                detail: log.detail,\n                ip: log.ip\n            }))\n        };\n\n        const blob = new Blob(\n            [JSON.stringify(data, null, 2)],\n            { type: 'application/json;charset=utf-8' }\n        );\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = 'audit_log_' + timestamp + '.json';\n        a.click();\n        URL.revokeObjectURL(url);\n\n        showToast('ログをJSON形式でエクスポートしました', 'success');\n        this.addLog('export', '監査ログ', 'system', 'JSONエクスポート実行');\n    },\n\n    /**\n     * フィルタ付きエクスポート\n     * @param {string} format - 'csv' または 'json'\n     * @param {Object} filter - フィルタ条件\n     */\n    exportFiltered(format, filter = {}) {\n        let logs = [...DataStore.logs];\n\n        // フィルタ適用\n        if (filter.from) {\n            logs = logs.filter(l => l.timestamp >= filter.from);\n        }\n        if (filter.to) {\n            logs = logs.filter(l => l.timestamp <= filter.to + ' 23:59:59');\n        }\n        if (filter.action) {\n            logs = logs.filter(l => l.action === filter.action);\n        }\n        if (filter.targetType) {\n            logs = logs.filter(l => l.targetType === filter.targetType);\n        }\n\n        const now = new Date();\n        const timestamp = `${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}_${String(now.getHours()).padStart(2,'0')}${String(now.getMinutes()).padStart(2,'0')}${String(now.getSeconds()).padStart(2,'0')}`;\n\n        if (format === 'json') {\n            const data = {\n                exportedAt: now.toISOString(),\n                version: '1.0.0',\n                filter: filter,\n                totalCount: logs.length,\n                logs: logs.map(log => ({\n                    timestamp: log.timestamp,\n                    user: log.user,\n                    action: log.action,\n                    actionLabel: this.getActionText(log.action),\n                    target: log.target,\n                    targetType: log.targetType,\n                    detail: log.detail,\n                    ip: log.ip\n                }))\n            };\n\n            const blob = new Blob(\n                [JSON.stringify(data, null, 2)],\n                { type: 'application/json;charset=utf-8' }\n            );\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = 'audit_log_filtered_' + timestamp + '.json';\n            a.click();\n            URL.revokeObjectURL(url);\n        } else {\n            const csv = '\\uFEFF日時,ユーザー,操作タイプ,対象,詳細,IPアドレス\\n' +\n                logs.map(l =>\n                    `\"${l.timestamp}\",\"${l.user}\",\"${this.getActionText(l.action)}\",\"${l.target}\",\"${l.detail}\",\"${l.ip}\"`\n                ).join('\\n');\n\n            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8' });\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = 'audit_log_filtered_' + timestamp + '.csv';\n            a.click();\n            URL.revokeObjectURL(url);\n        }\n\n        showToast(`${logs.length}件のログを${format.toUpperCase()}形式でエクスポートしました`, 'success');\n        this.addLog('export', '監査ログ', 'system', `${format.toUpperCase()}エクスポート実行（フィルタ適用）`);\n    },\n\n    renderRecent() {\n        const recentLogs = DataStore.logs.slice(0, 10);\n        const container = document.getElementById('recentLogs');\n        container.innerHTML = recentLogs.map(log => `\n            <div class=\"log-item\">\n                <span class=\"log-time\">${escapeHtml(log.timestamp)}</span>\n                <span class=\"log-user\">${escapeHtml(log.user)}</span>が\n                <span class=\"badge ${this.getActionBadge(log.action)}\" style=\"font-size:0.7rem;\">${this.getActionText(log.action)}</span>\n                ${escapeHtml(log.target)}\n            </div>\n        `).join('');\n    }\n};\n\n// インシデント管理モジュール\nconst IncidentModule = {\n    refresh() {\n        this.render(DataStore.incidents);\n    },\n\n    render(incidents) {\n        const tbody = document.getElementById('incidentsTableBody');\n        tbody.innerHTML = incidents.map(inc => `\n            <tr>\n                <td>${escapeHtml(inc.id)}</td>\n                <td>${escapeHtml(inc.title)}</td>\n                <td>${escapeHtml(inc.appName)}</td>\n                <td><span class=\"badge ${this.getPriorityBadge(inc.priority)}\">${this.getPriorityText(inc.priority)}</span></td>\n                <td><span class=\"badge ${this.getStatusBadge(inc.status)}\">${this.getStatusText(inc.status)}</span></td>\n                <td>${escapeHtml(inc.reporter)}</td>\n                <td>${escapeHtml(inc.assignee)}</td>\n                <td>${escapeHtml(inc.created)}</td>\n                <td>\n                    <button class=\"action-btn view\" onclick=\"IncidentModule.view('${escapeHtml(inc.id)}')\" title=\"詳細\"><i class=\"fas fa-eye\"></i></button>\n                    <button class=\"action-btn edit\" onclick=\"IncidentModule.edit('${escapeHtml(inc.id)}')\" title=\"編集\"><i class=\"fas fa-edit\"></i></button>\n                    <button class=\"action-btn delete\" onclick=\"IncidentModule.delete('${escapeHtml(inc.id)}')\" title=\"削除\"><i class=\"fas fa-trash\"></i></button>\n                </td>\n            </tr>\n        `).join('');\n    },\n\n    getPriorityBadge(priority) {\n        const badges = { high: 'badge-danger', medium: 'badge-warning', low: 'badge-info' };\n        return badges[priority] || 'badge-secondary';\n    },\n\n    getPriorityText(priority) {\n        const texts = { high: '高', medium: '中', low: '低' };\n        return texts[priority] || priority;\n    },\n\n    getStatusBadge(status) {\n        const badges = { open: 'badge-danger', in_progress: 'badge-warning', resolved: 'badge-info', closed: 'badge-success' };\n        return badges[status] || 'badge-secondary';\n    },\n\n    getStatusText(status) {\n        const texts = { open: 'オープン', in_progress: '対応中', resolved: '解決済', closed: 'クローズ' };\n        return texts[status] || status;\n    },\n\n    showAddModal() {\n        const appOptions = DataStore.apps.map(a => `<option value=\"${a.id}\" data-name=\"${a.name}\">${a.name}</option>`).join('');\n        const userOptions = DataStore.users.filter(u => u.status === 'active').map(u => `<option value=\"${u.username}\">${u.username}</option>`).join('');\n\n        openModal('インシデント登録', `\n            <div class=\"form-group\">\n                <label>タイトル</label>\n                <input type=\"text\" id=\"newIncTitle\" required>\n            </div>\n            <div class=\"form-group\">\n                <label>対象アプリ</label>\n                <select id=\"newIncApp\">\n                    ${appOptions}\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>優先度</label>\n                <select id=\"newIncPriority\">\n                    <option value=\"low\">低</option>\n                    <option value=\"medium\" selected>中</option>\n                    <option value=\"high\">高</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>担当者</label>\n                <select id=\"newIncAssignee\">\n                    <option value=\"-\">未割当</option>\n                    ${userOptions}\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>説明</label>\n                <textarea id=\"newIncDesc\" rows=\"3\" style=\"width:100%;padding:10px;border:1px solid #e2e8f0;border-radius:8px;\"></textarea>\n            </div>\n        `, [\n            { text: 'キャンセル', class: 'btn-secondary', onclick: 'closeModal()' },\n            { text: '登録', class: 'btn-primary', onclick: 'IncidentModule.add()' }\n        ]);\n    },\n\n    add() {\n        const appSelect = document.getElementById('newIncApp');\n        const selectedOption = appSelect.options[appSelect.selectedIndex];\n        const newInc = {\n            id: 'INC' + String(DataStore.incidents.length + 1).padStart(3, '0'),\n            title: document.getElementById('newIncTitle').value,\n            appId: appSelect.value,\n            appName: selectedOption.dataset.name,\n            priority: document.getElementById('newIncPriority').value,\n            status: 'open',\n            reporter: document.getElementById('currentUser').textContent,\n            assignee: document.getElementById('newIncAssignee').value,\n            created: new Date().toISOString().split('T')[0],\n            description: document.getElementById('newIncDesc').value\n        };\n        DataStore.incidents.push(newInc);\n        this.refresh();\n        closeModal();\n        showToast('インシデントを登録しました', 'success');\n        LogModule.addLog('create', 'インシデント', 'incident', '新規インシデント登録: ' + newInc.title);\n        updateDashboard();\n\n        // 通知トリガー\n        if (typeof NotificationManager !== 'undefined') {\n            NotificationManager.notifyIncidentCreated(newInc);\n            if (newInc.priority === 'high') {\n                NotificationManager.notifyHighPriorityIncident(newInc);\n            }\n        }\n    },\n\n    view(id) {\n        const inc = DataStore.incidents.find(i => i.id === id);\n        openModal('インシデント詳細: ' + inc.id, `\n            <div style=\"line-height: 2;\">\n                <p><strong>インシデントID:</strong> ${inc.id}</p>\n                <p><strong>タイトル:</strong> ${inc.title}</p>\n                <p><strong>対象アプリ:</strong> ${inc.appName}</p>\n                <p><strong>優先度:</strong> <span class=\"badge ${this.getPriorityBadge(inc.priority)}\">${this.getPriorityText(inc.priority)}</span></p>\n                <p><strong>ステータス:</strong> <span class=\"badge ${this.getStatusBadge(inc.status)}\">${this.getStatusText(inc.status)}</span></p>\n                <p><strong>報告者:</strong> ${inc.reporter}</p>\n                <p><strong>担当者:</strong> ${inc.assignee}</p>\n                <p><strong>登録日:</strong> ${inc.created}</p>\n                <p><strong>説明:</strong></p>\n                <p style=\"background:#f8fafc;padding:10px;border-radius:8px;\">${inc.description || '（なし）'}</p>\n            </div>\n        `, [\n            { text: '閉じる', class: 'btn-secondary', onclick: 'closeModal()' }\n        ]);\n    },\n\n    edit(id) {\n        const inc = DataStore.incidents.find(i => i.id === id);\n        const appOptions = DataStore.apps.map(a => `<option value=\"${a.id}\" data-name=\"${a.name}\" ${a.id === inc.appId ? 'selected' : ''}>${a.name}</option>`).join('');\n        const userOptions = DataStore.users.filter(u => u.status === 'active').map(u => `<option value=\"${u.username}\" ${u.username === inc.assignee ? 'selected' : ''}>${u.username}</option>`).join('');\n\n        openModal('インシデント編集: ' + inc.id, `\n            <div class=\"form-group\">\n                <label>タイトル</label>\n                <input type=\"text\" id=\"editIncTitle\" value=\"${inc.title}\">\n            </div>\n            <div class=\"form-group\">\n                <label>対象アプリ</label>\n                <select id=\"editIncApp\">\n                    ${appOptions}\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>優先度</label>\n                <select id=\"editIncPriority\">\n                    <option value=\"low\" ${inc.priority === 'low' ? 'selected' : ''}>低</option>\n                    <option value=\"medium\" ${inc.priority === 'medium' ? 'selected' : ''}>中</option>\n                    <option value=\"high\" ${inc.priority === 'high' ? 'selected' : ''}>高</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>ステータス</label>\n                <select id=\"editIncStatus\">\n                    <option value=\"open\" ${inc.status === 'open' ? 'selected' : ''}>オープン</option>\n                    <option value=\"in_progress\" ${inc.status === 'in_progress' ? 'selected' : ''}>対応中</option>\n                    <option value=\"resolved\" ${inc.status === 'resolved' ? 'selected' : ''}>解決済</option>\n                    <option value=\"closed\" ${inc.status === 'closed' ? 'selected' : ''}>クローズ</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>担当者</label>\n                <select id=\"editIncAssignee\">\n                    <option value=\"-\" ${inc.assignee === '-' ? 'selected' : ''}>未割当</option>\n                    ${userOptions}\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>説明</label>\n                <textarea id=\"editIncDesc\" rows=\"3\" style=\"width:100%;padding:10px;border:1px solid #e2e8f0;border-radius:8px;\">${inc.description || ''}</textarea>\n            </div>\n        `, [\n            { text: 'キャンセル', class: 'btn-secondary', onclick: 'closeModal()' },\n            { text: '保存', class: 'btn-primary', onclick: `IncidentModule.save('${id}')` }\n        ]);\n    },\n\n    save(id) {\n        const inc = DataStore.incidents.find(i => i.id === id);\n        const appSelect = document.getElementById('editIncApp');\n        const selectedOption = appSelect.options[appSelect.selectedIndex];\n        const nextStatus = document.getElementById('editIncStatus').value;\n        const newAssignee = document.getElementById('editIncAssignee').value;\n\n        // ステータス遷移検証（WorkflowEngineまたはローカル検証）\n        if (typeof WorkflowEngine !== 'undefined') {\n            const result = WorkflowEngine.isValidIncidentTransition(inc.status, nextStatus);\n            if (!result.valid) {\n                showToast(result.message, 'error');\n                return;\n            }\n        } else if (!this.isValidStatusTransition(inc.status, nextStatus)) {\n            showToast('ステータス遷移ルールに違反しています', 'error');\n            return;\n        }\n\n        // 変更前の値を保存（通知用）\n        const oldStatus = inc.status;\n        const oldAssignee = inc.assignee;\n\n        // 値を更新\n        inc.title = document.getElementById('editIncTitle').value;\n        inc.appId = appSelect.value;\n        inc.appName = selectedOption.dataset.name;\n        inc.priority = document.getElementById('editIncPriority').value;\n        inc.status = nextStatus;\n        inc.assignee = newAssignee;\n        inc.description = document.getElementById('editIncDesc').value;\n        inc.updatedAt = new Date().toISOString();\n\n        this.refresh();\n        closeModal();\n        showToast('インシデントを更新しました', 'success');\n        LogModule.addLog('update', 'インシデント', 'incident', 'インシデント更新: ' + inc.title);\n        updateDashboard();\n\n        // 通知トリガー\n        if (typeof NotificationManager !== 'undefined') {\n            // ステータス変更通知\n            if (oldStatus !== nextStatus) {\n                NotificationManager.notifyStatusChange(inc, 'incident', nextStatus);\n            }\n            // 担当者変更通知\n            if (oldAssignee !== newAssignee && newAssignee !== '-') {\n                NotificationManager.notifyAssignment(inc);\n            }\n        }\n    },\n\n    delete(id) {\n        const inc = DataStore.incidents.find(i => i.id === id);\n        if (confirm(`インシデント「${inc.title}」を削除しますか？`)) {\n            const idx = DataStore.incidents.findIndex(i => i.id === id);\n            DataStore.incidents.splice(idx, 1);\n            this.refresh();\n            showToast('インシデントを削除しました', 'success');\n            LogModule.addLog('delete', 'インシデント', 'incident', 'インシデント削除: ' + inc.title);\n            updateDashboard();\n        }\n    },\n\n    filter() {\n        const search = document.getElementById('incidentSearch').value.toLowerCase();\n        const priority = document.getElementById('incidentPriorityFilter').value;\n        const status = document.getElementById('incidentStatusFilter').value;\n\n        let filtered = DataStore.incidents;\n\n        if (search) {\n            filtered = filtered.filter(i =>\n                i.title.toLowerCase().includes(search) ||\n                (i.description || '').toLowerCase().includes(search)\n            );\n        }\n        if (priority) {\n            filtered = filtered.filter(i => i.priority === priority);\n        }\n        if (status) {\n            filtered = filtered.filter(i => i.status === status);\n        }\n\n        this.render(filtered);\n    },\n\n    isValidStatusTransition(currentStatus, nextStatus) {\n        if (currentStatus === nextStatus) {\n            return true;\n        }\n        const transitions = {\n            open: ['in_progress', 'closed'],\n            in_progress: ['resolved', 'open'],\n            resolved: ['closed', 'in_progress'],\n            closed: ['in_progress']\n        };\n        return (transitions[currentStatus] || []).includes(nextStatus);\n    }\n};\n\n// システム設定モジュール\nconst SettingsModule = {\n    // 設定データのデフォルト値\n    defaults: {\n        api: {\n            url: '',\n            key: '',\n            authMethod: 'bearer',\n            timeout: 30,\n            syncInterval: 30\n        },\n        general: {\n            systemName: 'AppSuite 管理運用システム',\n            orgName: '',\n            adminEmail: '',\n            theme: 'light',\n            language: 'ja',\n            dateFormat: 'yyyy-MM-dd',\n            pageSize: 25\n        },\n        notification: {\n            incidentNew: true,\n            incidentHigh: true,\n            changeApproval: true,\n            changeComplete: false,\n            smtpHost: '',\n            smtpPort: 587,\n            smtpUser: '',\n            smtpPass: '',\n            smtpSsl: true\n        },\n        security: {\n            pwMinLength: 8,\n            pwRequireUpper: true,\n            pwRequireNumber: true,\n            pwRequireSpecial: false,\n            pwExpireDays: 90,\n            sessionTimeout: 30,\n            maxSessions: 3,\n            enableTwoFactor: false,\n            maxLoginAttempts: 5,\n            lockoutDuration: 15\n        },\n        workflow: {\n            incidentAutoAssign: false,\n            incidentDefaultAssignee: '',\n            incidentEscalation: 24,\n            changeRequireApproval: true,\n            changeApprover: 'manager',\n            changeLeadTime: 3,\n            allowSkipStatus: false,\n            requireComment: true\n        },\n        backup: {\n            autoBackup: true,\n            backupInterval: 'daily',\n            backupRetention: 7\n        }\n    },\n\n    // 設定読み込み\n    load() {\n        const saved = localStorage.getItem('appsuiteSettings');\n        return saved ? JSON.parse(saved) : this.defaults;\n    },\n\n    // 設定保存\n    save(settings) {\n        localStorage.setItem('appsuiteSettings', JSON.stringify(settings));\n    },\n\n    // タブ切り替え初期化\n    initTabs() {\n        document.querySelectorAll('.settings-tab').forEach(tab => {\n            tab.addEventListener('click', () => {\n                // タブのアクティブ状態を切り替え\n                document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('active'));\n                tab.classList.add('active');\n\n                // パネルの表示を切り替え\n                const tabName = tab.dataset.tab;\n                document.querySelectorAll('.settings-panel').forEach(p => p.classList.remove('active'));\n                document.getElementById('panel-' + tabName).classList.add('active');\n            });\n        });\n    },\n\n    // フォームに設定を反映\n    loadToForm() {\n        const settings = this.load();\n\n        // API設定\n        document.getElementById('apiUrl').value = settings.api?.url || '';\n        document.getElementById('apiKey').value = settings.api?.key || '';\n        document.getElementById('authMethod').value = settings.api?.authMethod || 'bearer';\n        document.getElementById('timeout').value = settings.api?.timeout || 30;\n        document.getElementById('syncInterval').value = settings.api?.syncInterval || 30;\n\n        // 基本設定\n        document.getElementById('systemName').value = settings.general?.systemName || 'AppSuite 管理運用システム';\n        document.getElementById('orgName').value = settings.general?.orgName || '';\n        document.getElementById('adminEmail').value = settings.general?.adminEmail || '';\n        document.getElementById('themeSelect').value = settings.general?.theme || 'light';\n        document.getElementById('langSelect').value = settings.general?.language || 'ja';\n        document.getElementById('dateFormat').value = settings.general?.dateFormat || 'yyyy-MM-dd';\n        document.getElementById('pageSize').value = settings.general?.pageSize || 25;\n\n        // 通知設定\n        document.getElementById('notifyIncidentNew').checked = settings.notification?.incidentNew !== false;\n        document.getElementById('notifyIncidentHigh').checked = settings.notification?.incidentHigh !== false;\n        document.getElementById('notifyChangeApproval').checked = settings.notification?.changeApproval !== false;\n        document.getElementById('notifyChangeComplete').checked = settings.notification?.changeComplete === true;\n        document.getElementById('smtpHost').value = settings.notification?.smtpHost || '';\n        document.getElementById('smtpPort').value = settings.notification?.smtpPort || 587;\n        document.getElementById('smtpUser').value = settings.notification?.smtpUser || '';\n        document.getElementById('smtpPass').value = settings.notification?.smtpPass || '';\n        document.getElementById('smtpSsl').checked = settings.notification?.smtpSsl !== false;\n\n        // セキュリティ設定\n        document.getElementById('pwMinLength').value = settings.security?.pwMinLength || 8;\n        document.getElementById('pwRequireUpper').checked = settings.security?.pwRequireUpper !== false;\n        document.getElementById('pwRequireNumber').checked = settings.security?.pwRequireNumber !== false;\n        document.getElementById('pwRequireSpecial').checked = settings.security?.pwRequireSpecial === true;\n        document.getElementById('pwExpireDays').value = settings.security?.pwExpireDays || 90;\n        document.getElementById('sessionTimeout').value = settings.security?.sessionTimeout || 30;\n        document.getElementById('maxSessions').value = settings.security?.maxSessions || 3;\n        document.getElementById('enableTwoFactor').checked = settings.security?.enableTwoFactor === true;\n        document.getElementById('maxLoginAttempts').value = settings.security?.maxLoginAttempts || 5;\n        document.getElementById('lockoutDuration').value = settings.security?.lockoutDuration || 15;\n\n        // ワークフロー設定\n        document.getElementById('incidentAutoAssign').checked = settings.workflow?.incidentAutoAssign === true;\n        document.getElementById('incidentDefaultAssignee').value = settings.workflow?.incidentDefaultAssignee || '';\n        document.getElementById('incidentEscalation').value = settings.workflow?.incidentEscalation || 24;\n        document.getElementById('changeRequireApproval').checked = settings.workflow?.changeRequireApproval !== false;\n        document.getElementById('changeApprover').value = settings.workflow?.changeApprover || 'manager';\n        document.getElementById('changeLeadTime').value = settings.workflow?.changeLeadTime || 3;\n        document.getElementById('allowSkipStatus').checked = settings.workflow?.allowSkipStatus === true;\n        document.getElementById('requireComment').checked = settings.workflow?.requireComment !== false;\n\n        // バックアップ設定（BackupManagerと連携）\n        if (typeof BackupManager !== 'undefined') {\n            BackupManager.updateAutoBackupUI();\n        } else {\n            document.getElementById('autoBackup').checked = settings.backup?.autoBackup !== false;\n            document.getElementById('backupInterval').value = settings.backup?.backupInterval || 'daily';\n            document.getElementById('backupRetention').value = settings.backup?.backupRetention || 7;\n        }\n\n        // バックアップ状態を更新\n        this.updateBackupStatus();\n    },\n\n    // API設定保存\n    saveApi() {\n        const settings = this.load();\n        settings.api = {\n            url: document.getElementById('apiUrl').value,\n            key: document.getElementById('apiKey').value,\n            authMethod: document.getElementById('authMethod').value,\n            timeout: parseInt(document.getElementById('timeout').value),\n            syncInterval: parseInt(document.getElementById('syncInterval').value)\n        };\n        this.save(settings);\n        showToast('API設定を保存しました', 'success');\n        LogModule.addLog('update', 'システム設定', 'system', 'API設定を更新');\n        if (window.ApiSync) {ApiSync.applySettings();}\n    },\n\n    // API接続テスト\n    testApi() {\n        const url = document.getElementById('apiUrl').value;\n        if (!url) {\n            showToast('APIのURLを入力してください', 'error');\n            return;\n        }\n\n        showToast('接続テスト中...', 'info');\n        // シミュレーション（実際の実装ではfetchを使用）\n        setTimeout(() => {\n            document.getElementById('apiStatus').textContent = '接続成功';\n            document.getElementById('apiStatus').className = 'status-value badge badge-success';\n            document.getElementById('lastSync').textContent = new Date().toLocaleString('ja-JP');\n            document.getElementById('apiVersion').textContent = 'V7.5';\n            showToast('API接続に成功しました', 'success');\n        }, 1500);\n    },\n\n    syncNow() {\n        if (window.ApiSync) {\n            ApiSync.syncAll();\n        }\n    },\n\n    // 基本設定保存\n    saveGeneral() {\n        const settings = this.load();\n        settings.general = {\n            systemName: document.getElementById('systemName').value,\n            orgName: document.getElementById('orgName').value,\n            adminEmail: document.getElementById('adminEmail').value,\n            theme: document.getElementById('themeSelect').value,\n            language: document.getElementById('langSelect').value,\n            dateFormat: document.getElementById('dateFormat').value,\n            pageSize: parseInt(document.getElementById('pageSize').value)\n        };\n        this.save(settings);\n\n        // システム名を反映\n        document.querySelector('.sidebar-header h1').innerHTML = '<i class=\"fas fa-cogs\"></i> ' + settings.general.systemName.substring(0, 15);\n\n        showToast('基本設定を保存しました', 'success');\n        LogModule.addLog('update', 'システム設定', 'system', '基本設定を更新');\n    },\n\n    // 基本設定リセット\n    resetGeneral() {\n        if (confirm('基本設定を初期値にリセットしますか？')) {\n            const settings = this.load();\n            settings.general = this.defaults.general;\n            this.save(settings);\n            this.loadToForm();\n            showToast('基本設定をリセットしました', 'success');\n        }\n    },\n\n    // 通知設定保存\n    saveNotification() {\n        const settings = this.load();\n        settings.notification = {\n            incidentNew: document.getElementById('notifyIncidentNew').checked,\n            incidentHigh: document.getElementById('notifyIncidentHigh').checked,\n            changeApproval: document.getElementById('notifyChangeApproval').checked,\n            changeComplete: document.getElementById('notifyChangeComplete').checked,\n            smtpHost: document.getElementById('smtpHost').value,\n            smtpPort: parseInt(document.getElementById('smtpPort').value),\n            smtpUser: document.getElementById('smtpUser').value,\n            smtpPass: document.getElementById('smtpPass').value,\n            smtpSsl: document.getElementById('smtpSsl').checked\n        };\n        this.save(settings);\n        showToast('通知設定を保存しました', 'success');\n        LogModule.addLog('update', 'システム設定', 'system', '通知設定を更新');\n    },\n\n    // テストメール送信\n    testEmail() {\n        const host = document.getElementById('smtpHost').value;\n        if (!host) {\n            showToast('SMTPホストを入力してください', 'error');\n            return;\n        }\n        showToast('テストメールを送信中...', 'info');\n        setTimeout(() => {\n            showToast('テストメールを送信しました', 'success');\n        }, 1500);\n    },\n\n    // セキュリティ設定保存\n    saveSecurity() {\n        const settings = this.load();\n        settings.security = {\n            pwMinLength: parseInt(document.getElementById('pwMinLength').value),\n            pwRequireUpper: document.getElementById('pwRequireUpper').checked,\n            pwRequireNumber: document.getElementById('pwRequireNumber').checked,\n            pwRequireSpecial: document.getElementById('pwRequireSpecial').checked,\n            pwExpireDays: parseInt(document.getElementById('pwExpireDays').value),\n            sessionTimeout: parseInt(document.getElementById('sessionTimeout').value),\n            maxSessions: parseInt(document.getElementById('maxSessions').value),\n            enableTwoFactor: document.getElementById('enableTwoFactor').checked,\n            maxLoginAttempts: parseInt(document.getElementById('maxLoginAttempts').value),\n            lockoutDuration: parseInt(document.getElementById('lockoutDuration').value)\n        };\n        this.save(settings);\n        showToast('セキュリティ設定を保存しました', 'success');\n        LogModule.addLog('update', 'システム設定', 'system', 'セキュリティ設定を更新');\n    },\n\n    // ワークフロー設定保存\n    saveWorkflow() {\n        const settings = this.load();\n        settings.workflow = {\n            incidentAutoAssign: document.getElementById('incidentAutoAssign').checked,\n            incidentDefaultAssignee: document.getElementById('incidentDefaultAssignee').value,\n            incidentEscalation: parseInt(document.getElementById('incidentEscalation').value),\n            changeRequireApproval: document.getElementById('changeRequireApproval').checked,\n            changeApprover: document.getElementById('changeApprover').value,\n            changeLeadTime: parseInt(document.getElementById('changeLeadTime').value),\n            allowSkipStatus: document.getElementById('allowSkipStatus').checked,\n            requireComment: document.getElementById('requireComment').checked\n        };\n        this.save(settings);\n        showToast('ワークフロー設定を保存しました', 'success');\n        LogModule.addLog('update', 'システム設定', 'system', 'ワークフロー設定を更新');\n    },\n\n    // バックアップ作成\n    createBackup() {\n        const data = {\n            version: '1.0.0',\n            timestamp: new Date().toISOString(),\n            settings: this.load(),\n            users: DataStore.users,\n            apps: DataStore.apps,\n            incidents: DataStore.incidents,\n            changes: DataStore.changes,\n            logs: DataStore.logs\n        };\n\n        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = 'appsuite_backup_' + new Date().toISOString().split('T')[0] + '.json';\n        a.click();\n\n        // バックアップ履歴を保存\n        const backups = JSON.parse(localStorage.getItem('backupHistory') || '[]');\n        backups.unshift({\n            date: new Date().toISOString(),\n            size: blob.size\n        });\n        localStorage.setItem('backupHistory', JSON.stringify(backups.slice(0, 10)));\n\n        this.updateBackupStatus();\n        showToast('バックアップを作成しました', 'success');\n        LogModule.addLog('export', 'バックアップ', 'system', 'データバックアップを作成');\n    },\n\n    // バックアップ状態更新\n    updateBackupStatus() {\n        const backups = JSON.parse(localStorage.getItem('backupHistory') || '[]');\n        document.getElementById('lastBackup').textContent = backups.length > 0\n            ? new Date(backups[0].date).toLocaleString('ja-JP')\n            : '-';\n        document.getElementById('backupCount').textContent = backups.length;\n\n        // データサイズを計算\n        const dataSize = new Blob([JSON.stringify({\n            settings: this.load(),\n            users: DataStore.users,\n            apps: DataStore.apps,\n            incidents: DataStore.incidents,\n            changes: DataStore.changes,\n            logs: DataStore.logs\n        })]).size;\n        document.getElementById('dataSize').textContent = this.formatBytes(dataSize);\n\n        // バックアップリスト表示\n        const listEl = document.getElementById('backupList');\n        if (backups.length > 0) {\n            listEl.innerHTML = backups.slice(0, 5).map(b => `\n                <div class=\"backup-item\">\n                    <span>${new Date(b.date).toLocaleString('ja-JP')}${b.type === 'auto' ? ' <small>(自動)</small>' : ''}</span>\n                    <span>${this.formatBytes(b.size)}</span>\n                </div>\n            `).join('');\n        } else {\n            listEl.innerHTML = '<p class=\"text-muted\">バックアップはありません</p>';\n        }\n\n        // 自動バックアップ状態表示\n        const autoBackupStatusEl = document.getElementById('autoBackupStatus');\n        if (autoBackupStatusEl && typeof BackupManager !== 'undefined') {\n            const stats = BackupManager.getStatistics();\n            if (stats.autoBackupEnabled) {\n                autoBackupStatusEl.innerHTML = '<span class=\"badge badge-success\">有効</span>';\n            } else {\n                autoBackupStatusEl.innerHTML = '<span class=\"badge badge-secondary\">無効</span>';\n            }\n        }\n    },\n\n    // バイト数フォーマット\n    formatBytes(bytes) {\n        if (bytes === 0) {return '0 Bytes';}\n        const k = 1024;\n        const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n        const i = Math.floor(Math.log(bytes) / Math.log(k));\n        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n    },\n\n    // リストア実行\n    restoreBackup() {\n        const fileInput = document.getElementById('restoreFile');\n        const file = fileInput.files[0];\n\n        if (!file) {\n            showToast('バックアップファイルを選択してください', 'error');\n            return;\n        }\n\n        if (!confirm('現在のデータは上書きされます。リストアを実行しますか？')) {\n            return;\n        }\n\n        const reader = new FileReader();\n        reader.onload = (e) => {\n            try {\n                const data = JSON.parse(e.target.result);\n\n                // データの復元\n                if (data.settings) {this.save(data.settings);}\n                if (data.users) {DataStore.users = data.users;}\n                if (data.apps) {DataStore.apps = data.apps;}\n                if (data.incidents) {DataStore.incidents = data.incidents;}\n                if (data.changes) {DataStore.changes = data.changes;}\n                if (data.logs) {DataStore.logs = data.logs;}\n\n                this.loadToForm();\n                refreshAllModules();\n                updateDashboard();\n\n                showToast('データをリストアしました', 'success');\n                LogModule.addLog('update', 'バックアップ', 'system', 'データリストアを実行');\n            } catch (error) {\n                showToast('バックアップファイルの読み込みに失敗しました', 'error');\n            }\n        };\n        reader.readAsText(file);\n    },\n\n    // データエクスポート\n    exportData() {\n        const data = {\n            exportDate: new Date().toISOString(),\n            users: DataStore.users,\n            apps: DataStore.apps,\n            incidents: DataStore.incidents,\n            changes: DataStore.changes\n        };\n\n        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = 'appsuite_data_' + new Date().toISOString().split('T')[0] + '.json';\n        a.click();\n\n        showToast('データをエクスポートしました', 'success');\n        LogModule.addLog('export', 'データ', 'system', 'データエクスポートを実行');\n    },\n\n    // データ初期化\n    clearData() {\n        if (!confirm('全てのデータを初期化しますか？この操作は取り消せません。')) {\n            return;\n        }\n        if (!confirm('本当に初期化してよろしいですか？')) {\n            return;\n        }\n\n        localStorage.removeItem('appsuiteSettings');\n        localStorage.removeItem('backupHistory');\n        DataStore.users = [];\n        DataStore.apps = [];\n        DataStore.incidents = [];\n        DataStore.changes = [];\n        DataStore.logs = [];\n\n        this.loadToForm();\n        refreshAllModules();\n        updateDashboard();\n\n        showToast('データを初期化しました', 'warning');\n    }\n};\n\n// 変更管理モジュール\nconst ChangeModule = {\n    refresh() {\n        this.render(DataStore.changes);\n    },\n\n    render(changes) {\n        const tbody = document.getElementById('changesTableBody');\n        tbody.innerHTML = changes.map(chg => `\n            <tr>\n                <td>${escapeHtml(chg.id)}</td>\n                <td>${escapeHtml(chg.title)}</td>\n                <td>${escapeHtml(chg.appName)}</td>\n                <td><span class=\"badge ${this.getTypeBadge(chg.type)}\">${this.getTypeText(chg.type)}</span></td>\n                <td><span class=\"badge ${this.getStatusBadge(chg.status)}\">${this.getStatusText(chg.status)}</span></td>\n                <td>${escapeHtml(chg.requester)}</td>\n                <td>${escapeHtml(chg.scheduled)}</td>\n                <td>\n                    <button class=\"action-btn view\" onclick=\"ChangeModule.view('${escapeHtml(chg.id)}')\" title=\"詳細\"><i class=\"fas fa-eye\"></i></button>\n                    <button class=\"action-btn edit\" onclick=\"ChangeModule.edit('${escapeHtml(chg.id)}')\" title=\"編集\"><i class=\"fas fa-edit\"></i></button>\n                    <button class=\"action-btn delete\" onclick=\"ChangeModule.delete('${escapeHtml(chg.id)}')\" title=\"削除\"><i class=\"fas fa-trash\"></i></button>\n                </td>\n            </tr>\n        `).join('');\n    },\n\n    getTypeBadge(type) {\n        const badges = { feature: 'badge-success', improvement: 'badge-info', modification: 'badge-warning', bugfix: 'badge-danger' };\n        return badges[type] || 'badge-secondary';\n    },\n\n    getTypeText(type) {\n        const texts = { feature: '新機能', improvement: '改善', modification: '変更', bugfix: 'バグ修正' };\n        return texts[type] || type;\n    },\n\n    getStatusBadge(status) {\n        const badges = { draft: 'badge-secondary', pending: 'badge-warning', approved: 'badge-info', in_progress: 'badge-primary', completed: 'badge-success', rejected: 'badge-danger' };\n        return badges[status] || 'badge-secondary';\n    },\n\n    getStatusText(status) {\n        const texts = { draft: '下書き', pending: '申請中', approved: '承認済', in_progress: '実施中', completed: '完了', rejected: '却下' };\n        return texts[status] || status;\n    },\n\n    showAddModal() {\n        const appOptions = DataStore.apps.map(a => `<option value=\"${a.id}\" data-name=\"${a.name}\">${a.name}</option>`).join('');\n\n        openModal('変更要求登録', `\n            <div class=\"form-group\">\n                <label>タイトル</label>\n                <input type=\"text\" id=\"newChgTitle\" required>\n            </div>\n            <div class=\"form-group\">\n                <label>対象アプリ</label>\n                <select id=\"newChgApp\">\n                    ${appOptions}\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>変更種別</label>\n                <select id=\"newChgType\">\n                    <option value=\"feature\">新機能</option>\n                    <option value=\"improvement\">改善</option>\n                    <option value=\"modification\">変更</option>\n                    <option value=\"bugfix\">バグ修正</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>実施予定日</label>\n                <input type=\"date\" id=\"newChgScheduled\">\n            </div>\n            <div class=\"form-group\">\n                <label>説明</label>\n                <textarea id=\"newChgDesc\" rows=\"3\" style=\"width:100%;padding:10px;border:1px solid #e2e8f0;border-radius:8px;\"></textarea>\n            </div>\n        `, [\n            { text: 'キャンセル', class: 'btn-secondary', onclick: 'closeModal()' },\n            { text: '登録', class: 'btn-primary', onclick: 'ChangeModule.add()' }\n        ]);\n    },\n\n    add() {\n        const appSelect = document.getElementById('newChgApp');\n        const selectedOption = appSelect.options[appSelect.selectedIndex];\n        const newChg = {\n            id: 'CHG' + String(DataStore.changes.length + 1).padStart(3, '0'),\n            title: document.getElementById('newChgTitle').value,\n            appId: appSelect.value,\n            appName: selectedOption.dataset.name,\n            type: document.getElementById('newChgType').value,\n            status: 'draft',\n            requester: document.getElementById('currentUser').textContent,\n            scheduled: document.getElementById('newChgScheduled').value || '-',\n            description: document.getElementById('newChgDesc').value\n        };\n        DataStore.changes.push(newChg);\n        this.refresh();\n        closeModal();\n        showToast('変更要求を登録しました', 'success');\n        LogModule.addLog('create', '変更要求', 'change', '新規変更要求登録: ' + newChg.title);\n        updateDashboard();\n    },\n\n    view(id) {\n        const chg = DataStore.changes.find(c => c.id === id);\n        openModal('変更要求詳細: ' + chg.id, `\n            <div style=\"line-height: 2;\">\n                <p><strong>変更ID:</strong> ${chg.id}</p>\n                <p><strong>タイトル:</strong> ${chg.title}</p>\n                <p><strong>対象アプリ:</strong> ${chg.appName}</p>\n                <p><strong>変更種別:</strong> <span class=\"badge ${this.getTypeBadge(chg.type)}\">${this.getTypeText(chg.type)}</span></p>\n                <p><strong>ステータス:</strong> <span class=\"badge ${this.getStatusBadge(chg.status)}\">${this.getStatusText(chg.status)}</span></p>\n                <p><strong>依頼者:</strong> ${chg.requester}</p>\n                <p><strong>実施予定日:</strong> ${chg.scheduled}</p>\n                <p><strong>説明:</strong></p>\n                <p style=\"background:#f8fafc;padding:10px;border-radius:8px;\">${chg.description || '（なし）'}</p>\n            </div>\n        `, [\n            { text: '閉じる', class: 'btn-secondary', onclick: 'closeModal()' }\n        ]);\n    },\n\n    edit(id) {\n        const chg = DataStore.changes.find(c => c.id === id);\n        const appOptions = DataStore.apps.map(a => `<option value=\"${a.id}\" data-name=\"${a.name}\" ${a.id === chg.appId ? 'selected' : ''}>${a.name}</option>`).join('');\n\n        openModal('変更要求編集: ' + chg.id, `\n            <div class=\"form-group\">\n                <label>タイトル</label>\n                <input type=\"text\" id=\"editChgTitle\" value=\"${chg.title}\">\n            </div>\n            <div class=\"form-group\">\n                <label>対象アプリ</label>\n                <select id=\"editChgApp\">\n                    ${appOptions}\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>変更種別</label>\n                <select id=\"editChgType\">\n                    <option value=\"feature\" ${chg.type === 'feature' ? 'selected' : ''}>新機能</option>\n                    <option value=\"improvement\" ${chg.type === 'improvement' ? 'selected' : ''}>改善</option>\n                    <option value=\"modification\" ${chg.type === 'modification' ? 'selected' : ''}>変更</option>\n                    <option value=\"bugfix\" ${chg.type === 'bugfix' ? 'selected' : ''}>バグ修正</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>ステータス</label>\n                <select id=\"editChgStatus\">\n                    <option value=\"draft\" ${chg.status === 'draft' ? 'selected' : ''}>下書き</option>\n                    <option value=\"pending\" ${chg.status === 'pending' ? 'selected' : ''}>申請中</option>\n                    <option value=\"approved\" ${chg.status === 'approved' ? 'selected' : ''}>承認済</option>\n                    <option value=\"in_progress\" ${chg.status === 'in_progress' ? 'selected' : ''}>実施中</option>\n                    <option value=\"completed\" ${chg.status === 'completed' ? 'selected' : ''}>完了</option>\n                    <option value=\"rejected\" ${chg.status === 'rejected' ? 'selected' : ''}>却下</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label>実施予定日</label>\n                <input type=\"date\" id=\"editChgScheduled\" value=\"${chg.scheduled !== '-' ? chg.scheduled : ''}\">\n            </div>\n            <div class=\"form-group\">\n                <label>説明</label>\n                <textarea id=\"editChgDesc\" rows=\"3\" style=\"width:100%;padding:10px;border:1px solid #e2e8f0;border-radius:8px;\">${chg.description || ''}</textarea>\n            </div>\n        `, [\n            { text: 'キャンセル', class: 'btn-secondary', onclick: 'closeModal()' },\n            { text: '保存', class: 'btn-primary', onclick: `ChangeModule.save('${id}')` }\n        ]);\n    },\n\n    save(id) {\n        const chg = DataStore.changes.find(c => c.id === id);\n        const appSelect = document.getElementById('editChgApp');\n        const selectedOption = appSelect.options[appSelect.selectedIndex];\n        const nextStatus = document.getElementById('editChgStatus').value;\n\n        // ステータス遷移検証（WorkflowEngineが利用可能な場合）\n        if (typeof WorkflowEngine !== 'undefined') {\n            const result = WorkflowEngine.isValidChangeTransition(chg.status, nextStatus);\n            if (!result.valid) {\n                showToast(result.message, 'error');\n                return;\n            }\n        }\n\n        // 変更前の値を保存（通知用）\n        const oldStatus = chg.status;\n\n        // 値を更新\n        chg.title = document.getElementById('editChgTitle').value;\n        chg.appId = appSelect.value;\n        chg.appName = selectedOption.dataset.name;\n        chg.type = document.getElementById('editChgType').value;\n        chg.status = nextStatus;\n        chg.scheduled = document.getElementById('editChgScheduled').value || '-';\n        chg.description = document.getElementById('editChgDesc').value;\n        chg.updatedAt = new Date().toISOString();\n\n        this.refresh();\n        closeModal();\n        showToast('変更要求を更新しました', 'success');\n        LogModule.addLog('update', '変更要求', 'change', '変更要求更新: ' + chg.title);\n        updateDashboard();\n\n        // 通知トリガー\n        if (typeof NotificationManager !== 'undefined' && oldStatus !== nextStatus) {\n            // 承認待ちになった場合\n            if (nextStatus === 'pending') {\n                NotificationManager.notifyChangeApproval(chg);\n            }\n            // 承認または却下された場合\n            if (nextStatus === 'approved' || nextStatus === 'rejected') {\n                NotificationManager.notifyChangeDecision(chg, nextStatus);\n            }\n            // その他のステータス変更\n            NotificationManager.notifyStatusChange(chg, 'change', nextStatus);\n        }\n    },\n\n    delete(id) {\n        const chg = DataStore.changes.find(c => c.id === id);\n        if (confirm(`変更要求「${chg.title}」を削除しますか？`)) {\n            const idx = DataStore.changes.findIndex(c => c.id === id);\n            DataStore.changes.splice(idx, 1);\n            this.refresh();\n            showToast('変更要求を削除しました', 'success');\n            LogModule.addLog('delete', '変更要求', 'change', '変更要求削除: ' + chg.title);\n            updateDashboard();\n        }\n    },\n\n    filter() {\n        const search = document.getElementById('changeSearch').value.toLowerCase();\n        const type = document.getElementById('changeTypeFilter').value;\n        const status = document.getElementById('changeStatusFilter').value;\n\n        let filtered = DataStore.changes;\n\n        if (search) {\n            filtered = filtered.filter(c =>\n                c.title.toLowerCase().includes(search) ||\n                (c.description || '').toLowerCase().includes(search)\n            );\n        }\n        if (type) {\n            filtered = filtered.filter(c => c.type === type);\n        }\n        if (status) {\n            filtered = filtered.filter(c => c.status === status);\n        }\n\n        this.render(filtered);\n    }\n};\n","usedDeprecatedRules":[{"ruleId":"semi","replacedBy":[]},{"ruleId":"quotes","replacedBy":[]},{"ruleId":"indent","replacedBy":[]},{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/runner/work/Appsuite-ITSM-Management/Appsuite-ITSM-Management/WebUI-Sample/js/notification.js","messages":[{"ruleId":"no-undef","severity":1,"message":"'WorkflowEngine' is not defined.","line":657,"column":24,"nodeType":"Identifier","messageId":"undef","endLine":657,"endColumn":38},{"ruleId":"no-undef","severity":1,"message":"'WorkflowEngine' is not defined.","line":659,"column":24,"nodeType":"Identifier","messageId":"undef","endLine":659,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * NotificationManager - 通知システム\n *\n * ブラウザ通知API統合、通知履歴管理、UIレンダリングを担当\n *\n * @version 1.0.0\n * @since Sprint 3\n */\n\nconst NotificationManager = {\n    // ========================================\n    // 設定定数\n    // ========================================\n\n    /** 通知履歴のlocalStorageキー */\n    STORAGE_KEY: 'appsuite_notifications',\n\n    /** 通知履歴の最大保持数 */\n    MAX_HISTORY: 100,\n\n    /** 通知パネルが開いているか */\n    isPanelOpen: false,\n\n    /** ブラウザ通知の許可状態 */\n    permission: null,\n\n    /** 通知履歴 */\n    history: [],\n\n    /** 初期化済みフラグ */\n    initialized: false,\n\n    /** 最後の通知ID（重複防止用） */\n    lastNotificationIds: new Set(),\n\n    // ========================================\n    // 初期化・クリーンアップ\n    // ========================================\n\n    /**\n     * 通知システムを初期化\n     */\n    init() {\n        if (this.initialized) {\n            console.warn('NotificationManager: 既に初期化されています');\n            return;\n        }\n\n        console.log('NotificationManager: 初期化開始');\n\n        // 履歴を読み込み\n        this.loadHistory();\n\n        // ブラウザ通知のサポート確認\n        if ('Notification' in window) {\n            this.permission = Notification.permission;\n        } else {\n            this.permission = 'unsupported';\n        }\n\n        // 通知ベルをレンダリング\n        this.renderNotificationBell();\n\n        this.initialized = true;\n        console.log('NotificationManager: 初期化完了（権限: ' + this.permission + '）');\n    },\n\n    /**\n     * クリーンアップ処理\n     */\n    cleanup() {\n        this.saveHistory();\n        this.initialized = false;\n        console.log('NotificationManager: クリーンアップ完了');\n    },\n\n    // ========================================\n    // 権限管理\n    // ========================================\n\n    /**\n     * ブラウザ通知の許可をリクエスト\n     * @returns {Promise<string>} 許可状態\n     */\n    async requestPermission() {\n        if (!('Notification' in window)) {\n            if (typeof showToast === 'function') {\n                showToast('このブラウザはデスクトップ通知をサポートしていません', 'warning');\n            }\n            return 'unsupported';\n        }\n\n        try {\n            const result = await Notification.requestPermission();\n            this.permission = result;\n\n            if (typeof showToast === 'function') {\n                if (result === 'granted') {\n                    showToast('デスクトップ通知が有効になりました', 'success');\n                } else if (result === 'denied') {\n                    showToast('通知が拒否されました。ブラウザの設定から変更できます。', 'warning');\n                }\n            }\n\n            return result;\n        } catch (error) {\n            console.error('NotificationManager: 権限リクエストエラー', error);\n            return 'error';\n        }\n    },\n\n    // ========================================\n    // 通知送信\n    // ========================================\n\n    /**\n     * 通知を送信（汎用）\n     * @param {Object} options - 通知オプション\n     * @param {string} options.title - タイトル\n     * @param {string} options.body - 本文\n     * @param {string} options.type - 通知タイプ\n     * @param {string} [options.icon] - アイコンURL\n     * @param {Object} [options.data] - 追加データ\n     * @param {boolean} [options.silent=false] - Toastを表示しない\n     */\n    send(options) {\n        const { title, body, type, icon, data, silent = false } = options;\n\n        // 設定チェック\n        if (!this.isEnabled(type)) {\n            return;\n        }\n\n        // 重複チェック（同じIDの通知を短時間で繰り返さない）\n        const notificationKey = `${type}_${data?.id || ''}_${Math.floor(Date.now() / 60000)}`;\n        if (this.lastNotificationIds.has(notificationKey)) {\n            return;\n        }\n        this.lastNotificationIds.add(notificationKey);\n\n        // 古いキーを削除（最大50件保持）\n        if (this.lastNotificationIds.size > 50) {\n            const iterator = this.lastNotificationIds.values();\n            this.lastNotificationIds.delete(iterator.next().value);\n        }\n\n        // 通知オブジェクトを作成\n        const notification = {\n            id: this.generateId(),\n            title,\n            body,\n            type,\n            data: data || {},\n            timestamp: new Date().toISOString(),\n            read: false\n        };\n\n        // 履歴に追加\n        this.addToHistory(notification);\n\n        // ブラウザ通知を送信\n        if (this.permission === 'granted') {\n            try {\n                const browserNotif = new Notification(title, {\n                    body,\n                    icon: icon || '/favicon.ico',\n                    tag: notification.id,\n                    requireInteraction: type === 'high_priority' || type === 'sla_violation'\n                });\n\n                browserNotif.onclick = () => {\n                    window.focus();\n                    if (data?.section && typeof showSection === 'function') {\n                        showSection(data.section);\n                    }\n                    browserNotif.close();\n                };\n\n                // 自動クローズ（5秒後）\n                setTimeout(() => browserNotif.close(), 5000);\n            } catch (error) {\n                console.error('NotificationManager: ブラウザ通知送信エラー', error);\n            }\n        }\n\n        // Toast表示\n        if (!silent && typeof showToast === 'function') {\n            const toastType = this.getToastType(type);\n            showToast(body, toastType, 5000);\n        }\n\n        // UI更新\n        this.renderNotificationBell();\n    },\n\n    /**\n     * 通知タイプからToastタイプを取得\n     * @param {string} type - 通知タイプ\n     * @returns {string} Toastタイプ\n     */\n    getToastType(type) {\n        switch (type) {\n        case 'sla_violation':\n        case 'high_priority':\n        case 'escalation':\n            return 'error';\n        case 'sla_warning':\n            return 'warning';\n        case 'change_approved':\n        case 'incident_resolved':\n            return 'success';\n        default:\n            return 'info';\n        }\n    },\n\n    // ========================================\n    // 通知トリガー\n    // ========================================\n\n    /**\n     * 新規インシデント通知\n     * @param {Object} incident - インシデントオブジェクト\n     */\n    notifyIncidentCreated(incident) {\n        this.send({\n            title: '新規インシデント',\n            body: `${incident.id}: ${incident.title}`,\n            type: 'incident_new',\n            data: { section: 'incidents', id: incident.id }\n        });\n    },\n\n    /**\n     * 高優先度インシデント通知\n     * @param {Object} incident - インシデントオブジェクト\n     */\n    notifyHighPriorityIncident(incident) {\n        this.send({\n            title: '緊急: 高優先度インシデント',\n            body: `${incident.id}: ${incident.title}`,\n            type: 'high_priority',\n            data: { section: 'incidents', id: incident.id }\n        });\n    },\n\n    /**\n     * 担当者割当通知\n     * @param {Object} incident - インシデントオブジェクト\n     */\n    notifyAssignment(incident) {\n        this.send({\n            title: 'インシデント割当',\n            body: `${incident.id} が ${incident.assignee} に割り当てられました`,\n            type: 'assignment',\n            data: { section: 'incidents', id: incident.id }\n        });\n    },\n\n    /**\n     * ステータス変更通知\n     * @param {Object} item - アイテムオブジェクト\n     * @param {string} type - 'incident' または 'change'\n     * @param {string} newStatus - 新しいステータス\n     */\n    notifyStatusChange(item, type, newStatus) {\n        const typeLabel = type === 'incident' ? 'インシデント' : '変更要求';\n        const statusLabel = this.getStatusLabel(type, newStatus);\n\n        this.send({\n            title: `${typeLabel}ステータス更新`,\n            body: `${item.id}: ${statusLabel}`,\n            type: `${type}_status_change`,\n            data: { section: type === 'incident' ? 'incidents' : 'changes', id: item.id }\n        });\n    },\n\n    /**\n     * SLA警告通知\n     * @param {Array} incidents - 警告対象のインシデント配列\n     */\n    notifySlaWarning(incidents) {\n        if (incidents.length === 0) {return;}\n\n        this.send({\n            title: 'SLA警告',\n            body: `${incidents.length}件のインシデントがSLA期限に近づいています`,\n            type: 'sla_warning',\n            data: { section: 'incidents', ids: incidents.map(i => i.id) }\n        });\n    },\n\n    /**\n     * SLA違反通知\n     * @param {Array} incidents - 違反インシデント配列\n     */\n    notifySlaViolation(incidents) {\n        if (incidents.length === 0) {return;}\n\n        this.send({\n            title: 'SLA違反',\n            body: `${incidents.length}件のインシデントがSLAを超過しています`,\n            type: 'sla_violation',\n            data: { section: 'incidents', ids: incidents.map(i => i.id) }\n        });\n    },\n\n    /**\n     * 変更要求承認依頼通知\n     * @param {Object} change - 変更要求オブジェクト\n     */\n    notifyChangeApproval(change) {\n        this.send({\n            title: '承認依頼',\n            body: `${change.id}: ${change.title} の承認が必要です`,\n            type: 'change_approval',\n            data: { section: 'changes', id: change.id }\n        });\n    },\n\n    /**\n     * 変更要求承認完了通知\n     * @param {Object} change - 変更要求オブジェクト\n     * @param {string} decision - 'approved' または 'rejected'\n     */\n    notifyChangeDecision(change, decision) {\n        const isApproved = decision === 'approved';\n\n        this.send({\n            title: isApproved ? '変更要求承認' : '変更要求却下',\n            body: `${change.id}: ${change.title}`,\n            type: isApproved ? 'change_approved' : 'change_rejected',\n            data: { section: 'changes', id: change.id }\n        });\n    },\n\n    /**\n     * エスカレーション通知\n     * @param {Object} incident - インシデントオブジェクト\n     */\n    notifyEscalation(incident) {\n        this.send({\n            title: 'エスカレーション',\n            body: `${incident.id}: ${incident.title} がエスカレートされました`,\n            type: 'escalation',\n            data: { section: 'incidents', id: incident.id }\n        });\n    },\n\n    // ========================================\n    // 履歴管理\n    // ========================================\n\n    /**\n     * 履歴を読み込み\n     */\n    loadHistory() {\n        try {\n            const saved = localStorage.getItem(this.STORAGE_KEY);\n            this.history = saved ? JSON.parse(saved) : [];\n        } catch (error) {\n            console.error('NotificationManager: 履歴読み込みエラー', error);\n            this.history = [];\n        }\n    },\n\n    /**\n     * 履歴を保存\n     */\n    saveHistory() {\n        try {\n            localStorage.setItem(this.STORAGE_KEY, JSON.stringify(this.history));\n        } catch (error) {\n            console.error('NotificationManager: 履歴保存エラー', error);\n        }\n    },\n\n    /**\n     * 履歴に追加\n     * @param {Object} notification - 通知オブジェクト\n     */\n    addToHistory(notification) {\n        this.history.unshift(notification);\n\n        // 上限を超えたら古いものを削除\n        if (this.history.length > this.MAX_HISTORY) {\n            this.history = this.history.slice(0, this.MAX_HISTORY);\n        }\n\n        this.saveHistory();\n    },\n\n    /**\n     * 履歴を取得\n     * @param {Object} [filter] - フィルタ条件\n     * @returns {Array} 通知履歴\n     */\n    getHistory(filter = {}) {\n        let result = [...this.history];\n\n        if (filter.type) {\n            result = result.filter(n => n.type === filter.type);\n        }\n\n        if (filter.unreadOnly) {\n            result = result.filter(n => !n.read);\n        }\n\n        if (filter.limit) {\n            result = result.slice(0, filter.limit);\n        }\n\n        return result;\n    },\n\n    /**\n     * 履歴をクリア\n     */\n    clearHistory() {\n        this.history = [];\n        this.saveHistory();\n        this.renderNotificationBell();\n\n        if (typeof showToast === 'function') {\n            showToast('通知履歴をクリアしました', 'success');\n        }\n    },\n\n    /**\n     * 通知を既読にする\n     * @param {string} id - 通知ID\n     */\n    markAsRead(id) {\n        const notification = this.history.find(n => n.id === id);\n        if (notification) {\n            notification.read = true;\n            this.saveHistory();\n            this.renderNotificationBell();\n        }\n    },\n\n    /**\n     * すべての通知を既読にする\n     */\n    markAllAsRead() {\n        this.history.forEach(n => n.read = true);\n        this.saveHistory();\n        this.renderNotificationBell();\n    },\n\n    /**\n     * 未読数を取得\n     * @returns {number} 未読数\n     */\n    getUnreadCount() {\n        return this.history.filter(n => !n.read).length;\n    },\n\n    // ========================================\n    // UI\n    // ========================================\n\n    /**\n     * 通知ベルをレンダリング\n     */\n    renderNotificationBell() {\n        const bellElement = document.getElementById('notificationBell');\n        if (!bellElement) {return;}\n\n        const unread = this.getUnreadCount();\n        let badge = bellElement.querySelector('.notification-badge');\n\n        if (!badge) {\n            badge = document.createElement('span');\n            badge.className = 'notification-badge';\n            bellElement.appendChild(badge);\n        }\n\n        badge.textContent = unread > 99 ? '99+' : unread;\n        badge.style.display = unread > 0 ? 'flex' : 'none';\n    },\n\n    /**\n     * 通知パネルを開く\n     */\n    openNotificationPanel() {\n        // 既存のパネルがあれば削除\n        const existingPanel = document.getElementById('notificationPanel');\n        if (existingPanel) {\n            existingPanel.remove();\n            this.isPanelOpen = false;\n            return;\n        }\n\n        // 権限がない場合はリクエスト\n        if (this.permission === 'default') {\n            this.requestPermission();\n        }\n\n        // パネルを作成\n        const panel = document.createElement('div');\n        panel.id = 'notificationPanel';\n        panel.className = 'notification-panel';\n\n        const notifications = this.getHistory({ limit: 20 });\n\n        panel.innerHTML = `\n            <div class=\"notification-panel-header\">\n                <h3>通知</h3>\n                <div class=\"notification-panel-actions\">\n                    <button class=\"btn btn-sm\" onclick=\"NotificationManager.markAllAsRead()\">\n                        <i class=\"fas fa-check-double\"></i> すべて既読\n                    </button>\n                    <button class=\"btn btn-sm\" onclick=\"NotificationManager.clearHistory()\">\n                        <i class=\"fas fa-trash\"></i>\n                    </button>\n                    <button class=\"btn btn-sm\" onclick=\"NotificationManager.closeNotificationPanel()\">\n                        <i class=\"fas fa-times\"></i>\n                    </button>\n                </div>\n            </div>\n            <div class=\"notification-panel-body\">\n                ${notifications.length === 0\n        ? '<p class=\"notification-empty\">通知はありません</p>'\n        : notifications.map(n => this.renderNotificationItem(n)).join('')\n}\n            </div>\n            <div class=\"notification-panel-footer\">\n                ${this.permission !== 'granted'\n        ? `<button class=\"btn btn-primary btn-sm\" onclick=\"NotificationManager.requestPermission()\">\n                        <i class=\"fas fa-bell\"></i> デスクトップ通知を有効化\n                       </button>`\n        : '<span class=\"text-muted\"><i class=\"fas fa-check\"></i> デスクトップ通知: 有効</span>'\n}\n            </div>\n        `;\n\n        // ベルボタンの位置を基準にパネルを配置\n        const bellElement = document.getElementById('notificationBell');\n        if (bellElement) {\n            const rect = bellElement.getBoundingClientRect();\n            panel.style.position = 'fixed';\n            panel.style.top = (rect.bottom + 10) + 'px';\n            panel.style.right = '20px';\n        }\n\n        document.body.appendChild(panel);\n        this.isPanelOpen = true;\n\n        // パネル外クリックで閉じる\n        setTimeout(() => {\n            document.addEventListener('click', this.handleOutsideClick);\n        }, 100);\n    },\n\n    /**\n     * 通知パネルを閉じる\n     */\n    closeNotificationPanel() {\n        const panel = document.getElementById('notificationPanel');\n        if (panel) {\n            panel.remove();\n        }\n        this.isPanelOpen = false;\n        document.removeEventListener('click', this.handleOutsideClick);\n    },\n\n    /**\n     * パネル外クリックハンドラ\n     * @param {Event} event - クリックイベント\n     */\n    handleOutsideClick(event) {\n        const panel = document.getElementById('notificationPanel');\n        const bell = document.getElementById('notificationBell');\n\n        if (panel && !panel.contains(event.target) && !bell?.contains(event.target)) {\n            NotificationManager.closeNotificationPanel();\n        }\n    },\n\n    /**\n     * 通知アイテムをレンダリング\n     * @param {Object} notification - 通知オブジェクト\n     * @returns {string} HTML文字列\n     */\n    renderNotificationItem(notification) {\n        const icon = this.getNotificationIcon(notification.type);\n        const timeAgo = this.formatTimeAgo(notification.timestamp);\n        const readClass = notification.read ? 'read' : 'unread';\n\n        return `\n            <div class=\"notification-item ${readClass}\" onclick=\"NotificationManager.handleNotificationClick('${notification.id}')\">\n                <div class=\"notification-icon ${notification.type}\">\n                    <i class=\"fas ${icon}\"></i>\n                </div>\n                <div class=\"notification-content\">\n                    <div class=\"notification-title\">${this.escapeHtml(notification.title)}</div>\n                    <div class=\"notification-body\">${this.escapeHtml(notification.body)}</div>\n                    <div class=\"notification-time\">${timeAgo}</div>\n                </div>\n            </div>\n        `;\n    },\n\n    /**\n     * 通知クリックハンドラ\n     * @param {string} id - 通知ID\n     */\n    handleNotificationClick(id) {\n        const notification = this.history.find(n => n.id === id);\n        if (!notification) {return;}\n\n        // 既読にする\n        this.markAsRead(id);\n\n        // セクションに移動\n        if (notification.data?.section && typeof showSection === 'function') {\n            showSection(notification.data.section);\n        }\n\n        // パネルを閉じる\n        this.closeNotificationPanel();\n    },\n\n    /**\n     * 通知アイコンを取得\n     * @param {string} type - 通知タイプ\n     * @returns {string} アイコンクラス\n     */\n    getNotificationIcon(type) {\n        const icons = {\n            incident_new: 'fa-exclamation-circle',\n            high_priority: 'fa-fire',\n            assignment: 'fa-user-check',\n            incident_status_change: 'fa-exchange-alt',\n            change_status_change: 'fa-exchange-alt',\n            sla_warning: 'fa-clock',\n            sla_violation: 'fa-exclamation-triangle',\n            change_approval: 'fa-clipboard-check',\n            change_approved: 'fa-check-circle',\n            change_rejected: 'fa-times-circle',\n            escalation: 'fa-arrow-up'\n        };\n\n        return icons[type] || 'fa-bell';\n    },\n\n    /**\n     * ステータスラベルを取得\n     * @param {string} type - 'incident' または 'change'\n     * @param {string} status - ステータス値\n     * @returns {string} ステータスラベル\n     */\n    getStatusLabel(type, status) {\n        if (typeof WorkflowEngine !== 'undefined') {\n            if (type === 'incident') {\n                return WorkflowEngine.INCIDENT_STATUS_LABELS[status] || status;\n            } else {\n                return WorkflowEngine.CHANGE_STATUS_LABELS[status] || status;\n            }\n        }\n        return status;\n    },\n\n    // ========================================\n    // 設定連携\n    // ========================================\n\n    /**\n     * 通知タイプが有効かチェック\n     * @param {string} type - 通知タイプ\n     * @returns {boolean} 有効かどうか\n     */\n    isEnabled(type) {\n        // SettingsModuleが利用可能な場合は設定をチェック\n        if (typeof SettingsModule !== 'undefined') {\n            const settings = SettingsModule.load();\n            const notification = settings.notification || {};\n\n            // タイプ別の設定マッピング\n            const settingMap = {\n                incident_new: notification.notifyIncidentNew !== false,\n                high_priority: notification.notifyIncidentHigh !== false,\n                sla_warning: notification.notifyIncidentNew !== false,\n                sla_violation: notification.notifyIncidentNew !== false,\n                change_approval: notification.notifyChangeApproval !== false,\n                change_approved: notification.notifyChangeComplete !== false,\n                change_rejected: notification.notifyChangeComplete !== false,\n                escalation: notification.notifyIncidentNew !== false\n            };\n\n            return settingMap[type] !== false;\n        }\n\n        // SettingsModuleがない場合はすべて有効\n        return true;\n    },\n\n    // ========================================\n    // ユーティリティ\n    // ========================================\n\n    /**\n     * ユニークIDを生成\n     * @returns {string} ID\n     */\n    generateId() {\n        return 'notif_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\n    },\n\n    /**\n     * 相対時間をフォーマット\n     * @param {string} timestamp - タイムスタンプ\n     * @returns {string} 相対時間\n     */\n    formatTimeAgo(timestamp) {\n        const now = new Date();\n        const date = new Date(timestamp);\n        const diffMs = now.getTime() - date.getTime();\n        const diffMins = Math.floor(diffMs / 60000);\n        const diffHours = Math.floor(diffMs / 3600000);\n        const diffDays = Math.floor(diffMs / 86400000);\n\n        if (diffMins < 1) {\n            return 'たった今';\n        } else if (diffMins < 60) {\n            return `${diffMins}分前`;\n        } else if (diffHours < 24) {\n            return `${diffHours}時間前`;\n        } else if (diffDays < 7) {\n            return `${diffDays}日前`;\n        } else {\n            return date.toLocaleDateString('ja-JP');\n        }\n    },\n\n    /**\n     * HTMLエスケープ\n     * @param {string} str - 文字列\n     * @returns {string} エスケープされた文字列\n     */\n    escapeHtml(str) {\n        if (typeof str !== 'string') {return '';}\n        return str\n            .replace(/&/g, '&amp;')\n            .replace(/</g, '&lt;')\n            .replace(/>/g, '&gt;')\n            .replace(/\"/g, '&quot;')\n            .replace(/'/g, '&#039;');\n    }\n};\n\n// グローバルに公開\nwindow.NotificationManager = NotificationManager;\n","usedDeprecatedRules":[{"ruleId":"semi","replacedBy":[]},{"ruleId":"quotes","replacedBy":[]},{"ruleId":"indent","replacedBy":[]},{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/runner/work/Appsuite-ITSM-Management/Appsuite-ITSM-Management/WebUI-Sample/js/performance.js","messages":[{"ruleId":"no-undef","severity":1,"message":"'ApiConfig' is not defined.","line":242,"column":60,"nodeType":"Identifier","messageId":"undef","endLine":242,"endColumn":69},{"ruleId":"no-undef","severity":1,"message":"'ApiConfig' is not defined.","line":243,"column":80,"nodeType":"Identifier","messageId":"undef","endLine":243,"endColumn":89},{"ruleId":"no-undef","severity":1,"message":"'ApiConfig' is not defined.","line":335,"column":49,"nodeType":"Identifier","messageId":"undef","endLine":335,"endColumn":58},{"ruleId":"no-undef","severity":1,"message":"'ApiConfig' is not defined.","line":336,"column":21,"nodeType":"Identifier","messageId":"undef","endLine":336,"endColumn":30},{"ruleId":"no-undef","severity":1,"message":"'ApiConfig' is not defined.","line":338,"column":54,"nodeType":"Identifier","messageId":"undef","endLine":338,"endColumn":63},{"ruleId":"no-undef","severity":1,"message":"'ApiConfig' is not defined.","line":341,"column":58,"nodeType":"Identifier","messageId":"undef","endLine":341,"endColumn":67},{"ruleId":"no-undef","severity":1,"message":"'ApiConfig' is not defined.","line":344,"column":40,"nodeType":"Identifier","messageId":"undef","endLine":344,"endColumn":49}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AppSuite ITSM管理システム - パフォーマンス最適化モジュール\n * Sprint 5: API強化、キャッシュ、遅延読み込み、メトリクス\n */\n\n// ========================================\n// APIキャッシュマネージャー\n// ========================================\nconst ApiCache = {\n    cache: new Map(),\n    maxAge: 5 * 60 * 1000, // デフォルト5分\n    maxSize: 100, // 最大キャッシュエントリ数\n\n    /**\n     * キャッシュからデータを取得\n     */\n    get(key) {\n        const entry = this.cache.get(key);\n        if (!entry) {return null;}\n\n        // 有効期限チェック\n        if (Date.now() > entry.expiresAt) {\n            this.cache.delete(key);\n            return null;\n        }\n\n        entry.hits++;\n        return entry.data;\n    },\n\n    /**\n     * キャッシュにデータを保存\n     */\n    set(key, data, ttl = this.maxAge) {\n        // キャッシュサイズ制限\n        if (this.cache.size >= this.maxSize) {\n            this.evictOldest();\n        }\n\n        this.cache.set(key, {\n            data,\n            createdAt: Date.now(),\n            expiresAt: Date.now() + ttl,\n            hits: 0\n        });\n    },\n\n    /**\n     * キャッシュを無効化\n     */\n    invalidate(keyPattern) {\n        if (typeof keyPattern === 'string') {\n            this.cache.delete(keyPattern);\n        } else if (keyPattern instanceof RegExp) {\n            for (const key of this.cache.keys()) {\n                if (keyPattern.test(key)) {\n                    this.cache.delete(key);\n                }\n            }\n        }\n    },\n\n    /**\n     * 全キャッシュをクリア\n     */\n    clear() {\n        this.cache.clear();\n    },\n\n    /**\n     * 最も古いエントリを削除\n     */\n    evictOldest() {\n        let oldestKey = null;\n        let oldestTime = Infinity;\n\n        for (const [key, entry] of this.cache.entries()) {\n            if (entry.createdAt < oldestTime) {\n                oldestTime = entry.createdAt;\n                oldestKey = key;\n            }\n        }\n\n        if (oldestKey) {\n            this.cache.delete(oldestKey);\n        }\n    },\n\n    /**\n     * キャッシュ統計を取得\n     */\n    getStats() {\n        let totalHits = 0;\n        let expiredCount = 0;\n        const now = Date.now();\n\n        for (const entry of this.cache.values()) {\n            totalHits += entry.hits;\n            if (now > entry.expiresAt) {expiredCount++;}\n        }\n\n        return {\n            size: this.cache.size,\n            maxSize: this.maxSize,\n            totalHits,\n            expiredCount\n        };\n    }\n};\n\n// ========================================\n// リクエスト重複排除\n// ========================================\nconst RequestDeduplicator = {\n    pending: new Map(),\n\n    /**\n     * リクエストを実行（重複は排除）\n     */\n    async execute(key, requestFn) {\n        // 同じリクエストが進行中の場合は待機\n        if (this.pending.has(key)) {\n            return this.pending.get(key);\n        }\n\n        const promise = requestFn()\n            .finally(() => {\n                this.pending.delete(key);\n            });\n\n        this.pending.set(key, promise);\n        return promise;\n    },\n\n    /**\n     * 進行中のリクエスト数を取得\n     */\n    getPendingCount() {\n        return this.pending.size;\n    }\n};\n\n// ========================================\n// リトライ機構付きAPIクライアント\n// ========================================\nconst EnhancedApi = {\n    defaultRetries: 3,\n    baseDelay: 1000,\n    maxDelay: 30000,\n\n    /**\n     * リトライ付きGETリクエスト\n     */\n    async get(endpoint, options = {}) {\n        const cacheKey = `GET:${endpoint}:${JSON.stringify(options.params || {})}`;\n\n        // キャッシュチェック\n        if (options.cache !== false) {\n            const cached = ApiCache.get(cacheKey);\n            if (cached) {\n                PerformanceMetrics.recordCacheHit();\n                return cached;\n            }\n        }\n\n        const result = await this.requestWithRetry('GET', endpoint, options);\n\n        // キャッシュに保存\n        if (options.cache !== false) {\n            ApiCache.set(cacheKey, result, options.cacheTtl);\n        }\n\n        return result;\n    },\n\n    /**\n     * POSTリクエスト（キャッシュなし）\n     */\n    async post(endpoint, data, options = {}) {\n        return this.requestWithRetry('POST', endpoint, { ...options, data });\n    },\n\n    /**\n     * PUTリクエスト\n     */\n    async put(endpoint, data, options = {}) {\n        return this.requestWithRetry('PUT', endpoint, { ...options, data });\n    },\n\n    /**\n     * DELETEリクエスト\n     */\n    async delete(endpoint, options = {}) {\n        return this.requestWithRetry('DELETE', endpoint, options);\n    },\n\n    /**\n     * リトライ付きリクエスト実行\n     */\n    async requestWithRetry(method, endpoint, options = {}) {\n        const maxRetries = options.retries ?? this.defaultRetries;\n        const requestKey = `${method}:${endpoint}:${Date.now()}`;\n\n        return RequestDeduplicator.execute(requestKey, async () => {\n            let lastError;\n\n            for (let attempt = 0; attempt <= maxRetries; attempt++) {\n                try {\n                    const startTime = performance.now();\n                    const result = await this.executeRequest(method, endpoint, options);\n                    const duration = performance.now() - startTime;\n\n                    PerformanceMetrics.recordApiCall(endpoint, duration, true);\n                    return result;\n                } catch (error) {\n                    lastError = error;\n                    PerformanceMetrics.recordApiCall(endpoint, 0, false);\n\n                    // リトライ不可能なエラー\n                    if (this.isNonRetryableError(error)) {\n                        throw error;\n                    }\n\n                    // 最後の試行でない場合は待機\n                    if (attempt < maxRetries) {\n                        const delay = this.calculateDelay(attempt);\n                        console.log(`[EnhancedApi] Retry ${attempt + 1}/${maxRetries} after ${delay}ms`);\n                        await this.sleep(delay);\n                    }\n                }\n            }\n\n            throw lastError;\n        });\n    },\n\n    /**\n     * 実際のリクエスト実行\n     */\n    async executeRequest(method, endpoint, options) {\n        // ApiConfigが存在しない場合のフォールバック\n        const baseUrl = typeof ApiConfig !== 'undefined' ? ApiConfig.baseUrl : '';\n        const timeout = options.timeout || (typeof ApiConfig !== 'undefined' ? ApiConfig.timeout : 30000);\n\n        if (!baseUrl) {\n            // ローカルデモモード - DataStoreを使用\n            return this.handleLocalRequest(method, endpoint, options);\n        }\n\n        const url = new URL(endpoint, baseUrl);\n        const headers = this.getHeaders();\n\n        const fetchOptions = {\n            method,\n            headers\n        };\n\n        if (options.params && method === 'GET') {\n            Object.entries(options.params).forEach(([key, value]) => {\n                url.searchParams.append(key, value);\n            });\n        }\n\n        if (options.data && method !== 'GET') {\n            fetchOptions.body = JSON.stringify(options.data);\n        }\n\n        const controller = new AbortController();\n        const timeoutId = setTimeout(() => controller.abort(), timeout);\n        fetchOptions.signal = controller.signal;\n\n        try {\n            const response = await fetch(url, fetchOptions);\n            clearTimeout(timeoutId);\n\n            if (!response.ok) {\n                const error = new Error(`HTTP ${response.status}: ${response.statusText}`);\n                error.status = response.status;\n                throw error;\n            }\n\n            return await response.json();\n        } catch (error) {\n            clearTimeout(timeoutId);\n            if (error.name === 'AbortError') {\n                throw new Error('リクエストがタイムアウトしました');\n            }\n            throw error;\n        }\n    },\n\n    /**\n     * ローカルリクエスト処理（デモモード）\n     */\n    handleLocalRequest(method, endpoint, options) {\n        // DataStoreを使用したローカル処理\n        const segments = endpoint.split('/').filter(Boolean);\n        const resource = segments[0];\n        const id = segments[1];\n\n        if (typeof DataStore === 'undefined') {\n            throw new Error('DataStore is not available');\n        }\n\n        switch (method) {\n        case 'GET':\n            if (id) {\n                return DataStore.findById(resource, id);\n            }\n            return DataStore[resource] || [];\n\n        case 'POST':\n            return DataStore.create(resource, options.data);\n\n        case 'PUT':\n            return DataStore.update(resource, id, options.data);\n\n        case 'DELETE':\n            return DataStore.delete(resource, id);\n\n        default:\n            throw new Error(`Unsupported method: ${method}`);\n        }\n    },\n\n    /**\n     * リクエストヘッダー取得\n     */\n    getHeaders() {\n        const headers = {\n            'Content-Type': 'application/json',\n            'Accept': 'application/json'\n        };\n\n        if (typeof ApiConfig !== 'undefined' && ApiConfig.apiKey) {\n            switch (ApiConfig.authMethod) {\n            case 'bearer':\n                headers['Authorization'] = `Bearer ${ApiConfig.apiKey}`;\n                break;\n            case 'basic':\n                headers['Authorization'] = `Basic ${btoa(ApiConfig.apiKey)}`;\n                break;\n            case 'apikey':\n                headers['X-API-Key'] = ApiConfig.apiKey;\n                break;\n            }\n        }\n\n        return headers;\n    },\n\n    /**\n     * リトライ不可能なエラーか判定\n     */\n    isNonRetryableError(error) {\n        // 4xx系エラー（認証エラーなど）はリトライしない\n        if (error.status >= 400 && error.status < 500) {\n            return true;\n        }\n        return false;\n    },\n\n    /**\n     * 指数バックオフでディレイを計算\n     */\n    calculateDelay(attempt) {\n        const delay = this.baseDelay * Math.pow(2, attempt);\n        const jitter = Math.random() * 1000;\n        return Math.min(delay + jitter, this.maxDelay);\n    },\n\n    /**\n     * スリープ\n     */\n    sleep(ms) {\n        return new Promise(resolve => setTimeout(resolve, ms));\n    }\n};\n\n// ========================================\n// パフォーマンスメトリクス\n// ========================================\nconst PerformanceMetrics = {\n    metrics: {\n        apiCalls: [],\n        cacheHits: 0,\n        cacheMisses: 0,\n        renderTimes: [],\n        errors: []\n    },\n    maxHistory: 100,\n\n    /**\n     * API呼び出しを記録\n     */\n    recordApiCall(endpoint, duration, success) {\n        this.metrics.apiCalls.push({\n            endpoint,\n            duration,\n            success,\n            timestamp: Date.now()\n        });\n\n        // 履歴制限\n        if (this.metrics.apiCalls.length > this.maxHistory) {\n            this.metrics.apiCalls.shift();\n        }\n\n        if (!success) {\n            this.metrics.cacheMisses++;\n        }\n    },\n\n    /**\n     * キャッシュヒットを記録\n     */\n    recordCacheHit() {\n        this.metrics.cacheHits++;\n    },\n\n    /**\n     * レンダリング時間を記録\n     */\n    recordRenderTime(component, duration) {\n        this.metrics.renderTimes.push({\n            component,\n            duration,\n            timestamp: Date.now()\n        });\n\n        if (this.metrics.renderTimes.length > this.maxHistory) {\n            this.metrics.renderTimes.shift();\n        }\n    },\n\n    /**\n     * エラーを記録\n     */\n    recordError(error, context) {\n        this.metrics.errors.push({\n            message: error.message,\n            stack: error.stack,\n            context,\n            timestamp: Date.now()\n        });\n\n        if (this.metrics.errors.length > this.maxHistory) {\n            this.metrics.errors.shift();\n        }\n    },\n\n    /**\n     * 統計を取得\n     */\n    getStats() {\n        const apiCalls = this.metrics.apiCalls;\n        const successfulCalls = apiCalls.filter(c => c.success);\n\n        return {\n            totalApiCalls: apiCalls.length,\n            successfulApiCalls: successfulCalls.length,\n            failedApiCalls: apiCalls.length - successfulCalls.length,\n            averageResponseTime: successfulCalls.length > 0\n                ? successfulCalls.reduce((sum, c) => sum + c.duration, 0) / successfulCalls.length\n                : 0,\n            cacheHitRate: this.metrics.cacheHits + this.metrics.cacheMisses > 0\n                ? this.metrics.cacheHits / (this.metrics.cacheHits + this.metrics.cacheMisses)\n                : 0,\n            cacheHits: this.metrics.cacheHits,\n            cacheMisses: this.metrics.cacheMisses,\n            recentErrors: this.metrics.errors.slice(-10)\n        };\n    },\n\n    /**\n     * メトリクスをリセット\n     */\n    reset() {\n        this.metrics = {\n            apiCalls: [],\n            cacheHits: 0,\n            cacheMisses: 0,\n            renderTimes: [],\n            errors: []\n        };\n    }\n};\n\n// ========================================\n// 遅延読み込みユーティリティ\n// ========================================\nconst LazyLoader = {\n    observers: new Map(),\n\n    /**\n     * 要素の遅延読み込みを設定\n     */\n    observe(element, callback, options = {}) {\n        if (!('IntersectionObserver' in window)) {\n            // フォールバック: 即座に実行\n            callback(element);\n            return;\n        }\n\n        const observer = new IntersectionObserver((entries) => {\n            entries.forEach(entry => {\n                if (entry.isIntersecting) {\n                    callback(entry.target);\n                    observer.unobserve(entry.target);\n                    this.observers.delete(element);\n                }\n            });\n        }, {\n            rootMargin: options.rootMargin || '100px',\n            threshold: options.threshold || 0.1\n        });\n\n        observer.observe(element);\n        this.observers.set(element, observer);\n    },\n\n    /**\n     * 監視を解除\n     */\n    unobserve(element) {\n        const observer = this.observers.get(element);\n        if (observer) {\n            observer.unobserve(element);\n            this.observers.delete(element);\n        }\n    },\n\n    /**\n     * 全ての監視を解除\n     */\n    disconnect() {\n        this.observers.forEach(observer => observer.disconnect());\n        this.observers.clear();\n    }\n};\n\n// ========================================\n// デバウンス・スロットル\n// ========================================\nconst RateLimitUtils = {\n    /**\n     * デバウンス\n     */\n    debounce(fn, delay) {\n        let timeoutId;\n        return function (...args) {\n            clearTimeout(timeoutId);\n            timeoutId = setTimeout(() => fn.apply(this, args), delay);\n        };\n    },\n\n    /**\n     * スロットル\n     */\n    throttle(fn, limit) {\n        let inThrottle;\n        return function (...args) {\n            if (!inThrottle) {\n                fn.apply(this, args);\n                inThrottle = true;\n                setTimeout(() => inThrottle = false, limit);\n            }\n        };\n    },\n\n    /**\n     * 一定時間後に1回だけ実行\n     */\n    once(fn) {\n        let called = false;\n        return function (...args) {\n            if (!called) {\n                called = true;\n                return fn.apply(this, args);\n            }\n        };\n    }\n};\n\n// ========================================\n// メモ化ユーティリティ\n// ========================================\nconst Memoize = {\n    /**\n     * 関数の結果をメモ化\n     */\n    fn(fn, keyFn) {\n        const cache = new Map();\n\n        return function (...args) {\n            const key = keyFn ? keyFn(...args) : JSON.stringify(args);\n\n            if (cache.has(key)) {\n                return cache.get(key);\n            }\n\n            const result = fn.apply(this, args);\n            cache.set(key, result);\n            return result;\n        };\n    },\n\n    /**\n     * TTL付きメモ化\n     */\n    withTtl(fn, ttl, keyFn) {\n        const cache = new Map();\n\n        return function (...args) {\n            const key = keyFn ? keyFn(...args) : JSON.stringify(args);\n            const entry = cache.get(key);\n\n            if (entry && Date.now() < entry.expiresAt) {\n                return entry.value;\n            }\n\n            const result = fn.apply(this, args);\n            cache.set(key, {\n                value: result,\n                expiresAt: Date.now() + ttl\n            });\n            return result;\n        };\n    }\n};\n\n// ========================================\n// パフォーマンスモニター\n// ========================================\nconst PerformanceMonitor = {\n    enabled: true,\n    marks: new Map(),\n\n    /**\n     * 計測開始\n     */\n    start(name) {\n        if (!this.enabled) {return;}\n        this.marks.set(name, performance.now());\n    },\n\n    /**\n     * 計測終了して時間を返す\n     */\n    end(name) {\n        if (!this.enabled) {return 0;}\n\n        const startTime = this.marks.get(name);\n        if (!startTime) {return 0;}\n\n        const duration = performance.now() - startTime;\n        this.marks.delete(name);\n\n        PerformanceMetrics.recordRenderTime(name, duration);\n        return duration;\n    },\n\n    /**\n     * 関数の実行時間を計測\n     */\n    measure(name, fn) {\n        this.start(name);\n        const result = fn();\n        const duration = this.end(name);\n\n        if (duration > 100) {\n            console.warn(`[Performance] ${name} took ${duration.toFixed(2)}ms`);\n        }\n\n        return result;\n    },\n\n    /**\n     * 非同期関数の実行時間を計測\n     */\n    async measureAsync(name, fn) {\n        this.start(name);\n        try {\n            return await fn();\n        } finally {\n            const duration = this.end(name);\n            if (duration > 100) {\n                console.warn(`[Performance] ${name} took ${duration.toFixed(2)}ms`);\n            }\n        }\n    }\n};\n\n// ========================================\n// 初期化\n// ========================================\nconst PerformanceOptimizer = {\n    init() {\n        console.log('[PerformanceOptimizer] 初期化完了');\n\n        // 定期的なキャッシュクリーンアップ\n        setInterval(() => {\n            const stats = ApiCache.getStats();\n            if (stats.expiredCount > 0) {\n                console.log(`[PerformanceOptimizer] Cleaning ${stats.expiredCount} expired cache entries`);\n                // 期限切れエントリを削除\n                for (const [key, entry] of ApiCache.cache.entries()) {\n                    if (Date.now() > entry.expiresAt) {\n                        ApiCache.cache.delete(key);\n                    }\n                }\n            }\n        }, 60000); // 1分ごと\n    },\n\n    /**\n     * パフォーマンスレポートを取得\n     */\n    getReport() {\n        return {\n            cache: ApiCache.getStats(),\n            metrics: PerformanceMetrics.getStats(),\n            pendingRequests: RequestDeduplicator.getPendingCount()\n        };\n    },\n\n    /**\n     * 全てリセット\n     */\n    reset() {\n        ApiCache.clear();\n        PerformanceMetrics.reset();\n    }\n};\n\n// グローバルエクスポート\nif (typeof window !== 'undefined') {\n    window.ApiCache = ApiCache;\n    window.EnhancedApi = EnhancedApi;\n    window.PerformanceMetrics = PerformanceMetrics;\n    window.LazyLoader = LazyLoader;\n    window.RateLimitUtils = RateLimitUtils;\n    window.Memoize = Memoize;\n    window.PerformanceMonitor = PerformanceMonitor;\n    window.PerformanceOptimizer = PerformanceOptimizer;\n}\n","usedDeprecatedRules":[{"ruleId":"semi","replacedBy":[]},{"ruleId":"quotes","replacedBy":[]},{"ruleId":"indent","replacedBy":[]},{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/runner/work/Appsuite-ITSM-Management/Appsuite-ITSM-Management/WebUI-Sample/js/security.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'FormValidator' is assigned a value but never used.","line":269,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":269,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'CsrfProtection' is assigned a value but never used.","line":365,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":365,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'RateLimiter' is assigned a value but never used.","line":417,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":417,"endColumn":18},{"ruleId":"no-unused-vars","severity":1,"message":"'escapeHtml' is defined but never used.","line":485,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":485,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'sanitizeInput' is defined but never used.","line":489,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":489,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * AppSuite 管理運用システム - セキュリティユーティリティ\n * Phase 3 Sprint 1: セキュリティ強化\n */\n\nconst Security = {\n    /**\n     * HTMLエスケープ（XSS対策）\n     * @param {string} str - エスケープする文字列\n     * @returns {string} - エスケープされた文字列\n     */\n    escapeHtml(str) {\n        if (str === null || str === undefined) {return '';}\n        if (typeof str !== 'string') {str = String(str);}\n\n        const escapeMap = {\n            '&': '&amp;',\n            '<': '&lt;',\n            '>': '&gt;',\n            '\"': '&quot;',\n            '\\'': '&#039;',\n            '/': '&#x2F;',\n            '`': '&#x60;',\n            '=': '&#x3D;'\n        };\n\n        return str.replace(/[&<>\"'`=/]/g, char => escapeMap[char]);\n    },\n\n    /**\n     * HTMLアンエスケープ\n     * @param {string} str - アンエスケープする文字列\n     * @returns {string} - アンエスケープされた文字列\n     */\n    unescapeHtml(str) {\n        if (!str) {return '';}\n\n        const unescapeMap = {\n            '&amp;': '&',\n            '&lt;': '<',\n            '&gt;': '>',\n            '&quot;': '\"',\n            '&#039;': '\\'',\n            '&#x2F;': '/',\n            '&#x60;': '`',\n            '&#x3D;': '='\n        };\n\n        return str.replace(/&amp;|&lt;|&gt;|&quot;|&#039;|&#x2F;|&#x60;|&#x3D;/g,\n            match => unescapeMap[match]);\n    },\n\n    /**\n     * 安全なHTML生成（テンプレートリテラル用タグ関数）\n     * @param {Array} strings - テンプレート文字列配列\n     * @param {...any} values - 挿入値\n     * @returns {string} - エスケープされたHTML\n     */\n    html(strings, ...values) {\n        return strings.reduce((result, str, i) => {\n            const value = values[i - 1];\n            const escaped = this.escapeHtml(value);\n            return result + escaped + str;\n        });\n    },\n\n    /**\n     * URLエンコード\n     * @param {string} str - エンコードする文字列\n     * @returns {string} - エンコードされた文字列\n     */\n    encodeUrl(str) {\n        return encodeURIComponent(str);\n    },\n\n    /**\n     * SQLインジェクション対策（クライアント側参考実装）\n     * @param {string} str - サニタイズする文字列\n     * @returns {string} - サニタイズされた文字列\n     */\n    sanitizeSql(str) {\n        if (!str) {return '';}\n        // シングルクォートをエスケープ\n        return str.replace(/'/g, '\\'\\'');\n    }\n};\n\n/**\n * 入力バリデーションモジュール\n */\nconst Validator = {\n    /**\n     * 必須チェック\n     * @param {any} value - チェックする値\n     * @returns {boolean} - 値がある場合true\n     */\n    required(value) {\n        if (value === null || value === undefined) {return false;}\n        if (typeof value === 'string') {return value.trim().length > 0;}\n        if (Array.isArray(value)) {return value.length > 0;}\n        return true;\n    },\n\n    /**\n     * 最小長チェック\n     * @param {string} value - チェックする値\n     * @param {number} min - 最小長\n     * @returns {boolean} - 条件を満たす場合true\n     */\n    minLength(value, min) {\n        if (!value) {return false;}\n        return String(value).length >= min;\n    },\n\n    /**\n     * 最大長チェック\n     * @param {string} value - チェックする値\n     * @param {number} max - 最大長\n     * @returns {boolean} - 条件を満たす場合true\n     */\n    maxLength(value, max) {\n        if (!value) {return true;}\n        return String(value).length <= max;\n    },\n\n    /**\n     * メールアドレス形式チェック\n     * @param {string} email - チェックするメールアドレス\n     * @returns {boolean} - 有効な形式の場合true\n     */\n    email(email) {\n        if (!email) {return false;}\n        const pattern = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n        return pattern.test(email);\n    },\n\n    /**\n     * 電話番号形式チェック（日本）\n     * @param {string} phone - チェックする電話番号\n     * @returns {boolean} - 有効な形式の場合true\n     */\n    phone(phone) {\n        if (!phone) {return false;}\n        // ハイフンあり・なし両対応\n        const pattern = /^0\\d{1,4}-?\\d{1,4}-?\\d{4}$/;\n        return pattern.test(phone.replace(/\\s/g, ''));\n    },\n\n    /**\n     * 数値チェック\n     * @param {any} value - チェックする値\n     * @returns {boolean} - 数値の場合true\n     */\n    numeric(value) {\n        return !isNaN(parseFloat(value)) && isFinite(value);\n    },\n\n    /**\n     * 整数チェック\n     * @param {any} value - チェックする値\n     * @returns {boolean} - 整数の場合true\n     */\n    integer(value) {\n        return Number.isInteger(Number(value));\n    },\n\n    /**\n     * 範囲チェック\n     * @param {number} value - チェックする値\n     * @param {number} min - 最小値\n     * @param {number} max - 最大値\n     * @returns {boolean} - 範囲内の場合true\n     */\n    range(value, min, max) {\n        const num = Number(value);\n        return !isNaN(num) && num >= min && num <= max;\n    },\n\n    /**\n     * 正規表現チェック\n     * @param {string} value - チェックする値\n     * @param {RegExp} pattern - 正規表現パターン\n     * @returns {boolean} - パターンにマッチする場合true\n     */\n    pattern(value, pattern) {\n        if (!value) {return false;}\n        return pattern.test(value);\n    },\n\n    /**\n     * 日付形式チェック（YYYY-MM-DD）\n     * @param {string} date - チェックする日付文字列\n     * @returns {boolean} - 有効な日付の場合true\n     */\n    date(date) {\n        if (!date) {return false;}\n        const pattern = /^\\d{4}-\\d{2}-\\d{2}$/;\n        if (!pattern.test(date)) {return false;}\n\n        const d = new Date(date);\n        return d instanceof Date && !isNaN(d);\n    },\n\n    /**\n     * 日時形式チェック（YYYY-MM-DD HH:mm）\n     * @param {string} datetime - チェックする日時文字列\n     * @returns {boolean} - 有効な日時の場合true\n     */\n    datetime(datetime) {\n        if (!datetime) {return false;}\n        const pattern = /^\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}$/;\n        if (!pattern.test(datetime)) {return false;}\n\n        const d = new Date(datetime.replace(' ', 'T'));\n        return d instanceof Date && !isNaN(d);\n    },\n\n    /**\n     * URL形式チェック\n     * @param {string} url - チェックするURL\n     * @returns {boolean} - 有効なURLの場合true\n     */\n    url(url) {\n        if (!url) {return false;}\n        try {\n            new URL(url);\n            return true;\n        } catch {\n            return false;\n        }\n    },\n\n    /**\n     * 英数字のみチェック\n     * @param {string} value - チェックする値\n     * @returns {boolean} - 英数字のみの場合true\n     */\n    alphanumeric(value) {\n        if (!value) {return false;}\n        return /^[a-zA-Z0-9]+$/.test(value);\n    },\n\n    /**\n     * 日本語を含むかチェック\n     * @param {string} value - チェックする値\n     * @returns {boolean} - 日本語を含む場合true\n     */\n    containsJapanese(value) {\n        if (!value) {return false;}\n        return /[\\u3040-\\u309F\\u30A0-\\u30FF\\u4E00-\\u9FAF]/.test(value);\n    },\n\n    /**\n     * 禁止文字チェック\n     * @param {string} value - チェックする値\n     * @param {string} chars - 禁止文字（文字列）\n     * @returns {boolean} - 禁止文字を含まない場合true\n     */\n    noForbiddenChars(value, chars = '<>\"\\'/\\\\') {\n        if (!value) {return true;}\n        const pattern = new RegExp(`[${chars.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&')}]`);\n        return !pattern.test(value);\n    }\n};\n\n/**\n * フォームバリデーションヘルパー\n */\nconst FormValidator = {\n    /**\n     * フォームバリデーション実行\n     * @param {HTMLFormElement} form - フォーム要素\n     * @param {Object} rules - バリデーションルール\n     * @returns {Object} - バリデーション結果\n     */\n    validate(form, rules) {\n        const errors = {};\n        let isValid = true;\n\n        for (const [fieldName, fieldRules] of Object.entries(rules)) {\n            const input = form.querySelector(`[name=\"${fieldName}\"]`);\n            if (!input) {continue;}\n\n            const value = input.value;\n            const fieldErrors = [];\n\n            for (const rule of fieldRules) {\n                const { type, message, params } = rule;\n\n                let valid = true;\n                switch (type) {\n                case 'required':\n                    valid = Validator.required(value);\n                    break;\n                case 'minLength':\n                    valid = Validator.minLength(value, params.min);\n                    break;\n                case 'maxLength':\n                    valid = Validator.maxLength(value, params.max);\n                    break;\n                case 'email':\n                    valid = !value || Validator.email(value);\n                    break;\n                case 'pattern':\n                    valid = !value || Validator.pattern(value, params.pattern);\n                    break;\n                case 'range':\n                    valid = !value || Validator.range(value, params.min, params.max);\n                    break;\n                case 'custom':\n                    valid = params.fn(value, form);\n                    break;\n                }\n\n                if (!valid) {\n                    fieldErrors.push(message);\n                    isValid = false;\n                }\n            }\n\n            if (fieldErrors.length > 0) {\n                errors[fieldName] = fieldErrors;\n            }\n        }\n\n        return { isValid, errors };\n    },\n\n    /**\n     * エラー表示\n     * @param {HTMLFormElement} form - フォーム要素\n     * @param {Object} errors - エラーオブジェクト\n     */\n    showErrors(form, errors) {\n        // 既存のエラー表示をクリア\n        form.querySelectorAll('.field-error').forEach(el => el.remove());\n        form.querySelectorAll('.input-error').forEach(el => el.classList.remove('input-error'));\n\n        for (const [fieldName, messages] of Object.entries(errors)) {\n            const input = form.querySelector(`[name=\"${fieldName}\"]`);\n            if (!input) {continue;}\n\n            input.classList.add('input-error');\n\n            const errorDiv = document.createElement('div');\n            errorDiv.className = 'field-error';\n            errorDiv.textContent = messages[0]; // 最初のエラーのみ表示\n            input.parentNode.insertBefore(errorDiv, input.nextSibling);\n        }\n    },\n\n    /**\n     * エラークリア\n     * @param {HTMLFormElement} form - フォーム要素\n     */\n    clearErrors(form) {\n        form.querySelectorAll('.field-error').forEach(el => el.remove());\n        form.querySelectorAll('.input-error').forEach(el => el.classList.remove('input-error'));\n    }\n};\n\n/**\n * CSRFトークン管理（将来のサーバー連携用）\n */\nconst CsrfProtection = {\n    tokenKey: 'csrf_token',\n\n    /**\n     * トークン生成\n     * @returns {string} - CSRFトークン\n     */\n    generateToken() {\n        const array = new Uint8Array(32);\n        crypto.getRandomValues(array);\n        const token = Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');\n        sessionStorage.setItem(this.tokenKey, token);\n        return token;\n    },\n\n    /**\n     * トークン取得\n     * @returns {string|null} - 保存されているトークン\n     */\n    getToken() {\n        return sessionStorage.getItem(this.tokenKey);\n    },\n\n    /**\n     * トークン検証\n     * @param {string} token - 検証するトークン\n     * @returns {boolean} - 有効な場合true\n     */\n    verifyToken(token) {\n        const storedToken = this.getToken();\n        return storedToken && storedToken === token;\n    },\n\n    /**\n     * フォームにトークンを追加\n     * @param {HTMLFormElement} form - フォーム要素\n     */\n    addToForm(form) {\n        let input = form.querySelector('input[name=\"csrf_token\"]');\n        if (!input) {\n            input = document.createElement('input');\n            input.type = 'hidden';\n            input.name = 'csrf_token';\n            form.appendChild(input);\n        }\n        input.value = this.getToken() || this.generateToken();\n    }\n};\n\n/**\n * レート制限（ブルートフォース対策）\n */\nconst RateLimiter = {\n    limits: new Map(),\n\n    /**\n     * レート制限チェック\n     * @param {string} key - 識別キー\n     * @param {number} maxRequests - 最大リクエスト数\n     * @param {number} windowMs - 時間窓（ミリ秒）\n     * @returns {Object} - 制限情報\n     */\n    check(key, maxRequests = 10, windowMs = 60000) {\n        const now = Date.now();\n        let record = this.limits.get(key);\n\n        if (!record) {\n            record = { requests: [], blocked: false, blockUntil: 0 };\n            this.limits.set(key, record);\n        }\n\n        // ブロック中かチェック\n        if (record.blocked && now < record.blockUntil) {\n            return {\n                allowed: false,\n                remaining: 0,\n                resetAt: record.blockUntil\n            };\n        }\n\n        // ブロック解除\n        if (record.blocked && now >= record.blockUntil) {\n            record.blocked = false;\n            record.requests = [];\n        }\n\n        // 古いリクエストを削除\n        record.requests = record.requests.filter(time => now - time < windowMs);\n\n        // リクエスト追加\n        record.requests.push(now);\n\n        // 制限超過チェック\n        if (record.requests.length > maxRequests) {\n            record.blocked = true;\n            record.blockUntil = now + windowMs;\n            return {\n                allowed: false,\n                remaining: 0,\n                resetAt: record.blockUntil\n            };\n        }\n\n        return {\n            allowed: true,\n            remaining: maxRequests - record.requests.length,\n            resetAt: now + windowMs\n        };\n    },\n\n    /**\n     * リセット\n     * @param {string} key - 識別キー\n     */\n    reset(key) {\n        this.limits.delete(key);\n    }\n};\n\n// グローバル関数としてエクスポート（既存コードとの互換性）\nfunction escapeHtml(str) {\n    return Security.escapeHtml(str);\n}\n\nfunction sanitizeInput(str) {\n    return Security.escapeHtml(str);\n}\n","usedDeprecatedRules":[{"ruleId":"semi","replacedBy":[]},{"ruleId":"quotes","replacedBy":[]},{"ruleId":"indent","replacedBy":[]},{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/runner/work/Appsuite-ITSM-Management/Appsuite-ITSM-Management/WebUI-Sample/js/utils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"semi","replacedBy":[]},{"ruleId":"quotes","replacedBy":[]},{"ruleId":"indent","replacedBy":[]},{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/home/runner/work/Appsuite-ITSM-Management/Appsuite-ITSM-Management/WebUI-Sample/js/workflow.js","messages":[{"ruleId":"no-undef","severity":1,"message":"'NotificationManager' is not defined.","line":371,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":371,"endColumn":36},{"ruleId":"no-undef","severity":1,"message":"'NotificationManager' is not defined.","line":374,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":374,"endColumn":36},{"ruleId":"no-undef","severity":1,"message":"'NotificationManager' is not defined.","line":437,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":437,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * WorkflowEngine - ワークフローエンジン\n *\n * ステータス遷移管理、SLA監視、エスカレーション処理を担当\n *\n * @version 1.0.0\n * @since Sprint 3\n */\n\nconst WorkflowEngine = {\n    // ========================================\n    // 設定定数\n    // ========================================\n\n    /** SLA監視間隔（ミリ秒）- 1分 */\n    SLA_CHECK_INTERVAL: 60000,\n\n    /** SLA監視タイマーID */\n    slaTimerId: null,\n\n    /** 初期化済みフラグ */\n    initialized: false,\n\n    // ========================================\n    // ステータス遷移ルール\n    // ========================================\n\n    /**\n     * インシデントステータス遷移ルール\n     * キー: 現在のステータス\n     * 値: 遷移可能なステータスの配列\n     */\n    INCIDENT_TRANSITIONS: {\n        open: ['in_progress', 'closed'],\n        in_progress: ['resolved', 'open'],\n        resolved: ['closed', 'in_progress'],\n        closed: ['in_progress']\n    },\n\n    /**\n     * インシデントステータスの表示名\n     */\n    INCIDENT_STATUS_LABELS: {\n        open: 'オープン',\n        in_progress: '対応中',\n        resolved: '解決済み',\n        closed: 'クローズ'\n    },\n\n    /**\n     * 変更要求ステータス遷移ルール\n     */\n    CHANGE_TRANSITIONS: {\n        draft: ['pending'],\n        pending: ['approved', 'rejected'],\n        approved: ['in_progress'],\n        in_progress: ['completed'],\n        completed: [],\n        rejected: []\n    },\n\n    /**\n     * 変更要求ステータスの表示名\n     */\n    CHANGE_STATUS_LABELS: {\n        draft: '下書き',\n        pending: '承認待ち',\n        approved: '承認済み',\n        in_progress: '実施中',\n        completed: '完了',\n        rejected: '却下'\n    },\n\n    // ========================================\n    // SLA定義\n    // ========================================\n\n    /**\n     * SLA定義（ミリ秒）\n     * response: 応答時間（最初の対応まで）\n     * resolution: 解決時間（クローズまで）\n     */\n    SLA_DEFINITIONS: {\n        high: {\n            response: 1 * 60 * 60 * 1000,      // 1時間\n            resolution: 4 * 60 * 60 * 1000     // 4時間\n        },\n        medium: {\n            response: 4 * 60 * 60 * 1000,      // 4時間\n            resolution: 24 * 60 * 60 * 1000    // 24時間\n        },\n        low: {\n            response: 24 * 60 * 60 * 1000,     // 24時間\n            resolution: 72 * 60 * 60 * 1000    // 72時間\n        }\n    },\n\n    // ========================================\n    // 初期化・クリーンアップ\n    // ========================================\n\n    /**\n     * ワークフローエンジンを初期化\n     */\n    init() {\n        if (this.initialized) {\n            console.warn('WorkflowEngine: 既に初期化されています');\n            return;\n        }\n\n        console.log('WorkflowEngine: 初期化開始');\n\n        // SLA監視を開始\n        this.startSlaMonitoring();\n\n        this.initialized = true;\n        console.log('WorkflowEngine: 初期化完了');\n    },\n\n    /**\n     * クリーンアップ処理\n     */\n    cleanup() {\n        this.stopSlaMonitoring();\n        this.initialized = false;\n        console.log('WorkflowEngine: クリーンアップ完了');\n    },\n\n    // ========================================\n    // ステータス遷移検証\n    // ========================================\n\n    /**\n     * インシデントのステータス遷移を検証\n     * @param {string} fromStatus - 現在のステータス\n     * @param {string} toStatus - 遷移先ステータス\n     * @returns {Object} { valid: boolean, message: string }\n     */\n    isValidIncidentTransition(fromStatus, toStatus) {\n        // 同一ステータスへの遷移は常に許可\n        if (fromStatus === toStatus) {\n            return { valid: true, message: '' };\n        }\n\n        const allowedTransitions = this.INCIDENT_TRANSITIONS[fromStatus] || [];\n        const valid = allowedTransitions.includes(toStatus);\n\n        if (valid) {\n            return { valid: true, message: '' };\n        }\n\n        const fromLabel = this.INCIDENT_STATUS_LABELS[fromStatus] || fromStatus;\n        const toLabel = this.INCIDENT_STATUS_LABELS[toStatus] || toStatus;\n\n        return {\n            valid: false,\n            message: `「${fromLabel}」から「${toLabel}」への遷移は許可されていません`\n        };\n    },\n\n    /**\n     * 変更要求のステータス遷移を検証\n     * @param {string} fromStatus - 現在のステータス\n     * @param {string} toStatus - 遷移先ステータス\n     * @returns {Object} { valid: boolean, message: string }\n     */\n    isValidChangeTransition(fromStatus, toStatus) {\n        // 同一ステータスへの遷移は常に許可\n        if (fromStatus === toStatus) {\n            return { valid: true, message: '' };\n        }\n\n        const allowedTransitions = this.CHANGE_TRANSITIONS[fromStatus] || [];\n        const valid = allowedTransitions.includes(toStatus);\n\n        if (valid) {\n            return { valid: true, message: '' };\n        }\n\n        const fromLabel = this.CHANGE_STATUS_LABELS[fromStatus] || fromStatus;\n        const toLabel = this.CHANGE_STATUS_LABELS[toStatus] || toStatus;\n\n        return {\n            valid: false,\n            message: `「${fromLabel}」から「${toLabel}」への遷移は許可されていません`\n        };\n    },\n\n    /**\n     * 利用可能な遷移先を取得\n     * @param {string} type - 'incident' または 'change'\n     * @param {string} currentStatus - 現在のステータス\n     * @returns {Array<{value: string, label: string}>} 遷移可能なステータス一覧\n     */\n    getAvailableTransitions(type, currentStatus) {\n        let transitions, labels;\n\n        if (type === 'incident') {\n            transitions = this.INCIDENT_TRANSITIONS[currentStatus] || [];\n            labels = this.INCIDENT_STATUS_LABELS;\n        } else if (type === 'change') {\n            transitions = this.CHANGE_TRANSITIONS[currentStatus] || [];\n            labels = this.CHANGE_STATUS_LABELS;\n        } else {\n            return [];\n        }\n\n        // 現在のステータスも選択肢に含める\n        const result = [{\n            value: currentStatus,\n            label: labels[currentStatus] || currentStatus\n        }];\n\n        transitions.forEach(status => {\n            result.push({\n                value: status,\n                label: labels[status] || status\n            });\n        });\n\n        return result;\n    },\n\n    // ========================================\n    // SLA管理\n    // ========================================\n\n    /**\n     * SLA監視を開始\n     */\n    startSlaMonitoring() {\n        if (this.slaTimerId) {\n            console.warn('WorkflowEngine: SLA監視は既に開始されています');\n            return;\n        }\n\n        // 初回チェック\n        this.checkSlaViolations();\n\n        // 定期チェック開始\n        this.slaTimerId = setInterval(() => {\n            this.checkSlaViolations();\n            this.processEscalations();\n        }, this.SLA_CHECK_INTERVAL);\n\n        console.log('WorkflowEngine: SLA監視を開始しました（間隔: 1分）');\n    },\n\n    /**\n     * SLA監視を停止\n     */\n    stopSlaMonitoring() {\n        if (this.slaTimerId) {\n            clearInterval(this.slaTimerId);\n            this.slaTimerId = null;\n            console.log('WorkflowEngine: SLA監視を停止しました');\n        }\n    },\n\n    /**\n     * インシデントのSLAステータスを取得\n     * @param {Object} incident - インシデントオブジェクト\n     * @returns {Object} { status: 'ok'|'warning'|'breach', remaining: number|null, deadline: Date|null, message: string }\n     */\n    getSlaStatus(incident) {\n        // クローズ済みまたは解決済みはSLA対象外\n        if (incident.status === 'closed' || incident.status === 'resolved') {\n            return {\n                status: 'completed',\n                remaining: null,\n                deadline: null,\n                message: 'SLA評価完了'\n            };\n        }\n\n        const priority = incident.priority || 'medium';\n        const sla = this.SLA_DEFINITIONS[priority];\n\n        if (!sla) {\n            return {\n                status: 'unknown',\n                remaining: null,\n                deadline: null,\n                message: 'SLA定義なし'\n            };\n        }\n\n        // 作成日時を取得\n        const created = new Date(incident.created || incident.createdAt || incident.reportedAt);\n        if (isNaN(created.getTime())) {\n            return {\n                status: 'unknown',\n                remaining: null,\n                deadline: null,\n                message: '作成日時不明'\n            };\n        }\n\n        const now = new Date();\n        const deadline = new Date(created.getTime() + sla.resolution);\n        const remaining = deadline.getTime() - now.getTime();\n\n        let status = 'ok';\n        let message = '';\n\n        if (remaining <= 0) {\n            status = 'breach';\n            message = `SLA超過: ${this.formatDuration(Math.abs(remaining))}超過`;\n        } else if (remaining <= sla.resolution * 0.25) {\n            status = 'warning';\n            message = `SLA警告: 残り${this.formatDuration(remaining)}`;\n        } else {\n            message = `残り${this.formatDuration(remaining)}`;\n        }\n\n        return { status, remaining, deadline, message };\n    },\n\n    /**\n     * SLA期限を計算\n     * @param {Object} incident - インシデントオブジェクト\n     * @returns {Object} { response: Date, resolution: Date }\n     */\n    calculateSlaDeadline(incident) {\n        const priority = incident.priority || 'medium';\n        const sla = this.SLA_DEFINITIONS[priority];\n        const created = new Date(incident.created || incident.createdAt || incident.reportedAt);\n\n        return {\n            response: new Date(created.getTime() + sla.response),\n            resolution: new Date(created.getTime() + sla.resolution)\n        };\n    },\n\n    /**\n     * SLA違反をチェック\n     * @returns {Object} { violations: Array, warnings: Array }\n     */\n    checkSlaViolations() {\n        // DataStoreが利用可能かチェック\n        if (typeof DataStore === 'undefined' || !DataStore.incidents) {\n            return { violations: [], warnings: [] };\n        }\n\n        const activeIncidents = DataStore.incidents.filter(i =>\n            i.status !== 'closed' && i.status !== 'resolved'\n        );\n\n        const violations = [];\n        const warnings = [];\n\n        activeIncidents.forEach(incident => {\n            const slaStatus = this.getSlaStatus(incident);\n\n            if (slaStatus.status === 'breach') {\n                violations.push({\n                    incident,\n                    slaStatus\n                });\n            } else if (slaStatus.status === 'warning') {\n                warnings.push({\n                    incident,\n                    slaStatus\n                });\n            }\n        });\n\n        // 通知処理（NotificationManagerが利用可能な場合）\n        if (typeof NotificationManager !== 'undefined') {\n            if (violations.length > 0) {\n                NotificationManager.notifySlaViolation(violations.map(v => v.incident));\n            }\n            if (warnings.length > 0) {\n                NotificationManager.notifySlaWarning(warnings.map(w => w.incident));\n            }\n        }\n\n        return { violations, warnings };\n    },\n\n    // ========================================\n    // エスカレーション処理\n    // ========================================\n\n    /**\n     * エスカレーション処理を実行\n     */\n    processEscalations() {\n        // DataStoreとSettingsModuleが利用可能かチェック\n        if (typeof DataStore === 'undefined' || !DataStore.incidents) {\n            return;\n        }\n\n        // 設定からエスカレーション期限を取得\n        let escalationHours = 24; // デフォルト24時間\n        if (typeof SettingsModule !== 'undefined') {\n            const settings = SettingsModule.load();\n            escalationHours = settings.workflow?.incidentEscalation || 24;\n        }\n\n        const escalationMs = escalationHours * 60 * 60 * 1000;\n\n        // オープン状態かつ未エスカレートのインシデントを取得\n        const candidates = DataStore.incidents.filter(i =>\n            i.status === 'open' && !i.escalated\n        );\n\n        const now = new Date();\n\n        candidates.forEach(incident => {\n            const created = new Date(incident.created || incident.createdAt || incident.reportedAt);\n\n            if (now.getTime() - created.getTime() > escalationMs) {\n                this.escalateIncident(incident);\n            }\n        });\n    },\n\n    /**\n     * インシデントをエスカレート\n     * @param {Object} incident - インシデントオブジェクト\n     */\n    escalateIncident(incident) {\n        incident.escalated = true;\n        incident.escalatedAt = new Date().toISOString();\n\n        // 自動アサイン（設定がある場合）\n        if (typeof SettingsModule !== 'undefined') {\n            const settings = SettingsModule.load();\n            if (settings.workflow?.incidentAutoAssign && settings.workflow?.incidentDefaultAssignee) {\n                incident.assignee = settings.workflow.incidentDefaultAssignee;\n            }\n        }\n\n        // 通知\n        if (typeof NotificationManager !== 'undefined') {\n            NotificationManager.notifyEscalation(incident);\n        }\n\n        // ログ記録\n        if (typeof LogModule !== 'undefined') {\n            LogModule.addLog('escalation', 'インシデント', 'incident',\n                `エスカレーション: ${incident.id} - ${incident.title}`);\n        }\n\n        console.log(`WorkflowEngine: インシデント ${incident.id} をエスカレートしました`);\n    },\n\n    /**\n     * エスカレーションレベルを取得\n     * @param {Object} incident - インシデントオブジェクト\n     * @returns {number} エスカレーションレベル（0-3）\n     */\n    getEscalationLevel(incident) {\n        if (!incident.escalated) {\n            return 0; // 未エスカレート\n        }\n\n        const escalatedAt = new Date(incident.escalatedAt);\n        const now = new Date();\n        const hoursSinceEscalation = (now.getTime() - escalatedAt.getTime()) / (60 * 60 * 1000);\n\n        if (hoursSinceEscalation < 2) {\n            return 1; // レベル1: エスカレート直後\n        } else if (hoursSinceEscalation < 8) {\n            return 2; // レベル2: 2-8時間\n        } else {\n            return 3; // レベル3: 8時間以上\n        }\n    },\n\n    // ========================================\n    // ユーティリティ\n    // ========================================\n\n    /**\n     * 時間をフォーマット\n     * @param {number} ms - ミリ秒\n     * @returns {string} フォーマットされた時間文字列\n     */\n    formatDuration(ms) {\n        if (ms < 0) {ms = 0;}\n\n        const hours = Math.floor(ms / (60 * 60 * 1000));\n        const minutes = Math.floor((ms % (60 * 60 * 1000)) / (60 * 1000));\n\n        if (hours > 24) {\n            const days = Math.floor(hours / 24);\n            const remainingHours = hours % 24;\n            return `${days}日${remainingHours}時間`;\n        } else if (hours > 0) {\n            return `${hours}時間${minutes}分`;\n        } else {\n            return `${minutes}分`;\n        }\n    },\n\n    /**\n     * ステータスバッジのクラスを取得\n     * @param {string} slaStatus - SLAステータス\n     * @returns {string} CSSクラス名\n     */\n    getSlaStatusBadgeClass(slaStatus) {\n        switch (slaStatus) {\n        case 'ok':\n            return 'badge-success';\n        case 'warning':\n            return 'badge-warning';\n        case 'breach':\n            return 'badge-danger';\n        case 'completed':\n            return 'badge-info';\n        default:\n            return 'badge-secondary';\n        }\n    },\n\n    /**\n     * ステータスバッジのアイコンを取得\n     * @param {string} slaStatus - SLAステータス\n     * @returns {string} Font Awesomeアイコンクラス\n     */\n    getSlaStatusIcon(slaStatus) {\n        switch (slaStatus) {\n        case 'ok':\n            return 'fa-check-circle';\n        case 'warning':\n            return 'fa-exclamation-triangle';\n        case 'breach':\n            return 'fa-times-circle';\n        case 'completed':\n            return 'fa-flag-checkered';\n        default:\n            return 'fa-question-circle';\n        }\n    }\n};\n\n// グローバルに公開\nwindow.WorkflowEngine = WorkflowEngine;\n","usedDeprecatedRules":[{"ruleId":"semi","replacedBy":[]},{"ruleId":"quotes","replacedBy":[]},{"ruleId":"indent","replacedBy":[]},{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]
