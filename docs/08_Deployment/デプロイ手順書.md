# デプロイ手順書（詳細版）

**文書番号**: DEP-APPSUITE-001
**バージョン**: 1.0
**作成日**: 2026年2月4日
**対象システム**: AppSuite管理運用システム

---

## 目次

1. [概要](#1-概要)
2. [事前準備](#2-事前準備)
3. [ステージングデプロイ](#3-ステージングデプロイ)
4. [本番デプロイ](#4-本番デプロイ)
5. [デプロイ後検証](#5-デプロイ後検証)
6. [トラブルシューティング](#6-トラブルシューティング)

---

## 1. 概要

### 1.1 目的

本書は、AppSuite管理運用システムを本番環境に安全にデプロイするための詳細手順を提供する。

### 1.2 適用範囲

- ステージング環境へのデプロイ
- 本番環境へのデプロイ
- デプロイ後の動作確認

### 1.3 デプロイ方式

| 方式 | 説明 | 対象環境 |
|------|------|---------|
| **手動デプロイ** | SSH/rsyncを使用した手動配置 | ステージング、本番 |
| **CI/CDデプロイ** | 自動化パイプライン（将来対応） | - |

### 1.4 前提条件

- [ ] Phase 4（テストフェーズ）が完了している
- [ ] リリース判定会議で承認を得ている
- [ ] デプロイ担当者がサーバーへのSSHアクセス権を持っている
- [ ] バックアップ手順が確認されている
- [ ] ロールバック手順が確認されている

---

## 2. 事前準備

### 2.1 環境情報の確認

#### 2.1.1 ステージング環境情報

```bash
# 環境情報シート（実際の値に置き換える）
STAGING_HOST="staging.example.com"
STAGING_USER="deploy-user"
STAGING_PATH="/var/www/html/appsuite-itsm"
STAGING_URL="https://staging.example.com/appsuite-itsm"
```

#### 2.1.2 本番環境情報

```bash
# 環境情報シート（実際の値に置き換える）
PRODUCTION_HOST="appsuite-itsm.example.com"
PRODUCTION_USER="deploy-user"
PRODUCTION_PATH="/var/www/html/appsuite-itsm"
PRODUCTION_URL="https://appsuite-itsm.example.com"
```

### 2.2 必要なツールの確認

```bash
# ローカル環境で実行
# rsync の確認
rsync --version
# 期待: rsync version 3.x 以上

# ssh の確認
ssh -V
# 期待: OpenSSH_8.x 以上

# tar の確認
tar --version
# 期待: tar (GNU tar) 1.x 以上

# curl の確認
curl --version
# 期待: curl 7.x 以上
```

### 2.3 SSH接続確認

#### 2.3.1 ステージング環境

```bash
# SSH接続テスト
ssh ${STAGING_USER}@${STAGING_HOST} "echo 'Connection successful'"

# 期待出力: Connection successful
```

#### 2.3.2 本番環境

```bash
# SSH接続テスト
ssh ${PRODUCTION_USER}@${PRODUCTION_HOST} "echo 'Connection successful'"

# 期待出力: Connection successful
```

### 2.4 デプロイパッケージの準備

```bash
# プロジェクトルートに移動
cd /path/to/Appsuite-ITSM-Management

# ソースコードの最新状態を確認
git status

# 期待: nothing to commit, working tree clean

# デプロイ対象ブランチの確認
git branch --show-current

# 期待: main (または release/v1.0)

# 最新コミットの確認
git log -1 --oneline

# WebUI-Production の内容確認
ls -la WebUI-Production/
# 期待:
# index.html
# css/styles.css
# js/api.js
# js/modules.js
# js/security.js
# js/app.js
```

### 2.5 デプロイ前チェックリスト

| No. | 確認項目 | 確認方法 | 状態 |
|-----|---------|---------|------|
| 1 | Git リポジトリがクリーンな状態 | `git status` | □ |
| 2 | 本番用ブランチにいる | `git branch --show-current` | □ |
| 3 | 最新コードがプルされている | `git pull` | □ |
| 4 | ファイル構成が正しい | `ls WebUI-Production/` | □ |
| 5 | SSH接続が可能 | `ssh user@host` | □ |
| 6 | バックアップ手順を理解している | 手順書確認 | □ |
| 7 | ロールバック手順を理解している | 手順書確認 | □ |
| 8 | 緊急連絡先を把握している | 連絡先リスト確認 | □ |

---

## 3. ステージングデプロイ

**実施日時**: Week 25 Day 1 13:00-17:00
**担当**: BE開発者
**立会**: PM、QA

### 3.1 ステージング環境準備

```bash
# ========================================
# Step 1: ステージングサーバーへSSH接続
# ========================================
ssh ${STAGING_USER}@${STAGING_HOST}

# ========================================
# Step 2: Webサーバーの状態確認
# ========================================
# Apache の場合
sudo systemctl status apache2

# Nginx の場合
sudo systemctl status nginx

# 期待: active (running)

# ========================================
# Step 3: ディスク容量確認
# ========================================
df -h

# 期待: /var に最低1GB以上の空き容量

# ========================================
# Step 4: バックアップディレクトリ作成
# ========================================
sudo mkdir -p /var/backups/appsuite-itsm
sudo chown ${STAGING_USER}:${STAGING_USER} /var/backups/appsuite-itsm
```

### 3.2 既存環境のバックアップ

```bash
# ========================================
# Step 1: 現在のバージョンを確認
# ========================================
ls -la ${STAGING_PATH}/

# 既存のバージョンが存在する場合のみバックアップ
if [ -d "${STAGING_PATH}" ]; then
    BACKUP_DATE=$(date +%Y%m%d_%H%M%S)

    # ========================================
    # Step 2: tar.gz形式でバックアップ
    # ========================================
    sudo tar -czf /var/backups/appsuite-itsm/staging_backup_${BACKUP_DATE}.tar.gz \
        -C /var/www/html appsuite-itsm

    echo "Backup created: staging_backup_${BACKUP_DATE}.tar.gz"

    # ========================================
    # Step 3: バックアップファイルの確認
    # ========================================
    ls -lh /var/backups/appsuite-itsm/staging_backup_${BACKUP_DATE}.tar.gz
fi
```

### 3.3 ソースコードの転送

```bash
# ========================================
# ローカル環境で実行
# ========================================
cd /path/to/Appsuite-ITSM-Management

# ========================================
# Step 1: 転送前の最終確認
# ========================================
echo "以下のファイルを転送します:"
find WebUI-Production -type f -name "*.html" -o -name "*.css" -o -name "*.js"

# ========================================
# Step 2: rsyncで転送
# ========================================
rsync -avz --delete \
    --exclude='.git' \
    --exclude='.gitignore' \
    --exclude='docs' \
    --exclude='README.md' \
    --exclude='DEPLOYMENT.md' \
    --exclude='node_modules' \
    --exclude='.DS_Store' \
    --exclude='*.swp' \
    --exclude='*.bak' \
    --progress \
    --dry-run \
    WebUI-Production/ ${STAGING_USER}@${STAGING_HOST}:/tmp/appsuite-itsm-new/

# dry-runで問題なければ、実際に転送
rsync -avz --delete \
    --exclude='.git' \
    --exclude='.gitignore' \
    --exclude='docs' \
    --exclude='README.md' \
    --exclude='DEPLOYMENT.md' \
    --exclude='node_modules' \
    --exclude='.DS_Store' \
    --exclude='*.swp' \
    --exclude='*.bak' \
    --progress \
    WebUI-Production/ ${STAGING_USER}@${STAGING_HOST}:/tmp/appsuite-itsm-new/

# 期待出力: sent XXX bytes  received XXX bytes
```

### 3.4 ファイルの配置

```bash
# ========================================
# ステージングサーバーで実行
# ========================================
ssh ${STAGING_USER}@${STAGING_HOST}

# ========================================
# Step 1: 転送ファイルの確認
# ========================================
ls -la /tmp/appsuite-itsm-new/
find /tmp/appsuite-itsm-new/ -type f

# ========================================
# Step 2: 既存ディレクトリの削除
# ========================================
sudo rm -rf ${STAGING_PATH}

# ========================================
# Step 3: 新バージョンの配置
# ========================================
sudo cp -r /tmp/appsuite-itsm-new ${STAGING_PATH}

# ========================================
# Step 4: 権限設定
# ========================================
# 所有者設定（Apache/Nginxのユーザーに変更）
sudo chown -R www-data:www-data ${STAGING_PATH}

# ディレクトリ権限: 755
sudo find ${STAGING_PATH} -type d -exec chmod 755 {} \;

# ファイル権限: 644
sudo find ${STAGING_PATH} -type f -exec chmod 644 {} \;

# 権限確認
ls -la ${STAGING_PATH}/
ls -la ${STAGING_PATH}/css/
ls -la ${STAGING_PATH}/js/
```

### 3.5 Webサーバー設定

#### 3.5.1 Apache の場合

```bash
# ========================================
# Step 1: 設定ファイルの確認
# ========================================
sudo nano /etc/apache2/sites-available/appsuite-itsm-staging.conf

# 以下の内容を確認・修正
<VirtualHost *:443>
    ServerName staging.example.com
    DocumentRoot /var/www/html/appsuite-itsm

    SSLEngine on
    SSLProtocol -all +TLSv1.2 +TLSv1.3
    SSLCipherSuite HIGH:!aNULL:!MD5:!RC4
    SSLCertificateFile /etc/ssl/certs/staging.crt
    SSLCertificateKeyFile /etc/ssl/private/staging.key

    # セキュリティヘッダー
    Header always set Strict-Transport-Security "max-age=31536000"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"

    <Directory /var/www/html/appsuite-itsm>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>

# ========================================
# Step 2: 設定の有効化
# ========================================
sudo a2ensite appsuite-itsm-staging.conf
sudo a2enmod ssl headers rewrite

# ========================================
# Step 3: 設定のシンタックスチェック
# ========================================
sudo apache2ctl configtest

# 期待出力: Syntax OK
```

#### 3.5.2 Nginx の場合

```bash
# ========================================
# Step 1: 設定ファイルの確認
# ========================================
sudo nano /etc/nginx/sites-available/appsuite-itsm-staging

# 以下の内容を確認・修正
server {
    listen 443 ssl http2;
    server_name staging.example.com;
    root /var/www/html/appsuite-itsm;
    index index.html;

    ssl_certificate /etc/nginx/ssl/staging.crt;
    ssl_certificate_key /etc/nginx/ssl/staging.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5:!RC4;

    add_header Strict-Transport-Security "max-age=31536000" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-Frame-Options "SAMEORIGIN" always;

    location / {
        try_files $uri $uri/ /index.html;
    }
}

# ========================================
# Step 2: 設定の有効化
# ========================================
sudo ln -sf /etc/nginx/sites-available/appsuite-itsm-staging \
    /etc/nginx/sites-enabled/

# ========================================
# Step 3: 設定のシンタックスチェック
# ========================================
sudo nginx -t

# 期待出力: syntax is ok
#           test is successful
```

### 3.6 Webサーバー再起動

```bash
# ========================================
# Step 1: ログの監視を開始（別ターミナル）
# ========================================
# Apache
sudo tail -f /var/log/apache2/error.log

# Nginx
sudo tail -f /var/log/nginx/error.log

# ========================================
# Step 2: Webサーバー再起動
# ========================================
# Apache
sudo systemctl restart apache2

# Nginx
sudo systemctl restart nginx

# ========================================
# Step 3: 再起動確認
# ========================================
# Apache
sudo systemctl status apache2

# Nginx
sudo systemctl status nginx

# 期待: active (running)
```

### 3.7 デプロイ確認

```bash
# ========================================
# Step 1: HTTPSアクセス確認
# ========================================
curl -I ${STAGING_URL}/

# 期待出力:
# HTTP/2 200
# content-type: text/html

# ========================================
# Step 2: セキュリティヘッダー確認
# ========================================
curl -I ${STAGING_URL}/ | grep -E "(Strict-Transport-Security|X-Content-Type-Options|X-Frame-Options)"

# 期待出力:
# strict-transport-security: max-age=31536000
# x-content-type-options: nosniff
# x-frame-options: SAMEORIGIN

# ========================================
# Step 3: HTMLコンテンツ取得確認
# ========================================
curl -s ${STAGING_URL}/ | head -n 30

# 期待: <!DOCTYPE html> で始まるHTMLが表示される

# ========================================
# Step 4: ブラウザでアクセス確認
# ========================================
# ブラウザで以下のURLにアクセス
# https://staging.example.com/appsuite-itsm/

# 期待:
# - ダッシュボードが表示される
# - コンソールエラーがない
# - すべてのCSS/JSが読み込まれている
```

### 3.8 一時ファイルの削除

```bash
# ========================================
# 転送用一時ディレクトリの削除
# ========================================
sudo rm -rf /tmp/appsuite-itsm-new

# ========================================
# デプロイ完了ログの記録
# ========================================
echo "Staging deployment completed at $(date)" | \
    sudo tee -a /var/log/appsuite-itsm-deploy.log
```

---

## 4. 本番デプロイ

**実施日時**: Week 26 Day 1（月曜日）09:00-10:00
**担当**: BE開発者、インフラ担当
**立会**: PM、QA

### 4.1 デプロイ前最終確認

```bash
# ========================================
# 実施日時: 08:00-08:30
# ========================================

# ✓ デプロイ前チェックリスト（再確認）
# [ ] ステージング環境で全機能動作確認済み
# [ ] リリース判定会議で承認取得済み
# [ ] 本番サーバーへのアクセス権限確認
# [ ] デプロイパッケージの最終確認
# [ ] バックアップ手順の確認
# [ ] ロールバック手順の確認
# [ ] 関係者への事前通知完了
# [ ] サポート体制の確認
# [ ] SSL証明書の有効期限確認（3ヶ月以上）
# [ ] DNSレコードの確認
```

### 4.2 本番環境準備

```bash
# ========================================
# Step 1: 本番サーバーへSSH接続
# ========================================
ssh ${PRODUCTION_USER}@${PRODUCTION_HOST}

# ========================================
# Step 2: Webサーバーの状態確認
# ========================================
# Apache
sudo systemctl status apache2

# Nginx
sudo systemctl status nginx

# 期待: active (running)

# ========================================
# Step 3: ディスク容量確認
# ========================================
df -h

# 期待: /var に最低1GB以上の空き容量

# ========================================
# Step 4: SSL証明書の有効期限確認
# ========================================
# Apache
sudo openssl x509 -in /etc/ssl/certs/production.crt -noout -enddate

# Nginx
sudo openssl x509 -in /etc/nginx/ssl/production.crt -noout -enddate

# 期待: notAfter が3ヶ月以上先

# ========================================
# Step 5: バックアップディレクトリ作成
# ========================================
sudo mkdir -p /var/backups/appsuite-itsm
sudo chown ${PRODUCTION_USER}:${PRODUCTION_USER} /var/backups/appsuite-itsm
```

### 4.3 完全バックアップ取得

```bash
# ========================================
# ★重要: 本番環境の完全バックアップ
# ========================================
BACKUP_DATE=$(date +%Y%m%d_%H%M%S)

# ========================================
# Step 1: 既存ファイルのバックアップ
# ========================================
if [ -d "${PRODUCTION_PATH}" ]; then
    sudo tar -czf /var/backups/appsuite-itsm/production_backup_${BACKUP_DATE}.tar.gz \
        -C /var/www/html appsuite-itsm

    echo "✓ Backup created: production_backup_${BACKUP_DATE}.tar.gz"
else
    echo "! No existing deployment found. Skipping backup."
fi

# ========================================
# Step 2: バックアップの確認
# ========================================
ls -lh /var/backups/appsuite-itsm/production_backup_${BACKUP_DATE}.tar.gz

# 期待: ファイルサイズが表示される（数MB程度）

# ========================================
# Step 3: バックアップファイルの整合性確認
# ========================================
sudo tar -tzf /var/backups/appsuite-itsm/production_backup_${BACKUP_DATE}.tar.gz | head -n 20

# 期待: ファイル一覧が表示される

# ========================================
# Step 4: バックアップのコピー（オプション）
# ========================================
# 外部ストレージへバックアップをコピー（推奨）
# sudo scp /var/backups/appsuite-itsm/production_backup_${BACKUP_DATE}.tar.gz \
#     backup-server:/backups/
```

### 4.4 メンテナンスモード設定（オプション）

```bash
# ========================================
# 一時的なメンテナンスページを表示（オプション）
# ========================================

# メンテナンスページの作成
sudo tee /var/www/html/maintenance.html > /dev/null <<'EOF'
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>メンテナンス中</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
            background-color: #f5f5f5;
        }
        h1 { color: #333; }
        p { color: #666; }
    </style>
</head>
<body>
    <h1>メンテナンス中</h1>
    <p>システムのアップデートを行っています。</p>
    <p>しばらくお待ちください。</p>
    <p>完了予定: 10:00</p>
</body>
</html>
EOF

# Webサーバー設定を一時的に変更（必要に応じて）
# sudo mv /var/www/html/appsuite-itsm/index.html \
#     /var/www/html/appsuite-itsm/index.html.bak
# sudo cp /var/www/html/maintenance.html \
#     /var/www/html/appsuite-itsm/index.html
```

### 4.5 ソースコードの転送

```bash
# ========================================
# ローカル環境で実行
# ========================================
cd /path/to/Appsuite-ITSM-Management

# ========================================
# Step 1: Git の最終確認
# ========================================
git status
# 期待: nothing to commit, working tree clean

git log -1 --oneline
# 最新コミットを確認

git branch --show-current
# 期待: main (または release/v1.0)

# ========================================
# Step 2: デプロイファイルの確認
# ========================================
echo "デプロイ対象ファイル:"
find WebUI-Production -type f | sort

# ========================================
# Step 3: dry-run で転送内容を確認
# ========================================
rsync -avz --delete \
    --exclude='.git' \
    --exclude='.gitignore' \
    --exclude='docs' \
    --exclude='README.md' \
    --exclude='DEPLOYMENT.md' \
    --exclude='node_modules' \
    --exclude='.DS_Store' \
    --exclude='*.swp' \
    --exclude='*.bak' \
    --progress \
    --dry-run \
    WebUI-Production/ ${PRODUCTION_USER}@${PRODUCTION_HOST}:/tmp/appsuite-itsm-new/

# 期待出力を確認後、実際に転送

# ========================================
# Step 4: 実際に転送
# ========================================
rsync -avz --delete \
    --exclude='.git' \
    --exclude='.gitignore' \
    --exclude='docs' \
    --exclude='README.md' \
    --exclude='DEPLOYMENT.md' \
    --exclude='node_modules' \
    --exclude='.DS_Store' \
    --exclude='*.swp' \
    --exclude='*.bak' \
    --progress \
    WebUI-Production/ ${PRODUCTION_USER}@${PRODUCTION_HOST}:/tmp/appsuite-itsm-new/

# 期待出力:
# sent XXX bytes  received XXX bytes  XXX.XX bytes/sec
# total size is XXX  speedup is X.XX
```

### 4.6 本番ファイルの配置

```bash
# ========================================
# 本番サーバーで実行
# ========================================
ssh ${PRODUCTION_USER}@${PRODUCTION_HOST}

# ========================================
# Step 1: 転送ファイルの確認
# ========================================
ls -la /tmp/appsuite-itsm-new/
find /tmp/appsuite-itsm-new/ -type f

# ファイル数の確認
find /tmp/appsuite-itsm-new/ -type f | wc -l

# ========================================
# Step 2: 既存ディレクトリの削除（バックアップ済み）
# ========================================
sudo rm -rf ${PRODUCTION_PATH}

# ========================================
# Step 3: 新バージョンの配置
# ========================================
sudo cp -r /tmp/appsuite-itsm-new ${PRODUCTION_PATH}

# ========================================
# Step 4: 権限設定
# ========================================
# 所有者設定
sudo chown -R www-data:www-data ${PRODUCTION_PATH}

# ディレクトリ権限: 755
sudo find ${PRODUCTION_PATH} -type d -exec chmod 755 {} \;

# ファイル権限: 644
sudo find ${PRODUCTION_PATH} -type f -exec chmod 644 {} \;

# ========================================
# Step 5: 権限確認
# ========================================
ls -la ${PRODUCTION_PATH}/
ls -la ${PRODUCTION_PATH}/css/
ls -la ${PRODUCTION_PATH}/js/

# 期待:
# drwxr-xr-x www-data www-data css
# drwxr-xr-x www-data www-data js
# -rw-r--r-- www-data www-data index.html
```

### 4.7 Webサーバー設定確認

```bash
# ========================================
# Step 1: 設定ファイルのシンタックスチェック
# ========================================
# Apache
sudo apache2ctl configtest

# Nginx
sudo nginx -t

# 期待: Syntax OK / test is successful

# エラーがある場合は修正してから次へ進む
```

### 4.8 Webサーバー再起動

```bash
# ========================================
# Step 1: ログの監視を開始（別ターミナル）
# ========================================
# Apache
sudo tail -f /var/log/apache2/error.log

# Nginx
sudo tail -f /var/log/nginx/error.log

# ========================================
# Step 2: Webサーバー再起動
# ========================================
echo "Webサーバー再起動開始: $(date)"

# Apache
sudo systemctl restart apache2

# Nginx
sudo systemctl restart nginx

echo "Webサーバー再起動完了: $(date)"

# ========================================
# Step 3: 再起動確認
# ========================================
# Apache
sudo systemctl status apache2

# Nginx
sudo systemctl status nginx

# 期待: active (running)

# プロセス確認
ps aux | grep -E 'apache2|nginx' | grep -v grep
```

### 4.9 デプロイ確認

```bash
# ========================================
# Step 1: HTTPSアクセス確認
# ========================================
curl -I ${PRODUCTION_URL}/

# 期待出力:
# HTTP/2 200
# content-type: text/html

# ========================================
# Step 2: セキュリティヘッダー確認
# ========================================
curl -I ${PRODUCTION_URL}/ | grep -E "(Strict-Transport-Security|X-Content-Type-Options|X-Frame-Options|Content-Security-Policy)"

# 期待出力:
# strict-transport-security: max-age=31536000; includeSubDomains
# x-content-type-options: nosniff
# x-frame-options: SAMEORIGIN
# content-security-policy: ...

# ========================================
# Step 3: HTMLコンテンツ取得確認
# ========================================
curl -s ${PRODUCTION_URL}/ | head -n 30

# 期待: <!DOCTYPE html> で始まるHTMLが表示される

# ========================================
# Step 4: リダイレクト確認（HTTP → HTTPS）
# ========================================
curl -I http://appsuite-itsm.example.com/

# 期待出力:
# HTTP/1.1 301 Moved Permanently
# Location: https://appsuite-itsm.example.com/
```

### 4.10 一時ファイルの削除

```bash
# ========================================
# 転送用一時ディレクトリの削除
# ========================================
sudo rm -rf /tmp/appsuite-itsm-new

# ========================================
# デプロイ完了ログの記録
# ========================================
echo "Production deployment completed at $(date)" | \
    sudo tee -a /var/log/appsuite-itsm-deploy.log

echo "Deployed version: $(git -C /path/to/Appsuite-ITSM-Management log -1 --oneline)" | \
    sudo tee -a /var/log/appsuite-itsm-deploy.log
```

---

## 5. デプロイ後検証

**実施日時**: Week 26 Day 1 10:00-11:00
**担当**: QA、全開発者

### 5.1 基本動作確認

#### 5.1.1 コマンドラインでの確認

```bash
# ========================================
# 1. HTTPSアクセス確認
# ========================================
curl -I https://appsuite-itsm.example.com/
# 期待: HTTP/2 200 OK

# ========================================
# 2. セキュリティヘッダー確認
# ========================================
curl -I https://appsuite-itsm.example.com/ | grep "Strict-Transport-Security"
# 期待: Strict-Transport-Security: max-age=31536000; includeSubDomains

# ========================================
# 3. リダイレクト確認（HTTP → HTTPS）
# ========================================
curl -I http://appsuite-itsm.example.com/
# 期待: HTTP/1.1 301 Moved Permanently

# ========================================
# 4. ページ読み込み速度確認
# ========================================
time curl -s https://appsuite-itsm.example.com/ > /dev/null
# 期待: real時間が3秒以内
```

#### 5.1.2 ブラウザでの確認

**ブラウザ**: Chrome、Firefox、Edge

1. **トップページアクセス**
   - URL: `https://appsuite-itsm.example.com/`
   - 期待: ダッシュボードが表示される

2. **開発者ツール確認**
   - F12 → Console
   - 期待: エラーメッセージがない

3. **ネットワーク確認**
   - F12 → Network → Reload
   - 期待: すべてのリソース（CSS/JS）が200 OKで読み込まれる

4. **セキュリティ確認**
   - URL欄の鍵アイコンをクリック
   - 期待: 「接続は保護されています」と表示される

### 5.2 機能検証チェックリスト

| No. | 検証項目 | 手順 | 期待結果 | 結果 | 確認者 | 時刻 |
|-----|---------|------|---------|------|--------|------|
| 1 | ダッシュボード表示 | トップページにアクセス | 統計カードが表示される | □ | QA | |
| 2 | ナビゲーション | サイドバーの各メニューをクリック | 各画面に遷移する | □ | QA | |
| 3 | ユーザー管理 | ユーザー一覧を表示 | ユーザーリストが表示される | □ | QA | |
| 4 | ユーザー新規登録 | テストユーザーを登録 | 登録成功メッセージ | □ | QA | |
| 5 | ユーザー検索 | 検索ボックスで検索 | 該当ユーザーが表示される | □ | QA | |
| 6 | アプリ管理 | アプリ一覧を表示 | アプリリストが表示される | □ | QA | |
| 7 | アプリ新規登録 | テストアプリを登録 | 登録成功メッセージ | □ | QA | |
| 8 | インシデント管理 | インシデント一覧を表示 | インシデントリストが表示される | □ | QA | |
| 9 | インシデント新規登録 | テストインシデントを登録 | 登録成功メッセージ | □ | QA | |
| 10 | 変更管理 | 変更要求一覧を表示 | 変更要求リストが表示される | □ | QA | |
| 11 | 変更要求新規登録 | テスト変更要求を登録 | 登録成功メッセージ | □ | QA | |
| 12 | 監査ログ | ログ一覧を表示 | 操作ログが表示される | □ | QA | |
| 13 | ログ検索 | 日付範囲で検索 | 該当ログが表示される | □ | QA | |
| 14 | ログエクスポート | エクスポートボタンをクリック | CSVダウンロード | □ | QA | |
| 15 | システム設定 | 設定画面を表示 | 6タブが表示される | □ | QA | |
| 16 | API接続設定 | 設定を入力して保存 | 保存成功メッセージ | □ | QA | |
| 17 | バックアップ作成 | バックアップボタンをクリック | JSONダウンロード | □ | QA | |
| 18 | リストア | バックアップからリストア | データ復元成功 | □ | QA | |
| 19 | レスポンシブ | ブラウザ幅を変更 | レイアウトが調整される | □ | QA | |
| 20 | モバイル表示 | デバイスツールバーでモバイル | モバイルレイアウト表示 | □ | QA | |

### 5.3 性能確認

```bash
# ========================================
# 1. ページ読み込み速度（curl）
# ========================================
time curl -s https://appsuite-itsm.example.com/ > /dev/null
# 期待: real時間が3秒以内

# ========================================
# 2. 複数回の読み込み速度確認
# ========================================
for i in {1..5}; do
    echo "Test $i:"
    time curl -s https://appsuite-itsm.example.com/ > /dev/null
done

# ========================================
# 3. ブラウザでの確認
# ========================================
# Chrome開発者ツール:
# F12 → Network → Reload
# 期待: DOMContentLoaded < 3s, Load < 5s
```

### 5.4 ログ確認

```bash
# ========================================
# 1. エラーログ確認（直近100行）
# ========================================
# Apache
sudo tail -n 100 /var/log/apache2/error.log

# Nginx
sudo tail -n 100 /var/log/nginx/error.log

# 期待: [error] や [crit] レベルのメッセージがないこと

# ========================================
# 2. アクセスログ確認
# ========================================
# Apache
sudo tail -n 50 /var/log/apache2/access.log

# Nginx
sudo tail -n 50 /var/log/nginx/access.log

# 期待: 200 OK のレスポンスが記録されている

# ========================================
# 3. システムログ確認
# ========================================
sudo journalctl -u apache2 -n 50   # Apache
sudo journalctl -u nginx -n 50     # Nginx

# 期待: 起動・再起動が正常に記録されている
```

### 5.5 セキュリティ確認

```bash
# ========================================
# 1. SSL Labsテスト（オプション）
# ========================================
# ブラウザで以下にアクセス:
# https://www.ssllabs.com/ssltest/analyze.html?d=appsuite-itsm.example.com
# 期待: A評価以上

# ========================================
# 2. セキュリティヘッダーチェック（オプション）
# ========================================
# ブラウザで以下にアクセス:
# https://securityheaders.com/?q=https://appsuite-itsm.example.com
# 期待: A評価以上
```

---

## 6. トラブルシューティング

### 6.1 よくある問題と対処法

#### 6.1.1 接続エラー（502 Bad Gateway）

**症状**: `curl -I` で502エラーが返る

**原因**: Webサーバーが起動していない

**対処**:
```bash
# Webサーバーの状態確認
sudo systemctl status apache2    # Apache
sudo systemctl status nginx       # Nginx

# 起動していない場合は起動
sudo systemctl start apache2      # Apache
sudo systemctl start nginx        # Nginx
```

#### 6.1.2 403 Forbidden エラー

**症状**: ブラウザで403エラーが表示される

**原因**: ファイル権限が不正

**対処**:
```bash
# 権限を再設定
sudo chown -R www-data:www-data ${PRODUCTION_PATH}
sudo find ${PRODUCTION_PATH} -type d -exec chmod 755 {} \;
sudo find ${PRODUCTION_PATH} -type f -exec chmod 644 {} \;

# Webサーバー再起動
sudo systemctl restart apache2    # Apache
sudo systemctl restart nginx      # Nginx
```

#### 6.1.3 404 Not Found エラー

**症状**: ページが見つからない

**原因**: ファイルが正しく配置されていない

**対処**:
```bash
# ファイルの存在確認
ls -la ${PRODUCTION_PATH}/index.html

# 存在しない場合は再デプロイ
# （デプロイ手順を再実行）
```

#### 6.1.4 CSS/JSが読み込まれない

**症状**: スタイルが適用されていない、JavaScriptが動作しない

**原因**: ファイルパスが不正、またはMIMEタイプの問題

**対処**:
```bash
# ファイルの存在確認
ls -la ${PRODUCTION_PATH}/css/styles.css
ls -la ${PRODUCTION_PATH}/js/app.js

# ブラウザの開発者ツールでネットワークタブを確認
# 404エラーがないか確認

# ブラウザのキャッシュをクリア
# Ctrl + Shift + Del → キャッシュクリア
```

#### 6.1.5 SSL証明書エラー

**症状**: 「接続が保護されていません」と表示される

**原因**: 証明書の有効期限切れ、または設定ミス

**対処**:
```bash
# 証明書の確認
# Apache
sudo openssl x509 -in /etc/ssl/certs/production.crt -noout -dates

# Nginx
sudo openssl x509 -in /etc/nginx/ssl/production.crt -noout -dates

# 有効期限が切れている場合は証明書を更新
# 設定ファイルのパスを確認
```

### 6.2 緊急時の対応

#### 6.2.1 ロールバックが必要な場合

**判断基準**:
- 重大な機能が動作しない
- データ消失が発生
- セキュリティ脆弱性が発見された

**対処**: [ロールバック手順書](./ロールバック手順書.md) を参照

#### 6.2.2 緊急連絡

**連絡先**:
- PM: pm@example.com / 090-xxxx-xxxx
- インフラ: infra@example.com / 090-xxxx-xxxx

---

**文書履歴**

| バージョン | 日付 | 変更内容 | 作成者 |
|-----------|------|----------|--------|
| 1.0 | 2026-02-04 | 初版作成 | システム管理者 |
