# Phase 1: データフロー図とシステム構成

**作成日**: 2026年1月21日
**Phase**: Phase 1 - 要件定義
**対象システム**: AppSuite ITSM Management System

---

## 📋 目次

1. [システム構成図](#1-システム構成図)
2. [データフロー図（DFD）](#2-データフロー図dfd)
3. [データモデル](#3-データモデル)
4. [画面遷移図](#4-画面遷移図)

---

## 1. システム構成図

### 1.1 全体システム構成

```
┌─────────────────────────────────────────────────────────────┐
│                         ユーザー                             │
│               （IT管理者、サービスデスク、技術担当者）          │
└────────────────────────┬────────────────────────────────────┘
                         │ HTTPS (本番) / HTTP (開発)
                         ▼
┌─────────────────────────────────────────────────────────────┐
│                      Webブラウザ                             │
│              (Chrome 90+, Firefox 88+, Edge 90+)            │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────┐
│                    Webサーバー                               │
│            (Apache / Nginx / http-server)                   │
│   ┌─────────────────────────────────────────────────┐       │
│   │         静的ファイル配信                         │       │
│   │  - index.html                                   │       │
│   │  - css/styles.css                               │       │
│   │  - js/app.js, modules.js, api.js                │       │
│   └─────────────────────────────────────────────────┘       │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────┐
│              ブラウザ内JavaScript実行環境                     │
│                                                              │
│   ┌──────────────────────────────────────────────┐          │
│   │           アプリケーションロジック            │          │
│   │  ┌────────────┐  ┌────────────┐             │          │
│   │  │ UI Layer   │  │ API Layer  │             │          │
│   │  │ (app.js)   │  │ (api.js)   │             │          │
│   │  └─────┬──────┘  └──────┬─────┘             │          │
│   │        │                 │                   │          │
│   │        ▼                 ▼                   │          │
│   │  ┌─────────────────────────────┐            │          │
│   │  │    Business Logic Layer     │            │          │
│   │  │      (modules.js)           │            │          │
│   │  │                             │            │          │
│   │  │  - UserModule               │            │          │
│   │  │  - AppModule                │            │          │
│   │  │  - IncidentModule           │            │          │
│   │  │  - ChangeModule             │            │          │
│   │  │  - LogModule                │            │          │
│   │  │  - SettingsModule           │            │          │
│   │  └──────────┬──────────────────┘            │          │
│   │             │                                │          │
│   │             ▼                                │          │
│   │  ┌─────────────────────────────┐            │          │
│   │  │  Data Access Layer          │            │          │
│   │  │  (localStorage Manager)     │            │          │
│   │  └──────────┬──────────────────┘            │          │
│   └─────────────┼───────────────────────────────┘          │
│                 │                                            │
│                 ▼                                            │
│   ┌──────────────────────────────────────────────┐          │
│   │          localStorage                        │          │
│   │  - appsuite_users                            │          │
│   │  - appsuite_apps                             │          │
│   │  - appsuite_incidents                        │          │
│   │  - appsuite_changes                          │          │
│   │  - appsuite_logs                             │          │
│   │  - appsuite_settings                         │          │
│   └──────────────────────────────────────────────┘          │
└────────────────────────┬────────────────────────────────────┘
                         │ (オプション)
                         │ REST API
                         ▼
┌─────────────────────────────────────────────────────────────┐
│                DeskNet's Neo API (外部システム)               │
│                                                              │
│   エンドポイント:                                             │
│   https://{domain}.desknets.com/cgi-bin/dneo/zap.cgi        │
│                                                              │
│   主要コマンド:                                              │
│   - getuser: ユーザー情報取得                                 │
│   - getapps: アプリ一覧取得                                  │
│   - test: 接続テスト                                         │
└─────────────────────────────────────────────────────────────┘
```

---

### 1.2 開発環境 vs 本番環境

| 項目 | 開発環境 | 本番環境 |
|------|---------|---------|
| **プロトコル** | HTTP | HTTPS (TLS 1.2+) |
| **ポート** | 3000 | 8443 |
| **URL** | http://192.168.0.145:3000 | https://192.168.0.145:8443 |
| **SSL証明書** | 不要 | 自己署名証明書 |
| **サンプルデータ** | 有効 | 無効 |
| **デバッグモード** | 有効 | 無効 |
| **キャッシュ** | 無効 | 有効（86400秒） |
| **CORS** | 有効（*） | 制限あり |

---

## 2. データフロー図（DFD）

### 2.1 コンテキスト図（レベル0）

```
                          ┌─────────────┐
                          │IT管理者     │
                          │サービスデスク │
                          │技術担当者    │
                          └──────┬──────┘
                                 │
                     ユーザー情報、│操作指示
                     統計情報     │
                                 ▼
              ┌──────────────────────────────────┐
              │                                  │
              │   AppSuite ITSM                  │
              │   Management System              │
              │                                  │
              └────────────┬────────────┬────────┘
                          │            │
              API情報     │            │ログ出力、
              (オプション) │            │レポート
                          │            │
                          ▼            ▼
              ┌──────────────┐  ┌───────────────┐
              │DeskNet's Neo │  │ファイルシステム │
              │API           │  │(CSV Export)    │
              └──────────────┘  └───────────────┘
```

---

### 2.2 レベル1 DFD（主要プロセス）

```
┌──────────────┐
│ユーザー      │
└──────┬───────┘
       │
       │ログイン情報
       ▼
┌─────────────────────────────────────────────────────┐
│  1.0                                                │
│  認証・セッション管理                                │
└──────┬──────────────────────────────────────────────┘
       │認証済みセッション
       ▼
┌─────────────────────────────────────────────────────┐
│  2.0                                                │
│  ダッシュボード表示                                  │
│  (統計情報の集計・表示)                              │
└──────┬──────────────────────────────────────────────┘
       │
       ├───→ [D1: users]
       ├───→ [D2: apps]
       ├───→ [D3: incidents]
       ├───→ [D4: changes]
       └───→ [D5: logs]

┌─────────────────────────────────────────────────────┐
│  3.0                                                │
│  ユーザー管理                                        │
│  (CRUD操作)                                         │
└──────┬──────────────────────────────────────────────┘
       │
       ├───→ [D1: users] ◄───┐
       └───→ [D5: logs]       │
              (監査記録)       │
                              │
┌─────────────────────────────┼───────────────────────┐
│  4.0                        │                       │
│  アプリ管理                  │                       │
│  (CRUD操作)                 │                       │
└──────┬──────────────────────┘                       │
       │                                              │
       ├───→ [D2: apps] ◄────┘                       │
       ├───→ [D5: logs]                              │
       │                                              │
       │     DeskNet's Neo API                        │
       └─────→ (オプション連携) ───────────────────────┘

┌─────────────────────────────────────────────────────┐
│  5.0                                                │
│  インシデント管理                                    │
│  (CRUD操作、ステータス管理)                          │
└──────┬──────────────────────────────────────────────┘
       │
       ├───→ [D3: incidents]
       ├───→ [D5: logs]
       │
       │     関連アプリ情報
       └───→ [D2: apps] (参照)

┌─────────────────────────────────────────────────────┐
│  6.0                                                │
│  変更管理                                            │
│  (CRUD操作、承認フロー)                              │
└──────┬──────────────────────────────────────────────┘
       │
       ├───→ [D4: changes]
       ├───→ [D5: logs]
       │
       │     関連アプリ情報
       └───→ [D2: apps] (参照)

┌─────────────────────────────────────────────────────┐
│  7.0                                                │
│  監査ログ管理                                        │
│  (検索、フィルタ、エクスポート)                       │
└──────┬──────────────────────────────────────────────┘
       │
       ├───→ [D5: logs] (参照)
       │
       │     CSVファイル
       └───→ ファイルシステム

┌─────────────────────────────────────────────────────┐
│  8.0                                                │
│  システム設定                                        │
│  (API設定、セキュリティ設定)                         │
└──────┬──────────────────────────────────────────────┘
       │
       ├───→ [D6: settings]
       └───→ [D5: logs]
```

---

## 3. データモデル

### 3.1 エンティティ関係図（ER図）

```
┌─────────────────────┐
│ users               │
├─────────────────────┤
│ id (PK)             │
│ username            │
│ email (UNIQUE)      │
│ password_hash       │
│ department          │
│ role                │
│ status              │
│ lastLogin           │
│ createdAt           │
│ updatedAt           │
└──────────┬──────────┘
           │ 1
           │
           │ 作成者
           │
           ├──────────────────────────┐
           │ N                        │ N
           ▼                          ▼
┌──────────────────────┐    ┌──────────────────────┐
│ apps                 │    │ incidents            │
├──────────────────────┤    ├──────────────────────┤
│ id (PK)              │    │ id (PK)              │
│ name                 │◄───┤ appId (FK)           │
│ description          │ 1  │ title                │
│ category             │    │ description          │
│ creator (FK)         │    │ priority             │
│ recordCount          │ N  │ status               │
│ status               │    │ category             │
│ createdAt            │    │ reporter (FK)        │
│ updatedAt            │    │ assignee (FK)        │
└──────────┬───────────┘    │ createdAt            │
           │                │ updatedAt            │
           │ 1              │ closedAt             │
           │                └──────────────────────┘
           │
           │
           │ N
           ▼
┌──────────────────────┐
│ changes              │
├──────────────────────┤
│ id (PK)              │
│ title                │
│ description          │
│ appId (FK)           │
│ type                 │
│ status               │
│ risk                 │
│ requester (FK)       │
│ approver (FK)        │
│ implementer (FK)     │
│ scheduledDate        │
│ implementedDate      │
│ createdAt            │
│ updatedAt            │
└──────────────────────┘

┌──────────────────────┐
│ logs                 │
├──────────────────────┤
│ id (PK)              │
│ timestamp            │
│ userId (FK)          │
│ action               │
│ target               │
│ details              │
└──────────────────────┘

┌──────────────────────┐
│ settings             │
├──────────────────────┤
│ key (PK)             │
│ value                │
│ category             │
│ description          │
│ updatedAt            │
└──────────────────────┘
```

---

### 3.2 データストア詳細

#### localStorageキー構造

| キー名 | データ型 | 説明 |
|--------|---------|------|
| `appsuite_users` | Array<User> | ユーザー一覧 |
| `appsuite_apps` | Array<App> | アプリ一覧 |
| `appsuite_incidents` | Array<Incident> | インシデント一覧 |
| `appsuite_changes` | Array<Change> | 変更要求一覧 |
| `appsuite_logs` | Array<Log> | 監査ログ一覧 |
| `appsuite_settings` | Object<string, any> | システム設定 |

#### データサイズ推定

| エンティティ | 1件あたりサイズ | 想定件数 | 合計 |
|------------|---------------|---------|------|
| users | 500 bytes | 1,000 | ~500KB |
| apps | 400 bytes | 500 | ~200KB |
| incidents | 600 bytes | 10,000 | ~6MB |
| changes | 700 bytes | 1,000 | ~700KB |
| logs | 300 bytes | 10,000 | ~3MB |
| settings | - | - | ~10KB |

**合計推定**: ~10MB（localStorage制限: 通常5-10MB）

---

## 4. 画面遷移図

### 4.1 主要画面フロー

```
                    ┌─────────────┐
                    │ログイン画面 │
                    └──────┬──────┘
                           │
                           │ 認証成功
                           ▼
          ┌────────────────────────────────┐
          │     ダッシュボード（ホーム）      │
          └────┬───┬───┬───┬───┬───┬───┬──┘
               │   │   │   │   │   │   │
       ┌───────┘   │   │   │   │   │   └──────┐
       │           │   │   │   │   │          │
       ▼           ▼   ▼   ▼   ▼   ▼          ▼
┌────────────┐ ┌───────┐ ┌────────┐ ┌──────┐ ┌────────┐
│ユーザー管理│ │アプリ │ │インシデ│ │変更  │ │監査ログ│
│            │ │管理   │ │ント管理│ │管理  │ │        │
└─────┬──────┘ └───┬───┘ └───┬────┘ └───┬──┘ └───┬────┘
      │            │         │          │        │
      ▼            ▼         ▼          ▼        ▼
┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐
│ユーザー   │ │アプリ     │ │インシデント│ │変更詳細   │
│詳細/編集  │ │詳細/編集  │ │詳細/編集   │ │/承認      │
└───────────┘ └───────────┘ └───────────┘ └───────────┘

                           ┌────────────────┐
                           │システム設定    │
                           └────────────────┘
```

---

### 4.2 インシデント管理詳細フロー

```
  ┌──────────────────┐
  │インシデント一覧  │
  └─────────┬────────┘
            │
    ┌───────┼───────┐
    │       │       │
    ▼       ▼       ▼
┌───────┐ ┌──────┐ ┌──────────┐
│検索   │ │フィル│ │新規登録  │
│       │ │タ    │ │          │
└───┬───┘ └───┬──┘ └─────┬────┘
    │         │         │
    └─────────┼─────────┘
              │
              ▼
    ┌──────────────────┐
    │インシデント詳細  │
    └─────────┬────────┘
              │
      ┌───────┼───────┐
      │       │       │
      ▼       ▼       ▼
  ┌──────┐ ┌──────┐ ┌──────┐
  │編集  │ │コメント│ │ステータス│
  │      │ │追加  │ │変更  │
  └──────┘ └──────┘ └──┬───┘
                       │
                       ▼
                 ┌──────────┐
                 │クローズ  │
                 │確認      │
                 └──────────┘
```

---

## 📊 データフロー統計

### プロセス数
- **レベル0**: 1プロセス（システム全体）
- **レベル1**: 8プロセス（主要機能）
- **レベル2**: 36プロセス（詳細機能）

### データストア数
- **エンティティ**: 6種類
- **リレーションシップ**: 8種類

### 画面数
- **メイン画面**: 8画面
- **モーダル/詳細画面**: 15画面
- **合計**: 23画面

---

## ✅ レビューチェックリスト

- [ ] システム構成図が明確
- [ ] データフロー図の階層が適切
- [ ] データモデルに矛盾がない
- [ ] 画面遷移がユーザー視点で自然
- [ ] 全エンティティが定義されている
- [ ] データストアのサイズ見積もりが妥当
- [ ] ステークホルダーレビュー完了

---

**承認**: _____________
**日付**: _____________
**次のステップ**: モックアップ作成 → 要件定義書完成
